var Ms=Object.defineProperty;var Ns=(o,e,n)=>e in o?Ms(o,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):o[e]=n;var be=(o,e,n)=>Ns(o,typeof e!="symbol"?e+"":e,n);import{d as pe,u as ke,c as fe,r as F,B as tt,C as ue,o as Te,a as v,b as m,F as re,g as S,f as B,p as Ue,h as ne,i as r,t as c,e as s,w as se,m as ce,n as oe,q as de,D as lt,E as Lt,l as ie,G as st,H as Os,I as Se,J as ts,z as Ge,j as ve,T as Be,K as Ye,M as ss,A as Pe,v as Ls,N as ns,O as Qe,y as os,P as Bs,_ as qs}from"./index-CLAS9M60.js";import{I as P,_ as me}from"./_plugin-vue_export-helper-5Q0MvTjn.js";import{s as H,P as Ze,u as as}from"./sidebar-DWahxiba.js";import{M as js,A as Vs,T as Hs,u as ls,a as Gs}from"./useMessage-DMu2HOdM.js";import{L as Bt}from"./llm-check-BVkAKrj3.js";import{L as Ws}from"./LanguageSwitcher-D5AKI7s9.js";class Fe{static async getCoordinatorToolConfig(){try{const e=await fetch(`${this.BASE_URL}/config`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!e.ok)throw new Error(`Failed to get coordinator tool config: ${e.status}`);return await e.json()}catch(e){return console.error("Failed to get CoordinatorTool configuration:",e),{enabled:!0,success:!1,message:e.message}}}static async getAllEndpoints(){try{const e=await fetch(`${this.BASE_URL}/endpoints`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!e.ok)throw new Error(`Failed to get endpoints: ${e.status}`);return await e.json()}catch(e){throw console.error("Failed to get endpoints:",e),new Error("Failed to get endpoints: "+e.message)}}static async getCoordinatorToolsByTemplate(e){console.log("[CoordinatorToolApiService] Starting to get coordinator tool, planTemplateId:",e),console.log("[CoordinatorToolApiService] Request URL:",`${this.BASE_URL}/get-get-or-new-by-template/${e}`);try{const n=await fetch(`${this.BASE_URL}/get-or-new-by-template/${e}`,{method:"GET",headers:{"Content-Type":"application/json"}});if(console.log("[CoordinatorToolApiService] Response status:",n.status),console.log("[CoordinatorToolApiService] Response status text:",n.statusText),n.status===404)return console.log("[CoordinatorToolApiService] 404"),null;if(!n.ok){const a=await n.text();throw console.error("[CoordinatorToolApiService] Response error content:",a),new Error(`Failed to get coordinator tools: ${n.status} - ${a}`)}const t=await n.json();return console.log("[CoordinatorToolApiService] Successfully got coordinator tool, result:",t),t}catch(n){throw console.error("[CoordinatorToolApiService] Failed to get coordinator tool:",n),new Error("Failed to get coordinator tool: "+n.message)}}static async getOrNewCoordinatorToolsByTemplate(e){console.log("[CoordinatorToolApiService] Starting to get or create coordinator tool, planTemplateId:",e),console.log("[CoordinatorToolApiService] Request URL:",`${this.BASE_URL}/get-or-new-by-template/${e}`);try{const n=await fetch(`${this.BASE_URL}/get-or-new-by-template/${e}`,{method:"GET",headers:{"Content-Type":"application/json"}});if(console.log("[CoordinatorToolApiService] Response status:",n.status),console.log("[CoordinatorToolApiService] Response status text:",n.statusText),!n.ok){const a=await n.text();throw console.error("[CoordinatorToolApiService] Response error content:",a),new Error(`Failed to get coordinator tools: ${n.status} - ${a}`)}const t=await n.json();return console.log("[CoordinatorToolApiService] Successfully got coordinator tool, result:",t),t}catch(n){throw console.error("[CoordinatorToolApiService] Failed to get coordinator tool:",n),new Error("Failed to get coordinator tool: "+n.message)}}static async createCoordinatorTool(e){console.log("[CoordinatorToolApiService] Starting to create coordinator tool"),console.log("[CoordinatorToolApiService] Original data:",JSON.stringify(e,null,2)),console.log("[CoordinatorToolApiService] Request URL:",`${this.BASE_URL}`);const n={id:e.id,toolName:e.toolName,toolDescription:e.toolDescription,inputSchema:e.inputSchema,planTemplateId:e.planTemplateId,httpEndpoint:e.httpEndpoint,mcpEndpoint:e.mcpEndpoint,serviceGroup:e.serviceGroup,enableInternalToolcall:e.enableInternalToolcall,enableHttpService:e.enableHttpService,enableMcpService:e.enableMcpService};console.log("[CoordinatorToolApiService] Cleaned sending data:",JSON.stringify(n,null,2));try{const t=await fetch(`${this.BASE_URL}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});if(console.log("[CoordinatorToolApiService] Response status:",t.status),console.log("[CoordinatorToolApiService] Response status text:",t.statusText),!t.ok){let l="Unknown error";try{const i=await t.json();l=i.message||i.error||l}catch{l=await t.text()||l}throw console.error("[CoordinatorToolApiService] Response error content:",l),new Error(`Failed to create coordinator tool: ${t.status} - ${l}`)}const a=await t.json();return console.log("[CoordinatorToolApiService] Created successfully, result:",a),a}catch(t){throw console.error("[CoordinatorToolApiService] Failed to create coordinator tool:",t),new Error("Failed to create coordinator tool: "+t.message)}}static async updateCoordinatorTool(e,n){console.log("[CoordinatorToolApiService] Starting to update coordinator tool, ID:",e),console.log("[CoordinatorToolApiService] Sending data:",n),console.log("[CoordinatorToolApiService] Request URL:",`${this.BASE_URL}/${e}`);const t={id:n.id,toolName:n.toolName,toolDescription:n.toolDescription,inputSchema:n.inputSchema,planTemplateId:n.planTemplateId,httpEndpoint:n.httpEndpoint,mcpEndpoint:n.mcpEndpoint,serviceGroup:n.serviceGroup,enableInternalToolcall:n.enableInternalToolcall,enableHttpService:n.enableHttpService,enableMcpService:n.enableMcpService};console.log("[CoordinatorToolApiService] Cleaned sending data:",t);try{const a=await fetch(`${this.BASE_URL}/${e}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(console.log("[CoordinatorToolApiService] Response status:",a.status),console.log("[CoordinatorToolApiService] Response status text:",a.statusText),!a.ok){let i="Unknown error";try{const p=await a.json();i=p.message||p.error||i}catch{i=await a.text()||i}throw console.error("[CoordinatorToolApiService] Response error content:",i),new Error(`Failed to update coordinator tool: ${a.status} - ${i}`)}const l=await a.json();return console.log("[CoordinatorToolApiService] Updated successfully, result:",l),l}catch(a){throw console.error("[CoordinatorToolApiService] Failed to update coordinator tool:",a),new Error("Failed to update coordinator tool: "+a.message)}}static async deleteCoordinatorTool(e){console.log("[CoordinatorToolApiService] Starting to delete coordinator tool, ID:",e),console.log("[CoordinatorToolApiService] Request URL:",`${this.BASE_URL}/${e}`);try{const n=await fetch(`${this.BASE_URL}/${e}`,{method:"DELETE",headers:{"Content-Type":"application/json"}});if(console.log("[CoordinatorToolApiService] Response status:",n.status),console.log("[CoordinatorToolApiService] Response status text:",n.statusText),!n.ok){const a=await n.text();throw console.error("[CoordinatorToolApiService] Response error content:",a),new Error(`Failed to delete coordinator tool: ${n.status} - ${a}`)}const t=await n.json();return console.log("[CoordinatorToolApiService] Deleted successfully, result:",t),t}catch(n){throw console.error("[CoordinatorToolApiService] Failed to delete coordinator tool:",n),new Error("Failed to delete coordinator tool: "+n.message)}}}be(Fe,"BASE_URL","/api/coordinator-tools");class Dt{static async getParameterRequirements(e){try{const n=await fetch(`${this.BASE_URL}/${e}/parameters`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!n.ok)throw new Error(`Failed to get parameter requirements: ${n.statusText}`);return await n.json()}catch(n){throw console.error("Error getting parameter requirements:",n),n}}}be(Dt,"BASE_URL","/api/plan-template");const zs={class:"modal-form wide-modal"},Js={class:"form-section"},Ks={class:"form-item"},Xs=["placeholder"],Ys={class:"field-description"},Qs={class:"form-section"},Zs={class:"form-item"},en=["placeholder"],tn={class:"field-description"},sn={class:"form-section"},nn={class:"form-item"},on=["placeholder"],an={class:"field-description"},ln={class:"form-section"},rn={class:"section-title"},cn={key:0,class:"params-help-text"},dn={class:"parameter-table"},un=["onUpdate:modelValue","placeholder","readonly"],pn=["onUpdate:modelValue","placeholder"],mn={class:"form-section"},hn={class:"service-publish-options"},fn={class:"internal-toolcall-publish-option"},vn={class:"checkbox-label"},gn={class:"checkbox-text"},bn={class:"checkbox-description"},yn={class:"http-publish-option"},_n={class:"checkbox-label"},$n={class:"checkbox-text"},wn={class:"checkbox-description"},Sn={class:"mcp-publish-option"},kn={class:"checkbox-label"},Tn={class:"checkbox-text"},Pn={class:"checkbox-description"},En={key:0,class:"form-section"},Cn={class:"form-item"},Rn={class:"endpoint-description"},In={class:"endpoint-container"},An={class:"endpoint-row"},xn={class:"custom-select"},Dn={class:"select-input-container"},Fn={class:"input-content"},Un=["placeholder"],Mn={class:"dropdown-header"},Nn={class:"select-options"},On=["onClick"],Ln={class:"option-name"},Bn={class:"manual-input-section"},qn={class:"manual-input-container"},jn=["placeholder"],Vn={key:0,class:"form-item url-item"},Hn={class:"url-container"},Gn=["title"],Wn={class:"url-text"},zn={class:"button-container"},Jn=["disabled"],Kn=["disabled"],Xn=pe({__name:"PublishServiceModal",props:{modelValue:{type:Boolean,default:!1},planTemplateId:{default:""},planTitle:{default:""},planDescription:{default:""}},emits:["update:modelValue","published"],setup(o,{expose:e,emit:n}){const{t}=ke(),a=o,l=n,i=fe({get:()=>a.modelValue,set:G=>l("update:modelValue",G)}),p=F(""),g=F(""),d=F(!1),u=F(!1),k=F([]),C=F(""),U=F(!1),_=F("bottom"),y=F(""),h=F(null),b=F(!1),T=F(!1),$=F(!1),R=F(!0),f=F({parameters:[],hasParameters:!1,requirements:""}),q=F(!1),x=tt({serviceName:"",userRequest:"",endpoint:"",serviceGroup:"",parameters:[]}),te=fe(()=>{const G=h.value&&h.value.id;return t(G?"mcpService.updateService":"mcpService.createService")}),D=()=>{x.serviceName="",x.userRequest=a.planDescription||"",x.endpoint="",x.serviceGroup="",f.value.hasParameters||(x.parameters=[]),h.value=null,C.value="",b.value=!1},M=async()=>{try{k.value=await Fe.getAllEndpoints()}catch(G){console.error("Failed to load endpoints:",G),w(t("mcpService.loadEndpointsFailed")+": "+G.message,"error")}},z=async()=>{if(!a.planTemplateId){f.value={parameters:[],hasParameters:!1,requirements:""};return}q.value=!0;try{const G=await Dt.getParameterRequirements(a.planTemplateId);f.value=G,G.hasParameters&&(x.parameters=G.parameters.map(X=>({name:X,description:""})))}catch(G){console.error("[PublishModal] Failed to load parameter requirements:",G),G instanceof Error&&!G.message.includes("404")&&console.warn("[PublishModal] Parameter requirements not available yet, will retry later"),f.value={parameters:[],hasParameters:!1,requirements:""}}finally{q.value=!1}},Q=()=>{U.value||E(),U.value=!U.value},E=()=>{const G=document.querySelector(".custom-select");if(!G)return;const X=G.getBoundingClientRect(),K=window.innerHeight;X.bottom+200>K?_.value="top":_.value="bottom"},A=G=>{x.endpoint=G,U.value=!1,y.value=""},J=()=>{if(y.value.trim()){const G=y.value.trim().replace(/[^a-zA-Z0-9_/]/g,"");G&&(x.endpoint=G,k.value.includes(G)||k.value.push(G),U.value=!1,y.value="")}},Y=()=>{setTimeout(()=>{y.value.trim()&&J()},200)},ae=()=>{k.value.includes(x.endpoint)&&A(x.endpoint)},j=()=>{k.value.includes(x.endpoint)&&A(x.endpoint)},Z=()=>{k.value.includes(x.endpoint)&&A(x.endpoint)},V=async()=>{if(C.value)try{await navigator.clipboard.writeText(C.value),w(t("common.copy")+" "+t("common.success"),"success")}catch(G){console.error("Copy failed:",G),w(t("common.copy")+" "+t("common.error"),"error")}},w=(G,X)=>{X==="success"?(g.value=G,setTimeout(()=>{g.value=""},3e3)):X==="error"&&(p.value=G,setTimeout(()=>{p.value=""},5e3))},W=()=>{if(!x.serviceName||!x.serviceName.trim())return w(t("mcpService.toolNameRequiredError"),"error"),!1;if(!x.userRequest||!x.userRequest.trim())return w(t("mcpService.toolDescriptionRequiredError"),"error"),!1;if(!x.serviceGroup||!x.serviceGroup.trim())return w(t("mcpService.serviceGroupRequiredError"),"error"),!1;if(T.value&&(!x.endpoint||!x.endpoint.trim()))return w(t("mcpService.endpointRequiredError"),"error"),!1;if(!R.value&&!$.value&&!T.value)return w("Please select at least one service type","error"),!1;for(let G=0;G<x.parameters.length;G++){const X=x.parameters[G];if(X.name&&!X.description.trim())return w(`Parameter "${X.name}" description cannot be empty`,"error"),!1;if(X.description&&!X.name.trim())return w(`Parameter description "${X.description}" corresponding name cannot be empty`,"error"),!1}return!0},N=async()=>{if(console.log("[PublishModal] Starting to handle publish request"),console.log("[PublishModal] Form data:",x),console.log("[PublishModal] Current tool:",h.value),console.log("[PublishModal] Publish as MCP service:",T.value),console.log("[PublishModal] Publish as HTTP service:",$.value),!W()){console.log("[PublishModal] Form validation failed");return}d.value=!0;try{h.value||(console.log("[PublishModal] No current tool data, getting or creating first"),h.value=await Fe.getOrNewCoordinatorToolsByTemplate(a.planTemplateId)),console.log("[PublishModal] Updating tool information"),h.value.toolName=x.serviceName.trim(),h.value.toolDescription=x.userRequest.trim(),h.value.serviceGroup=x.serviceGroup.trim(),h.value.planTemplateId=a.planTemplateId,h.value.enableInternalToolcall=R.value,h.value.enableHttpService=$.value,h.value.enableMcpService=T.value,T.value?h.value.mcpEndpoint=x.endpoint.trim():h.value.mcpEndpoint=void 0;const G=x.parameters.filter(K=>K.name.trim()&&K.description.trim()).map(K=>({name:K.name.trim(),description:K.description.trim(),type:"string"}));if(h.value.inputSchema=JSON.stringify(G),console.log("[PublishModal] Updated tool information:",h.value),h.value.id)console.log("[PublishModal] Updating existing tool, ID:",h.value.id),await Fe.updateCoordinatorTool(h.value.id,h.value);else{console.log("[PublishModal] Creating new tool");const K=await Fe.createCoordinatorTool(h.value);h.value=K}const X=[];if(R.value&&X.push("Internal Method Call"),$.value&&X.push("HTTP Service"),T.value&&X.push("MCP Service"),X.length>0){console.log("[PublishModal] Step 5: Publishing service, ID:",h.value.id,"Enabled services:",X.join(", "));const K=[];if(T.value&&h.value.mcpEndpoint){const _e=window.location.origin;K.push(`MCP: ${_e}/mcp${h.value.mcpEndpoint}`)}R.value&&K.push(`Internal Call: ${x.serviceName}`),C.value=K.join(`
`),console.log("[PublishModal] Service published successfully, service URLs:",C.value),w(t("mcpService.publishSuccess"),"success"),l("published",h.value)}else console.log("[PublishModal] Only saving tool, not publishing as any service"),w(t("mcpService.saveSuccess"),"success"),l("published",h.value)}catch(G){console.error("[PublishModal] Failed to publish service:",G),w(t("mcpService.publishFailed")+": "+G.message,"error")}finally{d.value=!1}},O=async()=>{if(!u.value&&confirm(t("mcpService.deleteConfirmMessage"))){if(!h.value||!h.value.id){w(t("mcpService.deleteFailed")+": "+t("mcpService.selectPlanTemplateFirst"),"error");return}u.value=!0;try{console.log("[PublishModal] Starting to delete MCP service, ID:",h.value.id);const G=await Fe.deleteCoordinatorTool(h.value.id);if(G.success)console.log("[PublishModal] Deleted successfully"),w(t("mcpService.deleteSuccess"),"success"),i.value=!1,l("published",null);else throw new Error(G.message)}catch(G){console.error("[PublishModal] Failed to delete MCP service:",G),w(t("mcpService.deleteFailed")+": "+G.message,"error")}finally{u.value=!1}}},L=async()=>{i.value&&(console.log("[PublishModal] Modal opened, starting to initialize data"),D(),await M(),await le())},le=async()=>{if(!a.planTemplateId){console.log("[PublishModal] "+t("mcpService.noPlanTemplateId"));return}try{console.log("[PublishModal] Starting to load coordinator tool data, planTemplateId:",a.planTemplateId);const G=await Fe.getOrNewCoordinatorToolsByTemplate(a.planTemplateId);console.log("[PublishModal] Get coordinator tool data result:",G),h.value=G,b.value=!!G.id;const X=[];if(G.enableMcpService&&G.mcpEndpoint){const K=window.location.origin;X.push(`MCP: ${K}/mcp${G.mcpEndpoint}`)}G.enableInternalToolcall&&X.push(`Internal Call: ${G.toolName}`),C.value=X.join(`
`),console.log("[PublishModal] Load tool data - endpointUrl:",C.value),x.serviceName=G.toolName||"",x.userRequest=G.toolDescription||a.planDescription||"",x.serviceGroup=G.serviceGroup||"",T.value=G.enableMcpService||!1,$.value=G.enableHttpService||!1,R.value=G.enableInternalToolcall||!1,G.enableMcpService&&(x.endpoint=G.mcpEndpoint||"");try{if(G.inputSchema){const K=JSON.parse(G.inputSchema);Array.isArray(K)&&K.length>0?(x.parameters=K.map(_e=>({name:_e.name||"",description:_e.description||""})),console.log("[PublishModal] Load parameters from inputSchema:",x.parameters)):console.log("[PublishModal] inputSchema is empty, keeping existing parameters:",x.parameters)}}catch(K){console.warn("[PublishModal] "+t("mcpService.parseInputSchemaFailed")+":",K),console.log("[PublishModal] Parsing failed, keeping existing parameters:",x.parameters)}console.log("[PublishModal] Form data filled:",x)}catch(G){console.error("[PublishModal] "+t("mcpService.loadToolDataFailed")+":",G),w(t("mcpService.loadToolDataFailed")+": "+G.message,"error")}};return ue(()=>a.modelValue,L),ue(()=>a.planTemplateId,(G,X)=>{G&&G!==X&&(X&&G.startsWith("planTemplate-")?setTimeout(()=>{z()},1e3):z())}),Te(async()=>{i.value&&(console.log("[PublishModal] Initialize when component mounted"),D(),await M(),await le(),await z())}),e({loadParameterRequirements:z}),(G,X)=>(m(),v(re,null,[S(js,{modelValue:i.value,"onUpdate:modelValue":X[11]||(X[11]=K=>i.value=K),title:te.value,onConfirm:N},{footer:Ue(()=>{var K;return[s("div",zn,[b.value&&((K=h.value)!=null&&K.id)?(m(),v("button",{key:0,class:"action-btn danger",onClick:O,disabled:u.value},[u.value?(m(),ie(r(P),{key:0,icon:"carbon:loading",class:"loading-icon"})):(m(),ie(r(P),{key:1,icon:"carbon:trash-can"})),ne(" "+c(u.value?r(t)("mcpService.deleting"):r(t)("mcpService.delete")),1)],8,Jn)):B("",!0),s("button",{class:"action-btn primary",onClick:N,disabled:d.value},[d.value?(m(),ie(r(P),{key:0,icon:"carbon:loading",class:"loading-icon"})):(m(),ie(r(P),{key:1,icon:"carbon:cloud-upload"})),ne(" "+c(d.value?r(t)("mcpService.publishing"):r(t)("mcpService.publishAsService")),1)],8,Kn)])]}),default:Ue(()=>[s("div",zs,[s("div",Js,[s("div",Ks,[s("label",null,c(r(t)("mcpService.toolNameRequired")),1),se(s("input",{type:"text","onUpdate:modelValue":X[0]||(X[0]=K=>x.serviceName=K),placeholder:r(t)("mcpService.toolNamePlaceholder"),class:oe({error:!x.serviceName||!x.serviceName.trim()}),required:""},null,10,Xs),[[ce,x.serviceName]]),s("div",Ys,c(r(t)("mcpService.toolNameDescription")),1)])]),s("div",Qs,[s("div",Zs,[s("label",null,c(r(t)("mcpService.toolDescriptionRequired")),1),se(s("textarea",{"onUpdate:modelValue":X[1]||(X[1]=K=>x.userRequest=K),placeholder:r(t)("mcpService.toolDescriptionPlaceholder"),class:oe([{error:!x.userRequest||!x.userRequest.trim()},"description-field"]),rows:"4",required:""},null,10,en),[[ce,x.userRequest]]),s("div",tn,c(r(t)("mcpService.toolDescriptionDescription")),1)])]),s("div",sn,[s("div",nn,[s("label",null,c(r(t)("mcpService.serviceGroup")),1),se(s("input",{type:"text","onUpdate:modelValue":X[2]||(X[2]=K=>x.serviceGroup=K),placeholder:r(t)("mcpService.serviceGroupPlaceholder"),class:oe({error:!x.serviceGroup||!x.serviceGroup.trim()}),required:""},null,10,on),[[ce,x.serviceGroup]]),s("div",an,c(r(t)("mcpService.serviceGroupDescription")),1)])]),s("div",ln,[s("div",rn,c(r(t)("mcpService.parameterConfig")),1),f.value.hasParameters?(m(),v("div",cn,c(r(t)("sidebar.parameterRequirementsHelp")),1)):B("",!0),s("div",dn,[s("table",null,[s("thead",null,[s("tr",null,[s("th",null,c(r(t)("mcpService.parameterName")),1),s("th",null,c(r(t)("mcpService.parameterDescription")),1)])]),s("tbody",null,[(m(!0),v(re,null,de(x.parameters,(K,_e)=>(m(),v("tr",{key:_e},[s("td",null,[se(s("input",{type:"text","onUpdate:modelValue":xe=>K.name=xe,placeholder:r(t)("mcpService.parameterName"),class:oe(["parameter-input",{"readonly-input":f.value.hasParameters}]),readonly:f.value.hasParameters,required:""},null,10,un),[[ce,K.name]])]),s("td",null,[se(s("input",{type:"text","onUpdate:modelValue":xe=>K.description=xe,placeholder:r(t)("mcpService.parameterDescription"),class:"parameter-input",required:""},null,8,pn),[[ce,K.description]])])]))),128))])])])]),s("div",mn,[s("div",hn,[s("div",fn,[s("label",vn,[se(s("input",{type:"checkbox","onUpdate:modelValue":X[3]||(X[3]=K=>R.value=K),class:"checkbox-input"},null,512),[[lt,R.value]]),s("span",gn,c(r(t)("mcpService.publishAsInternalToolcall")),1)]),s("div",bn,c(r(t)("mcpService.publishAsInternalToolcallDescription")),1)]),s("div",yn,[s("label",_n,[se(s("input",{type:"checkbox","onUpdate:modelValue":X[4]||(X[4]=K=>$.value=K),class:"checkbox-input"},null,512),[[lt,$.value]]),s("span",$n,c(r(t)("mcpService.publishAsHttpService")),1)]),s("div",wn,c(r(t)("mcpService.publishAsHttpServiceDescription")),1)]),s("div",Sn,[s("label",kn,[se(s("input",{type:"checkbox","onUpdate:modelValue":X[5]||(X[5]=K=>T.value=K),class:"checkbox-input"},null,512),[[lt,T.value]]),s("span",Tn,c(r(t)("mcpService.publishAsMcpService")),1)]),s("div",Pn,c(r(t)("mcpService.publishAsMcpServiceDescription")),1),T.value?(m(),v("div",En,[s("div",Cn,[s("label",null,c(r(t)("mcpService.endpointRequired")),1),s("div",Rn,c(r(t)("mcpService.endpointDescription")),1),s("div",In,[s("div",An,[s("div",xn,[s("div",Dn,[s("div",Fn,[S(r(P),{icon:"carbon:application",width:"16",class:"input-icon"}),se(s("input",{type:"text","onUpdate:modelValue":X[6]||(X[6]=K=>x.endpoint=K),placeholder:r(t)("mcpService.endpointPlaceholder"),class:"select-input",onFocus:X[7]||(X[7]=K=>U.value=!0),onInput:ae,onKeydown:Lt(j,["enter"]),onBlur:Z},null,40,Un),[[ce,x.endpoint]])]),s("button",{class:"select-arrow-btn",onClick:Q,title:"Expand Options"},[S(r(P),{icon:U.value?"carbon:chevron-up":"carbon:chevron-down",width:"14",class:"chevron"},null,8,["icon"])])]),U.value?(m(),v("div",{key:0,class:oe(["select-dropdown",{"dropdown-top":_.value==="top"}])},[s("div",Mn,[s("span",null,c(r(t)("mcpService.selectEndpoint")),1),s("button",{class:"close-btn",onClick:X[8]||(X[8]=K=>U.value=!1)},[S(r(P),{icon:"carbon:close",width:"12"})])]),s("div",Nn,[(m(!0),v(re,null,de(k.value,K=>(m(),v("button",{key:K,class:oe(["select-option",{active:x.endpoint===K}]),onClick:_e=>A(K)},[s("span",Ln,c(K),1),x.endpoint===K?(m(),ie(r(P),{key:0,icon:"carbon:checkmark",width:"14",class:"check-icon"})):B("",!0)],10,On))),128))]),s("div",Bn,[s("div",qn,[se(s("input",{type:"text","onUpdate:modelValue":X[9]||(X[9]=K=>y.value=K),placeholder:r(t)("mcpService.manualInput"),class:"manual-input",onKeydown:Lt(J,["enter"]),onBlur:Y},null,40,jn),[[ce,y.value]]),s("button",{class:"add-manual-btn",onClick:J},[S(r(P),{icon:"carbon:add",width:"14"})])])])],2)):B("",!0),U.value?(m(),v("div",{key:1,class:"backdrop",onClick:X[10]||(X[10]=K=>U.value=!1)})):B("",!0)])])])]),C.value?(m(),v("div",Vn,[s("label",null,c(r(t)("mcpService.mcpStreamableUrl")),1),s("div",Hn,[s("div",{class:"url-display",onDblclick:V,title:r(t)("mcpService.copyUrl")+": "+C.value},[s("span",Wn,c(C.value||r(t)("mcpService.mcpStreamableUrlPlaceholder")),1),S(r(P),{icon:"carbon:copy",width:"16",class:"copy-icon"})],40,Gn)])])):B("",!0)])):B("",!0)])])])])]),_:1},8,["modelValue","title"]),p.value?(m(),v("div",{key:0,class:"error-toast",onClick:X[12]||(X[12]=K=>p.value="")},[S(r(P),{icon:"carbon:error"}),ne(" "+c(p.value),1)])):B("",!0),g.value?(m(),v("div",{key:1,class:"success-toast",onClick:X[13]||(X[13]=K=>g.value="")},[S(r(P),{icon:"carbon:checkmark"}),ne(" "+c(g.value),1)])):B("",!0)],64))}}),Yn=me(Xn,[["__scopeId","data-v-bd88743f"]]);function rs(o,e){const n=F(!1),t=tt({title:"",steps:[],directResponse:!1,planTemplateId:o.currentPlanTemplateId||"",planType:"dynamic_agent"}),a=h=>{try{if(!h){Object.assign(t,{title:"",steps:[],directResponse:!1,planTemplateId:o.currentPlanTemplateId||"",planType:"dynamic_agent"});return}const b=JSON.parse(h);t.title=b.title||"",t.directResponse=!1,t.planTemplateId=b.planTemplateId||o.currentPlanTemplateId||"",t.planType=b.planType||"dynamic_agent",t.steps=(b.steps||[]).map(T=>({stepRequirement:T.stepRequirement||"",agentName:T.agentName||"",modelName:T.modelName||null,selectedToolKeys:T.selectedToolKeys||[],terminateColumns:T.terminateColumns||""}))}catch(b){console.warn("Failed to parse JSON content:",b)}},l=()=>{try{const h={title:t.title,steps:t.steps.map(b=>({stepRequirement:b.stepRequirement,agentName:b.agentName,modelName:b.modelName||"",selectedToolKeys:b.selectedToolKeys,terminateColumns:b.terminateColumns})),directResponse:t.directResponse,planTemplateId:t.planTemplateId,planType:t.planType};return JSON.stringify(h,null,2)}catch(h){return console.error("Failed to convert visual data to JSON:",h),"{}"}},i=fe(()=>l());return ue(()=>o.jsonContent,h=>{a(h)},{immediate:!0}),ue(t,()=>{const h=l();e("update:jsonContent",h)},{deep:!0}),ue(()=>o.currentPlanTemplateId,h=>{h&&(t.planTemplateId=h)}),{showJsonPreview:n,displayData:t,formattedJsonOutput:i,addStep:()=>{const h={stepRequirement:"",agentName:"ConfigurableDynaAgent",modelName:null,selectedToolKeys:[],terminateColumns:"",agentType:"",stepContent:""};t.steps.push(h)},removeStep:h=>{h>=0&&h<t.steps.length&&t.steps.splice(h,1)},moveStepUp:h=>{if(h>0){const b=t.steps.splice(h,1)[0];t.steps.splice(h-1,0,b)}},moveStepDown:h=>{if(h<t.steps.length-1){const b=t.steps.splice(h,1)[0];t.steps.splice(h+1,0,b)}},toggleJsonPreview:()=>{n.value=!n.value},closeJsonPreview:()=>{n.value=!1},handleRollback:()=>{e("rollback")},handleRestore:()=>{e("restore")},handleSave:()=>{e("save")}}}const Qn={class:"config-section"},Zn={class:"section-header"},eo={class:"visual-editor"},to={class:"plan-basic-info"},so={class:"form-row"},no={class:"form-label"},oo=["placeholder"],ao={class:"steps-section"},lo={class:"steps-header"},ro={class:"form-label"},io={class:"steps-container"},co={class:"step-header"},uo={class:"step-number"},po={class:"step-actions"},mo=["onClick","disabled","title"],ho=["onClick","disabled","title"],fo=["onClick","title"],vo={class:"step-content"},go={class:"form-row"},bo={class:"form-label"},yo={class:"agent-selector"},_o=["onUpdate:modelValue"],$o={value:""},wo=["title"],So={class:"form-row"},ko={class:"form-label"},To=["onUpdate:modelValue","placeholder"],Po={class:"form-row"},Eo={class:"form-label"},Co=["onUpdate:modelValue","placeholder"],Ro={key:0,class:"empty-steps"},Io={class:"plan-id-section"},Ao={class:"form-row"},xo={class:"form-label"},Do={key:0,class:"json-preview"},Fo={class:"preview-header"},Uo={class:"form-label"},Mo={class:"json-code"},No={class:"editor-footer"},Oo={class:"section-actions"},Lo=["disabled","title"],Bo=["disabled","title"],qo=["disabled"],jo=pe({__name:"JsonEditor",props:{jsonContent:{},canRollback:{type:Boolean},canRestore:{type:Boolean},isGenerating:{type:Boolean},isExecuting:{type:Boolean},hiddenFields:{default:()=>["currentPlanId","userRequest","rootPlanId"]},currentPlanTemplateId:{}},emits:["rollback","restore","save","update:jsonContent"],setup(o,{emit:e}){const n=o,t=e,{showJsonPreview:a,displayData:l,formattedJsonOutput:i,addStep:p,removeStep:g,moveStepUp:d,moveStepDown:u,handleRollback:k,handleRestore:C,handleSave:U,toggleJsonPreview:_,closeJsonPreview:y}=rs(n,t),h=b=>{const T=b.target;if(!T)return;T.style.height="auto";const $=20,R=Math.ceil(T.scrollHeight/$),f=4,q=12,x=Math.max(f,Math.min(q,R)),te=x*$;T.style.height=`${te}px`,T.rows=x,R>q?T.style.overflowY="auto":T.style.overflowY="hidden"};return(b,T)=>(m(),v("div",Qn,[s("div",Zn,[S(r(P),{icon:"carbon:code",width:"16"}),s("span",null,c(b.$t("sidebar.jsonTemplate")),1)]),s("div",eo,[s("div",to,[s("div",so,[s("label",no,c(b.$t("sidebar.title")),1),se(s("input",{"onUpdate:modelValue":T[0]||(T[0]=$=>r(l).title=$),type:"text",class:"form-input",placeholder:b.$t("sidebar.titlePlaceholder")},null,8,oo),[[ce,r(l).title]])])]),s("div",ao,[s("div",lo,[s("label",ro,c(b.$t("sidebar.tasks")),1)]),s("div",io,[(m(!0),v(re,null,de(r(l).steps,($,R)=>(m(),v("div",{key:R,class:"step-item"},[s("div",co,[s("span",uo,c(b.$t("sidebar.subtask"))+" "+c(R+1),1),s("div",po,[s("button",{onClick:f=>r(d)(R),disabled:R===0,class:"btn btn-xs",title:b.$t("sidebar.moveUp")},[S(r(P),{icon:"carbon:chevron-up",width:"12"})],8,mo),s("button",{onClick:f=>r(u)(R),disabled:R===r(l).steps.length-1,class:"btn btn-xs",title:b.$t("sidebar.moveDown")},[S(r(P),{icon:"carbon:chevron-down",width:"12"})],8,ho),s("button",{onClick:f=>r(g)(R),class:"btn btn-xs btn-danger",title:b.$t("sidebar.removeStep")},[S(r(P),{icon:"carbon:trash-can",width:"12"})],8,fo)])]),s("div",vo,[s("div",go,[s("label",bo,c(b.$t("sidebar.agent")),1),s("div",yo,[se(s("select",{"onUpdate:modelValue":f=>$.agentName=f,class:"form-select agent-select"},[s("option",$o,c(b.$t("sidebar.selectAgent")),1),T[10]||(T[10]=Os('<option value="DEFAULT_AGENT" data-v-228d1ada>DEFAULT_AGENT</option><option value="BROWSER_AGENT" data-v-228d1ada>BROWSER_AGENT</option><option value="TEXT_FILE_AGENT" data-v-228d1ada>TEXT_FILE_AGENT</option><option value="JSX_GENERATOR_AGENT" data-v-228d1ada>JSX_GENERATOR_AGENT</option><option value="FILE_MANAGER_AGENT" data-v-228d1ada>FILE_MANAGER_AGENT</option>',5))],8,_o),[[st,$.agentName]]),s("button",{onClick:T[1]||(T[1]=(...f)=>r(p)&&r(p)(...f)),class:"btn btn-sm btn-add-step",title:b.$t("sidebar.addStep")},[S(r(P),{icon:"carbon:add",width:"14"})],8,wo)])]),s("div",So,[s("label",ko,c(b.$t("sidebar.stepRequirement")),1),se(s("textarea",{"onUpdate:modelValue":f=>$.stepContent=f,class:"form-textarea auto-resize",placeholder:b.$t("sidebar.stepRequirementPlaceholder"),rows:"4",onInput:T[2]||(T[2]=f=>h(f))},null,40,To),[[ce,$.stepContent]])]),s("div",Po,[s("label",Eo,c(b.$t("sidebar.terminateColumns")),1),se(s("input",{"onUpdate:modelValue":f=>$.terminateColumns=f,type:"text",class:"form-input",placeholder:b.$t("sidebar.terminateColumnsPlaceholder")},null,8,Co),[[ce,$.terminateColumns]])])])]))),128)),r(l).steps.length===0?(m(),v("div",Ro,[S(r(P),{icon:"carbon:add-alt",width:"32",class:"empty-icon"}),s("p",null,c(b.$t("sidebar.noSteps")),1),s("button",{onClick:T[3]||(T[3]=(...$)=>r(p)&&r(p)(...$)),class:"btn btn-primary"},[S(r(P),{icon:"carbon:add",width:"14"}),ne(" "+c(b.$t("sidebar.addFirstStep")),1)])])):B("",!0)])]),s("div",Io,[s("div",Ao,[s("label",xo,c(b.$t("sidebar.planId")),1),se(s("input",{"onUpdate:modelValue":T[4]||(T[4]=$=>r(l).planTemplateId=$),type:"text",class:"form-input",placeholder:"planTemplate-1756109892045"},null,512),[[ce,r(l).planTemplateId]])])]),r(a)?(m(),v("div",Do,[s("div",Fo,[s("label",Uo,c(b.$t("sidebar.jsonPreview")),1),s("button",{onClick:T[5]||(T[5]=(...$)=>r(y)&&r(y)(...$)),class:"btn btn-xs"},[S(r(P),{icon:"carbon:close",width:"12"})])]),s("pre",Mo,c(r(i)),1)])):B("",!0),s("div",No,[s("button",{onClick:T[6]||(T[6]=(...$)=>r(_)&&r(_)(...$)),class:"btn btn-sm btn-secondary"},[S(r(P),{icon:"carbon:code",width:"14"}),ne(" "+c(r(a)?b.$t("sidebar.hideJson"):b.$t("sidebar.showJson")),1)]),s("div",Oo,[s("button",{class:"btn btn-sm",onClick:T[7]||(T[7]=(...$)=>r(k)&&r(k)(...$)),disabled:!(b.canRollback??!1),title:b.$t("sidebar.rollback")},[S(r(P),{icon:"carbon:undo",width:"14"})],8,Lo),s("button",{class:"btn btn-sm",onClick:T[8]||(T[8]=(...$)=>r(C)&&r(C)(...$)),disabled:!(b.canRestore??!1),title:b.$t("sidebar.restore")},[S(r(P),{icon:"carbon:redo",width:"14"})],8,Bo),s("button",{class:"btn btn-primary",onClick:T[9]||(T[9]=(...$)=>r(U)&&r(U)(...$)),disabled:b.isGenerating||b.isExecuting},[S(r(P),{icon:"carbon:save",width:"14"}),T[11]||(T[11]=ne(" Save "))],8,qo)])])])]))}}),Vo=me(jo,[["__scopeId","data-v-228d1ada"]]);function is(o,e){return function(){return o.apply(e,arguments)}}const{toString:Ho}=Object.prototype,{getPrototypeOf:Ft}=Object,{iterator:mt,toStringTag:cs}=Symbol,ht=(o=>e=>{const n=Ho.call(e);return o[n]||(o[n]=n.slice(8,-1).toLowerCase())})(Object.create(null)),Ce=o=>(o=o.toLowerCase(),e=>ht(e)===o),ft=o=>e=>typeof e===o,{isArray:We}=Array,et=ft("undefined");function Go(o){return o!==null&&!et(o)&&o.constructor!==null&&!et(o.constructor)&&$e(o.constructor.isBuffer)&&o.constructor.isBuffer(o)}const ds=Ce("ArrayBuffer");function Wo(o){let e;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?e=ArrayBuffer.isView(o):e=o&&o.buffer&&ds(o.buffer),e}const zo=ft("string"),$e=ft("function"),us=ft("number"),vt=o=>o!==null&&typeof o=="object",Jo=o=>o===!0||o===!1,rt=o=>{if(ht(o)!=="object")return!1;const e=Ft(o);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(cs in o)&&!(mt in o)},Ko=Ce("Date"),Xo=Ce("File"),Yo=Ce("Blob"),Qo=Ce("FileList"),Zo=o=>vt(o)&&$e(o.pipe),ea=o=>{let e;return o&&(typeof FormData=="function"&&o instanceof FormData||$e(o.append)&&((e=ht(o))==="formdata"||e==="object"&&$e(o.toString)&&o.toString()==="[object FormData]"))},ta=Ce("URLSearchParams"),[sa,na,oa,aa]=["ReadableStream","Request","Response","Headers"].map(Ce),la=o=>o.trim?o.trim():o.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function nt(o,e,{allOwnKeys:n=!1}={}){if(o===null||typeof o>"u")return;let t,a;if(typeof o!="object"&&(o=[o]),We(o))for(t=0,a=o.length;t<a;t++)e.call(null,o[t],t,o);else{const l=n?Object.getOwnPropertyNames(o):Object.keys(o),i=l.length;let p;for(t=0;t<i;t++)p=l[t],e.call(null,o[p],p,o)}}function ps(o,e){e=e.toLowerCase();const n=Object.keys(o);let t=n.length,a;for(;t-- >0;)if(a=n[t],e===a.toLowerCase())return a;return null}const Le=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,ms=o=>!et(o)&&o!==Le;function Tt(){const{caseless:o}=ms(this)&&this||{},e={},n=(t,a)=>{const l=o&&ps(e,a)||a;rt(e[l])&&rt(t)?e[l]=Tt(e[l],t):rt(t)?e[l]=Tt({},t):We(t)?e[l]=t.slice():e[l]=t};for(let t=0,a=arguments.length;t<a;t++)arguments[t]&&nt(arguments[t],n);return e}const ra=(o,e,n,{allOwnKeys:t}={})=>(nt(e,(a,l)=>{n&&$e(a)?o[l]=is(a,n):o[l]=a},{allOwnKeys:t}),o),ia=o=>(o.charCodeAt(0)===65279&&(o=o.slice(1)),o),ca=(o,e,n,t)=>{o.prototype=Object.create(e.prototype,t),o.prototype.constructor=o,Object.defineProperty(o,"super",{value:e.prototype}),n&&Object.assign(o.prototype,n)},da=(o,e,n,t)=>{let a,l,i;const p={};if(e=e||{},o==null)return e;do{for(a=Object.getOwnPropertyNames(o),l=a.length;l-- >0;)i=a[l],(!t||t(i,o,e))&&!p[i]&&(e[i]=o[i],p[i]=!0);o=n!==!1&&Ft(o)}while(o&&(!n||n(o,e))&&o!==Object.prototype);return e},ua=(o,e,n)=>{o=String(o),(n===void 0||n>o.length)&&(n=o.length),n-=e.length;const t=o.indexOf(e,n);return t!==-1&&t===n},pa=o=>{if(!o)return null;if(We(o))return o;let e=o.length;if(!us(e))return null;const n=new Array(e);for(;e-- >0;)n[e]=o[e];return n},ma=(o=>e=>o&&e instanceof o)(typeof Uint8Array<"u"&&Ft(Uint8Array)),ha=(o,e)=>{const t=(o&&o[mt]).call(o);let a;for(;(a=t.next())&&!a.done;){const l=a.value;e.call(o,l[0],l[1])}},fa=(o,e)=>{let n;const t=[];for(;(n=o.exec(e))!==null;)t.push(n);return t},va=Ce("HTMLFormElement"),ga=o=>o.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(n,t,a){return t.toUpperCase()+a}),qt=(({hasOwnProperty:o})=>(e,n)=>o.call(e,n))(Object.prototype),ba=Ce("RegExp"),hs=(o,e)=>{const n=Object.getOwnPropertyDescriptors(o),t={};nt(n,(a,l)=>{let i;(i=e(a,l,o))!==!1&&(t[l]=i||a)}),Object.defineProperties(o,t)},ya=o=>{hs(o,(e,n)=>{if($e(o)&&["arguments","caller","callee"].indexOf(n)!==-1)return!1;const t=o[n];if($e(t)){if(e.enumerable=!1,"writable"in e){e.writable=!1;return}e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+n+"'")})}})},_a=(o,e)=>{const n={},t=a=>{a.forEach(l=>{n[l]=!0})};return We(o)?t(o):t(String(o).split(e)),n},$a=()=>{},wa=(o,e)=>o!=null&&Number.isFinite(o=+o)?o:e;function Sa(o){return!!(o&&$e(o.append)&&o[cs]==="FormData"&&o[mt])}const ka=o=>{const e=new Array(10),n=(t,a)=>{if(vt(t)){if(e.indexOf(t)>=0)return;if(!("toJSON"in t)){e[a]=t;const l=We(t)?[]:{};return nt(t,(i,p)=>{const g=n(i,a+1);!et(g)&&(l[p]=g)}),e[a]=void 0,l}}return t};return n(o,0)},Ta=Ce("AsyncFunction"),Pa=o=>o&&(vt(o)||$e(o))&&$e(o.then)&&$e(o.catch),fs=((o,e)=>o?setImmediate:e?((n,t)=>(Le.addEventListener("message",({source:a,data:l})=>{a===Le&&l===n&&t.length&&t.shift()()},!1),a=>{t.push(a),Le.postMessage(n,"*")}))(`axios@${Math.random()}`,[]):n=>setTimeout(n))(typeof setImmediate=="function",$e(Le.postMessage)),Ea=typeof queueMicrotask<"u"?queueMicrotask.bind(Le):typeof process<"u"&&process.nextTick||fs,Ca=o=>o!=null&&$e(o[mt]),I={isArray:We,isArrayBuffer:ds,isBuffer:Go,isFormData:ea,isArrayBufferView:Wo,isString:zo,isNumber:us,isBoolean:Jo,isObject:vt,isPlainObject:rt,isReadableStream:sa,isRequest:na,isResponse:oa,isHeaders:aa,isUndefined:et,isDate:Ko,isFile:Xo,isBlob:Yo,isRegExp:ba,isFunction:$e,isStream:Zo,isURLSearchParams:ta,isTypedArray:ma,isFileList:Qo,forEach:nt,merge:Tt,extend:ra,trim:la,stripBOM:ia,inherits:ca,toFlatObject:da,kindOf:ht,kindOfTest:Ce,endsWith:ua,toArray:pa,forEachEntry:ha,matchAll:fa,isHTMLForm:va,hasOwnProperty:qt,hasOwnProp:qt,reduceDescriptors:hs,freezeMethods:ya,toObjectSet:_a,toCamelCase:ga,noop:$a,toFiniteNumber:wa,findKey:ps,global:Le,isContextDefined:ms,isSpecCompliantForm:Sa,toJSONObject:ka,isAsyncFn:Ta,isThenable:Pa,setImmediate:fs,asap:Ea,isIterable:Ca};function ee(o,e,n,t,a){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=o,this.name="AxiosError",e&&(this.code=e),n&&(this.config=n),t&&(this.request=t),a&&(this.response=a,this.status=a.status?a.status:null)}I.inherits(ee,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:I.toJSONObject(this.config),code:this.code,status:this.status}}});const vs=ee.prototype,gs={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(o=>{gs[o]={value:o}});Object.defineProperties(ee,gs);Object.defineProperty(vs,"isAxiosError",{value:!0});ee.from=(o,e,n,t,a,l)=>{const i=Object.create(vs);return I.toFlatObject(o,i,function(g){return g!==Error.prototype},p=>p!=="isAxiosError"),ee.call(i,o.message,e,n,t,a),i.cause=o,i.name=o.name,l&&Object.assign(i,l),i};const Ra=null;function Pt(o){return I.isPlainObject(o)||I.isArray(o)}function bs(o){return I.endsWith(o,"[]")?o.slice(0,-2):o}function jt(o,e,n){return o?o.concat(e).map(function(a,l){return a=bs(a),!n&&l?"["+a+"]":a}).join(n?".":""):e}function Ia(o){return I.isArray(o)&&!o.some(Pt)}const Aa=I.toFlatObject(I,{},null,function(e){return/^is[A-Z]/.test(e)});function gt(o,e,n){if(!I.isObject(o))throw new TypeError("target must be an object");e=e||new FormData,n=I.toFlatObject(n,{metaTokens:!0,dots:!1,indexes:!1},!1,function(y,h){return!I.isUndefined(h[y])});const t=n.metaTokens,a=n.visitor||u,l=n.dots,i=n.indexes,g=(n.Blob||typeof Blob<"u"&&Blob)&&I.isSpecCompliantForm(e);if(!I.isFunction(a))throw new TypeError("visitor must be a function");function d(_){if(_===null)return"";if(I.isDate(_))return _.toISOString();if(!g&&I.isBlob(_))throw new ee("Blob is not supported. Use a Buffer instead.");return I.isArrayBuffer(_)||I.isTypedArray(_)?g&&typeof Blob=="function"?new Blob([_]):Buffer.from(_):_}function u(_,y,h){let b=_;if(_&&!h&&typeof _=="object"){if(I.endsWith(y,"{}"))y=t?y:y.slice(0,-2),_=JSON.stringify(_);else if(I.isArray(_)&&Ia(_)||(I.isFileList(_)||I.endsWith(y,"[]"))&&(b=I.toArray(_)))return y=bs(y),b.forEach(function($,R){!(I.isUndefined($)||$===null)&&e.append(i===!0?jt([y],R,l):i===null?y:y+"[]",d($))}),!1}return Pt(_)?!0:(e.append(jt(h,y,l),d(_)),!1)}const k=[],C=Object.assign(Aa,{defaultVisitor:u,convertValue:d,isVisitable:Pt});function U(_,y){if(!I.isUndefined(_)){if(k.indexOf(_)!==-1)throw Error("Circular reference detected in "+y.join("."));k.push(_),I.forEach(_,function(b,T){(!(I.isUndefined(b)||b===null)&&a.call(e,b,I.isString(T)?T.trim():T,y,C))===!0&&U(b,y?y.concat(T):[T])}),k.pop()}}if(!I.isObject(o))throw new TypeError("data must be an object");return U(o),e}function Vt(o){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(o).replace(/[!'()~]|%20|%00/g,function(t){return e[t]})}function Ut(o,e){this._pairs=[],o&&gt(o,this,e)}const ys=Ut.prototype;ys.append=function(e,n){this._pairs.push([e,n])};ys.toString=function(e){const n=e?function(t){return e.call(this,t,Vt)}:Vt;return this._pairs.map(function(a){return n(a[0])+"="+n(a[1])},"").join("&")};function xa(o){return encodeURIComponent(o).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function _s(o,e,n){if(!e)return o;const t=n&&n.encode||xa;I.isFunction(n)&&(n={serialize:n});const a=n&&n.serialize;let l;if(a?l=a(e,n):l=I.isURLSearchParams(e)?e.toString():new Ut(e,n).toString(t),l){const i=o.indexOf("#");i!==-1&&(o=o.slice(0,i)),o+=(o.indexOf("?")===-1?"?":"&")+l}return o}class Ht{constructor(){this.handlers=[]}use(e,n,t){return this.handlers.push({fulfilled:e,rejected:n,synchronous:t?t.synchronous:!1,runWhen:t?t.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){I.forEach(this.handlers,function(t){t!==null&&e(t)})}}const $s={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},Da=typeof URLSearchParams<"u"?URLSearchParams:Ut,Fa=typeof FormData<"u"?FormData:null,Ua=typeof Blob<"u"?Blob:null,Ma={isBrowser:!0,classes:{URLSearchParams:Da,FormData:Fa,Blob:Ua},protocols:["http","https","file","blob","url","data"]},Mt=typeof window<"u"&&typeof document<"u",Et=typeof navigator=="object"&&navigator||void 0,Na=Mt&&(!Et||["ReactNative","NativeScript","NS"].indexOf(Et.product)<0),Oa=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",La=Mt&&window.location.href||"http://localhost",Ba=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:Mt,hasStandardBrowserEnv:Na,hasStandardBrowserWebWorkerEnv:Oa,navigator:Et,origin:La},Symbol.toStringTag,{value:"Module"})),ye={...Ba,...Ma};function qa(o,e){return gt(o,new ye.classes.URLSearchParams,Object.assign({visitor:function(n,t,a,l){return ye.isNode&&I.isBuffer(n)?(this.append(t,n.toString("base64")),!1):l.defaultVisitor.apply(this,arguments)}},e))}function ja(o){return I.matchAll(/\w+|\[(\w*)]/g,o).map(e=>e[0]==="[]"?"":e[1]||e[0])}function Va(o){const e={},n=Object.keys(o);let t;const a=n.length;let l;for(t=0;t<a;t++)l=n[t],e[l]=o[l];return e}function ws(o){function e(n,t,a,l){let i=n[l++];if(i==="__proto__")return!0;const p=Number.isFinite(+i),g=l>=n.length;return i=!i&&I.isArray(a)?a.length:i,g?(I.hasOwnProp(a,i)?a[i]=[a[i],t]:a[i]=t,!p):((!a[i]||!I.isObject(a[i]))&&(a[i]=[]),e(n,t,a[i],l)&&I.isArray(a[i])&&(a[i]=Va(a[i])),!p)}if(I.isFormData(o)&&I.isFunction(o.entries)){const n={};return I.forEachEntry(o,(t,a)=>{e(ja(t),a,n,0)}),n}return null}function Ha(o,e,n){if(I.isString(o))try{return(e||JSON.parse)(o),I.trim(o)}catch(t){if(t.name!=="SyntaxError")throw t}return(n||JSON.stringify)(o)}const ot={transitional:$s,adapter:["xhr","http","fetch"],transformRequest:[function(e,n){const t=n.getContentType()||"",a=t.indexOf("application/json")>-1,l=I.isObject(e);if(l&&I.isHTMLForm(e)&&(e=new FormData(e)),I.isFormData(e))return a?JSON.stringify(ws(e)):e;if(I.isArrayBuffer(e)||I.isBuffer(e)||I.isStream(e)||I.isFile(e)||I.isBlob(e)||I.isReadableStream(e))return e;if(I.isArrayBufferView(e))return e.buffer;if(I.isURLSearchParams(e))return n.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let p;if(l){if(t.indexOf("application/x-www-form-urlencoded")>-1)return qa(e,this.formSerializer).toString();if((p=I.isFileList(e))||t.indexOf("multipart/form-data")>-1){const g=this.env&&this.env.FormData;return gt(p?{"files[]":e}:e,g&&new g,this.formSerializer)}}return l||a?(n.setContentType("application/json",!1),Ha(e)):e}],transformResponse:[function(e){const n=this.transitional||ot.transitional,t=n&&n.forcedJSONParsing,a=this.responseType==="json";if(I.isResponse(e)||I.isReadableStream(e))return e;if(e&&I.isString(e)&&(t&&!this.responseType||a)){const i=!(n&&n.silentJSONParsing)&&a;try{return JSON.parse(e)}catch(p){if(i)throw p.name==="SyntaxError"?ee.from(p,ee.ERR_BAD_RESPONSE,this,null,this.response):p}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:ye.classes.FormData,Blob:ye.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};I.forEach(["delete","get","head","post","put","patch"],o=>{ot.headers[o]={}});const Ga=I.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),Wa=o=>{const e={};let n,t,a;return o&&o.split(`
`).forEach(function(i){a=i.indexOf(":"),n=i.substring(0,a).trim().toLowerCase(),t=i.substring(a+1).trim(),!(!n||e[n]&&Ga[n])&&(n==="set-cookie"?e[n]?e[n].push(t):e[n]=[t]:e[n]=e[n]?e[n]+", "+t:t)}),e},Gt=Symbol("internals");function Xe(o){return o&&String(o).trim().toLowerCase()}function it(o){return o===!1||o==null?o:I.isArray(o)?o.map(it):String(o)}function za(o){const e=Object.create(null),n=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let t;for(;t=n.exec(o);)e[t[1]]=t[2];return e}const Ja=o=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(o.trim());function wt(o,e,n,t,a){if(I.isFunction(t))return t.call(this,e,n);if(a&&(e=n),!!I.isString(e)){if(I.isString(t))return e.indexOf(t)!==-1;if(I.isRegExp(t))return t.test(e)}}function Ka(o){return o.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,n,t)=>n.toUpperCase()+t)}function Xa(o,e){const n=I.toCamelCase(" "+e);["get","set","has"].forEach(t=>{Object.defineProperty(o,t+n,{value:function(a,l,i){return this[t].call(this,e,a,l,i)},configurable:!0})})}let we=class{constructor(e){e&&this.set(e)}set(e,n,t){const a=this;function l(p,g,d){const u=Xe(g);if(!u)throw new Error("header name must be a non-empty string");const k=I.findKey(a,u);(!k||a[k]===void 0||d===!0||d===void 0&&a[k]!==!1)&&(a[k||g]=it(p))}const i=(p,g)=>I.forEach(p,(d,u)=>l(d,u,g));if(I.isPlainObject(e)||e instanceof this.constructor)i(e,n);else if(I.isString(e)&&(e=e.trim())&&!Ja(e))i(Wa(e),n);else if(I.isObject(e)&&I.isIterable(e)){let p={},g,d;for(const u of e){if(!I.isArray(u))throw TypeError("Object iterator must return a key-value pair");p[d=u[0]]=(g=p[d])?I.isArray(g)?[...g,u[1]]:[g,u[1]]:u[1]}i(p,n)}else e!=null&&l(n,e,t);return this}get(e,n){if(e=Xe(e),e){const t=I.findKey(this,e);if(t){const a=this[t];if(!n)return a;if(n===!0)return za(a);if(I.isFunction(n))return n.call(this,a,t);if(I.isRegExp(n))return n.exec(a);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,n){if(e=Xe(e),e){const t=I.findKey(this,e);return!!(t&&this[t]!==void 0&&(!n||wt(this,this[t],t,n)))}return!1}delete(e,n){const t=this;let a=!1;function l(i){if(i=Xe(i),i){const p=I.findKey(t,i);p&&(!n||wt(t,t[p],p,n))&&(delete t[p],a=!0)}}return I.isArray(e)?e.forEach(l):l(e),a}clear(e){const n=Object.keys(this);let t=n.length,a=!1;for(;t--;){const l=n[t];(!e||wt(this,this[l],l,e,!0))&&(delete this[l],a=!0)}return a}normalize(e){const n=this,t={};return I.forEach(this,(a,l)=>{const i=I.findKey(t,l);if(i){n[i]=it(a),delete n[l];return}const p=e?Ka(l):String(l).trim();p!==l&&delete n[l],n[p]=it(a),t[p]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const n=Object.create(null);return I.forEach(this,(t,a)=>{t!=null&&t!==!1&&(n[a]=e&&I.isArray(t)?t.join(", "):t)}),n}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,n])=>e+": "+n).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...n){const t=new this(e);return n.forEach(a=>t.set(a)),t}static accessor(e){const t=(this[Gt]=this[Gt]={accessors:{}}).accessors,a=this.prototype;function l(i){const p=Xe(i);t[p]||(Xa(a,i),t[p]=!0)}return I.isArray(e)?e.forEach(l):l(e),this}};we.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);I.reduceDescriptors(we.prototype,({value:o},e)=>{let n=e[0].toUpperCase()+e.slice(1);return{get:()=>o,set(t){this[n]=t}}});I.freezeMethods(we);function St(o,e){const n=this||ot,t=e||n,a=we.from(t.headers);let l=t.data;return I.forEach(o,function(p){l=p.call(n,l,a.normalize(),e?e.status:void 0)}),a.normalize(),l}function Ss(o){return!!(o&&o.__CANCEL__)}function ze(o,e,n){ee.call(this,o??"canceled",ee.ERR_CANCELED,e,n),this.name="CanceledError"}I.inherits(ze,ee,{__CANCEL__:!0});function ks(o,e,n){const t=n.config.validateStatus;!n.status||!t||t(n.status)?o(n):e(new ee("Request failed with status code "+n.status,[ee.ERR_BAD_REQUEST,ee.ERR_BAD_RESPONSE][Math.floor(n.status/100)-4],n.config,n.request,n))}function Ya(o){const e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(o);return e&&e[1]||""}function Qa(o,e){o=o||10;const n=new Array(o),t=new Array(o);let a=0,l=0,i;return e=e!==void 0?e:1e3,function(g){const d=Date.now(),u=t[l];i||(i=d),n[a]=g,t[a]=d;let k=l,C=0;for(;k!==a;)C+=n[k++],k=k%o;if(a=(a+1)%o,a===l&&(l=(l+1)%o),d-i<e)return;const U=u&&d-u;return U?Math.round(C*1e3/U):void 0}}function Za(o,e){let n=0,t=1e3/e,a,l;const i=(d,u=Date.now())=>{n=u,a=null,l&&(clearTimeout(l),l=null),o.apply(null,d)};return[(...d)=>{const u=Date.now(),k=u-n;k>=t?i(d,u):(a=d,l||(l=setTimeout(()=>{l=null,i(a)},t-k)))},()=>a&&i(a)]}const ut=(o,e,n=3)=>{let t=0;const a=Qa(50,250);return Za(l=>{const i=l.loaded,p=l.lengthComputable?l.total:void 0,g=i-t,d=a(g),u=i<=p;t=i;const k={loaded:i,total:p,progress:p?i/p:void 0,bytes:g,rate:d||void 0,estimated:d&&p&&u?(p-i)/d:void 0,event:l,lengthComputable:p!=null,[e?"download":"upload"]:!0};o(k)},n)},Wt=(o,e)=>{const n=o!=null;return[t=>e[0]({lengthComputable:n,total:o,loaded:t}),e[1]]},zt=o=>(...e)=>I.asap(()=>o(...e)),el=ye.hasStandardBrowserEnv?((o,e)=>n=>(n=new URL(n,ye.origin),o.protocol===n.protocol&&o.host===n.host&&(e||o.port===n.port)))(new URL(ye.origin),ye.navigator&&/(msie|trident)/i.test(ye.navigator.userAgent)):()=>!0,tl=ye.hasStandardBrowserEnv?{write(o,e,n,t,a,l){const i=[o+"="+encodeURIComponent(e)];I.isNumber(n)&&i.push("expires="+new Date(n).toGMTString()),I.isString(t)&&i.push("path="+t),I.isString(a)&&i.push("domain="+a),l===!0&&i.push("secure"),document.cookie=i.join("; ")},read(o){const e=document.cookie.match(new RegExp("(^|;\\s*)("+o+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove(o){this.write(o,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function sl(o){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(o)}function nl(o,e){return e?o.replace(/\/?\/$/,"")+"/"+e.replace(/^\/+/,""):o}function Ts(o,e,n){let t=!sl(e);return o&&(t||n==!1)?nl(o,e):e}const Jt=o=>o instanceof we?{...o}:o;function je(o,e){e=e||{};const n={};function t(d,u,k,C){return I.isPlainObject(d)&&I.isPlainObject(u)?I.merge.call({caseless:C},d,u):I.isPlainObject(u)?I.merge({},u):I.isArray(u)?u.slice():u}function a(d,u,k,C){if(I.isUndefined(u)){if(!I.isUndefined(d))return t(void 0,d,k,C)}else return t(d,u,k,C)}function l(d,u){if(!I.isUndefined(u))return t(void 0,u)}function i(d,u){if(I.isUndefined(u)){if(!I.isUndefined(d))return t(void 0,d)}else return t(void 0,u)}function p(d,u,k){if(k in e)return t(d,u);if(k in o)return t(void 0,d)}const g={url:l,method:l,data:l,baseURL:i,transformRequest:i,transformResponse:i,paramsSerializer:i,timeout:i,timeoutMessage:i,withCredentials:i,withXSRFToken:i,adapter:i,responseType:i,xsrfCookieName:i,xsrfHeaderName:i,onUploadProgress:i,onDownloadProgress:i,decompress:i,maxContentLength:i,maxBodyLength:i,beforeRedirect:i,transport:i,httpAgent:i,httpsAgent:i,cancelToken:i,socketPath:i,responseEncoding:i,validateStatus:p,headers:(d,u,k)=>a(Jt(d),Jt(u),k,!0)};return I.forEach(Object.keys(Object.assign({},o,e)),function(u){const k=g[u]||a,C=k(o[u],e[u],u);I.isUndefined(C)&&k!==p||(n[u]=C)}),n}const Ps=o=>{const e=je({},o);let{data:n,withXSRFToken:t,xsrfHeaderName:a,xsrfCookieName:l,headers:i,auth:p}=e;e.headers=i=we.from(i),e.url=_s(Ts(e.baseURL,e.url,e.allowAbsoluteUrls),o.params,o.paramsSerializer),p&&i.set("Authorization","Basic "+btoa((p.username||"")+":"+(p.password?unescape(encodeURIComponent(p.password)):"")));let g;if(I.isFormData(n)){if(ye.hasStandardBrowserEnv||ye.hasStandardBrowserWebWorkerEnv)i.setContentType(void 0);else if((g=i.getContentType())!==!1){const[d,...u]=g?g.split(";").map(k=>k.trim()).filter(Boolean):[];i.setContentType([d||"multipart/form-data",...u].join("; "))}}if(ye.hasStandardBrowserEnv&&(t&&I.isFunction(t)&&(t=t(e)),t||t!==!1&&el(e.url))){const d=a&&l&&tl.read(l);d&&i.set(a,d)}return e},ol=typeof XMLHttpRequest<"u",al=ol&&function(o){return new Promise(function(n,t){const a=Ps(o);let l=a.data;const i=we.from(a.headers).normalize();let{responseType:p,onUploadProgress:g,onDownloadProgress:d}=a,u,k,C,U,_;function y(){U&&U(),_&&_(),a.cancelToken&&a.cancelToken.unsubscribe(u),a.signal&&a.signal.removeEventListener("abort",u)}let h=new XMLHttpRequest;h.open(a.method.toUpperCase(),a.url,!0),h.timeout=a.timeout;function b(){if(!h)return;const $=we.from("getAllResponseHeaders"in h&&h.getAllResponseHeaders()),f={data:!p||p==="text"||p==="json"?h.responseText:h.response,status:h.status,statusText:h.statusText,headers:$,config:o,request:h};ks(function(x){n(x),y()},function(x){t(x),y()},f),h=null}"onloadend"in h?h.onloadend=b:h.onreadystatechange=function(){!h||h.readyState!==4||h.status===0&&!(h.responseURL&&h.responseURL.indexOf("file:")===0)||setTimeout(b)},h.onabort=function(){h&&(t(new ee("Request aborted",ee.ECONNABORTED,o,h)),h=null)},h.onerror=function(){t(new ee("Network Error",ee.ERR_NETWORK,o,h)),h=null},h.ontimeout=function(){let R=a.timeout?"timeout of "+a.timeout+"ms exceeded":"timeout exceeded";const f=a.transitional||$s;a.timeoutErrorMessage&&(R=a.timeoutErrorMessage),t(new ee(R,f.clarifyTimeoutError?ee.ETIMEDOUT:ee.ECONNABORTED,o,h)),h=null},l===void 0&&i.setContentType(null),"setRequestHeader"in h&&I.forEach(i.toJSON(),function(R,f){h.setRequestHeader(f,R)}),I.isUndefined(a.withCredentials)||(h.withCredentials=!!a.withCredentials),p&&p!=="json"&&(h.responseType=a.responseType),d&&([C,_]=ut(d,!0),h.addEventListener("progress",C)),g&&h.upload&&([k,U]=ut(g),h.upload.addEventListener("progress",k),h.upload.addEventListener("loadend",U)),(a.cancelToken||a.signal)&&(u=$=>{h&&(t(!$||$.type?new ze(null,o,h):$),h.abort(),h=null)},a.cancelToken&&a.cancelToken.subscribe(u),a.signal&&(a.signal.aborted?u():a.signal.addEventListener("abort",u)));const T=Ya(a.url);if(T&&ye.protocols.indexOf(T)===-1){t(new ee("Unsupported protocol "+T+":",ee.ERR_BAD_REQUEST,o));return}h.send(l||null)})},ll=(o,e)=>{const{length:n}=o=o?o.filter(Boolean):[];if(e||n){let t=new AbortController,a;const l=function(d){if(!a){a=!0,p();const u=d instanceof Error?d:this.reason;t.abort(u instanceof ee?u:new ze(u instanceof Error?u.message:u))}};let i=e&&setTimeout(()=>{i=null,l(new ee(`timeout ${e} of ms exceeded`,ee.ETIMEDOUT))},e);const p=()=>{o&&(i&&clearTimeout(i),i=null,o.forEach(d=>{d.unsubscribe?d.unsubscribe(l):d.removeEventListener("abort",l)}),o=null)};o.forEach(d=>d.addEventListener("abort",l));const{signal:g}=t;return g.unsubscribe=()=>I.asap(p),g}},rl=function*(o,e){let n=o.byteLength;if(n<e){yield o;return}let t=0,a;for(;t<n;)a=t+e,yield o.slice(t,a),t=a},il=async function*(o,e){for await(const n of cl(o))yield*rl(n,e)},cl=async function*(o){if(o[Symbol.asyncIterator]){yield*o;return}const e=o.getReader();try{for(;;){const{done:n,value:t}=await e.read();if(n)break;yield t}}finally{await e.cancel()}},Kt=(o,e,n,t)=>{const a=il(o,e);let l=0,i,p=g=>{i||(i=!0,t&&t(g))};return new ReadableStream({async pull(g){try{const{done:d,value:u}=await a.next();if(d){p(),g.close();return}let k=u.byteLength;if(n){let C=l+=k;n(C)}g.enqueue(new Uint8Array(u))}catch(d){throw p(d),d}},cancel(g){return p(g),a.return()}},{highWaterMark:2})},bt=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",Es=bt&&typeof ReadableStream=="function",dl=bt&&(typeof TextEncoder=="function"?(o=>e=>o.encode(e))(new TextEncoder):async o=>new Uint8Array(await new Response(o).arrayBuffer())),Cs=(o,...e)=>{try{return!!o(...e)}catch{return!1}},ul=Es&&Cs(()=>{let o=!1;const e=new Request(ye.origin,{body:new ReadableStream,method:"POST",get duplex(){return o=!0,"half"}}).headers.has("Content-Type");return o&&!e}),Xt=64*1024,Ct=Es&&Cs(()=>I.isReadableStream(new Response("").body)),pt={stream:Ct&&(o=>o.body)};bt&&(o=>{["text","arrayBuffer","blob","formData","stream"].forEach(e=>{!pt[e]&&(pt[e]=I.isFunction(o[e])?n=>n[e]():(n,t)=>{throw new ee(`Response type '${e}' is not supported`,ee.ERR_NOT_SUPPORT,t)})})})(new Response);const pl=async o=>{if(o==null)return 0;if(I.isBlob(o))return o.size;if(I.isSpecCompliantForm(o))return(await new Request(ye.origin,{method:"POST",body:o}).arrayBuffer()).byteLength;if(I.isArrayBufferView(o)||I.isArrayBuffer(o))return o.byteLength;if(I.isURLSearchParams(o)&&(o=o+""),I.isString(o))return(await dl(o)).byteLength},ml=async(o,e)=>{const n=I.toFiniteNumber(o.getContentLength());return n??pl(e)},hl=bt&&(async o=>{let{url:e,method:n,data:t,signal:a,cancelToken:l,timeout:i,onDownloadProgress:p,onUploadProgress:g,responseType:d,headers:u,withCredentials:k="same-origin",fetchOptions:C}=Ps(o);d=d?(d+"").toLowerCase():"text";let U=ll([a,l&&l.toAbortSignal()],i),_;const y=U&&U.unsubscribe&&(()=>{U.unsubscribe()});let h;try{if(g&&ul&&n!=="get"&&n!=="head"&&(h=await ml(u,t))!==0){let f=new Request(e,{method:"POST",body:t,duplex:"half"}),q;if(I.isFormData(t)&&(q=f.headers.get("content-type"))&&u.setContentType(q),f.body){const[x,te]=Wt(h,ut(zt(g)));t=Kt(f.body,Xt,x,te)}}I.isString(k)||(k=k?"include":"omit");const b="credentials"in Request.prototype;_=new Request(e,{...C,signal:U,method:n.toUpperCase(),headers:u.normalize().toJSON(),body:t,duplex:"half",credentials:b?k:void 0});let T=await fetch(_);const $=Ct&&(d==="stream"||d==="response");if(Ct&&(p||$&&y)){const f={};["status","statusText","headers"].forEach(D=>{f[D]=T[D]});const q=I.toFiniteNumber(T.headers.get("content-length")),[x,te]=p&&Wt(q,ut(zt(p),!0))||[];T=new Response(Kt(T.body,Xt,x,()=>{te&&te(),y&&y()}),f)}d=d||"text";let R=await pt[I.findKey(pt,d)||"text"](T,o);return!$&&y&&y(),await new Promise((f,q)=>{ks(f,q,{data:R,headers:we.from(T.headers),status:T.status,statusText:T.statusText,config:o,request:_})})}catch(b){throw y&&y(),b&&b.name==="TypeError"&&/Load failed|fetch/i.test(b.message)?Object.assign(new ee("Network Error",ee.ERR_NETWORK,o,_),{cause:b.cause||b}):ee.from(b,b&&b.code,o,_)}}),Rt={http:Ra,xhr:al,fetch:hl};I.forEach(Rt,(o,e)=>{if(o){try{Object.defineProperty(o,"name",{value:e})}catch{}Object.defineProperty(o,"adapterName",{value:e})}});const Yt=o=>`- ${o}`,fl=o=>I.isFunction(o)||o===null||o===!1,Rs={getAdapter:o=>{o=I.isArray(o)?o:[o];const{length:e}=o;let n,t;const a={};for(let l=0;l<e;l++){n=o[l];let i;if(t=n,!fl(n)&&(t=Rt[(i=String(n)).toLowerCase()],t===void 0))throw new ee(`Unknown adapter '${i}'`);if(t)break;a[i||"#"+l]=t}if(!t){const l=Object.entries(a).map(([p,g])=>`adapter ${p} `+(g===!1?"is not supported by the environment":"is not available in the build"));let i=e?l.length>1?`since :
`+l.map(Yt).join(`
`):" "+Yt(l[0]):"as no adapter specified";throw new ee("There is no suitable adapter to dispatch the request "+i,"ERR_NOT_SUPPORT")}return t},adapters:Rt};function kt(o){if(o.cancelToken&&o.cancelToken.throwIfRequested(),o.signal&&o.signal.aborted)throw new ze(null,o)}function Qt(o){return kt(o),o.headers=we.from(o.headers),o.data=St.call(o,o.transformRequest),["post","put","patch"].indexOf(o.method)!==-1&&o.headers.setContentType("application/x-www-form-urlencoded",!1),Rs.getAdapter(o.adapter||ot.adapter)(o).then(function(t){return kt(o),t.data=St.call(o,o.transformResponse,t),t.headers=we.from(t.headers),t},function(t){return Ss(t)||(kt(o),t&&t.response&&(t.response.data=St.call(o,o.transformResponse,t.response),t.response.headers=we.from(t.response.headers))),Promise.reject(t)})}const Is="1.9.0",yt={};["object","boolean","number","function","string","symbol"].forEach((o,e)=>{yt[o]=function(t){return typeof t===o||"a"+(e<1?"n ":" ")+o}});const Zt={};yt.transitional=function(e,n,t){function a(l,i){return"[Axios v"+Is+"] Transitional option '"+l+"'"+i+(t?". "+t:"")}return(l,i,p)=>{if(e===!1)throw new ee(a(i," has been removed"+(n?" in "+n:"")),ee.ERR_DEPRECATED);return n&&!Zt[i]&&(Zt[i]=!0,console.warn(a(i," has been deprecated since v"+n+" and will be removed in the near future"))),e?e(l,i,p):!0}};yt.spelling=function(e){return(n,t)=>(console.warn(`${t} is likely a misspelling of ${e}`),!0)};function vl(o,e,n){if(typeof o!="object")throw new ee("options must be an object",ee.ERR_BAD_OPTION_VALUE);const t=Object.keys(o);let a=t.length;for(;a-- >0;){const l=t[a],i=e[l];if(i){const p=o[l],g=p===void 0||i(p,l,o);if(g!==!0)throw new ee("option "+l+" must be "+g,ee.ERR_BAD_OPTION_VALUE);continue}if(n!==!0)throw new ee("Unknown option "+l,ee.ERR_BAD_OPTION)}}const ct={assertOptions:vl,validators:yt},Ae=ct.validators;let qe=class{constructor(e){this.defaults=e||{},this.interceptors={request:new Ht,response:new Ht}}async request(e,n){try{return await this._request(e,n)}catch(t){if(t instanceof Error){let a={};Error.captureStackTrace?Error.captureStackTrace(a):a=new Error;const l=a.stack?a.stack.replace(/^.+\n/,""):"";try{t.stack?l&&!String(t.stack).endsWith(l.replace(/^.+\n.+\n/,""))&&(t.stack+=`
`+l):t.stack=l}catch{}}throw t}}_request(e,n){typeof e=="string"?(n=n||{},n.url=e):n=e||{},n=je(this.defaults,n);const{transitional:t,paramsSerializer:a,headers:l}=n;t!==void 0&&ct.assertOptions(t,{silentJSONParsing:Ae.transitional(Ae.boolean),forcedJSONParsing:Ae.transitional(Ae.boolean),clarifyTimeoutError:Ae.transitional(Ae.boolean)},!1),a!=null&&(I.isFunction(a)?n.paramsSerializer={serialize:a}:ct.assertOptions(a,{encode:Ae.function,serialize:Ae.function},!0)),n.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?n.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:n.allowAbsoluteUrls=!0),ct.assertOptions(n,{baseUrl:Ae.spelling("baseURL"),withXsrfToken:Ae.spelling("withXSRFToken")},!0),n.method=(n.method||this.defaults.method||"get").toLowerCase();let i=l&&I.merge(l.common,l[n.method]);l&&I.forEach(["delete","get","head","post","put","patch","common"],_=>{delete l[_]}),n.headers=we.concat(i,l);const p=[];let g=!0;this.interceptors.request.forEach(function(y){typeof y.runWhen=="function"&&y.runWhen(n)===!1||(g=g&&y.synchronous,p.unshift(y.fulfilled,y.rejected))});const d=[];this.interceptors.response.forEach(function(y){d.push(y.fulfilled,y.rejected)});let u,k=0,C;if(!g){const _=[Qt.bind(this),void 0];for(_.unshift.apply(_,p),_.push.apply(_,d),C=_.length,u=Promise.resolve(n);k<C;)u=u.then(_[k++],_[k++]);return u}C=p.length;let U=n;for(k=0;k<C;){const _=p[k++],y=p[k++];try{U=_(U)}catch(h){y.call(this,h);break}}try{u=Qt.call(this,U)}catch(_){return Promise.reject(_)}for(k=0,C=d.length;k<C;)u=u.then(d[k++],d[k++]);return u}getUri(e){e=je(this.defaults,e);const n=Ts(e.baseURL,e.url,e.allowAbsoluteUrls);return _s(n,e.params,e.paramsSerializer)}};I.forEach(["delete","get","head","options"],function(e){qe.prototype[e]=function(n,t){return this.request(je(t||{},{method:e,url:n,data:(t||{}).data}))}});I.forEach(["post","put","patch"],function(e){function n(t){return function(l,i,p){return this.request(je(p||{},{method:e,headers:t?{"Content-Type":"multipart/form-data"}:{},url:l,data:i}))}}qe.prototype[e]=n(),qe.prototype[e+"Form"]=n(!0)});let gl=class As{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let n;this.promise=new Promise(function(l){n=l});const t=this;this.promise.then(a=>{if(!t._listeners)return;let l=t._listeners.length;for(;l-- >0;)t._listeners[l](a);t._listeners=null}),this.promise.then=a=>{let l;const i=new Promise(p=>{t.subscribe(p),l=p}).then(a);return i.cancel=function(){t.unsubscribe(l)},i},e(function(l,i,p){t.reason||(t.reason=new ze(l,i,p),n(t.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const n=this._listeners.indexOf(e);n!==-1&&this._listeners.splice(n,1)}toAbortSignal(){const e=new AbortController,n=t=>{e.abort(t)};return this.subscribe(n),e.signal.unsubscribe=()=>this.unsubscribe(n),e.signal}static source(){let e;return{token:new As(function(a){e=a}),cancel:e}}};function bl(o){return function(n){return o.apply(null,n)}}function yl(o){return I.isObject(o)&&o.isAxiosError===!0}const It={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(It).forEach(([o,e])=>{It[e]=o});function xs(o){const e=new qe(o),n=is(qe.prototype.request,e);return I.extend(n,qe.prototype,e,{allOwnKeys:!0}),I.extend(n,e,null,{allOwnKeys:!0}),n.create=function(a){return xs(je(o,a))},n}const ge=xs(ot);ge.Axios=qe;ge.CanceledError=ze;ge.CancelToken=gl;ge.isCancel=Ss;ge.VERSION=Is;ge.toFormData=gt;ge.AxiosError=ee;ge.Cancel=ge.CanceledError;ge.all=function(e){return Promise.all(e)};ge.spread=bl;ge.isAxiosError=yl;ge.mergeConfig=je;ge.AxiosHeaders=we;ge.formToJSON=o=>ws(I.isHTMLForm(o)?new FormData(o):o);ge.getAdapter=Rs.getAdapter;ge.HttpStatusCode=It;ge.default=ge;const{Axios:vg,AxiosError:gg,CanceledError:bg,isCancel:yg,CancelToken:_g,VERSION:$g,all:wg,Cancel:Sg,isAxiosError:kg,spread:Tg,toFormData:Pg,AxiosHeaders:Eg,HttpStatusCode:Cg,formToJSON:Rg,getAdapter:Ig,mergeConfig:Ag}=ge;class _l{static async getAvailableModels(){try{return(await ge({url:"/api/models/available-models",method:"GET",baseURL:""})).data}catch(e){return console.error("Failed to fetch available models:",e),{options:[],total:0}}}}const $l={class:"config-section"},wl={class:"section-header"},Sl={key:0,class:"error-section"},kl={class:"error-message"},Tl={class:"error-content"},Pl={class:"error-title"},El={class:"error-description"},Cl={key:1,class:"visual-editor"},Rl={class:"plan-basic-info"},Il={class:"form-row"},Al={class:"form-label"},xl=["placeholder"],Dl={key:0,class:"field-error-message"},Fl={class:"form-row"},Ul={class:"form-label"},Ml=["value","placeholder"],Nl={class:"steps-section"},Ol={class:"steps-header"},Ll={class:"form-label"},Bl={class:"steps-actions"},ql=["title"],jl={class:"steps-container"},Vl={class:"step-header"},Hl={class:"step-number"},Gl={class:"step-actions"},Wl=["onClick","disabled","title"],zl=["onClick","disabled","title"],Jl=["onClick","title"],Kl={class:"step-content"},Xl={class:"form-row"},Yl={class:"form-label"},Ql=["onUpdate:modelValue","placeholder"],Zl={class:"form-row"},er={class:"form-label"},tr=["onUpdate:modelValue","placeholder"],sr={class:"form-row"},nr={class:"form-label"},or={class:"model-selector"},ar=["onUpdate:modelValue","disabled"],lr={key:0,disabled:"",value:""},rr={key:1,disabled:"",value:""},ir={value:"",disabled:""},cr={value:""},dr=["value","title"],ur=["title"],pr={key:0,class:"error-message"},mr={class:"form-row"},hr={key:0,class:"empty-steps"},fr={key:0,class:"json-preview"},vr={class:"preview-header"},gr={class:"form-label"},br={class:"json-code"},yr={class:"editor-footer"},_r={class:"section-actions"},$r=["disabled","title"],wr=["disabled","title"],Sr=["disabled"],kr=pe({__name:"JsonEditorV2",props:{jsonContent:{},canRollback:{type:Boolean},canRestore:{type:Boolean},isGenerating:{type:Boolean},isExecuting:{type:Boolean},hiddenFields:{default:()=>[]},currentPlanTemplateId:{default:""}},emits:["rollback","restore","save","update:jsonContent"],setup(o,{emit:e}){const n=o,t=e,{showJsonPreview:a,displayData:l,formattedJsonOutput:i,addStep:p,removeStep:g,moveStepUp:d,moveStepDown:u,handleRollback:k,handleRestore:C,handleSave:U,toggleJsonPreview:_,closeJsonPreview:y}=rs(n,t),h=F(null),b=F(""),T=F([]),$=F(!1),R=F(""),f=F(!1),q=F(-1),x=async()=>{if(!$.value){$.value=!0,R.value="";try{const E=await _l.getAvailableModels();E&&E.options?T.value=E.options:T.value=[]}catch(E){console.error("Failed to load models:",E),R.value=E instanceof Error?E.message:"Failed to load models",T.value=[]}finally{$.value=!1}}},te=E=>{q.value=E,f.value=!0,console.log("[JsonEditorV2] Available tools from store:",H.availableTools)},D=E=>{q.value>=0&&q.value<l.steps.length&&(l.steps[q.value].selectedToolKeys=[...E]),f.value=!1,q.value=-1},M=(E,A)=>{E>=0&&E<l.steps.length&&(l.steps[E].selectedToolKeys=[...A])},z=()=>{try{h.value=null,l.title||(l.title=""),l.steps||(l.steps=[]),l.directResponse=!1}catch(E){const A=`Failed to initialize JsonEditorV2: ${E instanceof Error?E.message:"Unknown error"}`;h.value=A,console.error(A,E)}};ue(()=>l,E=>{try{!E.title||!E.title.trim()?b.value="Title is required field":b.value="",h.value=null}catch(A){h.value=`Invalid data structure: ${A instanceof Error?A.message:"Unknown error"}`,b.value=""}},{immediate:!0,deep:!0}),Te(()=>{z(),x()});const Q=E=>{const A=E.target;if(!A)return;A.style.height="auto";const J=20,Y=Math.ceil(A.scrollHeight/J),ae=4,j=12,Z=Math.max(ae,Math.min(j,Y)),V=Z*J;A.style.height=`${V}px`,A.rows=Z,Y>j?A.style.overflowY="auto":A.style.overflowY="hidden"};return(E,A)=>{var J;return m(),v("div",$l,[s("div",wl,[S(r(P),{icon:"carbon:code",width:"16"}),s("span",null,c(E.$t("sidebar.dynamicAgentPlan")),1)]),h.value?(m(),v("div",Sl,[s("div",kl,[S(r(P),{icon:"carbon:warning",width:"16"}),s("div",Tl,[s("div",Pl,c(E.$t("sidebar.planTypeError")),1),s("div",El,c(h.value),1)])])])):(m(),v("div",Cl,[s("div",Rl,[s("div",Il,[s("label",Al,c(E.$t("sidebar.title")),1),se(s("input",{"onUpdate:modelValue":A[0]||(A[0]=Y=>r(l).title=Y),type:"text",class:oe(["form-input",{error:b.value}]),placeholder:E.$t("sidebar.titlePlaceholder")},null,10,xl),[[ce,r(l).title]]),b.value?(m(),v("div",Dl,[S(r(P),{icon:"carbon:warning",width:"12"}),ne(" "+c(b.value),1)])):B("",!0)]),s("div",Fl,[s("label",Ul,c(E.$t("sidebar.planTemplateId")),1),s("input",{value:E.currentPlanTemplateId,type:"text",class:"form-input readonly-input",readonly:"",placeholder:E.$t("sidebar.planTemplateIdPlaceholder")},null,8,Ml)])]),s("div",Nl,[s("div",Ol,[s("label",Ll,c(E.$t("sidebar.tasks")),1),s("div",Bl,[s("button",{onClick:A[1]||(A[1]=(...Y)=>r(p)&&r(p)(...Y)),class:"btn btn-xs",title:E.$t("sidebar.addStep")},[S(r(P),{icon:"carbon:add",width:"12"})],8,ql)])]),s("div",jl,[(m(!0),v(re,null,de(r(l).steps,(Y,ae)=>(m(),v("div",{key:ae,class:"step-item"},[s("div",Vl,[s("span",Hl,c(E.$t("sidebar.subtask"))+" "+c(ae+1),1),s("div",Gl,[s("button",{onClick:j=>r(d)(ae),disabled:ae===0,class:"btn btn-xs",title:E.$t("sidebar.moveUp")},[S(r(P),{icon:"carbon:chevron-up",width:"12"})],8,Wl),s("button",{onClick:j=>r(u)(ae),disabled:ae===r(l).steps.length-1,class:"btn btn-xs",title:E.$t("sidebar.moveDown")},[S(r(P),{icon:"carbon:chevron-down",width:"12"})],8,zl),s("button",{onClick:j=>r(g)(ae),class:"btn btn-xs btn-danger",title:E.$t("sidebar.removeStep")},[S(r(P),{icon:"carbon:trash-can",width:"12"})],8,Jl)])]),s("div",Kl,[s("div",Xl,[s("label",Yl,c(E.$t("sidebar.stepRequirement")),1),se(s("textarea",{"onUpdate:modelValue":j=>Y.stepRequirement=j,class:"form-textarea auto-resize",placeholder:E.$t("sidebar.stepRequirementPlaceholder"),rows:"4",onInput:A[2]||(A[2]=j=>Q(j))},null,40,Ql),[[ce,Y.stepRequirement]])]),s("div",Zl,[s("label",er,c(E.$t("sidebar.terminateColumns")),1),se(s("textarea",{"onUpdate:modelValue":j=>Y.terminateColumns=j,class:"form-textarea auto-resize",placeholder:E.$t("sidebar.terminateColumnsPlaceholder"),rows:"4",onInput:A[3]||(A[3]=j=>Q(j))},null,40,tr),[[ce,Y.terminateColumns]])]),s("div",sr,[s("label",nr,c(E.$t("sidebar.modelName")),1),s("div",or,[se(s("select",{"onUpdate:modelValue":j=>Y.modelName=j,class:"form-select model-select",disabled:$.value},[$.value?(m(),v("option",lr,c(E.$t("sidebar.loading")),1)):R.value?(m(),v("option",rr,c(E.$t("sidebar.modelLoadError")),1)):B("",!0),s("option",ir,c(E.$t("sidebar.modelNameDescription")),1),s("option",cr,c(E.$t("sidebar.noModelSelected")),1),(m(!0),v(re,null,de(T.value,j=>(m(),v("option",{key:j.value,value:j.value,title:j.label},c(j.label),9,dr))),128))],8,ar),[[st,Y.modelName]]),R.value?(m(),v("button",{key:0,onClick:x,class:"btn btn-sm btn-danger",title:E.$t("sidebar.retryLoadModels")},[S(r(P),{icon:"carbon:warning",width:"14"}),ne(" "+c(E.$t("sidebar.retry")),1)],8,ur)):B("",!0)]),R.value?(m(),v("div",pr,[S(r(P),{icon:"carbon:warning",width:"12"}),ne(" "+c(R.value),1)])):B("",!0)]),s("div",mr,[S(Vs,{title:E.$t("sidebar.selectedTools"),"selected-tool-ids":Y.selectedToolKeys,"available-tools":r(H).availableTools,"add-button-text":E.$t("sidebar.addRemoveTools"),"empty-text":E.$t("sidebar.noTools"),"use-grid-layout":!0,onAddTools:j=>te(ae),onToolsFiltered:j=>M(ae,j)},null,8,["title","selected-tool-ids","available-tools","add-button-text","empty-text","onAddTools","onToolsFiltered"])])])]))),128)),r(l).steps.length===0?(m(),v("div",hr,[S(r(P),{icon:"carbon:add-alt",width:"32",class:"empty-icon"}),s("p",null,c(E.$t("sidebar.noSteps")),1),s("button",{onClick:A[4]||(A[4]=(...Y)=>r(p)&&r(p)(...Y)),class:"btn btn-primary"},[S(r(P),{icon:"carbon:add",width:"14"}),ne(" "+c(E.$t("sidebar.addFirstStep")),1)])])):B("",!0)])]),r(a)?(m(),v("div",fr,[s("div",vr,[s("label",gr,c(E.$t("sidebar.jsonPreview")),1),s("button",{onClick:A[5]||(A[5]=(...Y)=>r(y)&&r(y)(...Y)),class:"btn btn-xs"},[S(r(P),{icon:"carbon:close",width:"12"})])]),s("pre",br,c(r(i)),1)])):B("",!0),s("div",yr,[s("button",{onClick:A[6]||(A[6]=(...Y)=>r(_)&&r(_)(...Y)),class:"btn btn-sm btn-secondary"},[S(r(P),{icon:"carbon:code",width:"14"}),ne(" "+c(r(a)?E.$t("sidebar.hideJson"):E.$t("sidebar.showJson")),1)]),s("div",_r,[s("button",{class:"btn btn-sm",onClick:A[7]||(A[7]=(...Y)=>r(k)&&r(k)(...Y)),disabled:!(E.canRollback??!1),title:E.$t("sidebar.rollback")},[S(r(P),{icon:"carbon:undo",width:"14"})],8,$r),s("button",{class:"btn btn-sm",onClick:A[8]||(A[8]=(...Y)=>r(C)&&r(C)(...Y)),disabled:!(E.canRestore??!1),title:E.$t("sidebar.restore")},[S(r(P),{icon:"carbon:redo",width:"14"})],8,wr),s("button",{class:"btn btn-primary",onClick:A[9]||(A[9]=(...Y)=>r(U)&&r(U)(...Y)),disabled:E.isGenerating||E.isExecuting},[S(r(P),{icon:"carbon:save",width:"14"}),A[11]||(A[11]=ne(" Save "))],8,Sr)])])])),S(Hs,{modelValue:f.value,"onUpdate:modelValue":A[10]||(A[10]=Y=>f.value=Y),tools:r(H).availableTools,"selected-tool-ids":q.value>=0?((J=r(l).steps[q.value])==null?void 0:J.selectedToolKeys)||[]:[],onConfirm:D},null,8,["modelValue","tools","selected-tool-ids"])])}}}),Tr=me(kr,[["__scopeId","data-v-575f3fe3"]]);class es{static async uploadFiles(e){try{console.log("[FileUploadApiService] Uploading files:",e.length);const n=new FormData;e.forEach(l=>{n.append("files",l)});const t=await fetch("/api/file-upload/upload",{method:"POST",body:n});if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const a=await t.json();return console.log("[FileUploadApiService] Files uploaded successfully:",a.successfulFiles,"uploadKey:",a.uploadKey),a}catch(n){throw console.error("[FileUploadApiService] Error uploading files:",n),n}}static async getUploadedFiles(e){try{console.log("[FileUploadApiService] Getting uploaded files for uploadKey:",e);const n=await fetch(`/api/file-upload/files/${encodeURIComponent(e)}`);if(!n.ok)throw new Error(`HTTP error! status: ${n.status}`);const t=await n.json();return console.log("[FileUploadApiService] Got uploaded files:",t.totalCount,"for uploadKey:",e),t}catch(n){throw console.error("[FileUploadApiService] Error getting uploaded files:",n),n}}static async deleteFile(e,n){try{console.log("[FileUploadApiService] Deleting file:",n,"from uploadKey:",e);const t=await fetch(`/api/file-upload/files/${encodeURIComponent(e)}/${encodeURIComponent(n)}`,{method:"DELETE",headers:{"Content-Type":"application/json"}});if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const a=await t.json();return console.log("[FileUploadApiService] File deleted successfully:",a.success),a}catch(t){throw console.error("[FileUploadApiService] Error deleting file:",t),t}}static async getUploadConfig(){try{console.log("[FileUploadApiService] Getting upload configuration");const e=await fetch("/api/file-upload/config");if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);const n=await e.json();return console.log("[FileUploadApiService] Got upload configuration:",n),n}catch(e){throw console.error("[FileUploadApiService] Error getting upload configuration:",e),e}}}const Pr={class:"file-upload-component"},Er=["accept"],Cr={key:0},Rr={key:1},Ir={key:0,class:"files-list"},Ar={class:"file-name"},xr={class:"file-size"},Dr=["onClick","title"],Fr={key:0,class:"upload-progress"},Ur=pe({__name:"FileUploadComponent",props:{acceptedFileTypes:{default:".pdf,.txt,.md,.doc,.docx,.csv,.xlsx,.xls,.json,.xml,.html,.htm,.log,.java,.py,.js,.ts,.sql,.sh,.bat,.yaml,.yml,.properties,.conf,.ini"},disabled:{type:Boolean,default:!1}},emits:["files-uploaded","files-removed","upload-key-changed","upload-started","upload-completed","upload-error"],setup(o,{expose:e,emit:n}){const{t}=ke(),a=o,l=n,i=F(),p=F([]),g=F(!1),d=F(null),u=()=>{console.log("[FileUpload] Resetting session and clearing uploadKey"),p.value=[],d.value=null,l("upload-key-changed",null)};Se(()=>{u()}),ue(()=>p.value,h=>{l("files-removed",h)},{deep:!0});const k=()=>{a.disabled||i.value&&i.value.click()},C=async h=>{const b=h.target,T=b.files;if(!T||T.length===0)return;const $=Array.from(T);console.log("[FileUpload] Selected files for upload:",$.map(R=>R.name)),await U($),b&&(b.value="")},U=async h=>{if(h.length!==0){g.value=!0,l("upload-started");try{const b=await es.uploadFiles(h);b.success&&b.uploadedFiles&&(!d.value&&b.uploadKey?(d.value=b.uploadKey,console.log("[FileUpload] Set uploadKey:",d.value),p.value=b.uploadedFiles):d.value?(console.log("[FileUpload] Using existing uploadKey:",d.value),p.value=[...p.value,...b.uploadedFiles]):(console.warn("[FileUpload] No uploadKey returned from upload"),p.value=b.uploadedFiles),b.uploadKey&&(d.value=b.uploadKey,console.log("[Input] Saved uploadKey locally:",b.uploadKey),l("upload-key-changed",d.value)),console.log("[Input] Updated global uploadedFiles state:",p.value),l("files-uploaded",p.value,d.value)),console.log("Files uploaded successfully:",b),l("upload-completed")}catch(b){console.error("File upload error:",b),l("upload-error",b)}finally{g.value=!1}}},_=async h=>{try{if(console.log("🗑️ Removing file:",h.originalName,"from uploadKey:",d),d.value){const b=await es.deleteFile(d.value,h.originalName);b.success?console.log("✅ File deleted from server successfully"):console.error("❌ Failed to delete file from server:",b.error)}p.value=p.value.filter(b=>b.originalName!==h.originalName),p.value.length===0&&(console.log("[FileUpload] 🧹 Clearing uploadKey to force new plan for new files"),d.value=null,l("upload-key-changed",null)),console.log("🎉 File removal completed, remaining files:",p.value.length)}catch(b){console.error("❌ Error removing file:",b),l("upload-error",b)}},y=h=>{if(h===0)return"0 Bytes";const b=1024,T=["Bytes","KB","MB","GB"],$=Math.floor(Math.log(h)/Math.log(b));return parseFloat((h/Math.pow(b,$)).toFixed(2))+" "+T[$]};return e({uploadedFiles:p,uploadKey:d,resetSession:u,uploadFiles:U,removeFile:_,isUploading:g}),(h,b)=>(m(),v("div",Pr,[s("input",{ref_key:"fileInputRef",ref:i,type:"file",multiple:"",style:{display:"none"},onChange:C,accept:h.acceptedFileTypes||""},null,40,Er),s("div",{class:oe(["uploaded-files",{"has-files":p.value.length>0}])},[s("div",{class:"files-header",onClick:k},[S(r(P),{icon:"carbon:attachment"}),p.value.length===0?(m(),v("span",Cr,c(r(t)("input.attachFile")),1)):(m(),v("span",Rr,c(r(t)("input.attachedFiles"))+" ("+c(p.value.length)+")",1))]),p.value.length>0?(m(),v("div",Ir,[(m(!0),v(re,null,de(p.value,T=>(m(),v("div",{key:T.originalName,class:"file-item"},[S(r(P),{icon:"carbon:document",class:"file-icon"}),s("span",Ar,c(T.originalName),1),s("span",xr,"("+c(y(T.size))+")",1),s("button",{onClick:$=>_(T),class:"remove-btn",title:r(t)("input.removeFile")},[S(r(P),{icon:"carbon:close"})],8,Dr)]))),128))])):B("",!0)],2),g.value?(m(),v("div",Fr,[S(r(P),{icon:"carbon:rotate--clockwise",class:"loading-icon"}),s("span",null,c(r(t)("input.uploading")),1)])):B("",!0)]))}}),Ds=me(Ur,[["__scopeId","data-v-e6b19bbb"]]),Mr={class:"config-section"},Nr={class:"section-header"},Or={class:"execution-content"},Lr={class:"params-requirements-group"},Br={class:"params-help-text"},qr={key:0,class:"parameter-fields"},jr={class:"parameter-label"},Vr=["onUpdate:modelValue","placeholder","onInput"],Hr={key:0,class:"parameter-error"},Gr={key:1,class:"validation-message"},Wr=["disabled"],zr=["disabled"],Jr={key:1,class:"call-example-wrapper"},Kr={class:"call-example-header"},Xr={class:"call-example-title"},Yr={class:"call-example-description"},Qr={class:"internal-call-wrapper"},Zr={class:"call-info"},ei={class:"call-method"},ti={class:"call-endpoint"},si={key:0,class:"call-endpoint"},ni={class:"call-description"},oi={class:"call-example"},ai={class:"example-code"},li={key:2,class:"call-example-wrapper"},ri={class:"call-example-header"},ii={class:"call-example-title"},ci={class:"call-example-description"},di={class:"http-api-urls-wrapper"},ui={class:"tab-container"},pi={class:"tab-header"},mi=["onClick"],hi={class:"tab-content"},fi={class:"http-api-url-display"},vi={class:"api-method"},gi={class:"api-endpoint"},bi={class:"api-description"},yi={key:0,class:"api-example"},_i={class:"example-code"},$i={key:3,class:"call-example-wrapper"},wi={class:"call-example-header"},Si={class:"call-example-title"},ki={class:"call-example-description"},Ti={class:"mcp-call-wrapper"},Pi={class:"call-info"},Ei={class:"call-method"},Ci={class:"call-endpoint"},Ri={class:"call-description"},Ii={class:"call-example"},Ai={class:"example-code"},xi=pe({__name:"ExecutionController",props:{currentPlanTemplateId:{default:""},isExecuting:{type:Boolean,default:!1},isGenerating:{type:Boolean,default:!1},showPublishButton:{type:Boolean,default:!0},toolInfo:{default:()=>({toolName:"",toolDescription:"",planTemplateId:"",inputSchema:"[]",enableHttpService:!1,enableMcpService:!1,enableInternalToolcall:!1,serviceGroup:""})}},emits:["executePlan","publishMcpService","clearParams","updateExecutionParams"],setup(o,{expose:e,emit:n}){const{t}=ke(),a=o,l=n,i=F(""),p=F({parameters:[],hasParameters:!1,requirements:""}),g=F({}),d=F(!1),u=F("get-sync"),k=F({}),C=F(!1),U=F(!1),_=F(),y=F([]),h=F(null),b=F([{id:"get-sync",label:"GET + Sync",method:"GET",endpoint:"/api/executor/executeByToolNameSync/{toolName}",description:"Synchronous GET request - returns execution result immediately",example:`GET /api/executor/executeByToolNameSync/my-tool?allParams={"rawParam":"test"}
Response: {
  "status": "completed",
  "result": "Execution result here"
}`},{id:"post-sync",label:"POST + Sync",method:"POST",endpoint:"/api/executor/executeByToolNameSync",description:"Synchronous POST request - returns execution result immediately",example:`POST /api/executor/executeByToolNameSync
Content-Type: application/json

{
  "toolName": "my-tool",
  "replacementParams": {
    "rawParam": "test"
  },
  "uploadedFiles": []
}

Response: {
  "status": "completed",
  "result": "Execution result here"
}`},{id:"post-async",label:"POST + Async",method:"POST",endpoint:"/api/executor/executeByToolNameAsync",description:"Asynchronous POST request - returns task ID, check status separately",example:`POST /api/executor/executeByToolNameAsync
Content-Type: application/json

{
  "toolName": "my-tool",
  "replacementParams": {
    "rawParam": "test"
  },
  "uploadedFiles": []
}

Response: {
  "planId": "plan-123",
  "status": "processing",
  "message": "Task submitted, processing",
  "memoryId": "ABC12345",
  "toolName": "my-tool",
  "planTemplateId": "template-456"
}

# Check execution status and get detailed results:
GET /api/executor/details/{planId}
Response: {
  "currentPlanId": "plan-123",
  "title": "Plan Title",
  "status": "completed",
  "summary": "Execution completed successfully",
  "agentExecutionSequence": [...],
  "userInputWaitState": null
}`}]),T=fe(()=>{var j,Z,V;return((j=a.toolInfo)==null?void 0:j.enableInternalToolcall)||((Z=a.toolInfo)==null?void 0:Z.enableHttpService)||((V=a.toolInfo)==null?void 0:V.enableMcpService)}),$=fe(()=>T.value?t("sidebar.updateServiceStatus"):t("sidebar.publishMcpService")),R=fe(()=>a.isExecuting||a.isGenerating?!1:p.value.hasParameters?p.value.parameters.every(j=>{var Z;return(Z=g.value[j])==null?void 0:Z.trim()}):!0),f=(j,Z)=>{y.value=j.map(V=>V.originalName),h.value=Z,console.log("[ExecutionController] Files uploaded:",j.length,"uploadKey:",Z)},q=j=>{y.value=j.map(Z=>Z.originalName),console.log("[ExecutionController] Files removed, remaining:",j.length)},x=j=>{h.value=j,console.log("[ExecutionController] Upload key changed:",j)},te=()=>{console.log("[ExecutionController] Upload started")},D=()=>{console.log("[ExecutionController] Upload completed")},M=j=>{console.error("[ExecutionController] Upload error:",j)},z=()=>{if(console.log("[ExecutionController] 🚀 Execute button clicked"),U.value=!0,console.log("[ExecutionController] 🔒 Set isExecutingPlan to true"),!Y()){console.log("[ExecutionController] ❌ Parameter validation failed:",k.value),U.value=!1;return}const j=p.value.hasParameters&&Object.keys(g.value).length>0?g.value:void 0;console.log("[ExecutionController] 🔄 Replacement params:",j);const Z={title:"",planData:{title:"",steps:[],directResponse:!1},params:void 0,replacementParams:j,uploadedFiles:y.value,uploadKey:h.value};console.log("[ExecutionController] 📤 Emitting executePlan with payload:",JSON.stringify(Z,null,2)),l("executePlan",Z)},Q=()=>{l("publishMcpService")},E=()=>{console.log("[ExecutionController] 🧹 clearExecutionParams called"),i.value="",g.value={},U.value=!1,console.log("[ExecutionController] 🔓 Reset isExecutingPlan to false"),console.log("[ExecutionController] ✅ After clear - parameterValues cleared"),l("clearParams")},A=async()=>{if(console.log("[ExecutionController] 🔄 loadParameterRequirements called for templateId:",a.currentPlanTemplateId),console.log("[ExecutionController] 📊 Current parameterRequirements before load:",JSON.stringify(p.value,null,2)),!a.currentPlanTemplateId){console.log("[ExecutionController] ❌ No template ID, resetting parameters"),p.value={parameters:[],hasParameters:!1,requirements:""},g.value={};return}d.value=!0;try{console.log("[ExecutionController] 🌐 Fetching parameter requirements from API...");const j=await Dt.getParameterRequirements(a.currentPlanTemplateId);console.log("[ExecutionController] 📥 Received requirements from API:",JSON.stringify(j,null,2)),p.value=j;const Z={};j.parameters.forEach(V=>{Z[V]=g.value[V]||""}),g.value=Z,console.log("[ExecutionController] ✅ Updated parameterRequirements:",JSON.stringify(p.value,null,2)),console.log("[ExecutionController] ✅ Updated parameterValues:",JSON.stringify(g.value,null,2)),ae()}catch(j){console.error("[ExecutionController] ❌ Failed to load parameter requirements:",j),j instanceof Error&&!j.message.includes("404")&&console.warn("[ExecutionController] ⚠️ Parameter requirements not available yet, will retry later"),p.value={parameters:[],hasParameters:!1,requirements:""},console.log("[ExecutionController] 🔄 Reset parameterRequirements due to error:",JSON.stringify(p.value,null,2))}finally{d.value=!1,console.log("[ExecutionController] ✅ loadParameterRequirements completed")}},J=(j,Z)=>{g.value[j]=Z,k.value[j]&&delete k.value[j],ae()},Y=()=>{if(k.value={},C.value=!1,!p.value.hasParameters)return!0;let j=!1;return p.value.parameters.forEach(Z=>{var w;((w=g.value[Z])==null?void 0:w.trim())||(k.value[Z]=`${Z} is required`,j=!0)}),C.value=j,!j},ae=()=>{p.value.hasParameters?i.value=JSON.stringify(g.value,null,2):i.value="",l("updateExecutionParams",i.value)};return ue(()=>a.currentPlanTemplateId,(j,Z)=>{if(j&&j!==Z){if(U.value){console.log("[ExecutionController] ⏸️ Skipping parameter reload - plan is executing");return}console.log("[ExecutionController] 🔄 Template ID changed, will reload parameters"),Z&&j.startsWith("planTemplate-")?(console.log("[ExecutionController] ⏰ New template detected, retrying with delay..."),setTimeout(()=>{console.log("[ExecutionController] ⏰ Delay timeout, calling loadParameterRequirements"),A()},1e3)):(console.log("[ExecutionController] 🚀 Immediate reload of parameters"),A())}}),ue(()=>i.value,j=>{l("updateExecutionParams",j)}),Te(()=>{A()}),e({executionParams:i,clearExecutionParams:E,loadParameterRequirements:A,fileUploadRef:_,uploadedFiles:y,uploadKey:h}),(j,Z)=>{var V,w,W,N,O;return m(),v("div",Mr,[s("div",Nr,[S(r(P),{icon:"carbon:play",width:"16"}),s("span",null,c(r(t)("sidebar.executionController")),1)]),s("div",Or,[s("div",Lr,[s("label",null,c(r(t)("sidebar.parameterRequirements")),1),s("div",Br,c(r(t)("sidebar.parameterRequirementsHelp")),1),p.value.hasParameters?(m(),v("div",qr,[(m(!0),v(re,null,de(p.value.parameters,L=>(m(),v("div",{key:L,class:"parameter-field"},[s("label",jr,[ne(c(L)+" ",1),Z[0]||(Z[0]=s("span",{class:"required"},"*",-1))]),se(s("input",{"onUpdate:modelValue":le=>g.value[L]=le,class:oe(["parameter-input",{error:k.value[L]}]),placeholder:r(t)("sidebar.enterValueFor",{param:L}),onInput:le=>J(L,le.target.value),required:""},null,42,Vr),[[ce,g.value[L]]]),k.value[L]?(m(),v("div",Hr,c(k.value[L]),1)):B("",!0)]))),128))])):B("",!0),p.value.hasParameters&&!R.value&&!a.isExecuting&&!a.isGenerating?(m(),v("div",Gr,[S(r(P),{icon:"carbon:warning",width:"14"}),ne(" "+c(r(t)("sidebar.fillAllRequiredParameters")),1)])):B("",!0)]),S(Ds,{ref_key:"fileUploadRef",ref:_,disabled:a.isExecuting||a.isGenerating,onFilesUploaded:f,onFilesRemoved:q,onUploadKeyChanged:x,onUploadStarted:te,onUploadCompleted:D,onUploadError:M},null,8,["disabled"]),s("button",{class:"btn btn-primary execute-btn",onClick:z,disabled:!R.value},[S(r(P),{icon:a.isExecuting?"carbon:circle-dash":"carbon:play",width:"16",class:oe({spinning:a.isExecuting})},null,8,["icon","class"]),ne(" "+c(a.isExecuting?r(t)("sidebar.executing"):r(t)("sidebar.executePlan")),1)],8,Wr),j.showPublishButton?(m(),v("button",{key:0,class:"btn publish-mcp-btn",onClick:Q,disabled:!j.currentPlanTemplateId},[S(r(P),{icon:"carbon:application",width:"16"}),ne(" "+c($.value),1)],8,zr)):B("",!0),(V=j.toolInfo)!=null&&V.enableInternalToolcall?(m(),v("div",Jr,[s("div",Kr,[s("h4",Xr,c(r(t)("sidebar.internalCall")),1),s("p",Yr,c(r(t)("sidebar.internalCallDescription")),1)]),s("div",Qr,[s("div",Zr,[s("div",ei,c(r(t)("sidebar.internalMethodCall")),1),s("div",ti,c(r(t)("sidebar.toolName"))+": "+c(((w=j.toolInfo)==null?void 0:w.toolName)||j.currentPlanTemplateId),1),(W=j.toolInfo)!=null&&W.serviceGroup?(m(),v("div",si,c(r(t)("sidebar.serviceGroup"))+": "+c(j.toolInfo.serviceGroup),1)):B("",!0),s("div",ni,c(r(t)("sidebar.internalCallUsage")),1),s("div",oi,[s("strong",null,c(r(t)("sidebar.usage"))+":",1),s("pre",ai,c(r(t)("sidebar.internalCallExample")),1)])])])])):B("",!0),(N=j.toolInfo)!=null&&N.enableHttpService?(m(),v("div",li,[s("div",ri,[s("h4",ii,c(r(t)("sidebar.httpCallExample")),1),s("p",ci,c(r(t)("sidebar.httpCallDescription")),1)]),s("div",di,[s("div",ui,[s("div",pi,[(m(!0),v(re,null,de(b.value,L=>(m(),v("button",{key:L.id,class:oe(["tab-button",{active:u.value===L.id}]),onClick:le=>u.value=L.id},c(L.label),11,mi))),128))]),s("div",hi,[(m(!0),v(re,null,de(b.value,L=>se((m(),v("div",{key:L.id,class:"tab-panel"},[s("div",fi,[s("div",vi,c(L.method),1),s("div",gi,c(L.endpoint),1),s("div",bi,c(L.description),1),L.example?(m(),v("div",yi,[s("strong",null,c(r(t)("sidebar.example"))+":",1),s("pre",_i,c(L.example),1)])):B("",!0)])])),[[ts,u.value===L.id]])),128))])])])])):B("",!0),(O=j.toolInfo)!=null&&O.enableMcpService?(m(),v("div",$i,[s("div",wi,[s("h4",Si,c(r(t)("sidebar.mcpCall")),1),s("p",ki,c(r(t)("sidebar.mcpCallDescription")),1)]),s("div",Ti,[s("div",Pi,[s("div",Ei,c(r(t)("sidebar.mcpServiceCall")),1),s("div",Ci,c(r(t)("sidebar.mcpEndpoint"))+": /mcp/execute",1),s("div",Ri,c(r(t)("sidebar.mcpCallUsage")),1),s("div",Ii,[s("strong",null,c(r(t)("sidebar.usage"))+":",1),s("pre",Ai,c(r(t)("sidebar.mcpCallExample")),1)])])])])):B("",!0)])])}}}),Di=me(xi,[["__scopeId","data-v-29b1330b"]]),Fi={class:"config-section"},Ui={class:"section-header"},Mi={class:"generator-content"},Ni={class:"plan-type-selection"},Oi={class:"form-label"},Li={value:"simple"},Bi={value:"dynamic_agent"},qi={key:0,class:"dynamic-agent-instruction"},ji=["value"],Vi=["placeholder"],Hi={class:"generator-actions"},Gi=["disabled"],Wi=["disabled"],zi=pe({__name:"PlanGenerator",props:{generatorPrompt:{},jsonContent:{},isGenerating:{type:Boolean},planType:{default:"dynamic_agent"}},emits:["generatePlan","updatePlan","updateGeneratorPrompt","updatePlanType"],setup(o,{expose:e,emit:n}){const{t}=ke(),a=o,l=n,i=F(a.generatorPrompt),p=F(a.planType);ue(()=>a.generatorPrompt,u=>{i.value=u}),ue(i,u=>{l("updateGeneratorPrompt",u)}),ue(()=>a.planType,u=>{p.value=u}),ue(p,u=>{l("updatePlanType",u)});const g=()=>{l("generatePlan")},d=()=>{l("updatePlan")};return e({generatorPrompt:i}),(u,k)=>(m(),v("div",Fi,[s("div",Ui,[S(r(P),{icon:"carbon:generate",width:"16"}),s("span",null,c(r(t)("sidebar.planGenerator")),1)]),s("div",Mi,[s("div",Ni,[s("label",Oi,c(r(t)("sidebar.planType")),1),se(s("select",{"onUpdate:modelValue":k[0]||(k[0]=C=>p.value=C),class:"form-select"},[s("option",Li,c(r(t)("sidebar.simplePlan")),1),s("option",Bi,c(r(t)("sidebar.dynamicAgentPlan")),1)],512),[[st,p.value]])]),p.value==="dynamic_agent"?(m(),v("div",qi,[s("textarea",{readonly:"",class:"instruction-textarea",rows:"2",value:r(t)("sidebar.dynamicAgentInstruction")},null,8,ji)])):(m(),v(re,{key:1},[se(s("textarea",{"onUpdate:modelValue":k[1]||(k[1]=C=>i.value=C),class:"prompt-input",placeholder:r(t)("sidebar.generatorPlaceholder"),rows:"3"},null,8,Vi),[[ce,i.value]]),s("div",Hi,[s("button",{class:"btn btn-primary btn-sm",onClick:g,disabled:u.isGenerating||!i.value.trim()},[S(r(P),{icon:u.isGenerating?"carbon:circle-dash":"carbon:generate",width:"14",class:oe({spinning:u.isGenerating})},null,8,["icon","class"]),ne(" "+c(u.isGenerating?r(t)("sidebar.generating"):r(t)("sidebar.generatePlan")),1)],8,Gi),s("button",{class:"btn btn-secondary btn-sm",onClick:d,disabled:u.isGenerating||!i.value.trim()||!u.jsonContent.trim()},[S(r(P),{icon:"carbon:edit",width:"14"}),ne(" "+c(r(t)("sidebar.updatePlan")),1)],8,Wi)])],64))])]))}}),Ji=me(zi,[["__scopeId","data-v-ef6f6cb4"]]),Ki={class:"sidebar-content"},Xi={class:"sidebar-content-header"},Yi={class:"sidebar-content-title"},Qi={class:"tab-switcher"},Zi=["disabled"],ec={key:0,class:"tab-content"},tc={class:"new-task-section"},sc={class:"sidebar-content-list"},nc={key:0,class:"loading-state"},oc={key:1,class:"error-state"},ac={key:2,class:"empty-state"},lc=["onClick"],rc={class:"task-icon"},ic={class:"task-details"},cc={class:"task-title"},dc={class:"task-preview"},uc={class:"task-time"},pc={class:"task-actions"},mc=["title","onClick"],hc={key:1,class:"tab-content config-tab"},fc={key:0,class:"config-container"},vc={class:"template-info-header"},gc={class:"template-info"},bc={class:"template-id"},yc=["title"],_c=pe({__name:"Sidebar",emits:["planExecutionRequested"],setup(o,{expose:e,emit:n}){const{t}=ke(),a=ls(),l=F(80),i=F(!1),p=F(0),g=F(0),d=F(null),u=F({toolName:"",toolDescription:"",planTemplateId:"",inputSchema:"[]",enableHttpService:!1,enableMcpService:!1,enableInternalToolcall:!1,serviceGroup:""}),k=F(null),C=F({enabled:!0,success:!0}),U=fe(()=>C.value.enabled),_=async()=>{try{const w=await Fe.getCoordinatorToolConfig();C.value=w}catch(w){console.error("Failed to load CoordinatorTool configuration:",w),C.value={enabled:!0,success:!1,message:w instanceof Error?w.message:"Unknown error"}}},y=n,h=async()=>{try{const w=await H.saveTemplate();w!=null&&w.duplicate?a.success(t("sidebar.saveCompleted",{message:w.message,versionCount:w.versionCount})):w!=null&&w.saved?(a.success(t("sidebar.saveSuccess",{message:w.message,versionCount:w.versionCount})),b()):w!=null&&w.message&&a.success(t("sidebar.saveStatus",{message:w.message}))}catch(w){console.error("Failed to save plan modifications:",w),a.error(w.message||t("sidebar.saveFailed"))}},b=async()=>{await new Promise(w=>setTimeout(w,500)),d.value&&d.value.loadParameterRequirements(),k.value&&k.value.loadParameterRequirements()},T=async()=>{var w;try{await H.generatePlan(),a.success(t("sidebar.generateSuccess",{templateId:((w=H.selectedTemplate)==null?void 0:w.id)??t("sidebar.unknown")}))}catch(W){console.error("Failed to generate plan:",W),a.error(t("sidebar.generateFailed")+": "+W.message)}},$=async()=>{try{await H.updatePlan(),a.success(t("sidebar.updateSuccess"))}catch(w){console.error("Failed to update plan:",w),a.error(t("sidebar.updateFailed")+": "+w.message)}},R=()=>{try{H&&typeof H.rollbackVersion=="function"?H.rollbackVersion():console.warn("sidebarStore or rollbackVersion method is not available")}catch(w){console.error("Error during rollback operation:",w),a.error(t("sidebar.rollbackFailed")||"Rollback failed")}},f=()=>{try{H&&typeof H.restoreVersion=="function"?H.restoreVersion():console.warn("sidebarStore or restoreVersion method is not available")}catch(w){console.error("Error during restore operation:",w),a.error(t("sidebar.restoreFailed")||"Restore failed")}},q=async w=>{var W,N;console.log("[Sidebar] 🎯 handleExecutePlan called with payload:",JSON.stringify(w,null,2)),console.log("[Sidebar] 📊 Current sidebarStore state:",{currentPlanTemplateId:H.currentPlanTemplateId,selectedTemplate:(W=H.selectedTemplate)==null?void 0:W.id,jsonContent:((N=H.jsonContent)==null?void 0:N.substring(0,100))+"..."});try{const O=H.preparePlanExecution();if(console.log("[Sidebar] 📋 Prepared plan data:",JSON.stringify(O,null,2)),!O){console.log("[Sidebar] ❌ No plan data available, returning");return}const L={...O,uploadedFiles:w.uploadedFiles,uploadKey:w.uploadKey};w.replacementParams&&Object.keys(w.replacementParams).length>0&&(console.log("[Sidebar] 🔄 Processing replacement parameters:",w.replacementParams),L.replacementParams=w.replacementParams),console.log("[Sidebar] ✅ Final plan data:",JSON.stringify(L,null,2));const le={...w,title:L.title,planData:L.planData,params:L.params,uploadedFiles:L.uploadedFiles,uploadKey:L.uploadKey};console.log("[Sidebar] 📤 Emitting planExecutionRequested with final payload:",JSON.stringify(le,null,2)),y("planExecutionRequested",le),console.log("[Sidebar] ✅ Event emitted successfully")}catch(O){console.error("[Sidebar] ❌ Error executing plan:",O),a.error(t("sidebar.executeFailed")+": "+O.message)}finally{console.log("[Sidebar] 🧹 Cleaning up after execution"),H.finishPlanExecution(),H.clearExecutionParams(),d.value&&(console.log("[Sidebar] 🧹 Calling ExecutionController.clearExecutionParams"),d.value.clearExecutionParams()),console.log("[Sidebar] ✅ Cleanup completed")}},x=F(!1),te=()=>{if(console.log("[Sidebar] Publish MCP service button clicked"),console.log("[Sidebar] currentPlanTemplateId:",H.currentPlanTemplateId),!H.currentPlanTemplateId){console.log("[Sidebar] No plan template selected, showing warning"),a.error(t("mcpService.selectPlanTemplateFirst"));return}console.log("[Sidebar] Opening publish MCP service modal"),x.value=!0},D=w=>{w===null?(console.log("MCP service deleted successfully"),a.success(t("mcpService.deleteSuccess")),u.value={toolName:"",toolDescription:"",planTemplateId:"",inputSchema:"[]",enableHttpService:!1,enableMcpService:!1,enableInternalToolcall:!1,serviceGroup:""}):(console.log("MCP service published successfully:",w),a.success(t("mcpService.publishSuccess")),u.value={...w,toolName:w.toolName||"",serviceGroup:w.serviceGroup||""})},M=()=>{H.clearExecutionParams()},z=w=>{H.executionParams=w},Q=w=>{H.generatorPrompt=w},E=w=>{H.planType=w},A=async w=>{if(!w){u.value={toolName:"",toolDescription:"",planTemplateId:"",inputSchema:"[]",enableHttpService:!1,enableMcpService:!1,enableInternalToolcall:!1,serviceGroup:""};return}try{const W=await Fe.getCoordinatorToolsByTemplate(w);W?u.value={...W,toolName:W.toolName||"",serviceGroup:W.serviceGroup||""}:u.value={toolName:"",toolDescription:"",planTemplateId:w,inputSchema:"[]",enableHttpService:!1,enableMcpService:!1,enableInternalToolcall:!1,serviceGroup:""}}catch(W){console.error("Failed to load tool information:",W),u.value={toolName:"",toolDescription:"",planTemplateId:w,inputSchema:"[]",enableHttpService:!1,enableMcpService:!1,enableInternalToolcall:!1,serviceGroup:""}}},J=w=>{if(isNaN(w.getTime()))return console.warn("Invalid date received:",w),t("time.unknown");const N=new Date().getTime()-w.getTime(),O=Math.floor(N/6e4),L=Math.floor(N/36e5),le=Math.floor(N/864e5);return O<1?t("time.now"):O<60?t("time.minuteAgo",{count:O}):L<24?t("time.hourAgo",{count:L}):le<30?t("time.dayAgo",{count:le}):w.toLocaleDateString("zh-CN")},Y=(w,W)=>!w||w.length<=W?w:w.substring(0,W)+"...",ae=w=>{i.value=!0,p.value=w.clientX,g.value=l.value,document.addEventListener("mousemove",j),document.addEventListener("mouseup",Z),document.body.style.cursor="col-resize",document.body.style.userSelect="none",w.preventDefault()},j=w=>{if(!i.value)return;const W=window.innerWidth,O=(w.clientX-p.value)/W*100;let L=g.value+O;L=Math.max(15,Math.min(100,L)),l.value=L},Z=()=>{i.value=!1,document.removeEventListener("mousemove",j),document.removeEventListener("mouseup",Z),document.body.style.cursor="",document.body.style.userSelect="",localStorage.setItem("sidebarWidth",l.value.toString())},V=()=>{l.value=80,localStorage.setItem("sidebarWidth","80")};return ue(()=>H.currentPlanTemplateId,w=>{A(w)},{immediate:!0}),Te(()=>{H.loadPlanTemplateList(),_(),H.loadAvailableTools();const w=localStorage.getItem("sidebarWidth");w&&(l.value=parseFloat(w))}),Se(()=>{document.removeEventListener("mousemove",j),document.removeEventListener("mouseup",Z)}),e({loadPlanTemplateList:H.loadPlanTemplateList,toggleSidebar:H.toggleSidebar,currentPlanTemplateId:H.currentPlanTemplateId}),(w,W)=>{var N,O;return m(),v(re,null,[s("div",{class:oe(["sidebar-wrapper",{"sidebar-wrapper-collapsed":r(H).isCollapsed}]),style:Ge({width:l.value+"%"})},[s("div",Ki,[s("div",Xi,[s("div",Yi,c(w.$t("sidebar.title")),1)]),s("div",Qi,[s("button",{class:oe(["tab-button",{active:r(H).currentTab==="list"}]),onClick:W[0]||(W[0]=L=>r(H).switchToTab("list"))},[S(r(P),{icon:"carbon:list",width:"16"}),ne(" "+c(w.$t("sidebar.templateList")),1)],2),s("button",{class:oe(["tab-button",{active:r(H).currentTab==="config"}]),onClick:W[1]||(W[1]=L=>r(H).switchToTab("config")),disabled:!r(H).selectedTemplate},[S(r(P),{icon:"carbon:settings",width:"16"}),ne(" "+c(w.$t("sidebar.configuration")),1)],10,Zi)]),r(H).currentTab==="list"?(m(),v("div",ec,[s("div",tc,[s("button",{class:"new-task-btn",onClick:W[2]||(W[2]=L=>r(H).createNewTemplate(r(H).planType))},[S(r(P),{icon:"carbon:add",width:"16"}),ne(" "+c(w.$t("sidebar.newPlan"))+" ",1),W[8]||(W[8]=s("span",{class:"shortcut"},"⌘ K",-1))])]),s("div",sc,[r(H).isLoading?(m(),v("div",nc,[S(r(P),{icon:"carbon:circle-dash",width:"20",class:"spinning"}),s("span",null,c(w.$t("sidebar.loading")),1)])):r(H).errorMessage?(m(),v("div",oc,[S(r(P),{icon:"carbon:warning",width:"20"}),s("span",null,c(r(H).errorMessage),1),s("button",{onClick:W[3]||(W[3]=(...L)=>r(H).loadPlanTemplateList&&r(H).loadPlanTemplateList(...L)),class:"retry-btn"},c(w.$t("sidebar.retry")),1)])):r(H).planTemplateList.length===0?(m(),v("div",ac,[S(r(P),{icon:"carbon:document",width:"32"}),s("span",null,c(w.$t("sidebar.noTemplates")),1)])):(m(!0),v(re,{key:3},de(r(H).sortedTemplates,L=>(m(),v("div",{key:L.id,class:oe(["sidebar-content-list-item",{"sidebar-content-list-item-active":L.id===r(H).currentPlanTemplateId}]),onClick:le=>r(H).selectTemplate(L)},[s("div",rc,[S(r(P),{icon:"carbon:document",width:"20"})]),s("div",ic,[s("div",cc,c(L.title||w.$t("sidebar.unnamedPlan")),1),s("div",dc,c(Y(L.description||w.$t("sidebar.noDescription"),40)),1)]),s("div",uc,c(J(r(H).parseDateTime(L.updateTime||L.createTime))),1),s("div",pc,[s("button",{class:"delete-task-btn",title:w.$t("sidebar.deleteTemplate"),onClick:ve(le=>r(H).deleteTemplate(L),["stop"])},[S(r(P),{icon:"carbon:close",width:"16"})],8,mc)])],10,lc))),128))])])):r(H).currentTab==="config"?(m(),v("div",hc,[r(H).selectedTemplate?(m(),v("div",fc,[s("div",vc,[s("div",gc,[s("h3",null,c(r(H).selectedTemplate.title||w.$t("sidebar.unnamedPlan")),1),s("span",bc,"ID: "+c(r(H).selectedTemplate.id),1)]),s("button",{class:"back-to-list-btn",onClick:W[4]||(W[4]=L=>r(H).switchToTab("list"))},[S(r(P),{icon:"carbon:arrow-left",width:"16"})])]),S(Ji,{"generator-prompt":r(H).generatorPrompt,"json-content":r(H).jsonContent,"is-generating":r(H).isGenerating,"plan-type":r(H).planType,onGeneratePlan:T,onUpdatePlan:$,onUpdateGeneratorPrompt:Q,onUpdatePlanType:E},null,8,["generator-prompt","json-content","is-generating","plan-type"]),r(H).planType==="dynamic_agent"?(m(),ie(Tr,{key:0,"json-content":r(H).jsonContent,"can-rollback":r(H).canRollback,"can-restore":r(H).canRestore,"is-generating":r(H).isGenerating,"is-executing":r(H).isExecuting,"current-plan-template-id":r(H).currentPlanTemplateId||"",onRollback:R,onRestore:f,onSave:h,"onUpdate:jsonContent":W[5]||(W[5]=L=>r(H).jsonContent=L)},null,8,["json-content","can-rollback","can-restore","is-generating","is-executing","current-plan-template-id"])):(m(),ie(Vo,{key:1,"json-content":r(H).jsonContent,"can-rollback":r(H).canRollback,"can-restore":r(H).canRestore,"is-generating":r(H).isGenerating,"is-executing":r(H).isExecuting,"current-plan-template-id":r(H).currentPlanTemplateId||"",onRollback:R,onRestore:f,onSave:h,"onUpdate:jsonContent":W[6]||(W[6]=L=>r(H).jsonContent=L)},null,8,["json-content","can-rollback","can-restore","is-generating","is-executing","current-plan-template-id"])),S(Di,{ref_key:"executionControllerRef",ref:d,"current-plan-template-id":r(H).currentPlanTemplateId||"","is-executing":r(H).isExecuting,"is-generating":r(H).isGenerating,"show-publish-button":U.value,"tool-info":u.value,onExecutePlan:q,onPublishMcpService:te,onClearParams:M,onUpdateExecutionParams:z},null,8,["current-plan-template-id","is-executing","is-generating","show-publish-button","tool-info"])])):B("",!0)])):B("",!0)]),s("div",{class:"sidebar-resizer",onMousedown:ae,onDblclick:V,title:w.$t("sidebar.resizeHint")},W[9]||(W[9]=[s("div",{class:"resizer-line"},null,-1)]),40,yc)],6),S(Yn,{ref_key:"publishMcpModalRef",ref:k,modelValue:x.value,"onUpdate:modelValue":W[7]||(W[7]=L=>x.value=L),"plan-template-id":r(H).currentPlanTemplateId||"","plan-title":((N=r(H).selectedTemplate)==null?void 0:N.title)||"","plan-description":((O=r(H).selectedTemplate)==null?void 0:O.description)||"",onPublished:D},null,8,["modelValue","plan-template-id","plan-title","plan-description"])],64)}}}),$c=me(_c,[["__scopeId","data-v-9d1adc56"]]);class dt{static async handleResponse(e){if(!e.ok)try{const n=await e.json();throw new Error(n.message||`API request failed: ${e.status}`)}catch{throw new Error(`API request failed: ${e.status} ${e.statusText}`)}return e}static async getMemories(){try{const e=await fetch(`${this.BASE_URL}`);return(await(await this.handleResponse(e)).json()).memories||[]}catch(e){throw console.error("Failed to get memory list:",e),e}}static async getMemory(e){try{const n=await fetch(`${this.BASE_URL}/single?conversationId=${e}`),a=await(await this.handleResponse(n)).json();if(!a.data)throw new Error("Memory not found");return a.data}catch(n){throw console.error("Failed to get memory:",n),n}}static async createMemory(e,n){try{const t=await fetch(`${this.BASE_URL}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({conversation_id:e,memory_name:n})}),l=await(await this.handleResponse(t)).json();if(!l.data)throw new Error("Failed to create memory");return l.data}catch(t){throw console.error("Failed to create memory:",t),t}}static async updateMemory(e,n){try{const t=await fetch(`${this.BASE_URL}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({conversation_id:e,memory_name:n})}),l=await(await this.handleResponse(t)).json();if(!l.data)throw new Error("Failed to update memory");return l.data}catch(t){throw console.error("Failed to update memory:",t),t}}static async deleteMemory(e){try{const n=await fetch(`${this.BASE_URL}/${e}`,{method:"DELETE"});await this.handleResponse(n)}catch(n){throw console.error("Failed to delete memory:",n),n}}static async generateConversationId(){try{const e=await fetch(`${this.BASE_URL}/generate-id`),t=await(await this.handleResponse(e)).json();if(!t.data)throw new Error("Failed to generate conversation ID");return t.data}catch(e){throw console.error("Failed to generate conversation ID:",e),e}}}be(dt,"BASE_URL","/api/memories");class wc{constructor(){be(this,"isCollapsed",!1);be(this,"selectMemoryId","");be(this,"loadMessages",()=>{});be(this,"intervalId")}toggleSidebar(){this.isCollapsed=!this.isCollapsed,this.isCollapsed?(this.loadMessages(),this.intervalId=window.setInterval(()=>{this.loadMessages()},3e3)):clearInterval(this.intervalId)}selectMemory(e){this.toggleSidebar(),this.selectMemoryId=e}setMemory(e){this.selectMemoryId=e}defaultMemoryId(){this.selectMemoryId=this.generateRandomId()}clearMemoryId(){this.selectMemoryId=""}generateRandomId(){return Math.random().toString(36).substring(2,10)}setLoadMessages(e){this.loadMessages=e}}const Me=tt(new wc),Sc={key:0,class:"app-container"},kc={class:"app-content"},Tc={class:"header"},Pc={class:"relative"},Ec={class:"title-edit-group"},Cc={id:"main-title",class:"main-title"},Rc={key:0,id:"title-edit-container",class:"title-edit-container"},Ic={class:"search-bar"},Ac={class:"search-container"},xc=["placeholder"],Dc={class:"message-list",id:"message-list"},Fc={class:"message-header"},Uc={class:"message-content"},Mc={class:"sender-info"},Nc=["onClick"],Oc={class:"sender-name"},Lc=["onClick"],Bc={class:"action-buttons"},qc=["onClick"],jc={class:"action-buttons"},Vc=["onClick"],Hc={class:"message-preview"},Gc={class:"preview-line"},Wc={key:0,class:"preview-line",style:{opacity:"0.8"}},zc={class:"message-meta"},Jc={class:"message-id"},Kc={class:"meta-right"},Xc={key:0,class:"unread-count"},Yc={class:"message-time"},Qc=["id"],Zc={style:{display:"flex","flex-direction":"column",gap:"0.75rem"}},ed={class:"bubble-avatar"},td={class:"bubble-content"},sd={class:"bubble-text"},nd={key:0,class:"empty-state"},od={class:"modal-content"},ad={class:"modal-header"},ld={class:"modal-title"},rd=["placeholder"],id={id:"name-char-count",class:"char-count",style:{"text-align":"right",display:"block","margin-top":"0.25rem"}},cd={class:"modal-footer"},dd={class:"modal-content"},ud={class:"modal-header"},pd={class:"modal-title"},md={class:"state-text",id:"delete-message"},hd={class:"modal-footer"},fd=pe({__name:"Memory",emits:["memory-selected"],setup(o,{emit:e}){const n=F(!1),t=F(""),a=F([]),l=F([]),i=F(!1),p=F(null),g=F(""),d=F(!1),u=F(null),k=new Map,C=e,U=D=>{D.key==="Escape"&&(d.value?x():i.value&&$())};Te(()=>{Me.setLoadMessages(_),document.addEventListener("keydown",U)}),Se(()=>{document.removeEventListener("keydown",U)});const _=async()=>{try{const D=await dt.getMemories();a.value?a.value=D.map(M=>({...M,expanded:k.has(M.conversation_id)?k.get(M.conversation_id):!1})):a.value=D.map(M=>({...M,expanded:!1})),l.value=[...a.value],b()}catch(D){console.error("error:",D),a.value=[],l.value=[]}},y=D=>{Me.selectMemory(D),C("memory-selected")},h=D=>{const M=typeof D=="string"?parseInt(D,10):D;return isNaN(M)||M<=0?"unknow time":new Date(M.toString().length===13?M:M*1e3).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1}).replace(","," ")},b=()=>{const D=t.value.toLowerCase().trim();if(!D){l.value=[...a.value];return}l.value=a.value.filter(M=>{var A;const z=M.memory_name.toLowerCase().includes(D),Q=M.conversation_id.toLowerCase().includes(D),E=((A=M.messages)==null?void 0:A.some(J=>J.text.toLowerCase().includes(D)))||!1;return z||Q||E})},T=(D,M)=>{p.value=D,g.value=M,i.value=!0},$=()=>{i.value=!1,p.value=null},R=async()=>{if(!p.value)return;const D=g.value.trim()||"unknow name",M=a.value.findIndex(z=>z.conversation_id===p.value);if(M!==-1){const z=a.value[M];try{const Q=await dt.updateMemory(z.conversation_id,D);Q.messages||(Q.messages=[]),a.value[M]={...Q,expanded:z.expanded},b(),i.value=!1}catch(Q){console.error("error:",Q)}}},f=D=>{const M=a.value.find(z=>z.conversation_id===D);if(M){M.expanded=!M.expanded,k.set(D,M.expanded);const z=l.value.findIndex(Q=>Q.conversation_id===D);z!==-1&&(l.value[z]={...M})}},q=D=>{u.value=D,d.value=!0},x=()=>{d.value=!1,u.value=null},te=async()=>{if(u.value)try{await dt.deleteMemory(u.value),a.value=a.value.filter(D=>D.conversation_id!==u.value),b(),a.value.length===0&&Me.clearMemoryId(),d.value=!1,u.value=null}catch(D){console.error("error:",D)}};return(D,M)=>(m(),ie(Ye,{to:"body"},[S(Be,{name:"modal"},{default:Ue(()=>[r(Me).isCollapsed?(m(),v("div",Sc,[s("div",kc,[s("div",Tc,[s("div",Pc,[s("div",Ec,[s("h1",Cc,[s("span",null,c(D.$t("memory.title")),1)])]),n.value?(m(),v("div",Rc)):B("",!0)]),s("button",{class:"close-btn",onClick:M[0]||(M[0]=z=>r(Me).toggleSidebar())},[S(r(P),{icon:"carbon:close"})])]),s("div",Ic,[s("div",Ac,[S(r(P),{class:"search-container-icon",icon:"carbon:search"}),se(s("input",{type:"text",placeholder:D.$t("memory.searchPlaceholder"),class:"search-input","onUpdate:modelValue":M[1]||(M[1]=z=>t.value=z),onInput:b},null,40,xc),[[ce,t.value]])])]),s("div",Dc,[s("div",null,[(m(!0),v(re,null,de(l.value,z=>(m(),v("div",{class:oe(["message-item",{expanded:z.expanded}]),key:z.conversation_id},[s("div",Fc,[s("div",Uc,[s("div",Mc,[s("div",{class:"sender-div",onClick:ve(Q=>y(z.conversation_id),["stop"])},[s("h3",Oc,c(z.memory_name),1)],8,Nc),s("div",{class:"toggle-container",onClick:ve(Q=>T(z.conversation_id,z.memory_name),["stop"])},[S(r(P),{icon:"carbon:edit",class:"edit-btn"})],8,Lc),s("div",Bc,[s("button",{class:"delete-btn",onClick:ve(Q=>f(z.conversation_id),["stop"])},[S(r(P),{id:"toggle-"+z.conversation_id,icon:"carbon:chevron-down",class:"down-btn"},null,8,["id"])],8,qc)]),s("div",jc,[s("button",{class:"delete-btn",onClick:ve(Q=>q(z.conversation_id),["stop"])},[S(r(P),{icon:"carbon:delete"})],8,Vc)])]),s("div",Hc,[s("p",Gc,c(z.messages&&z.messages.length>0?z.messages[0].text:"none message"),1),z.messages&&z.messages.length>1?(m(),v("p",Wc,c(z.messages[1].text),1)):B("",!0)]),s("div",zc,[s("span",Jc,"ID: "+c(z.conversation_id),1),s("div",Kc,[z.messages&&z.messages.length>0?(m(),v("span",Xc,c(z.messages.length)+" "+c(D.$t("memory.size")),1)):B("",!0),s("span",Yc,c(h(z.create_time)),1)])])])]),z.expanded?(m(),v("div",{key:0,id:"content-"+z.conversation_id,class:"expanded-content"},[s("div",Zc,[(m(!0),v(re,null,de(z.messages,(Q,E)=>(m(),v("div",{class:"message-bubble",key:E},[s("div",ed,c(Q.messageType),1),s("div",td,[s("p",sd,c(Q.text),1)])]))),128))])],8,Qc)):B("",!0)],2))),128))]),l.value.length===0&&t.value?(m(),v("div",nd,M[3]||(M[3]=[s("p",{class:"state-text"},"none message",-1)]))):B("",!0)]),i.value?(m(),v("div",{key:0,id:"name-edit-modal",class:"modal-overlay",onClick:ve($,["self"])},[s("div",od,[s("div",ad,[s("h3",ld,c(D.$t("memory.changeName")),1),se(s("input",{type:"text","onUpdate:modelValue":M[2]||(M[2]=z=>g.value=z),class:"edit-input",placeholder:D.$t("memory.newNamePlaceholder")},null,8,rd),[[ce,g.value]]),s("span",id,c(g.value.length),1)]),s("div",cd,[s("button",{id:"cancel-name",class:"modal-btn cancel-btn",onClick:$},c(D.$t("memory.cancel")),1),s("button",{id:"save-name",class:"modal-btn confirm-btn",onClick:R},c(D.$t("memory.save")),1)])])])):B("",!0),d.value?(m(),v("div",{key:1,id:"delete-modal",class:"modal-overlay",onClick:ve(x,["self"])},[s("div",dd,[s("div",ud,[s("h3",pd,c(D.$t("memory.deleteHint")),1),s("p",md,c(D.$t("memory.deleteHintPrefix"))+" "+c(u.value)+" "+c(D.$t("memory.deleteHintSuffix")),1)]),s("div",hd,[s("button",{id:"cancel-delete",class:"modal-btn cancel-btn",onClick:x},c(D.$t("memory.cancel")),1),s("button",{id:"confirm-delete",class:"modal-btn delete-btn-confirm",onClick:te},c(D.$t("memory.delete")),1)])])])):B("",!0)])])):B("",!0)]),_:1})]))}}),vd=me(fd,[["__scopeId","data-v-ca286acb"]]),gd="/api/executor";async function Fs(o){try{const e=await fetch(`${gd}/agent-execution/${o}`);if(!e.ok){if(e.status===404)return console.warn(`Agent execution detail not found for stepId: ${o}`),null;throw new Error(`HTTP error! status: ${e.status}`)}return await e.json()}catch(e){return console.error(`Error fetching agent execution detail for stepId: ${o}:`,e),null}}async function bd(o){return console.log(`Refreshing agent execution detail for stepId: ${o}`),Fs(o)}class Ne{static async handleResponse(e){if(!e.ok)try{const n=await e.json();throw new Error(n.message||`API request failed: ${e.status}`)}catch{throw new Error(`API request failed: ${e.status} ${e.statusText}`)}return e}static async getFileTree(e){try{const n=await fetch(`${this.BASE_URL}/tree/${e}`),a=await(await this.handleResponse(n)).json();if(!a.success)throw new Error(a.message||"Failed to get file tree");return a.data}catch(n){throw console.error("Failed to get file tree:",n),n}}static async getFileContent(e,n){try{const t=await fetch(`${this.BASE_URL}/content/${e}?path=${encodeURIComponent(n)}`),l=await(await this.handleResponse(t)).json();if(!l.success)throw new Error(l.message||"Failed to get file content");return l.data}catch(t){throw console.error("Failed to get file content:",t),t}}static async downloadFile(e,n,t){try{const a=await fetch(`${this.BASE_URL}/download/${e}?path=${encodeURIComponent(n)}`);await this.handleResponse(a);const l=await a.blob(),i=window.URL.createObjectURL(l),p=document.createElement("a");p.href=i,p.download=t||n.split("/").pop()||"download",document.body.appendChild(p),p.click(),window.URL.revokeObjectURL(i),document.body.removeChild(p)}catch(a){throw console.error("Failed to download file:",a),a}}static isTextFile(e,n){const t=["text/","application/json","application/xml","application/javascript","application/typescript"],a=[".txt",".md",".json",".xml",".html",".css",".js",".ts",".vue",".jsx",".tsx",".py",".java",".cpp",".c",".h",".sh",".bat",".yml",".yaml",".properties",".conf",".cfg"];if(t.some(i=>e.startsWith(i)))return!0;const l=n.toLowerCase();return a.some(i=>l.endsWith(i))}static getFileIcon(e){if(e.type==="directory")return"carbon:folder";const n=e.name.toLowerCase();return n.endsWith(".js")?"vscode-icons:file-type-js":n.endsWith(".ts")?"vscode-icons:file-type-typescript":n.endsWith(".vue")?"vscode-icons:file-type-vue":n.endsWith(".java")?"vscode-icons:file-type-java":n.endsWith(".py")?"vscode-icons:file-type-python":n.endsWith(".json")?"vscode-icons:file-type-json":n.endsWith(".xml")?"vscode-icons:file-type-xml":n.endsWith(".html")?"vscode-icons:file-type-html":n.endsWith(".css")?"vscode-icons:file-type-css":n.endsWith(".md")?"vscode-icons:file-type-markdown":n.endsWith(".yml")||n.endsWith(".yaml")?"vscode-icons:file-type-yaml":n.endsWith(".pdf")?"vscode-icons:file-type-pdf2":n.endsWith(".doc")||n.endsWith(".docx")?"vscode-icons:file-type-word":n.endsWith(".xls")||n.endsWith(".xlsx")?"vscode-icons:file-type-excel":n.endsWith(".ppt")||n.endsWith(".pptx")?"vscode-icons:file-type-powerpoint":n.match(/\.(jpg|jpeg|png|gif|bmp|svg)$/)?"carbon:image":n.match(/\.(zip|rar|7z|tar|gz)$/)?"carbon:archive":"carbon:document"}}be(Ne,"BASE_URL","/api/file-browser");const yd={class:"file-tree-node"},_d={class:"node-icon"},$d={class:"node-name"},wd={key:1,class:"file-size"},Sd={key:2,class:"node-actions"},kd={key:0,class:"children"},Td=pe({__name:"FileTreeNode",props:{node:{},level:{}},emits:["file-selected","download-file"],setup(o,{emit:e}){const n=o,t=e,a=F(n.level===0),l=F(!1),i=F(!1),p=F({}),g=()=>{n.node.type==="directory"&&(a.value=!a.value)},d=()=>{n.node.type==="directory"?g():u()},u=()=>{n.node.type==="file"&&t("file-selected",n.node),U()},k=()=>{t("download-file",n.node),U()},C=b=>{b.preventDefault(),i.value=!0,p.value={position:"fixed",top:`${b.clientY}px`,left:`${b.clientX}px`,zIndex:1e3},setTimeout(()=>{document.addEventListener("click",U)},0)},U=()=>{i.value=!1,document.removeEventListener("click",U)},_=async()=>{try{await navigator.clipboard.writeText(n.node.path)}catch(b){console.error("Failed to copy path:",b)}U()},y=()=>n.node.type==="directory"?a.value?"carbon:folder-open":"carbon:folder":Ne.getFileIcon(n.node),h=b=>{if(b===0)return"0 B";const T=1024,$=["B","KB","MB","GB"],R=Math.floor(Math.log(b)/Math.log(T));return parseFloat((b/Math.pow(T,R)).toFixed(1))+" "+$[R]};return Se(()=>{document.removeEventListener("click",U)}),(b,T)=>{const $=ss("FileTreeNode",!0);return m(),v("div",yd,[s("div",{class:oe(["node-content",{"is-directory":b.node.type==="directory","is-file":b.node.type==="file","is-expanded":a.value}]),style:Ge({paddingLeft:`${b.level*16+12}px`}),onClick:d,onContextmenu:ve(C,["prevent"])},[b.node.type==="directory"?(m(),v("div",{key:0,class:"expand-icon",onClick:ve(g,["stop"])},[S(r(P),{icon:a.value?"carbon:chevron-down":"carbon:chevron-right",class:"chevron-icon"},null,8,["icon"])])):B("",!0),s("div",_d,[S(r(P),{icon:y()},null,8,["icon"])]),s("span",$d,c(b.node.name),1),b.node.type==="file"?(m(),v("span",wd,c(h(b.node.size)),1)):B("",!0),l.value?(m(),v("div",Sd,[b.node.type==="file"?(m(),v("button",{key:0,onClick:T[0]||(T[0]=ve(R=>b.$emit("download-file",b.node),["stop"])),class:"action-btn download-btn",title:"Download"},[S(r(P),{icon:"carbon:download"})])):B("",!0)])):B("",!0)],38),b.node.type==="directory"&&a.value&&b.node.children?(m(),v("div",kd,[(m(!0),v(re,null,de(b.node.children,R=>(m(),ie($,{key:R.path,node:R,level:b.level+1,onFileSelected:T[1]||(T[1]=f=>b.$emit("file-selected",f)),onDownloadFile:T[2]||(T[2]=f=>b.$emit("download-file",f))},null,8,["node","level"]))),128))])):B("",!0),i.value?(m(),v("div",{key:1,class:"context-menu",style:Ge(p.value),onClick:T[3]||(T[3]=ve(()=>{},["stop"]))},[s("div",{class:"context-menu-item",onClick:u},[S(r(P),{icon:"carbon:view"}),T[4]||(T[4]=s("span",null,"Open",-1))]),b.node.type==="file"?(m(),v("div",{key:0,class:"context-menu-item",onClick:k},[S(r(P),{icon:"carbon:download"}),T[5]||(T[5]=s("span",null,"Download",-1))])):B("",!0),T[7]||(T[7]=s("div",{class:"context-menu-divider"},null,-1)),s("div",{class:"context-menu-item",onClick:_},[S(r(P),{icon:"carbon:copy"}),T[6]||(T[6]=s("span",null,"Copy Path",-1))])],4)):B("",!0)])}}}),Pd=me(Td,[["__scopeId","data-v-e4a376d5"]]),Ed={class:"file-browser"},Cd={class:"file-browser-header"},Rd={class:"header-actions"},Id=["disabled","title"],Ad={class:"file-browser-content"},xd={class:"file-tree-panel"},Dd={key:0,class:"loading-state"},Fd={key:1,class:"error-state"},Ud={key:0,class:"waiting-for-files"},Md={class:"message-content"},Nd={class:"tips"},Od=["disabled"],Ld={key:1,class:"actual-error"},Bd={key:2,class:"empty-state"},qd={key:3,class:"file-tree"},jd={key:0,class:"file-content-panel"},Vd={class:"file-content-header"},Hd={class:"file-info"},Gd={class:"file-name"},Wd={class:"file-size"},zd={class:"file-actions"},Jd=["title"],Kd=["title"],Xd={class:"file-content-body"},Yd={key:0,class:"loading-content"},Qd={key:1,class:"content-error"},Zd={key:2,class:"file-content"},eu={key:0,class:"text-content"},tu={key:1,class:"binary-content"},su=pe({__name:"index",props:{planId:{}},setup(o){const e=o,{t:n}=ke(),t=F(!1),a=F(null),l=F(null),i=F(null),p=F(null),g=F(!1),d=F(null),u=F(null),k=fe(()=>!p.value||!i.value?!1:Ne.isTextFile(p.value.mimeType,i.value.name)),C=fe(()=>a.value&&(a.value.includes("Plan directory not found")||a.value.includes("not found"))),U=()=>{u.value&&(clearTimeout(u.value),u.value=null)},_=()=>{U(),u.value=window.setTimeout(()=>{C.value&&y()},5e3)},y=async()=>{if(e.planId){t.value=!0,a.value=null,U();try{l.value=await Ne.getFileTree(e.planId)}catch(f){a.value=f instanceof Error?f.message:n("fileBrowser.loadError"),console.error("Failed to load file tree:",f);const q=f instanceof Error?f.message:"";(q.includes("Plan directory not found")||q.includes("not found"))&&_()}finally{t.value=!1}}},h=async f=>{if(f.type!=="directory"){i.value=f,p.value=null,g.value=!0,d.value=null;try{p.value=await Ne.getFileContent(e.planId,f.path)}catch(q){d.value=q instanceof Error?q.message:n("fileBrowser.contentLoadError"),console.error("Failed to load file content:",q)}finally{g.value=!1}}},b=async f=>{try{await Ne.downloadFile(e.planId,f.path,f.name)}catch(q){console.error("Failed to download file:",q)}},T=()=>{i.value=null,p.value=null,d.value=null},$=f=>Ne.getFileIcon(f),R=f=>{if(f===0)return"0 B";const q=1024,x=["B","KB","MB","GB"],te=Math.floor(Math.log(f)/Math.log(q));return parseFloat((f/Math.pow(q,te)).toFixed(1))+" "+x[te]};return ue(()=>e.planId,f=>{f&&(i.value=null,p.value=null,y())},{immediate:!0}),Te(()=>{e.planId&&y()}),Se(()=>{U()}),(f,q)=>(m(),v("div",Ed,[s("div",Cd,[s("h3",null,c(f.$t("fileBrowser.title")),1),s("div",Rd,[s("button",{class:"refresh-btn",onClick:y,disabled:t.value,title:f.$t("fileBrowser.refresh")},[S(r(P),{icon:"carbon:refresh",class:oe({rotating:t.value}),style:{color:"#ffffff",fontSize:"18px",width:"18px",height:"18px"}},null,8,["class"])],8,Id)])]),s("div",Ad,[s("div",xd,[t.value?(m(),v("div",Dd,[S(r(P),{icon:"carbon:loading",class:"rotating"}),s("span",null,c(f.$t("fileBrowser.loading")),1)])):a.value?(m(),v("div",Fd,[C.value?(m(),v("div",Ud,[S(r(P),{icon:"carbon:time",class:"rotating"}),s("div",Md,[s("h3",null,c(f.$t("fileBrowser.waitingForGeneration")),1),s("p",null,c(f.$t("fileBrowser.planExecuting")),1),s("div",Nd,[S(r(P),{icon:"carbon:information"}),s("span",null,c(f.$t("fileBrowser.filesTip")),1)])]),s("button",{onClick:y,class:"retry-btn",disabled:t.value},[S(r(P),{icon:"carbon:refresh",class:oe({rotating:t.value})},null,8,["class"]),ne(" "+c(t.value?f.$t("fileBrowser.checking"):f.$t("fileBrowser.checkNow")),1)],8,Od)])):(m(),v("div",Ld,[S(r(P),{icon:"carbon:warning"}),s("span",null,c(a.value),1),s("button",{onClick:y,class:"retry-btn"},c(f.$t("fileBrowser.retry")),1)]))])):l.value?(m(),v("div",qd,[S(Pd,{node:l.value,level:0,onFileSelected:h,onDownloadFile:b},null,8,["node"])])):(m(),v("div",Bd,[S(r(P),{icon:"carbon:folder-off"}),s("span",null,c(f.$t("fileBrowser.noFiles")),1)]))]),i.value?(m(),v("div",jd,[s("div",Vd,[s("div",Hd,[S(r(P),{icon:$(i.value)},null,8,["icon"]),s("span",Gd,c(i.value.name),1),s("span",Wd,"("+c(R(i.value.size))+")",1)]),s("div",zd,[s("button",{onClick:q[0]||(q[0]=x=>b(i.value)),class:"download-btn",title:f.$t("fileBrowser.download")},[S(r(P),{icon:"carbon:download"})],8,Jd),s("button",{onClick:T,class:"close-btn",title:f.$t("common.close")},[S(r(P),{icon:"carbon:close"})],8,Kd)])]),s("div",Xd,[g.value?(m(),v("div",Yd,[S(r(P),{icon:"carbon:loading",class:"rotating"}),s("span",null,c(f.$t("fileBrowser.loadingContent")),1)])):d.value?(m(),v("div",Qd,[S(r(P),{icon:"carbon:warning"}),s("span",null,c(d.value),1)])):p.value?(m(),v("div",Zd,[k.value?(m(),v("div",eu,[s("pre",null,[s("code",null,c(p.value.content),1)])])):(m(),v("div",tu,[S(r(P),{icon:"carbon:document-unknown"}),s("p",null,c(f.$t("fileBrowser.binaryFile")),1),s("button",{onClick:q[1]||(q[1]=x=>b(i.value)),class:"download-btn-large"},[S(r(P),{icon:"carbon:download"}),ne(" "+c(f.$t("fileBrowser.downloadToView")),1)])]))])):B("",!0)])])):B("",!0)])]))}}),nu=me(su,[["__scopeId","data-v-e7c74fe4"]]),ou={class:"right-panel"},au={class:"preview-header"},lu={class:"preview-tabs"},ru={class:"preview-content"},iu={key:0,class:"step-details"},cu={key:0,class:"step-info"},du={key:0,class:"agent-info"},uu={class:"info-item"},pu={class:"label"},mu={class:"value"},hu={class:"info-item"},fu={class:"label"},vu={class:"value"},gu={class:"info-item"},bu={class:"label"},yu={class:"execution-status"},_u={class:"status-item"},$u={class:"status-text"},wu={key:0},Su={key:0,class:"think-act-steps"},ku={class:"steps-container"},Tu={class:"step-header"},Pu={class:"step-number"},Eu={class:"think-section"},Cu={class:"think-content"},Ru={class:"input"},Iu={class:"label"},Au={class:"output"},xu={class:"label"},Du={key:0,class:"action-section"},Fu={class:"action-content"},Uu={class:"tool-info"},Mu={class:"label"},Nu={class:"value"},Ou={class:"input"},Lu={class:"label"},Bu={class:"output"},qu={class:"label"},ju={key:0,class:"sub-plan-section"},Vu={class:"sub-plan-content"},Hu={class:"sub-plan-header"},Gu={class:"sub-plan-info"},Wu={class:"label"},zu={class:"value"},Ju={key:0,class:"sub-plan-info"},Ku={class:"label"},Xu={class:"value"},Yu={class:"sub-plan-status"},Qu={class:"status-text"},Zu={key:0,class:"no-steps-message"},ep={key:1,class:"no-execution-message"},tp={class:"step-basic-info"},sp={class:"info-item"},np={class:"label"},op={class:"value"},ap={key:0,class:"info-item"},lp={class:"label"},rp={class:"value"},ip={class:"info-item"},cp={class:"label"},dp={class:"no-execution-hint"},up={key:2,class:"execution-indicator"},pp={class:"execution-text"},mp={key:1,class:"no-selection"},hp=["title"],fp={key:1,class:"file-browser-container"},vp={key:1,class:"no-plan-message"},gp={class:"message-content"},bp={class:"tips"},yp=pe({__name:"RightPanel",props:{currentRootPlanId:{},selectedStepId:{}},setup(o,{expose:e}){const n=o,{t}=ke(),a=F(),l=F(),i=F("details"),p=F(localStorage.getItem("jmanus-last-plan-id")),g=F(localStorage.getItem("jmanus-has-executed-plan")==="true"),d=F(!1),u=F(!0),k=F(!0),C=fe(()=>l.value?l.value.completed?t("rightPanel.status.completed"):l.value.current?t("rightPanel.status.executing"):t("rightPanel.status.waiting"):""),U=fe(()=>n.currentRootPlanId?n.currentRootPlanId:p.value),_=fe(()=>!U.value&&!g.value),y=async D=>{var M,z,Q;if(console.log("[RightPanel] Step selected:",{stepId:D}),!D){console.warn("[RightPanel] No stepId provided"),l.value=null;return}try{const E=await Fs(D);if(!E){console.warn("[RightPanel] Agent execution detail not found for stepId:",D),l.value=null;return}const A={stepId:D,title:E.agentName||`Step ${D}`,description:E.agentDescription||"",agentExecution:E,completed:E.status==="FINISHED",current:E.status==="RUNNING"};l.value=A,console.log("[RightPanel] Step details updated:",A),console.log("[RightPanel] activeTab:",i.value),console.log("[RightPanel] selectedStep.value:",l.value),console.log("[RightPanel] agentExecution:",l.value.agentExecution),console.log("[RightPanel] thinkActSteps:",(M=l.value.agentExecution)==null?void 0:M.thinkActSteps),console.log("[RightPanel] thinkActSteps length:",(Q=(z=l.value.agentExecution)==null?void 0:z.thinkActSteps)==null?void 0:Q.length),await Pe(),console.log("[RightPanel] After nextTick - selectedStep:",l.value),setTimeout(()=>{T()},100),R()}catch(E){console.error("[RightPanel] Error fetching step details:",E),l.value=null}},h=async()=>{var D;if(!((D=l.value)!=null&&D.stepId)){console.warn("[RightPanel] No step selected for refresh");return}console.log("[RightPanel] Refreshing current step:",l.value.stepId);try{const M=await bd(l.value.stepId);M&&l.value&&(l.value.agentExecution=M,l.value.completed=M.status==="FINISHED",l.value.current=M.status==="RUNNING",console.log("[RightPanel] Step refreshed successfully"),R())}catch(M){console.error("[RightPanel] Error refreshing step:",M)}};ue(()=>n.selectedStepId,async D=>{D?await y(D):l.value=null},{immediate:!0});const b=D=>{a.value=D??void 0},T=()=>{if(!a.value)return;const{scrollTop:D,scrollHeight:M,clientHeight:z}=a.value,Q=M-D-z<50,E=M>z;u.value=Q,d.value=E&&!Q,Q?k.value=!0:M-D-z>100&&(k.value=!1),console.log("[RightPanel] Scroll state check:",{scrollTop:D,scrollHeight:M,clientHeight:z,isAtBottom:Q,hasScrollableContent:E,showButton:d.value,shouldAutoScroll:k.value})},$=()=>{a.value&&(a.value.scrollTo({top:a.value.scrollHeight,behavior:"smooth"}),Pe(()=>{k.value=!0,T()}))},R=()=>{!k.value||!a.value||Pe(()=>{a.value&&(a.value.scrollTop=a.value.scrollHeight,console.log("[RightPanel] Auto scroll to bottom"))})},f=D=>{if(D===null||typeof D>"u"||D==="")return"N/A";try{const M=typeof D=="object"?D:JSON.parse(D);return JSON.stringify(M,null,2)}catch{return String(D)}},q=()=>{l.value=null,k.value=!0,a.value&&a.value.removeEventListener("scroll",T)},x=()=>{const D=()=>{const M=a.value;return M?(b(M),M.addEventListener("scroll",T),k.value=!0,T(),console.log("[RightPanel] Scroll listener initialized successfully"),!0):(console.log("[RightPanel] Scroll container not found, retrying..."),!1)};Pe(()=>{D()||setTimeout(()=>{D()},100)})};return ue(()=>n.currentRootPlanId,(D,M)=>{D&&D!==M?(p.value=D,g.value=!0,localStorage.setItem("jmanus-last-plan-id",D),localStorage.setItem("jmanus-has-executed-plan","true"),console.log("[RightPanel] New plan started:",D)):!D&&M&&console.log("[RightPanel] Plan execution finished, keeping last plan:",p.value)},{immediate:!0}),Te(()=>{console.log("[RightPanel] Component mounted"),Pe(()=>{x()})}),Se(()=>{console.log("[RightPanel] Component unmounting, cleaning up..."),q()}),e({handleStepSelected:y,refreshCurrentStep:h,updateDisplayedPlanProgress:D=>{console.log("[RightPanel] updateDisplayedPlanProgress called with rootPlanId:",D),D&&(p.value=D,g.value=!0,localStorage.setItem("jmanus-last-plan-id",D),localStorage.setItem("jmanus-has-executed-plan","true"),console.log("[RightPanel] Plan progress updated:",D))}}),(D,M)=>{var z,Q;return m(),v("div",ou,[s("div",au,[s("div",lu,[s("div",{class:oe(["tab-item",{active:i.value==="details"}]),onClick:M[0]||(M[0]=E=>i.value="details")},[S(r(P),{icon:"carbon:events"}),s("span",null,c(r(t)("rightPanel.stepExecutionDetails")),1)],2),s("div",{class:oe(["tab-item",{active:i.value==="files"}]),onClick:M[1]||(M[1]=E=>i.value="files")},[S(r(P),{icon:"carbon:folder"}),s("span",null,c(r(t)("fileBrowser.title")),1)],2)])]),s("div",ru,[i.value==="details"?(m(),v("div",iu,[l.value?(m(),v("div",cu,[s("h3",null,c(l.value.title||l.value.description||r(t)("rightPanel.defaultStepTitle",{number:1})),1),l.value.agentExecution?(m(),v("div",du,[s("div",uu,[s("span",pu,c(r(t)("rightPanel.executingAgent"))+":",1),s("span",mu,c(l.value.agentExecution.agentName),1)]),s("div",hu,[s("span",fu,c(r(t)("rightPanel.callingModel"))+":",1),s("span",vu,c(l.value.agentExecution.modelName),1)]),s("div",gu,[s("span",bu,c(r(t)("rightPanel.executionResult"))+":",1),s("span",{class:oe(["value",{success:l.value.agentExecution.status==="FINISHED"}])},c(l.value.agentExecution.status||r(t)("rightPanel.executing")),3)])])):B("",!0),s("div",yu,[s("div",_u,[l.value.completed?(m(),ie(r(P),{key:0,icon:"carbon:checkmark-filled",class:"status-icon success"})):l.value.current?(m(),ie(r(P),{key:1,icon:"carbon:in-progress",class:"status-icon progress"})):(m(),ie(r(P),{key:2,icon:"carbon:time",class:"status-icon pending"})),s("span",$u,c(C.value),1)])])])):B("",!0),s("div",{ref_key:"scrollContainer",ref:a,class:"step-details-scroll-container",onScroll:T},[l.value?(m(),v("div",wu,[(z=l.value.agentExecution)!=null&&z.thinkActSteps&&l.value.agentExecution.thinkActSteps.length>0?(m(),v("div",Su,[s("h4",null,c(r(t)("rightPanel.thinkAndActionSteps")),1),s("div",ku,[(m(!0),v(re,null,de(l.value.agentExecution.thinkActSteps,(E,A)=>(m(),v("div",{key:A,class:"think-act-step"},[s("div",Tu,[s("span",Pu,"#"+c(A+1),1),s("span",{class:oe(["step-status",E.status])},c(E.status||r(t)("rightPanel.executing")),3)]),s("div",Eu,[s("h5",null,[S(r(P),{icon:"carbon:thinking"}),ne(" "+c(r(t)("rightPanel.thinking")),1)]),s("div",Cu,[s("div",Ru,[s("span",Iu,c(r(t)("rightPanel.input"))+":",1),s("pre",null,c(f(E.thinkInput)),1)]),s("div",Au,[s("span",xu,c(r(t)("rightPanel.output"))+":",1),s("pre",null,c(f(E.thinkOutput)),1)])])]),E.actionNeeded?(m(),v("div",Du,[s("h5",null,[S(r(P),{icon:"carbon:play"}),ne(" "+c(r(t)("rightPanel.action")),1)]),s("div",Fu,[(m(!0),v(re,null,de(E.actToolInfoList,(J,Y)=>(m(),v("div",{key:Y},[s("div",Uu,[s("span",Mu,c(r(t)("rightPanel.tool"))+":",1),s("span",Nu,c(J.name||""),1)]),s("div",Ou,[s("span",Lu,c(r(t)("rightPanel.toolParameters"))+":",1),s("pre",null,c(f(J.parameters)),1)]),s("div",Bu,[s("span",qu,c(r(t)("rightPanel.executionResult"))+":",1),s("pre",null,c(f(J.result)),1)])]))),128))]),E.subPlanExecutionRecord?(m(),v("div",ju,[s("h5",null,[S(r(P),{icon:"carbon:tree-view"}),ne(" "+c(r(t)("rightPanel.subPlan")),1)]),s("div",Vu,[s("div",Hu,[s("div",Gu,[s("span",Wu,c(D.$t("rightPanel.subPlanId"))+":",1),s("span",zu,c(E.subPlanExecutionRecord.currentPlanId),1)]),E.subPlanExecutionRecord.title?(m(),v("div",Ju,[s("span",Ku,c(D.$t("rightPanel.title"))+":",1),s("span",Xu,c(E.subPlanExecutionRecord.title),1)])):B("",!0),s("div",Yu,[E.subPlanExecutionRecord.completed?(m(),ie(r(P),{key:0,icon:"carbon:checkmark-filled",class:"status-icon success"})):(m(),ie(r(P),{key:1,icon:"carbon:in-progress",class:"status-icon progress"})),s("span",Qu,c(E.subPlanExecutionRecord.completed?D.$t("rightPanel.status.completed"):D.$t("rightPanel.status.executing")),1)])])])])):B("",!0)])):B("",!0)]))),128))]),l.value.agentExecution&&!((Q=l.value.agentExecution.thinkActSteps)!=null&&Q.length)?(m(),v("div",Zu,[s("p",null,c(r(t)("rightPanel.noStepDetails")),1)])):l.value.agentExecution?B("",!0):(m(),v("div",ep,[S(r(P),{icon:"carbon:information",class:"info-icon"}),s("h4",null,c(r(t)("rightPanel.stepInfo")),1),s("div",tp,[s("div",sp,[s("span",np,c(r(t)("rightPanel.stepName"))+":",1),s("span",op,c(l.value.title||l.value.description||l.value.stepId),1)]),l.value.description?(m(),v("div",ap,[s("span",lp,c(D.$t("rightPanel.description"))+":",1),s("span",rp,c(l.value.description),1)])):B("",!0),s("div",ip,[s("span",cp,c(D.$t("rightPanel.status.label"))+":",1),s("span",{class:oe(["value",{"status-completed":l.value.completed,"status-current":l.value.current,"status-pending":!l.value.completed&&!l.value.current}])},c(l.value.completed?D.$t("rightPanel.status.completed"):l.value.current?D.$t("rightPanel.status.executing"):D.$t("rightPanel.status.pending")),3)])]),s("p",dp,c(r(t)("rightPanel.noExecutionInfo")),1)])),l.value.current&&!l.value.completed?(m(),v("div",up,[M[2]||(M[2]=s("div",{class:"execution-waves"},[s("div",{class:"wave wave-1"}),s("div",{class:"wave wave-2"}),s("div",{class:"wave wave-3"})],-1)),s("p",pp,[S(r(P),{icon:"carbon:in-progress",class:"rotating-icon"}),ne(" "+c(r(t)("rightPanel.stepExecuting")),1)])])):B("",!0)])):(m(),v("div",mp,[S(r(P),{icon:"carbon:events",class:"empty-icon"}),s("h3",null,c(r(t)("rightPanel.noStepSelected")),1),s("p",null,c(r(t)("rightPanel.selectStepHint")),1)]))])):B("",!0),S(Be,{name:"scroll-button"},{default:Ue(()=>[d.value?(m(),v("button",{key:0,onClick:$,class:"scroll-to-bottom-btn",title:r(t)("rightPanel.scrollToBottom")},[S(r(P),{icon:"carbon:chevron-down"})],8,hp)):B("",!0)]),_:1})],544)])):B("",!0),i.value==="files"?(m(),v("div",fp,[U.value?(m(),ie(nu,{key:0,"plan-id":U.value},null,8,["plan-id"])):_.value?(m(),v("div",vp,[S(r(P),{icon:"carbon:folder-off"}),s("div",gp,[s("h3",null,c(r(t)("fileBrowser.noFilesYet")),1),s("p",null,c(r(t)("fileBrowser.noPlanExecuting")),1),s("div",bp,[S(r(P),{icon:"carbon:information"}),s("span",null,c(r(t)("fileBrowser.startTaskTip")),1)])])])):B("",!0)])):B("",!0)])])}}}),_p=me(yp,[["__scopeId","data-v-ea214380"]]);function Nt(){return{formatResponseText:g=>g?g.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/\*(.*?)\*/g,"<em>$1</em>").replace(/`([^`]+)`/g,"<code>$1</code>").replace(/\n/g,"<br>").replace(/```([\s\S]*?)```/g,"<pre><code>$1</code></pre>"):"",formatTimestamp:g=>{const u=new Date().getTime()-g.getTime();return u<6e4?"Just now":u<36e5?`${Math.floor(u/6e4)} minutes ago`:u<864e5?`${Math.floor(u/36e5)} hours ago`:g.toLocaleDateString("zh-CN",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})},getMessageClasses:g=>fe(()=>({user:g.type==="user",assistant:g.type==="assistant",streaming:g.isStreaming,"has-error":!!g.error,"has-thinking":!!g.thinking,"has-execution":!!g.planExecution})),formatFileSize:g=>{if(g===0)return"0 B";const d=1024,u=["B","KB","MB","GB"],k=Math.floor(Math.log(g)/Math.log(d));return parseFloat((g/Math.pow(d,k)).toFixed(2))+" "+u[k]},truncateText:(g,d=100)=>!g||g.length<=d?g:g.substring(0,d)+"...",stripHtml:g=>g.replace(/<[^>]*>/g,""),hasDisplayableContent:g=>!!(g.content||g.thinking||g.planExecution||g.error),getMessageStatus:g=>g.error?"Send failed":g.isStreaming?"Typing...":g.type==="assistant"&&!g.content&&!g.thinking?"Waiting for response":""}}const $p=["data-message-id"],wp={class:"user-content"},Sp={class:"message-text"},kp={key:0,class:"attachments"},Tp={class:"attachment-name"},Pp={class:"attachment-size"},Ep={class:"message-timestamp"},Cp={key:0,class:"message-status error"},Rp={class:"status-text"},Ip=pe({__name:"UserMessage",props:{message:{}},setup(o){const{formatTimestamp:e,formatFileSize:n}=Nt();return(t,a)=>{var l;return m(),v("div",{class:"user-message","data-message-id":t.message.id},[s("div",wp,[s("div",Sp,c(t.message.content),1),(l=t.message.attachments)!=null&&l.length?(m(),v("div",kp,[(m(!0),v(re,null,de(t.message.attachments,(i,p)=>(m(),v("div",{key:p,class:"attachment-item"},[S(r(P),{icon:"carbon:document",class:"attachment-icon"}),s("span",Tp,c(i.name),1),s("span",Pp,c(r(n)(i.size)),1)]))),128))])):B("",!0),s("div",Ep,c(r(e)(t.message.timestamp)),1)]),t.message.error?(m(),v("div",Cp,[S(r(P),{icon:"carbon:warning",class:"status-icon"}),s("span",Rp,c(t.message.error),1)])):B("",!0)],8,$p)}}}),Ap=me(Ip,[["__scopeId","data-v-94372507"]]),xp={class:"sub-plan-info"},Dp={class:"sub-plan-details"},Fp={class:"sub-plan-title"},Up={key:0,class:"nesting-level"},Mp={class:"sub-plan-id"},Np={class:"sub-plan-meta"},Op={key:0,class:"trigger-tool"},Lp={class:"trigger-text"},Bp={key:0,class:"sub-plan-progress"},qp={class:"progress-info"},jp={class:"progress-text"},Vp={class:"progress-bar"},Hp={key:1,class:"sub-plan-agents-steps"},Gp={class:"agents-steps-header"},Wp={class:"agents-label"},zp={class:"agents-steps-list"},Jp=["onClick"],Kp={class:"agent-step-header"},Xp={class:"agent-name"},Yp={class:"sub-agent-execution-info"},Qp={key:0,class:"agent-result"},Zp={class:"result-header"},em={class:"result-label"},tm={class:"result-content"},sm={key:1,class:"agent-error"},nm={class:"error-header"},om={class:"error-label"},am={class:"error-content"},lm={key:2,class:"think-act-preview"},rm={class:"think-act-header"},im={class:"think-act-label"},cm={class:"think-act-steps-preview"},dm=["onClick"],um={class:"step-number"},pm={class:"step-description"},mm={key:0,class:"more-steps"},hm={class:"more-steps-text"},fm={key:3,class:"nested-sub-plans"},vm={class:"nested-sub-plans-header"},gm={class:"nested-label"},bm={class:"nested-sub-plans-list"},ym={key:4,class:"direct-sub-plans"},_m={class:"direct-sub-plans-header"},$m={class:"direct-label"},wm={class:"direct-sub-plans-list"},Sm=pe({__name:"RecursiveSubPlan",props:{subPlan:{},subPlanIndex:{},nestingLevel:{default:0},maxNestingDepth:{default:3},maxVisibleSteps:{default:2}},emits:["sub-plan-selected","step-selected"],setup(o,{emit:e}){const n=o,t=e,{t:a}=ke(),l=()=>`nesting-level-${n.nestingLevel}`,i=()=>{var x,te;return n.subPlan.completed?"completed":((x=n.subPlan.agentExecutionSequence)==null?void 0:x.some(D=>D.status==="RUNNING"))?"running":((te=n.subPlan.agentExecutionSequence)==null?void 0:te.some(D=>D.status==="FINISHED"))?"in-progress":"pending"},p=()=>{switch(i()){case"completed":return a("chat.status.completed");case"running":return a("chat.status.executing");case"in-progress":return a("chat.status.inProgress");case"pending":return a("chat.status.pending");default:return a("chat.status.unknown")}},g=()=>{switch(i()){case"completed":return"carbon:checkmark";case"running":return"carbon:play";case"in-progress":return"carbon:in-progress";case"pending":default:return"carbon:dot-mark"}},d=()=>{var q;if(!((q=n.subPlan.agentExecutionSequence)!=null&&q.length))return 0;if(n.subPlan.completed)return 100;const f=u();return Math.min(100,f/n.subPlan.agentExecutionSequence.length*100)},u=()=>{var f;return(f=n.subPlan.agentExecutionSequence)!=null&&f.length?n.subPlan.agentExecutionSequence.filter(q=>q.status==="FINISHED").length:0},k=f=>{switch(f){case"FINISHED":return"completed";case"RUNNING":return"running";case"IDLE":default:return"pending"}},C=f=>{switch(f){case"FINISHED":return"carbon:checkmark";case"RUNNING":return"carbon:play";case"IDLE":default:return"carbon:dot-mark"}},U=f=>{switch(f){case"RUNNING":return a("chat.status.executing");case"FINISHED":return a("chat.status.completed");case"IDLE":default:return a("chat.status.pending")}},_=f=>{var q;return((q=f.thinkActSteps)==null?void 0:q.some(x=>x.subPlanExecutionRecord))??!1},y=f=>{var q;return((q=f.thinkActSteps)==null?void 0:q.filter(x=>x.subPlanExecutionRecord))??[]},h=()=>{t("sub-plan-selected",-1,n.subPlanIndex,n.subPlan)},b=(f,q)=>{const x=q.stepId||`subplan-${n.subPlanIndex}-agent-${f}`;t("step-selected",x)},T=(f,q,x)=>{const te=x.stepId||`subplan-${n.subPlanIndex}-agent-${f}`;t("step-selected",te)},$=(f,q,x)=>{t("sub-plan-selected",f,q,x)},R=f=>{t("step-selected",f)};return(f,q)=>{var te,D;const x=ss("RecursiveSubPlan",!0);return m(),v("div",{class:oe(["recursive-sub-plan",l()])},[s("div",{class:"sub-plan-header",onClick:h},[s("div",xp,[S(r(P),{icon:g(),class:"sub-plan-status-icon"},null,8,["icon"]),s("div",Dp,[s("div",Fp,[ne(c(f.subPlan.title||f.$t("chat.subPlan"))+" #"+c(f.subPlanIndex+1)+" ",1),(f.nestingLevel??0)>0?(m(),v("span",Up,"(L"+c((f.nestingLevel??0)+1)+")",1)):B("",!0)]),s("div",Mp,c(f.subPlan.currentPlanId),1)])]),s("div",Np,[s("div",{class:oe(["sub-plan-status-badge",i()])},c(p()),3),f.subPlan.parentActToolCall?(m(),v("div",Op,[S(r(P),{icon:"carbon:function",class:"trigger-icon"}),s("span",Lp,c(f.subPlan.parentActToolCall.name),1)])):B("",!0)])]),(te=f.subPlan.agentExecutionSequence)!=null&&te.length?(m(),v("div",Bp,[s("div",qp,[s("span",jp,c(f.$t("chat.progress"))+": "+c(u())+" / "+c(f.subPlan.agentExecutionSequence.length),1),s("div",Vp,[s("div",{class:"progress-fill",style:Ge({width:d()+"%"})},null,4)])])])):B("",!0),(D=f.subPlan.agentExecutionSequence)!=null&&D.length?(m(),v("div",Hp,[s("div",Gp,[s("span",Wp,c(f.$t("chat.agentExecutions"))+":",1)]),s("div",zp,[(m(!0),v(re,null,de(f.subPlan.agentExecutionSequence,(M,z)=>{var Q,E;return m(),v("div",{key:M.id||z,class:oe(["agent-step-item",k(M.status)]),onClick:A=>b(z,M)},[s("div",Kp,[S(r(P),{icon:C(M.status),class:"agent-icon"},null,8,["icon"]),s("span",Xp,c(M.agentName||f.$t("chat.unknownAgent")),1),s("div",{class:oe(["agent-status-badge",k(M.status)])},c(U(M.status)),3)]),s("div",Yp,[M.result?(m(),v("div",Qp,[s("div",Zp,[S(r(P),{icon:"carbon:checkmark",class:"result-icon"}),s("span",em,c(f.$t("chat.agentResult"))+":",1)]),s("pre",tm,c(M.result),1)])):B("",!0),M.errorMessage?(m(),v("div",sm,[s("div",nm,[S(r(P),{icon:"carbon:warning",class:"error-icon"}),s("span",om,c(f.$t("chat.errorMessage"))+":",1)]),s("pre",am,c(M.errorMessage),1)])):B("",!0),(Q=M.thinkActSteps)!=null&&Q.length?(m(),v("div",lm,[s("div",rm,[S(r(P),{icon:"carbon:thinking",class:"think-act-icon"}),s("span",im,c(f.$t("chat.thinkActSteps"))+" ("+c(M.thinkActSteps.length)+")",1)]),s("div",cm,[(m(!0),v(re,null,de(M.thinkActSteps.slice(0,f.maxVisibleSteps??2),(A,J)=>(m(),v("div",{key:A.id||J,class:"think-act-step-preview",onClick:ve(Y=>T(z,J,M),["stop"])},[s("span",um,"#"+c(J+1),1),s("span",pm,c(A.actionDescription||f.$t("chat.thinking")),1),S(r(P),{icon:"carbon:arrow-right",class:"step-arrow"})],8,dm))),128)),M.thinkActSteps.length>(f.maxVisibleSteps??2)?(m(),v("div",mm,[s("span",hm,c(f.$t("chat.andMoreSteps",{count:M.thinkActSteps.length-(f.maxVisibleSteps??2)})),1)])):B("",!0)])])):B("",!0),_(M)?(m(),v("div",fm,[s("div",vm,[S(r(P),{icon:"carbon:tree-view-alt",class:"nested-icon"}),s("span",gm,c(f.$t("chat.nestedSubPlans")),1)]),s("div",bm,[(m(!0),v(re,null,de(y(M),(A,J)=>(m(),ie(x,{key:A.id||J,"sub-plan":A.subPlanExecutionRecord,"sub-plan-index":J,"nesting-level":(f.nestingLevel??0)+1,"max-nesting-depth":f.maxNestingDepth??3,"max-visible-steps":f.maxVisibleSteps??2,onSubPlanSelected:$,onStepSelected:R},null,8,["sub-plan","sub-plan-index","nesting-level","max-nesting-depth","max-visible-steps"]))),128))])])):B("",!0),(E=M.subPlanExecutionRecords)!=null&&E.length?(m(),v("div",ym,[s("div",_m,[S(r(P),{icon:"carbon:tree-view",class:"direct-icon"}),s("span",$m,c(f.$t("chat.directSubPlans")),1)]),s("div",wm,[(m(!0),v(re,null,de(M.subPlanExecutionRecords,(A,J)=>(m(),ie(x,{key:A.currentPlanId||J,"sub-plan":A,"sub-plan-index":J,"nesting-level":(f.nestingLevel??0)+1,"max-nesting-depth":f.maxNestingDepth??3,"max-visible-steps":f.maxVisibleSteps??2,onSubPlanSelected:$,onStepSelected:R},null,8,["sub-plan","sub-plan-index","nesting-level","max-nesting-depth","max-visible-steps"]))),128))])])):B("",!0)])],10,Jp)}),128))])])):B("",!0)],2)}}}),km=me(Sm,[["__scopeId","data-v-5ef3cbb7"]]),Tm={class:"execution-details"},Pm={key:0,class:"plan-overview"},Em={class:"plan-header"},Cm={class:"plan-title"},Rm={key:0,class:"parent-tool-call"},Im={class:"parent-tool-header"},Am={class:"tool-label"},xm={class:"tool-name"},Dm={key:0,class:"tool-parameters"},Fm={class:"param-label"},Um={class:"param-content"},Mm={key:1,class:"agent-execution-container"},Nm={class:"section-title"},Om=["onClick"],Lm={class:"agent-info"},Bm={class:"agent-details"},qm={class:"agent-name"},jm={class:"request-content"},Vm={class:"agent-controls"},Hm={class:"agent-execution-info"},Gm={key:0,class:"agent-result"},Wm={class:"result-header"},zm={class:"result-label"},Jm={class:"result-content"},Km={key:1,class:"agent-error"},Xm={class:"error-header"},Ym={class:"error-label"},Qm={class:"error-content"},Zm={key:0,class:"sub-plans-container"},eh={class:"sub-plans-header"},th={class:"sub-plans-title"},sh={class:"sub-plans-list"},nh=pe({__name:"ExecutionDetails",props:{planExecution:{},genericInput:{}},emits:["agent-selected","sub-plan-selected","user-input-submitted","step-selected"],setup(o,{emit:e}){const n=o,t=e,{t:a}=ke(),l=fe(()=>{var y;return((y=n.planExecution)==null?void 0:y.agentExecutionSequence)??[]}),i=y=>{y.stepId?t("step-selected",y.stepId):console.warn("[ExecutionDetails] Agent execution has no stepId:",y)},p=()=>n.planExecution?n.planExecution.completed?"completed":l.value.some(b=>b.status==="RUNNING")?"running":l.value.some(b=>b.status==="FINISHED")?"in-progress":"pending":"unknown",g=()=>{switch(p()){case"completed":return a("chat.status.completed");case"running":return a("chat.status.executing");case"in-progress":return a("chat.status.inProgress");case"pending":return a("chat.status.pending");default:return a("chat.status.unknown")}},d=y=>{switch(y){case"RUNNING":return"running";case"FINISHED":return"completed";case"IDLE":default:return"pending"}},u=y=>{switch(y){case"RUNNING":return a("chat.status.executing");case"FINISHED":return a("chat.status.completed");case"IDLE":default:return a("chat.status.pending")}},k=y=>{switch(y){case"RUNNING":return"carbon:play";case"FINISHED":return"carbon:checkmark";case"IDLE":default:return"carbon:dot-mark"}},C=(y,h,b)=>{t("sub-plan-selected",y,h,b)},U=y=>{t("step-selected",y)},_=y=>{if(!y)return"";try{const h=JSON.parse(y);return JSON.stringify(h,null,2)}catch{return y}};return(y,h)=>{var b,T,$;return m(),v("div",Tm,[y.planExecution?(m(),v("div",Pm,[s("div",Em,[s("h3",Cm,c(y.planExecution.title||y.$t("chat.planExecution")),1),s("div",{class:oe(["plan-status-badge",p()])},c(g()),3)]),y.planExecution.parentActToolCall?(m(),v("div",Rm,[s("div",Im,[S(r(P),{icon:"carbon:flow",class:"tool-icon"}),s("span",Am,c(y.$t("chat.triggeredByTool"))+":",1),s("span",xm,c(y.planExecution.parentActToolCall.name),1)]),y.planExecution.parentActToolCall.parameters?(m(),v("div",Dm,[s("span",Fm,c(y.$t("common.parameters"))+":",1),s("pre",Um,c(_(y.planExecution.parentActToolCall.parameters)),1)])):B("",!0)])):B("",!0)])):B("",!0),(((T=(b=y.planExecution)==null?void 0:b.agentExecutionSequence)==null?void 0:T.length)??0)>0?(m(),v("div",Mm,[s("h4",Nm,c(y.$t("chat.agentExecutionSequence")),1),(m(!0),v(re,null,de(($=y.planExecution)==null?void 0:$.agentExecutionSequence,(R,f)=>{var q;return m(),v("div",{key:R.id||f,class:oe(["agent-execution-item",d(R.status)])},[s("div",{class:"agent-header",onClick:x=>i(R)},[s("div",Lm,[S(r(P),{icon:k(R.status),class:"agent-status-icon"},null,8,["icon"]),s("div",Bm,[s("div",qm,c(R.agentName||y.$t("chat.unknownAgent")),1),s("pre",jm,c(R.agentRequest),1)])]),s("div",Vm,[s("div",{class:oe(["agent-status-badge",d(R.status)])},c(u(R.status)),3),S(r(P),{icon:"carbon:arrow-right",class:"step-select-icon"})])],8,Om),s("div",Hm,[R.result?(m(),v("div",Gm,[s("div",Wm,[S(r(P),{icon:"carbon:checkmark",class:"result-icon"}),s("span",zm,c(y.$t("chat.agentResult"))+":",1)]),s("pre",Jm,c(R.result),1)])):B("",!0),R.errorMessage?(m(),v("div",Km,[s("div",Xm,[S(r(P),{icon:"carbon:warning",class:"error-icon"}),s("span",Ym,c(y.$t("chat.errorMessage"))+":",1)]),s("pre",Qm,c(R.errorMessage),1)])):B("",!0)]),(q=R.subPlanExecutionRecords)!=null&&q.length?(m(),v("div",Zm,[s("div",eh,[S(r(P),{icon:"carbon:tree-view",class:"sub-plans-icon"}),s("span",th,c(y.$t("chat.subPlanExecutions"))+" ("+c(R.subPlanExecutionRecords.length)+") ",1)]),s("div",sh,[(m(!0),v(re,null,de(R.subPlanExecutionRecords,(x,te)=>(m(),ie(km,{key:x.currentPlanId||te,"sub-plan":x,"sub-plan-index":te,"nesting-level":0,"max-nesting-depth":3,"max-visible-steps":2,onSubPlanSelected:C,onStepSelected:U},null,8,["sub-plan","sub-plan-index"]))),128))])])):B("",!0)],2)}),128))])):B("",!0)])}}}),Us=me(nh,[["__scopeId","data-v-2d936ebb"]]),oh={key:0,class:"thinking-section"},ah={class:"thinking-header"},lh={class:"thinking-avatar"},rh={class:"thinking-label"},ih={class:"thinking-content"},ch={key:0,class:"thinking"},dh={key:2,class:"default-processing"},uh={class:"processing-indicator"},ph=pe({__name:"ThinkingSection",props:{thinking:{},thinkingDetails:{},planExecution:{},stepActions:{},genericInput:{},hasContent:{type:Boolean}},emits:["agent-selected","sub-plan-selected","user-input-submitted","step-selected"],setup(o,{emit:e}){const n=o,t=e,a=fe(()=>{var d,u,k,C;return n.thinking||(((u=(d=n.thinkingDetails)==null?void 0:d.agentExecutionSequence)==null?void 0:u.length)??0)>0||(((C=(k=n.planExecution)==null?void 0:k.agentExecutionSequence)==null?void 0:C.length)??0)>0}),l=(d,u)=>{t("agent-selected",d,u)},i=(d,u,k)=>{t("sub-plan-selected",d,u,k)},p=d=>{t("user-input-submitted",d)},g=d=>{t("step-selected",d)};return(d,u)=>a.value?(m(),v("div",oh,[s("div",ah,[s("div",lh,[S(r(P),{icon:"carbon:thinking",class:"thinking-icon"})]),s("div",rh,c(d.$t("chat.thinkingLabel")),1)]),s("div",ih,[d.thinking?(m(),v("div",ch,[S(r(P),{icon:"carbon:thinking",class:"thinking-icon"}),s("span",null,c(d.thinking),1)])):B("",!0),d.thinkingDetails||d.planExecution?(m(),ie(Us,{key:1,"plan-execution":d.thinkingDetails||d.planExecution,"step-actions":d.stepActions||[],"generic-input":d.genericInput||"",onAgentSelected:l,onSubPlanSelected:i,onUserInputSubmitted:p,onStepSelected:g},null,8,["plan-execution","step-actions","generic-input"])):!d.hasContent&&d.thinking?(m(),v("div",dh,[s("div",uh,[u[0]||(u[0]=s("div",{class:"thinking-dots"},[s("span"),s("span"),s("span")],-1)),s("span",null,c(d.thinking||d.$t("chat.thinkingProcessing")),1)])])):B("",!0)])])):B("",!0)}}),mh=me(ph,[["__scopeId","data-v-c341487f"]]);class _t{static async getDetails(e){try{const n=await fetch(`${this.BASE_URL}/details/${e}`);if(n.status===404)return null;if(!n.ok){const l=await n.text();throw new Error(`Failed to get detailed information: ${n.status} - ${l}`)}const t=await n.text(),a=JSON.parse(t);return a&&typeof a=="object"&&!a.currentPlanId&&(a.currentPlanId=e),a}catch(n){return console.error("[CommonApiService] Failed to get plan details:",n),null}}static async submitFormInput(e,n){const t=await fetch(`${this.BASE_URL}/submit-input/${e}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});if(!t.ok){let l;try{l=await t.json()}catch{l={message:`Failed to submit form input: ${t.status}`}}throw new Error(l.message||`Failed to submit form input: ${t.status}`)}const a=t.headers.get("content-type");return a&&a.indexOf("application/json")!==-1?await t.json():{success:!0}}static async getAllPrompts(){try{const e=await fetch(this.BASE_URL);return await(await this.handleResponse(e)).json()}catch(e){throw console.error("Failed to get Prompt list:",e),e}}static async handleResponse(e){if(!e.ok)try{const n=await e.json();throw new Error(n.message||`API request failed: ${e.status}`)}catch{throw new Error(`API request failed: ${e.status} ${e.statusText}`)}return e}}be(_t,"BASE_URL","/api/executor");const hh={class:"user-input-form-container"},fh={class:"user-input-header"},vh={class:"user-input-title"},gh={class:"user-input-message"},bh={key:0,class:"form-description"},yh={key:0,class:"form-grid"},_h=["for"],$h=["id","name","placeholder","required","onUpdate:modelValue"],wh=["id","name","placeholder","required","onUpdate:modelValue"],Sh=["id","name","placeholder","required","onUpdate:modelValue"],kh=["id","name","placeholder","required","onUpdate:modelValue"],Th=["id","name","placeholder","required","onUpdate:modelValue"],Ph=["id","name","required","onUpdate:modelValue"],Eh={value:""},Ch=["value"],Rh={key:6,class:"checkbox-group"},Ih=["id","name","value","onUpdate:modelValue"],Ah={class:"checkbox-label"},xh={key:7,class:"radio-group"},Dh=["id","name","value","onUpdate:modelValue"],Fh={class:"radio-label"},Uh=["id","name","placeholder","required","onUpdate:modelValue"],Mh={key:1,class:"form-group"},Nh={for:"form-input-genericInput"},Oh={type:"submit",class:"submit-user-input-btn"},Lh=pe({__name:"UserInputForm",props:{userInputWaitState:{},planId:{},genericInput:{}},emits:["user-input-submitted"],setup(o,{emit:e}){const n=o,t=e;ke();const a=tt({}),l=F(n.genericInput||""),i=F(!1),p=F(null),g=()=>{var U;const C=(U=n.userInputWaitState)==null?void 0:U.formInputs;C&&C.length>0&&(!i.value||Object.keys(a).length!==C.length)&&(C.forEach((y,h)=>{(!(h in a)||y.type==="checkbox"&&!Array.isArray(a[h])||y.type!=="checkbox"&&a[h]==="")&&(y.type==="checkbox"?a[h]=[]:a[h]="")}),i.value=!0)};Te(()=>{g()}),ue(()=>{var C;return(C=n.userInputWaitState)==null?void 0:C.formInputs},()=>{p.value&&clearTimeout(p.value),p.value=setTimeout(()=>{i.value=!1,g()},100)},{deep:!0});const d=async()=>{var C;try{const U={},_=(C=n.userInputWaitState)==null?void 0:C.formInputs;_&&_.length>0?Object.entries(a).forEach(([y,h])=>{const b=parseInt(y,10),T=_[b];if(T){const $=T.label||`input_${y}`;Array.isArray(h)?U[$]=h.join(", "):U[$]=h}}):U.genericInput=l.value,console.log("[UserInputForm] Submitting user input:",U,"for planId:",n.planId),n.planId?(await _t.submitFormInput(n.planId,U),console.log("[UserInputForm] User input submitted successfully")):console.error("[UserInputForm] No planId available for user input submission"),t("user-input-submitted",U)}catch(U){console.error("[UserInputForm] User input submission failed:",U)}},u=C=>C?Array.isArray(C)?C:typeof C=="string"?C.split(",").map(U=>U.trim()).filter(U=>U.length>0):[]:[],k=C=>typeof C=="boolean"?C:typeof C=="string"?C==="true":!1;return Se(()=>{p.value&&clearTimeout(p.value)}),(C,U)=>{var _,y,h,b,T;return m(),v("div",hh,[s("div",fh,[S(r(P),{icon:"carbon:user",class:"user-icon"}),s("h4",vh,c(C.$t("chat.userInputRequired")),1)]),s("p",gh,c(((_=C.userInputWaitState)==null?void 0:_.title)??C.$t("chat.userInput.message")),1),(y=C.userInputWaitState)!=null&&y.formDescription?(m(),v("p",bh,c((h=C.userInputWaitState)==null?void 0:h.formDescription),1)):B("",!0),s("form",{onSubmit:ve(d,["prevent"]),class:"user-input-form"},[(b=C.userInputWaitState)!=null&&b.formInputs&&C.userInputWaitState.formInputs.length>0?(m(),v("div",yh,[(m(!0),v(re,null,de((T=C.userInputWaitState)==null?void 0:T.formInputs,($,R)=>(m(),v("div",{key:R,class:"form-group"},[s("label",{for:`form-input-${$.label.replace(/\W+/g,"_")}`},c($.label)+c(k($.required)?" *":"")+": ",9,_h),!$.type||$.type==="text"?se((m(),v("input",{key:0,type:"text",id:`form-input-${$.label.replace(/\W+/g,"_")}`,name:$.label,placeholder:$.placeholder||"",required:k($.required),"onUpdate:modelValue":f=>a[R]=f,class:"form-input"},null,8,$h)),[[ce,a[R]]]):$.type==="email"?se((m(),v("input",{key:1,type:"email",id:`form-input-${$.label.replace(/\W+/g,"_")}`,name:$.label,placeholder:$.placeholder||"",required:k($.required),"onUpdate:modelValue":f=>a[R]=f,class:"form-input"},null,8,wh)),[[ce,a[R]]]):$.type==="number"?se((m(),v("input",{key:2,type:"number",id:`form-input-${$.label.replace(/\W+/g,"_")}`,name:$.label,placeholder:$.placeholder||"",required:k($.required),"onUpdate:modelValue":f=>a[R]=f,class:"form-input"},null,8,Sh)),[[ce,a[R]]]):$.type==="password"?se((m(),v("input",{key:3,type:"password",id:`form-input-${$.label.replace(/\W+/g,"_")}`,name:$.label,placeholder:$.placeholder||"",required:k($.required),"onUpdate:modelValue":f=>a[R]=f,class:"form-input"},null,8,kh)),[[ce,a[R]]]):$.type==="textarea"?se((m(),v("textarea",{key:4,id:`form-input-${$.label.replace(/\W+/g,"_")}`,name:$.label,placeholder:$.placeholder||"",required:k($.required),"onUpdate:modelValue":f=>a[R]=f,class:"form-input form-textarea",rows:"4"},null,8,Th)),[[ce,a[R]]]):$.type==="select"&&$.options?se((m(),v("select",{key:5,id:`form-input-${$.label.replace(/\W+/g,"_")}`,name:$.label,required:k($.required),"onUpdate:modelValue":f=>a[R]=f,class:"form-input form-select"},[s("option",Eh,c(C.$t("selectCommon.pleaseSelect")),1),(m(!0),v(re,null,de(u($.options),f=>(m(),v("option",{key:f,value:f},c(f),9,Ch))),128))],8,Ph)),[[st,a[R]]]):$.type==="checkbox"&&$.options?(m(),v("div",Rh,[(m(!0),v(re,null,de(u($.options),f=>(m(),v("label",{key:f,class:"checkbox-item"},[se(s("input",{type:"checkbox",id:`form-input-${$.label.replace(/\W+/g,"_")}-${f.replace(/\W+/g,"_")}`,name:$.label,value:f,"onUpdate:modelValue":q=>a[R]=q,class:"form-checkbox"},null,8,Ih),[[lt,a[R]]]),s("span",Ah,c(f),1)]))),128))])):$.type==="radio"&&$.options?(m(),v("div",xh,[(m(!0),v(re,null,de(u($.options),f=>(m(),v("label",{key:f,class:"radio-item"},[se(s("input",{type:"radio",id:`form-input-${$.label.replace(/\W+/g,"_")}-${f.replace(/\W+/g,"_")}`,name:$.label,value:f,"onUpdate:modelValue":q=>a[R]=q,class:"form-radio"},null,8,Dh),[[Ls,a[R]]]),s("span",Fh,c(f),1)]))),128))])):se((m(),v("input",{key:8,type:"text",id:`form-input-${$.label.replace(/\W+/g,"_")}`,name:$.label,placeholder:$.placeholder||"",required:k($.required),"onUpdate:modelValue":f=>a[R]=f,class:"form-input"},null,8,Uh)),[[ce,a[R]]])]))),128))])):(m(),v("div",Mh,[s("label",Nh,c(C.$t("common.input"))+":",1),se(s("input",{type:"text",id:"form-input-genericInput",name:"genericInput","onUpdate:modelValue":U[0]||(U[0]=$=>l.value=$),class:"form-input"},null,512),[[ce,l.value]])])),s("button",Oh,c(C.$t("chat.userInput.submit")),1)],32)])}}}),Bh=me(Lh,[["__scopeId","data-v-043b591c"]]),qh={class:"response-section"},jh={class:"response-header"},Vh={class:"response-avatar"},Hh={class:"response-name"},Gh={key:0,class:"response-timestamp"},Wh={class:"response-content"},zh={key:1,class:"final-response"},Jh=["innerHTML"],Kh={class:"response-actions"},Xh=["title"],Yh=["title"],Qh={key:2,class:"response-placeholder"},Zh={class:"typing-indicator"},ef={class:"typing-text"},tf={key:3,class:"response-error"},sf={class:"error-text"},nf={key:4,class:"response-empty"},of={class:"empty-text"},af=pe({__name:"ResponseSection",props:{content:{},isStreaming:{type:Boolean},error:{},timestamp:{},userInputWaitState:{},planId:{},genericInput:{}},emits:["copy","regenerate","retry","user-input-submitted"],setup(o,{emit:e}){const n=o,t=e,{formatResponseText:a,formatTimestamp:l}=Nt(),i=async()=>{if(n.content)try{const u=n.content.replace(/<[^>]*>/g,"");await navigator.clipboard.writeText(u),t("copy")}catch(u){console.error("Failed to copy to clipboard:",u)}},p=()=>{t("regenerate")},g=()=>{t("retry")},d=u=>{console.log("[ResponseSection] User input submitted:",u),t("user-input-submitted",u)};return(u,k)=>{var C;return m(),v("div",qh,[s("div",jh,[s("div",Vh,[S(r(P),{icon:"carbon:bot",class:"bot-icon"})]),s("div",Hh,c(u.$t("chat.botName")),1),u.timestamp?(m(),v("div",Gh,c(r(l)(u.timestamp)),1)):B("",!0)]),s("div",Wh,[(C=u.userInputWaitState)!=null&&C.waiting?(m(),ie(Bh,ns({key:0,"user-input-wait-state":u.userInputWaitState},u.planId?{"plan-id":u.planId}:{},{"generic-input":u.genericInput??"",onUserInputSubmitted:d}),null,16,["user-input-wait-state","generic-input"])):B("",!0),u.content?(m(),v("div",zh,[s("div",{class:"response-text",innerHTML:r(a)(u.content)},null,8,Jh),s("div",Kh,[s("button",{class:"action-btn copy-btn",onClick:i,title:u.$t("chat.copyResponse")},[S(r(P),{icon:"carbon:copy"})],8,Xh),s("button",{class:"action-btn regenerate-btn",onClick:p,title:u.$t("chat.regenerateResponse")},[S(r(P),{icon:"carbon:renew"})],8,Yh)])])):u.isStreaming?(m(),v("div",Qh,[s("div",Zh,[k[0]||(k[0]=s("div",{class:"typing-dots"},[s("span"),s("span"),s("span")],-1)),s("span",ef,c(u.$t("chat.thinkingResponse")),1)])])):u.error?(m(),v("div",tf,[S(r(P),{icon:"carbon:warning",class:"error-icon"}),s("span",sf,c(u.error),1),s("button",{class:"retry-btn",onClick:g},c(u.$t("chat.retry")),1)])):(m(),v("div",nf,[s("span",of,c(u.$t("chat.waitingForResponse")),1)]))])])}}}),lf=me(af,[["__scopeId","data-v-6581a34f"]]),rf={class:"assistant-message"},cf=pe({__name:"AssistantMessage",props:{message:{},isStreaming:{type:Boolean}},emits:["copy","regenerate","retry","step-selected"],setup(o,{emit:e}){const n=o,t=e,a=()=>{t("copy",n.message.id)},l=()=>{t("regenerate",n.message.id)},i=()=>{t("retry",n.message.id)},p=(d,u)=>{console.log("[AssistantMessage] User input submitted:",u,"for message:",d.id)},g=d=>{console.log("[AssistantMessage] Step selected:",d),t("step-selected",d)};return(d,u)=>{var k,C,U,_;return m(),v("div",rf,[d.message.thinkingDetails?(m(),ie(mh,{key:0,"thinking-details":d.message.thinkingDetails,onStepSelected:g},null,8,["thinking-details"])):B("",!0),d.message.planExecution?(m(),ie(Us,{key:1,"plan-execution":d.message.planExecution,"step-actions":d.message.stepActions||[],"generic-input":d.message.genericInput||"",onStepSelected:g},null,8,["plan-execution","step-actions","generic-input"])):B("",!0),d.message.content||d.message.error||d.isStreaming||(C=(k=d.message.planExecution)==null?void 0:k.userInputWaitState)!=null&&C.waiting?(m(),ie(lf,ns({key:2,content:d.message.content||"","is-streaming":d.isStreaming||!1},{...d.message.error?{error:d.message.error}:{},...(U=d.message.planExecution)!=null&&U.userInputWaitState?{userInputWaitState:d.message.planExecution.userInputWaitState}:{},...(_=d.message.planExecution)!=null&&_.currentPlanId?{planId:d.message.planExecution.currentPlanId}:{}},{timestamp:d.message.timestamp,"generic-input":d.message.genericInput||"",onCopy:a,onRegenerate:l,onRetry:i,onUserInputSubmitted:u[0]||(u[0]=y=>p(d.message,y))}),null,16,["content","is-streaming","timestamp","generic-input"])):B("",!0)])}}}),df=me(cf,[["__scopeId","data-v-3810c279"]]),uf=pe({__name:"ChatMessage",props:{message:{},isStreaming:{type:Boolean}},emits:["copy","regenerate","retry","step-selected"],setup(o,{emit:e}){const n=o,t=e,{getMessageClasses:a}=Nt(),l=fe(()=>a(n.message)),i=u=>{t("copy",u)},p=u=>{t("regenerate",u)},g=u=>{t("retry",u)},d=u=>{t("step-selected",u)};return(u,k)=>(m(),v("div",{class:oe(["chat-message",l.value])},[u.message.type==="user"?(m(),ie(Ap,{key:0,message:u.message},null,8,["message"])):u.message.type==="assistant"?(m(),ie(df,{key:1,message:u.message,"is-streaming":u.isStreaming||!1,onCopy:i,onRegenerate:p,onRetry:g,onStepSelected:d},null,8,["message","is-streaming"])):B("",!0)],2))}}),pf=me(uf,[["__scopeId","data-v-218b3735"]]);function At(o){const e={...o};return"agentExecutionSequence"in o&&Array.isArray(o.agentExecutionSequence)&&(e.agentExecutionSequence=o.agentExecutionSequence.map(n=>mf(n))),e}function mf(o){const e={...o};return"subPlanExecutionRecords"in o&&Array.isArray(o.subPlanExecutionRecords)&&(e.subPlanExecutionRecords=o.subPlanExecutionRecords.map(n=>At(n))),e}function hf(o){const e={...o};return"thinkingDetails"in o&&o.thinkingDetails&&(e.thinkingDetails=At(o.thinkingDetails)),"planExecution"in o&&o.planExecution&&(e.planExecution=At(o.planExecution)),"attachments"in o&&Array.isArray(o.attachments)&&(e.attachments=[...o.attachments]),e}function ff(){const o=F([]),e=F(!1),n=F(null),t=F(null),a=fe(()=>o.value.length>0?o.value[o.value.length-1]:null),l=fe(()=>n.value!==null),i=fe(()=>o.value.length>0),p=(R,f,q)=>{const x={id:`msg_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,type:R,content:f,timestamp:new Date,isStreaming:!1,...q};return o.value.push(x),x},g=(R,f)=>{const q=o.value.findIndex(x=>x.id===R);q!==-1&&(o.value[q]={...o.value[q],...f})},d=R=>{const f=o.value.findIndex(q=>q.id===R);f!==-1&&o.value.splice(f,1)},u=()=>{o.value=[],n.value=null,t.value=null},k=R=>{n.value=R,g(R,{isStreaming:!0})},C=R=>{R&&g(R,{isStreaming:!1}),n.value===R&&(n.value=null)},U=R=>{t.value=R},_=(R,f,q="content")=>{const x=o.value.find(te=>te.id===R);x&&typeof x[q]=="string"&&g(R,{[q]:x[q]+f})},y=(R,f)=>{g(R,{thinkingDetails:f})},h=(R,f)=>{g(R,{thinking:f})},b=(R,f)=>{g(R,{planExecution:f})},T=R=>o.value.find(f=>f.id===R),$=R=>o.value.findIndex(f=>f.id===R);return{messages:Qe(o),isLoading:e,streamingMessageId:Qe(n),activeMessageId:Qe(t),lastMessage:a,isStreaming:l,hasMessages:i,addMessage:p,updateMessage:g,removeMessage:d,clearMessages:u,startStreaming:k,stopStreaming:C,setActiveMessage:U,appendToMessage:_,updateMessageThinking:h,updateMessageThinkingDetails:y,updateMessagePlanExecution:b,findMessage:T,getMessageIndex:$}}function vf(o){const e=F(!1),n=F(!0),t=150,a=async(h=!0)=>{o.value&&(await Pe(),o.value.scrollTo({top:o.value.scrollHeight,behavior:h?"smooth":"auto"}))},l=()=>{if(!o.value)return!1;const{scrollTop:h,scrollHeight:b,clientHeight:T}=o.value;return b-h-T<t},i=()=>{if(!o.value)return;const h=l();e.value=!h&&o.value.scrollHeight>o.value.clientHeight,h&&(n.value=!0)},p=()=>{i(),l()||(n.value=!1)},g=async()=>{n.value&&await a()},d=async()=>{n.value=!0,await a()},u=(h,b=!0)=>{if(!o.value)return;const T=o.value.querySelector(`[data-message-id="${h}"]`);T&&T.scrollIntoView({behavior:b?"smooth":"auto",block:"center"})},k=()=>{if(!o.value)return{scrollTop:0,scrollHeight:0,clientHeight:0,isAtTop:!0,isAtBottom:!0,scrollPercentage:0};const{scrollTop:h,scrollHeight:b,clientHeight:T}=o.value,$=h===0,R=h+T>=b-5,f=b>T?h/(b-T)*100:100;return{scrollTop:h,scrollHeight:b,clientHeight:T,isAtTop:$,isAtBottom:R,scrollPercentage:f}},C=()=>{o.value&&o.value.addEventListener("scroll",p,{passive:!0})},U=()=>{o.value&&o.value.removeEventListener("scroll",p)},_=()=>{C(),i()},y=()=>{U()};return Te(()=>{Pe(()=>{_()})}),Se(()=>{y()}),{showScrollToBottom:Qe(e),isAutoScrollEnabled:Qe(n),scrollToBottom:a,autoScrollToBottom:g,forceScrollToBottom:d,scrollToMessage:u,isNearBottom:l,checkScrollPosition:i,getScrollInfo:k,addScrollListener:C,removeScrollListener:U,initializeScrollBehavior:_,cleanupScrollBehavior:y}}class Ot{static async sendMessage(e){return Bt.withLlmCheck(async()=>{const n={...e,isVueRequest:!0},t=await fetch(`${this.BASE_URL}/execute`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});if(!t.ok)throw new Error(`API request failed: ${t.status}`);return await t.json()})}static async sendMessageWithDefaultPlan(e){return Bt.withLlmCheck(async()=>{const n="default-plan-id-001000222",t={userRequirement:e.input},a={toolName:n,replacementParams:t,isVueRequest:!0};e.uploadedFiles&&e.uploadedFiles.length>0&&(a.uploadedFiles=e.uploadedFiles,console.log("[DirectApiService] Including uploaded files:",e.uploadedFiles.length)),e.uploadKey&&(a.uploadKey=e.uploadKey,console.log("[DirectApiService] Including uploadKey:",e.uploadKey)),console.log("[DirectApiService] Sending message with default plan:",a);const l=await fetch(`${this.BASE_URL}/executeByToolNameAsync`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!l.ok)throw new Error(`API request failed: ${l.status}`);return await l.json()})}}be(Ot,"BASE_URL","/api/executor");const gf=Object.freeze(Object.defineProperty({__proto__:null,DirectApiService:Ot},Symbol.toStringTag,{value:"Module"})),Oe=class Oe{constructor(){be(this,"POLL_INTERVAL",5e3);be(this,"state",tt({activePlanId:null,lastSequenceSize:0,isPolling:!1,pollTimer:null}));be(this,"callbacks",{});be(this,"planExecutionCache",new Map);be(this,"uiStateCache",new Map);console.log("[PlanExecutionManager] Initialized with callback-based event system")}getCachedPlanRecord(e){return this.planExecutionCache.get(e)}getCachedUIState(e){return this.uiStateCache.get(e)}setCachedUIState(e,n){this.uiStateCache.set(e,n),console.log(`[PlanExecutionManager] Cached UI state for rootPlanId: ${e}`)}getAllCachedRecords(){return new Map(this.planExecutionCache)}hasCachedPlanRecord(e){return this.planExecutionCache.has(e)}setCachedPlanRecord(e,n){this.planExecutionCache.set(e,n),console.log(`[PlanExecutionManager] Cached plan execution record for rootPlanId: ${e}`)}clearCachedPlanRecord(e){const n=this.planExecutionCache.delete(e);return n&&console.log(`[PlanExecutionManager] Cleared cached plan execution record for rootPlanId: ${e}`),n}clearAllCachedRecords(){const e=this.planExecutionCache.size,n=this.uiStateCache.size;this.planExecutionCache.clear(),this.uiStateCache.clear(),console.log(`[PlanExecutionManager] Cleared all caches - Plans: ${e}, UI States: ${n}`)}static getInstance(){return Oe.instance||(Oe.instance=new Oe),Oe.instance}getActivePlanId(){return this.state.activePlanId}getState(){return this.state}setEventCallbacks(e){this.callbacks={...this.callbacks,...e},console.log("[PlanExecutionManager] Event callbacks set:",Object.keys(e))}async handleUserMessageSendRequested(e){if(this.validateAndPrepareUIForNewRequest(e))try{if(await this.sendUserMessageAndSetPlanId(e),this.state.activePlanId)this.initiatePlanExecutionSequence(e,this.state.activePlanId);else throw new Error("Failed to get valid plan ID")}catch(n){console.error("[PlanExecutionManager] Failed to send user message:",n);const t=this.state.activePlanId??"error";this.setCachedUIState(t,{enabled:!0}),this.emitChatInputUpdateState(t),this.state.activePlanId=null}}handlePlanExecutionRequested(e,n){console.log("[PlanExecutionManager] Received plan execution request:",{planId:e,query:n}),e?(this.state.activePlanId=e,this.initiatePlanExecutionSequence(n??"Execute Plan",e)):console.error("[PlanExecutionManager] Invalid plan execution request: missing planId")}handleCachedPlanExecution(e,n){const t=this.getCachedPlanRecord(e);return t!=null&&t.currentPlanId?(console.log(`[PlanExecutionManager] Found cached plan execution record for rootPlanId: ${e}`),this.handlePlanExecutionRequested(t.currentPlanId,n),!0):(console.log(`[PlanExecutionManager] No cached plan execution record found for rootPlanId: ${e}`),!1)}validateAndPrepareUIForNewRequest(e){if(!e)return console.warn("[PlanExecutionManager] Query is empty"),!1;if(this.state.activePlanId)return!1;this.emitChatInputClear();const n=this.state.activePlanId??"ui-state";return this.setCachedUIState(n,{enabled:!1,placeholder:"Processing..."}),this.emitChatInputUpdateState(n),!0}async sendUserMessageAndSetPlanId(e){try{const n=await Ot.sendMessage({input:e});if(n!=null&&n.planId)return this.state.activePlanId=n.planId,n;if(n!=null&&n.planTemplateId)return this.state.activePlanId=n.planTemplateId,{...n,planId:n.planTemplateId};throw console.error("[PlanExecutionManager] Failed to get planId from response:",n),new Error("Failed to get valid planId from API response")}catch(n){throw console.error("[PlanExecutionManager] API call failed:",n),n}}initiatePlanExecutionSequence(e,n){console.log(`[PlanExecutionManager] Starting plan execution sequence for query: "${e}", planId: ${n}`);const t=n;this.emitDialogRoundStart(t),this.startPolling()}handlePlanCompletion(e){this.emitPlanCompleted(e.rootPlanId??""),this.state.lastSequenceSize=0,this.stopPolling();try{setTimeout(async()=>{if(this.state.activePlanId)try{await Ze.deletePlanTemplate(this.state.activePlanId),console.log(`[PlanExecutionManager] Plan template ${this.state.activePlanId} deleted successfully`)}catch(n){console.log(`Delete plan execution record failed: ${n.message}`)}},5e3)}catch(n){console.log(`Delete plan execution record failed: ${n.message}`)}e.completed&&(this.state.activePlanId=null,this.emitChatInputUpdateState(e.rootPlanId??""))}handlePlanError(e){this.emitPlanError(e.message??""),this.state.lastSequenceSize=0,this.stopPolling();try{setTimeout(async()=>{if(this.state.activePlanId)try{await Ze.deletePlanTemplate(this.state.activePlanId),console.log(`[PlanExecutionManager] Plan template ${this.state.activePlanId} deleted successfully`)}catch(n){console.log(`Delete plan execution record failed: ${n.message}`)}},5e3)}catch(n){console.log(`Delete plan execution record failed: ${n.message}`)}}async pollPlanStatus(){if(this.state.activePlanId){if(this.state.isPolling){console.log("[PlanExecutionManager] Previous polling still in progress, skipping");return}try{this.state.isPolling=!0;const e=await this.getPlanDetails(this.state.activePlanId);if(!e){console.warn("[PlanExecutionManager] No details received from API - this might be a temporary network issue");return}if(e.status&&e.status==="failed"&&e.message&&!e.message.includes("Failed to get detailed information")){this.handlePlanError(e);return}e.rootPlanId&&this.setCachedPlanRecord(e.rootPlanId,e),this.emitPlanUpdate(e.rootPlanId??""),e.completed&&this.handlePlanCompletion(e)}catch(e){console.error("[PlanExecutionManager] Failed to poll plan status:",e)}finally{this.state.isPolling=!1}}}async getPlanDetails(e){try{const n=await _t.getDetails(e);return n!=null&&n.rootPlanId&&(this.planExecutionCache.set(n.rootPlanId,n),console.log(`[PlanExecutionManager] Cached plan execution record for rootPlanId: ${n.rootPlanId}`)),n}catch(n){return console.error("[PlanExecutionManager] Failed to get plan details:",n),{currentPlanId:e,status:"failed",message:n instanceof Error?n.message:"Failed to get plan"}}}startPolling(){this.state.pollTimer&&clearInterval(this.state.pollTimer),this.state.pollTimer=window.setInterval(()=>{this.pollPlanStatus()},this.POLL_INTERVAL),console.log("[PlanExecutionManager] Started polling")}async pollPlanStatusImmediately(){console.log("[PlanExecutionManager] Polling plan status immediately"),await this.pollPlanStatus()}stopPolling(){this.state.pollTimer&&(clearInterval(this.state.pollTimer),this.state.pollTimer=null),console.log("[PlanExecutionManager] Stopped polling")}cleanup(){this.stopPolling(),this.state.activePlanId=null,this.state.lastSequenceSize=0,this.state.isPolling=!1,this.clearAllCachedRecords()}emitChatInputClear(){this.callbacks.onChatInputClear&&this.callbacks.onChatInputClear()}emitChatInputUpdateState(e){this.callbacks.onChatInputUpdateState&&this.callbacks.onChatInputUpdateState(e)}emitDialogRoundStart(e){this.callbacks.onDialogRoundStart&&this.callbacks.onDialogRoundStart(e)}emitPlanUpdate(e){this.callbacks.onPlanUpdate&&this.callbacks.onPlanUpdate(e)}emitPlanCompleted(e){this.callbacks.onPlanCompleted&&this.callbacks.onPlanCompleted(e)}emitPlanError(e){this.callbacks.onPlanError&&this.callbacks.onPlanError(e)}};be(Oe,"instance",null);let xt=Oe;const De=xt.getInstance(),bf={class:"chat-container"},yf={key:0,class:"loading-message"},_f={class:"loading-content"},$f=["title"],wf=pe({__name:"ChatContainer",props:{mode:{default:"plan"},initialPrompt:{default:""}},emits:["step-selected"],setup(o,{expose:e,emit:n}){const t=n,{t:a}=ke(),{messages:l,isLoading:i,streamingMessageId:p,addMessage:g,updateMessage:d,startStreaming:u,stopStreaming:k,findMessage:C}=ff(),U=F(null),{scrollToBottom:_,autoScrollToBottom:y,showScrollToBottom:h}=vf(U),b=F(),T=A=>p.value===A,$=fe(()=>l.value.map(hf)),R=()=>{},f=A=>{const J=A.target;if(J.classList.contains("md-copy-btn")){const Y=J.getAttribute("data-raw");if(Y){const ae=decodeURIComponent(Y);navigator.clipboard.writeText(ae).then(()=>{J.textContent=a("chat.copied"),setTimeout(()=>{J.textContent=a("chat.copy")},1e3)})}}},q=async A=>{const J=C(A);if(J)try{const Y=J.content.replace(/<[^>]*>/g,"");await navigator.clipboard.writeText(Y)}catch(Y){console.error("Failed to copy message:",Y)}},x=A=>{const J=C(A);J&&J.type==="assistant"&&(d(A,{content:""}),u(A))},te=A=>{C(A)&&(d(A,{content:""}),u(A))},D=A=>{console.log("[ChatContainer] Step selected:",A),t("step-selected",A)},M=A=>{console.log("[ChatContainer] Plan update received:",A);const J=De.getCachedPlanRecord(A);if(!J){console.warn("[ChatContainer] No cached plan data found for rootPlanId:",A);return}console.log("[ChatContainer] Retrieved plan details from cache:",J);const Y=l.value.findIndex(ae=>{var j;return((j=ae.planExecution)==null?void 0:j.currentPlanId)===J.currentPlanId&&ae.type==="assistant"});if(Y!==-1){const ae=l.value[Y],j={planExecution:JSON.parse(JSON.stringify(J))};if(!J.agentExecutionSequence||J.agentExecutionSequence.length===0){if(console.log("[ChatContainer] Handling simple response without agent execution sequence"),J.completed){j.thinking="";const Z=J.summary??J.result??J.message??"Execution completed";j.content=Z,console.log("[ChatContainer] Set simple response content:",Z)}}else console.log("[ChatContainer] Handling detailed plan with agent execution sequence");d(ae.id,j)}},z=A=>{if(console.log("[ChatContainer] Plan completed:",A),A.rootPlanId){const J=l.value.findIndex(Y=>{var ae;return((ae=Y.planExecution)==null?void 0:ae.currentPlanId)===A.rootPlanId});if(J!==-1){const Y=l.value[J],ae=A.summary??A.result??"Execution completed";d(Y.id,{thinking:"",content:ae}),console.log("[ChatContainer] Updated completed message:",ae)}}},Q=A=>{console.log("[ChatContainer] Dialog round start:",A)},E=A=>{console.log("[ChatContainer] Plan error:",A),g("assistant",`Error: ${A}`),console.error("[ChatContainer] Plan execution error:",A)};return Te(()=>{ue(l,()=>{Pe(()=>{y()})},{deep:!0}),De.setEventCallbacks({onPlanUpdate:M,onPlanCompleted:z,onDialogRoundStart:Q,onPlanError:E})}),Se(()=>{b.value&&clearInterval(b.value)}),e({scrollToBottom:_,handlePlanUpdate:M,handlePlanCompleted:z,handleDialogRoundStart:Q,handlePlanError:E,addMessage:g,updateMessage:d,startStreaming:u,stopStreaming:k}),(A,J)=>(m(),v("div",bf,[s("div",{class:"messages",ref_key:"messagesRef",ref:U,onScroll:R,onClick:f},[(m(!0),v(re,null,de($.value,Y=>(m(),ie(pf,{key:Y.id,message:Y,"is-streaming":T(Y.id),onCopy:q,onRegenerate:x,onRetry:te,onStepSelected:D},null,8,["message","is-streaming"]))),128)),r(i)?(m(),v("div",yf,[s("div",_f,[S(r(P),{icon:"carbon:circle-dash",class:"loading-icon"}),s("span",null,c(A.$t("chat.processing")),1)])])):B("",!0)],544),S(Be,{name:"scroll-button"},{default:Ue(()=>[r(h)?(m(),v("button",{key:0,class:"scroll-to-bottom",onClick:J[0]||(J[0]=()=>r(_)()),title:A.$t("chat.scrollToBottom")},[S(r(P),{icon:"carbon:chevron-down"})],8,$f)):B("",!0)]),_:1})]))}}),Sf=me(wf,[["__scopeId","data-v-e7a5d6c9"]]),kf={class:"input-area"},Tf={class:"input-container"},Pf=["placeholder","disabled"],Ef=["title"],Cf=["disabled","title"],Rf=pe({__name:"InputArea",props:{placeholder:{default:""},disabled:{type:Boolean,default:!1},initialValue:{default:""}},emits:["send","clear","update-state","plan-mode-clicked"],setup(o,{expose:e,emit:n}){const{t}=ke(),a=o,l=n,i=F(),p=F(),g=F(""),d=fe(()=>a.placeholder||t("input.placeholder")),u=F(d.value),k=F([]),C=F(null),U=()=>{var E;console.log("[FileUpload] Resetting session and clearing uploadKey"),(E=p.value)==null||E.resetSession()};Se(()=>{U()});const _=(E,A)=>{k.value=E.map(J=>J.originalName),C.value=A,console.log("[InputArea] Files uploaded:",E.length,"uploadKey:",A),k.value.length>0&&(u.value=t("input.filesAttached",{count:k.value.length}))},y=E=>{k.value=E.map(A=>A.originalName),console.log("[InputArea] Files removed, remaining:",E.length),k.value.length===0?u.value=d.value:u.value=t("input.filesAttached",{count:k.value.length})},h=E=>{C.value=E,console.log("[InputArea] Upload key changed:",E)},b=()=>{console.log("[InputArea] Upload started")},T=()=>{console.log("[InputArea] Upload completed")},$=E=>{console.error("[InputArea] Upload error:",E)},R=fe(()=>!!a.disabled),f=()=>{Pe(()=>{i.value&&(i.value.style.height="auto",i.value.style.height=Math.min(i.value.scrollHeight,120)+"px")})},q=E=>{E.key==="Enter"&&!E.shiftKey&&(E.preventDefault(),x())},x=()=>{if(!g.value.trim()||R.value)return;const A={input:g.value.trim(),memoryId:Me.selectMemoryId,uploadedFiles:k.value};C.value?(A.uploadKey=C.value,console.log("[InputArea] Including uploadKey in message:",C.value)):console.log("[InputArea] No uploadKey available for message"),l("send",A),D()},te=()=>{l("plan-mode-clicked")},D=()=>{g.value="",f(),l("clear")},M=(E,A)=>{A&&(u.value=E?A:t("input.waiting")),l("update-state",E,A)},z=E=>{g.value=E,f()},Q=()=>g.value.trim();return ue(()=>a.initialValue,E=>{E&&E.trim()&&(g.value=E,f())},{immediate:!0}),e({clearInput:D,updateState:M,setInputValue:z,getQuery:Q,resetSession:U,focus:()=>{var E;return(E=i.value)==null?void 0:E.focus()},get uploadedFiles(){var E,A;return((A=(E=p.value)==null?void 0:E.uploadedFiles)==null?void 0:A.map(J=>J.originalName))||[]},get uploadKey(){var E;return((E=p.value)==null?void 0:E.uploadKey)||null}}),Te(()=>{}),Se(()=>{}),(E,A)=>(m(),v("div",kf,[S(Ds,{ref_key:"fileUploadRef",ref:p,disabled:R.value,onFilesUploaded:_,onFilesRemoved:y,onUploadKeyChanged:h,onUploadStarted:b,onUploadCompleted:T,onUploadError:$},null,8,["disabled"]),s("div",Tf,[se(s("textarea",{"onUpdate:modelValue":A[0]||(A[0]=J=>g.value=J),ref_key:"inputRef",ref:i,class:"chat-input",placeholder:u.value,disabled:R.value,onKeydown:q,onInput:f},null,40,Pf),[[ce,g.value]]),s("button",{class:"plan-mode-btn",title:E.$t("input.planMode"),onClick:te},[S(r(P),{icon:"carbon:document"}),ne(" "+c(E.$t("input.planMode")),1)],8,Ef),s("button",{class:"send-button",disabled:!g.value.trim()||R.value,onClick:x,title:E.$t("input.send")},[S(r(P),{icon:"carbon:send-alt"}),ne(" "+c(E.$t("input.send")),1)],8,Cf)])]))}}),If=me(Rf,[["__scopeId","data-v-84fb4aeb"]]);class Ve{static async getAllCronTasks(){try{const e=await fetch(this.BASE_URL);return await(await this.handleResponse(e)).json()}catch(e){throw console.error("Failed to get cron tasks:",e),e}}static async getCronTaskById(e){try{const n=await fetch(`${this.BASE_URL}/${e}`);return await(await this.handleResponse(n)).json()}catch(n){throw console.error("Failed to get cron task by id:",n),n}}static async createCronTask(e){try{const n=await fetch(this.BASE_URL,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});return await(await this.handleResponse(n)).json()}catch(n){throw console.error("Failed to create cron task:",n),n}}static async updateCronTask(e,n){try{const t=await fetch(`${this.BASE_URL}/${e}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});return await(await this.handleResponse(t)).json()}catch(t){throw console.error("Failed to update cron task:",t),t}}static async updateTaskStatus(e,n){try{const t=await fetch(`${this.BASE_URL}/${e}/status?status=${n}`,{method:"PUT"});await this.handleResponse(t)}catch(t){throw console.error("Failed to update task status:",t),t}}static async deleteCronTask(e){try{const n=await fetch(`${this.BASE_URL}/${e}`,{method:"DELETE"});await this.handleResponse(n)}catch(n){throw console.error("Failed to delete cron task:",n),n}}static async handleResponse(e){if(!e.ok)try{const n=await e.json();throw new Error(n.message||`API request failed: ${e.status}`)}catch{throw new Error(`API request failed: ${e.status} ${e.statusText}`)}return e}}be(Ve,"BASE_URL","/api/cron-tasks");const He={validateCronExpression(o){const e=o.trim().split(/\s+/);return e.length>=5&&e.length<=6},formatTime(o){return new Date(o).toLocaleString()},async saveTask(o){try{let e;return o.id?e=await Ve.updateCronTask(Number(o.id),o):e=await Ve.createCronTask(o),e}catch(e){throw console.error("Failed to save cron task:",e),e}},async deleteTask(o){try{await Ve.deleteCronTask(String(o))}catch(e){throw console.error("Failed to delete cron task:",e),e}},async toggleTaskStatus(o){if(!o.id)throw new Error("Task ID is required");const e=o.status===0?1:0;return await Ve.updateCronTask(Number(o.id),{...o,status:e})},prepareTaskExecution(o){return o.planTemplateId?{useTemplate:!0,planData:{title:o.cronName||"Scheduled Task Execution",planData:{id:o.planTemplateId,planTemplateId:o.planTemplateId,planId:o.planTemplateId},params:o.executionParams||void 0}}:{useTemplate:!1,taskContent:o.planDesc||o.cronName||""}}},Af={class:"modal-header"},xf={class:"header-actions"},Df={class:"status-switch"},Ff={class:"status-label"},Uf={class:"toggle-switch"},Mf=["checked"],Nf={class:"modal-content"},Of={class:"form-group"},Lf={class:"form-label"},Bf=["placeholder"],qf={class:"form-group"},jf={class:"form-label"},Vf=["placeholder"],Hf={class:"form-help"},Gf={class:"form-group"},Wf={class:"form-label"},zf=["placeholder"],Jf={class:"form-group"},Kf={class:"form-label"},Xf={class:"template-toggle"},Yf={key:0,class:"template-selector"},Qf={value:""},Zf=["value"],ev={class:"form-help"},tv={key:0,class:"form-group"},sv={class:"time-info"},nv={class:"time-label"},ov={class:"time-value"},av={key:1,class:"form-group"},lv={class:"time-info"},rv={class:"time-label"},iv={class:"time-value"},cv={class:"modal-footer"},dv=["disabled"],uv=pe({__name:"TaskDetailModal",props:{modelValue:{type:Boolean},task:{}},emits:["update:modelValue","save"],setup(o,{emit:e}){const n=o,t=e,a=F(!1),l=F([]),i=F({cronName:"",cronTime:"",planDesc:"",status:1,linkTemplate:!1,templateId:"",planTemplateId:""}),p=async()=>{try{const _=await Ze.getAllPlanTemplates();_&&_.templates&&(l.value=_.templates.map(y=>({id:y.id,name:y.title||"Unnamed Template"})))}catch(_){console.error("Failed to get template list:",_)}},g=_=>{_.key==="Escape"&&n.modelValue&&t("update:modelValue",!1)};Te(()=>{p(),document.addEventListener("keydown",g)}),Se(()=>{document.removeEventListener("keydown",g)});const d=_=>{_.target===_.currentTarget&&t("update:modelValue",!1)},u=()=>{i.value.linkTemplate=!1,i.value.templateId="",i.value.planTemplateId=""},k=()=>i.value.cronName.trim()?i.value.cronTime.trim()?He.validateCronExpression(i.value.cronTime)?i.value.planDesc.trim()?i.value.linkTemplate&&!i.value.templateId?(alert("Please select a plan template"),!1):!0:(alert("Task description cannot be empty"),!1):(alert("Invalid Cron expression format, should be 5-6 parts separated by spaces"),!1):(alert("Cron expression cannot be empty"),!1):(alert("Task name cannot be empty"),!1),C=_=>He.formatTime(_),U=async()=>{var _;if(k()){a.value=!0;try{const y={...i.value,...((_=n.task)==null?void 0:_.id)!==void 0&&{id:n.task.id},cronName:i.value.cronName.trim(),cronTime:i.value.cronTime.trim(),planDesc:i.value.planDesc.trim(),status:i.value.status,planTemplateId:i.value.linkTemplate&&i.value.templateId||""};t("save",y)}finally{a.value=!1}}};return ue(()=>n.task,_=>{if(_){const y=_.templateId||_.planTemplateId||"";i.value={cronName:_.cronName||"",cronTime:_.cronTime||"",planDesc:_.planDesc||"",status:_.status??1,linkTemplate:!!y,templateId:y,planTemplateId:y}}else i.value={cronName:"",cronTime:"",planDesc:"",status:1,linkTemplate:!1,templateId:"",planTemplateId:""}},{immediate:!0}),ue(()=>n.modelValue,_=>{_||(i.value={cronName:"",cronTime:"",planDesc:"",status:1,linkTemplate:!1,templateId:"",planTemplateId:""})}),(_,y)=>(m(),ie(Ye,{to:"body"},[S(Be,{name:"modal"},{default:Ue(()=>{var h,b,T;return[_.modelValue?(m(),v("div",{key:0,class:"modal-overlay",onClick:d},[s("div",{class:"modal-container",onClick:y[8]||(y[8]=ve(()=>{},["stop"]))},[s("div",Af,[s("h3",null,c(_.$t("cronTask.taskDetail")),1),s("div",xf,[s("div",Df,[s("span",Ff,c(_.$t("cronTask.taskStatus")),1),s("label",Uf,[s("input",{type:"checkbox",checked:i.value.status===0,onChange:y[0]||(y[0]=$=>i.value.status=i.value.status===0?1:0)},null,40,Mf),y[9]||(y[9]=s("span",{class:"toggle-slider"},null,-1))])]),s("button",{class:"close-btn",onClick:y[1]||(y[1]=$=>_.$emit("update:modelValue",!1))},[S(r(P),{icon:"carbon:close"})])])]),s("div",Nf,[s("form",{onSubmit:ve(U,["prevent"]),class:"task-form"},[s("div",Of,[s("label",Lf,c(_.$t("cronTask.taskName")),1),se(s("input",{"onUpdate:modelValue":y[2]||(y[2]=$=>i.value.cronName=$),type:"text",class:"form-input",placeholder:_.$t("cronTask.taskNamePlaceholder"),required:""},null,8,Bf),[[ce,i.value.cronName]])]),s("div",qf,[s("label",jf,c(_.$t("cronTask.cronExpression")),1),se(s("input",{"onUpdate:modelValue":y[3]||(y[3]=$=>i.value.cronTime=$),type:"text",class:"form-input",placeholder:_.$t("cronTask.cronExpressionPlaceholder"),required:""},null,8,Vf),[[ce,i.value.cronTime]]),s("div",Hf,c(_.$t("cronTask.cronExpressionHelp")),1)]),s("div",Gf,[s("label",Wf,c(_.$t("cronTask.taskDescription")),1),se(s("textarea",{"onUpdate:modelValue":y[4]||(y[4]=$=>i.value.planDesc=$),class:"form-textarea",placeholder:_.$t("cronTask.taskDescriptionPlaceholder"),rows:"4",required:""},null,8,zf),[[ce,i.value.planDesc]])]),s("div",Jf,[s("label",Kf,c(_.$t("cronTask.planTemplate")),1),s("div",Xf,[s("button",{type:"button",class:oe(["template-btn",i.value.linkTemplate?"active":""]),onClick:y[5]||(y[5]=$=>i.value.linkTemplate=!0)},[S(r(P),{icon:"carbon:checkmark"}),ne(" "+c(_.$t("cronTask.linkTemplate")),1)],2),s("button",{type:"button",class:oe(["template-btn",i.value.linkTemplate?"":"active"]),onClick:u},[S(r(P),{icon:"carbon:close"}),ne(" "+c(_.$t("cronTask.noTemplate")),1)],2)]),i.value.linkTemplate?(m(),v("div",Yf,[se(s("select",{"onUpdate:modelValue":y[6]||(y[6]=$=>i.value.templateId=$),class:"form-select"},[s("option",Qf,c(_.$t("cronTask.selectTemplate")),1),(m(!0),v(re,null,de(l.value,$=>(m(),v("option",{key:$.id,value:$.id},c($.name),9,Zf))),128))],512),[[st,i.value.templateId]]),s("div",ev,c(_.$t("cronTask.templateHelpText")),1)])):B("",!0)]),(h=_.task)!=null&&h.createTime?(m(),v("div",tv,[s("div",sv,[s("span",nv,c(_.$t("cronTask.createTime"))+":",1),s("span",ov,c(C(_.task.createTime)),1)])])):B("",!0),(b=_.task)!=null&&b.updateTime?(m(),v("div",av,[s("div",lv,[s("span",rv,c(_.$t("cronTask.updateTime"))+":",1),s("span",iv,c(C(_.task.updateTime)),1)])])):B("",!0)],32)]),s("div",cv,[s("button",{type:"button",class:"cancel-btn",onClick:y[7]||(y[7]=$=>_.$emit("update:modelValue",!1))},c(_.$t("common.cancel")),1),s("button",{type:"button",class:"save-btn",onClick:U,disabled:a.value},[a.value?(m(),ie(r(P),{key:0,icon:"carbon:loading",class:"loading-icon"})):B("",!0),ne(" "+c((T=n.task)!=null&&T.id?_.$t("common.save"):_.$t("common.create")),1)],8,dv)])])])):B("",!0)]}),_:1})]))}}),pv=me(uv,[["__scopeId","data-v-45bbcf14"]]),mv={class:"modal-header"},hv={class:"header-actions"},fv={class:"modal-content"},vv={key:0,class:"loading-container"},gv={key:1,class:"empty-container"},bv={key:2,class:"task-list"},yv=["onClick"],_v={class:"task-main"},$v={class:"task-info"},wv={class:"task-header"},Sv={class:"task-name"},kv={class:"task-description"},Tv={class:"task-time"},Pv=["onClick"],Ev=["onClick","disabled","title"],Cv=["onClick","title"],Rv={class:"dropdown-menu"},Iv=["onClick"],Av=["onClick","disabled"],xv=["onClick","disabled"],Dv={class:"confirm-header"},Fv={class:"confirm-content"},Uv={class:"confirm-actions"},Mv=["disabled"],Nv={class:"confirm-header"},Ov={class:"confirm-content"},Lv={class:"create-options"},Bv={class:"option-content"},qv={class:"option-title"},jv={class:"option-desc"},Vv={class:"option-content"},Hv={class:"option-title"},Gv={class:"option-desc"},Wv={class:"confirm-actions"},zv=pe({__name:"CronTaskModal",props:{modelValue:{type:Boolean,required:!0}},emits:["update:modelValue"],setup(o,{emit:e}){const n=os(),t=as(),a=ls(),{t:l}=ke(),i=o,p=e,g=F([]),d=F(!1),u=F(null),k=F(null),C=F(null),U=F(null),_=F(!1),y=F(null),h=F(!1),b=F(null),T=F(!1),$=V=>{V.target===V.currentTarget&&p("update:modelValue",!1)},R=async()=>{d.value=!0;try{g.value=await Ve.getAllCronTasks()}catch(V){console.error("Failed to load cron tasks:",V),a.error(`Failed to load tasks: ${V instanceof Error?V.message:String(V)}`)}finally{d.value=!1}},f=async V=>{u.value=V;try{const w=g.value.find(O=>O.id===V);if(!w){console.error("Task not found:",V);return}p("update:modelValue",!1);const W=Date.now().toString();await n.push({name:"direct",params:{id:W}}),await new Promise(O=>setTimeout(O,100));const N=He.prepareTaskExecution(w);N.useTemplate&&N.planData?t.emitPlanExecutionRequested(N.planData):N.taskContent&&t.setTask(N.taskContent)}catch(w){console.error("Failed to execute task:",w),a.error(`Execution failed: ${w instanceof Error?w.message:String(w)}`)}finally{u.value=null}},q=V=>{y.value={...V},_.value=!0,U.value=null},x=async V=>{try{await He.saveTask(V),await R(),_.value=!1,a.success("Task saved successfully")}catch(w){console.error("Failed to save task:",w),a.error(`Save failed: ${w instanceof Error?w.message:String(w)}`)}},te=V=>{b.value=V,h.value=!0},D=async()=>{var V;if((V=b.value)!=null&&V.id){k.value=b.value.id;try{await He.deleteTask(b.value.id),await R(),h.value=!1,b.value=null,a.success("Task deleted successfully")}catch(w){console.error("Failed to delete task:",w),a.error(`Delete failed: ${w instanceof Error?w.message:String(w)}`)}finally{k.value=null}}},M=()=>{h.value=!1,b.value=null},z=V=>{U.value=U.value===V?null:V},Q=async V=>{if(V.id){C.value=V.id;try{await He.toggleTaskStatus(V),await R(),U.value=null,a.success(`Task ${V.status===0?"disabled":"enabled"} successfully`)}catch(w){console.error("Failed to toggle task status:",w),a.error(`Status toggle failed: ${w instanceof Error?w.message:String(w)}`)}finally{C.value=null}}},E=async V=>{try{await navigator.clipboard.writeText(V),a.success("Cron expression copied successfully")}catch(w){a.error(`Copy failed: ${w instanceof Error?w.message:String(w)}`)}},A=()=>{T.value=!0},J=()=>{T.value=!1;try{p("update:modelValue",!1);const V=l("cronTask.template");t.setTaskToInput(V);const w=Date.now().toString();n.push({name:"direct",params:{id:w}})}catch(V){console.error("Error in createWithJmanus:",V),a.error(`Creation failed: ${V instanceof Error?V.message:String(V)}`)}},Y=()=>{T.value=!1,y.value={cronName:"",cronTime:"",planDesc:"",status:0,planTemplateId:""},_.value=!0},ae=()=>{T.value=!1},j=V=>{const w=V.target;!w.closest(".action-dropdown")&&!w.closest(".dropdown-menu")&&(U.value=null)},Z=V=>{V.key==="Escape"&&(h.value?M():T.value?ae():i.modelValue&&p("update:modelValue",!1))};return Te(()=>{document.addEventListener("click",j,!0),document.addEventListener("keydown",Z)}),Se(()=>{document.removeEventListener("click",j,!0),document.removeEventListener("keydown",Z)}),ue(()=>i.modelValue,V=>{V&&R()}),(V,w)=>(m(),v(re,null,[(m(),ie(Ye,{to:"body"},[S(Be,{name:"modal"},{default:Ue(()=>[o.modelValue?(m(),v("div",{key:0,class:"modal-overlay",onClick:$},[s("div",{class:"modal-container",onClick:w[3]||(w[3]=ve(()=>{},["stop"]))},[s("div",mv,[s("h3",null,c(V.$t("cronTask.title")),1),s("div",hv,[s("button",{class:"add-task-btn",onClick:[A,w[0]||(w[0]=ve(()=>{},["stop"]))]},[S(r(P),{icon:"carbon:add"}),ne(" "+c(V.$t("cronTask.addTask")),1)]),s("button",{class:"close-btn",onClick:w[1]||(w[1]=W=>V.$emit("update:modelValue",!1))},[S(r(P),{icon:"carbon:close"})])])]),s("div",fv,[d.value?(m(),v("div",vv,[S(r(P),{icon:"carbon:loading",class:"loading-icon"}),s("span",null,c(V.$t("common.loading")),1)])):g.value.length===0?(m(),v("div",gv,[S(r(P),{icon:"carbon:time",class:"empty-icon"}),s("span",null,c(V.$t("cronTask.noTasks")),1)])):(m(),v("div",bv,[(m(!0),v(re,null,de(g.value,W=>(m(),v("div",{key:W.id||"",class:"task-item",onClick:N=>q(W)},[s("div",_v,[s("div",$v,[s("div",wv,[s("div",Sv,c(W.cronName),1),s("div",{class:oe(["task-status-badge",W.status===0?"active":"inactive"])},[S(r(P),{icon:W.status===0?"carbon:checkmark-filled":"carbon:pause-filled"},null,8,["icon"]),s("span",null,c(W.status===0?V.$t("cronTask.active"):V.$t("cronTask.inactive")),1)],2)]),s("div",kv,c(W.planDesc),1),s("div",Tv,[S(r(P),{icon:"carbon:time"}),s("span",{class:"cron-readable",style:{cursor:"pointer"},onClick:ve(N=>E(W.cronTime),["stop"])},c(W.cronTime),9,Pv)])])]),s("div",{class:"task-actions",onClick:w[2]||(w[2]=ve(()=>{},["stop"]))},[s("button",{class:"action-btn execute-btn",onClick:N=>f(W.id),disabled:u.value===W.id,title:V.$t("cronTask.executeOnce")},[S(r(P),{icon:u.value===W.id?"carbon:loading":"carbon:play-filled"},null,8,["icon"]),ne(" "+c(V.$t("cronTask.executeOnce")),1)],8,Ev),s("div",{class:oe(["action-dropdown",{active:U.value===W.id}])},[s("button",{class:"action-btn dropdown-btn",onClick:N=>z(W.id),title:V.$t("cronTask.operations")},[S(r(P),{icon:"carbon:overflow-menu-horizontal"}),ne(" "+c(V.$t("cronTask.operations")),1)],8,Cv),se(s("div",Rv,[s("button",{class:"dropdown-item edit-btn",onClick:N=>q(W)},[S(r(P),{icon:"carbon:edit"}),ne(" "+c(V.$t("cronTask.edit")),1)],8,Iv),s("button",{class:"dropdown-item toggle-btn",onClick:N=>Q(W),disabled:C.value===W.id},[S(r(P),{icon:C.value===W.id?"carbon:loading":W.status===0?"carbon:pause-filled":"carbon:play-filled"},null,8,["icon"]),ne(" "+c(W.status===0?V.$t("cronTask.disable"):V.$t("cronTask.enable")),1)],8,Av),s("button",{class:"dropdown-item delete-btn",onClick:N=>te(W),disabled:k.value===W.id},[S(r(P),{icon:k.value===W.id?"carbon:loading":"carbon:trash-can"},null,8,["icon"]),ne(" "+c(V.$t("cronTask.delete")),1)],8,xv)],512),[[ts,U.value===W.id]])],2)])],8,yv))),128))]))])])])):B("",!0)]),_:1})])),S(pv,{modelValue:_.value,"onUpdate:modelValue":w[4]||(w[4]=W=>_.value=W),task:y.value,onSave:x},null,8,["modelValue","task"]),(m(),ie(Ye,{to:"body"},[S(Be,{name:"modal"},{default:Ue(()=>{var W,N,O,L;return[h.value?(m(),v("div",{key:0,class:"modal-overlay",onClick:M},[s("div",{class:"confirm-modal",onClick:w[5]||(w[5]=ve(()=>{},["stop"]))},[s("div",Dv,[S(r(P),{icon:"carbon:warning",class:"warning-icon"}),s("h3",null,c(V.$t("cronTask.deleteConfirm")),1)]),s("div",Fv,[s("p",null,c(V.$t("cronTask.deleteConfirmMessage",{taskName:((W=b.value)==null?void 0:W.cronName)||((N=b.value)==null?void 0:N.planDesc)||""})),1)]),s("div",Uv,[s("button",{class:"confirm-btn cancel-btn",onClick:M},c(V.$t("common.cancel")),1),s("button",{class:"confirm-btn delete-btn",onClick:D,disabled:k.value===((O=b.value)==null?void 0:O.id)},[S(r(P),{icon:k.value===((L=b.value)==null?void 0:L.id)?"carbon:loading":"carbon:trash-can"},null,8,["icon"]),ne(" "+c(V.$t("cronTask.delete")),1)],8,Mv)])])])):B("",!0)]}),_:1})])),(m(),ie(Ye,{to:"body"},[S(Be,{name:"modal"},{default:Ue(()=>[T.value?(m(),v("div",{key:0,class:"modal-overlay",onClick:ae},[s("div",{class:"confirm-modal create-options-modal",onClick:w[6]||(w[6]=ve(()=>{},["stop"]))},[s("div",Nv,[S(r(P),{icon:"carbon:time",class:"create-icon"}),s("h3",null,c(V.$t("cronTask.createTask")),1)]),s("div",Ov,[s("p",null,c(V.$t("cronTask.selectCreateMethod")),1),s("div",Lv,[s("button",{class:"create-option-btn jmanus-btn",onClick:J},[S(r(P),{icon:"carbon:ai-status"}),s("div",Bv,[s("span",qv,c(V.$t("cronTask.createWithJmanus")),1),s("span",jv,c(V.$t("cronTask.createWithJmanusDesc")),1)])]),s("button",{class:"create-option-btn manual-btn",onClick:Y},[S(r(P),{icon:"carbon:edit"}),s("div",Vv,[s("span",Hv,c(V.$t("cronTask.createManually")),1),s("span",Gv,c(V.$t("cronTask.createManuallyDesc")),1)])])])]),s("div",Wv,[s("button",{class:"confirm-btn cancel-btn",onClick:ae},c(V.$t("common.cancel")),1)])])])):B("",!0)]),_:1})]))],64))}}),Jv=me(zv,[["__scopeId","data-v-a90a3961"]]),Kv={class:"direct-page"},Xv={class:"direct-chat"},Yv={class:"chat-header"},Qv={class:"header-actions"},Zv=["title"],eg=["title"],tg=["title"],sg=["title"],ng={class:"chat-content"},og=["title"],ag={class:"message-content"},lg=pe({__name:"index",setup(o){const e=Bs(),n=os(),t=as(),{t:a}=ke(),{message:l}=Gs(),i=F(""),p=F(""),g=F(),d=F(),u=F(),k=F(),C=F(!1),U=F(!1),_=F(null),y=F(!1),h=F(50),b=F(!1),T=F(0),$=F(0),R=fe(()=>{if(H.isCollapsed)return h.value;let N=26;k.value&&k.value.sidebarWidth!==void 0&&(N=k.value.sidebarWidth);const O=100-N;return Math.max(20,Math.min(O,h.value))});Te(()=>{if(console.log("[Direct] onMounted called"),console.log("[Direct] taskStore.currentTask:",t.currentTask),console.log("[Direct] taskStore.hasUnprocessedTask():",t.hasUnprocessedTask()),De.setEventCallbacks({onPlanUpdate:O=>{console.log("[Direct] Plan update event received for rootPlanId:",O),D(O)&&(console.log("[Direct] Processing plan update for current rootPlanId:",O),d.value&&typeof d.value.handlePlanUpdate=="function"?(console.log("[Direct] Calling chatRef.handlePlanUpdate with rootPlanId:",O),d.value.handlePlanUpdate(O)):console.warn("[Direct] chatRef.handlePlanUpdate method not available"),g.value&&typeof g.value.updateDisplayedPlanProgress=="function"?(console.log("[Direct] Calling rightPanelRef.updateDisplayedPlanProgress with rootPlanId:",O),g.value.updateDisplayedPlanProgress(O)):console.warn("[Direct] rightPanelRef.updateDisplayedPlanProgress method not available"))},onPlanCompleted:O=>{if(console.log("[Direct] Plan completed event received for rootPlanId:",O),!!D(O)){if(console.log("[Direct] Processing plan completion for current rootPlanId:",O),d.value&&typeof d.value.handlePlanCompleted=="function"){const L=De.getCachedPlanRecord(O);L&&L.completed?L.summary&&L.summary.trim().length>0?(console.log("[Direct]  Plan details are valid and complete from polling cache, updating UI"),d.value.handlePlanCompleted(L)):(console.warn("[Direct]  Plan completed but summary is empty, still proceeding with available data"),d.value.handlePlanCompleted(L)):(console.warn("[Direct]  Plan details incomplete in cache, attempting API fallback"),_t.getDetails(O).then(le=>{console.log("[Direct]  Got fresh details from API:",le),le&&le.completed?(console.log("[Direct] Fresh details from API are valid, updating UI"),De.setCachedPlanRecord(O,le),d.value.handlePlanCompleted(le)):(console.warn("[Direct]  API details also incomplete, using best available data"),d.value.handlePlanCompleted(L??{planId:O}))}).catch(le=>{console.error("[Direct] API call failed (likely record deleted), using cached data:",le),d.value.handlePlanCompleted(L??{planId:O})}))}else console.warn("[Direct] chatRef.handlePlanCompleted method not available");_.value=null,console.log("[Direct] 🧹 Cleared currentRootPlanId after plan completion"),u.value&&typeof u.value.resetSession=="function"&&(console.log("[Direct] 🧹 Calling inputRef.resetSession to clear sessionPlanId"),u.value.resetSession())}},onDialogRoundStart:O=>{console.log("[Direct] Dialog round start event received for rootPlanId:",O),_.value=O,console.log("[Direct] Set currentRootPlanId to:",O),d.value&&typeof d.value.handleDialogRoundStart=="function"?(console.log("[Direct] Calling chatRef.handleDialogRoundStart with planId:",O),d.value.handleDialogRoundStart(O)):console.warn("[Direct] chatRef.handleDialogRoundStart method not available")},onChatInputClear:()=>{console.log("[Direct] Chat input clear event received"),Q()},onChatInputUpdateState:O=>{if(console.log("[Direct] Chat input update state event received for rootPlanId:",O),!D(O,!0))return;const L=De.getCachedUIState(O);L&&A(L.enabled,L.placeholder)},onPlanError:O=>{d.value.handlePlanError(O)}}),console.log("[Direct] Event callbacks registered to planExecutionManager"),H.loadPlanTemplateList(),t.hasUnprocessedTask()&&t.currentTask){const O=t.currentTask.prompt;console.log("[Direct] Found unprocessed task from store:",O),t.markTaskAsProcessed(),Pe(async()=>{try{console.log("[Direct] Calling handleChatSendMessage with taskContent:",O),await M({input:O})}catch(L){console.warn("[Direct] handleChatSendMessage failed, falling back to prompt:",L),i.value=O}})}else{const O=t.getAndClearTaskToInput();O?(p.value=O,console.log("[Direct] Setting inputOnlyContent for input only:",p.value)):(i.value=e.query.prompt||"",console.log("[Direct] Received task from URL:",i.value),console.log("[Direct] No unprocessed task in store"))}const N=localStorage.getItem("directPanelWidth");N&&(h.value=parseFloat(N)),console.log("[Direct] Final prompt value:",i.value),p.value&&Pe(()=>{u.value&&typeof u.value.setInputValue=="function"&&(u.value.setInputValue(p.value),console.log("[Direct] Set input value:",p.value),p.value="")}),window.addEventListener("plan-execution-requested",O=>{console.log("[DirectView] Received plan-execution-requested event:",O.detail),V(O.detail)})}),ue(()=>t.currentTask,N=>{if(console.log("[Direct] Watch taskStore.currentTask triggered, newTask:",N),N&&!N.processed){const O=N.prompt;t.markTaskAsProcessed(),console.log("[Direct] Received new task from store:",O),Pe(async()=>{try{console.log("[Direct] Directly executing new task via handleChatSendMessage:",O),await M({input:O})}catch(L){console.warn("[Direct] handleChatSendMessage failed for new task:",L)}})}else console.log("[Direct] Task is null or already processed, ignoring")},{immediate:!1}),ue(()=>i.value,(N,O)=>{console.log("[Direct] prompt value changed from:",O,"to:",N)},{immediate:!1}),ue(()=>t.taskToInput,N=>{console.log("[Direct] Watch taskStore.taskToInput triggered, newTaskToInput:",N),N!=null&&N.trim()&&(console.log("[Direct] Setting input value from taskToInput:",N),Pe(()=>{u.value&&typeof u.value.setInputValue=="function"&&(u.value.setInputValue(N.trim()),console.log("[Direct] Input value set from taskToInput watch:",N.trim()),t.getAndClearTaskToInput())}))},{immediate:!1}),Se(()=>{console.log("[Direct] onUnmounted called, cleaning up resources"),_.value=null,De.cleanup(),document.removeEventListener("mousemove",q),document.removeEventListener("mouseup",x),window.removeEventListener("plan-execution-requested",N=>{V(N.detail)})});const f=N=>{b.value=!0,T.value=N.clientX,$.value=h.value,document.addEventListener("mousemove",q),document.addEventListener("mouseup",x),document.body.style.cursor="col-resize",document.body.style.userSelect="none",N.preventDefault()},q=N=>{if(!b.value)return;const O=window.innerWidth,le=(N.clientX-T.value)/O*100;let G=$.value+le;G=Math.max(20,Math.min(80,G)),h.value=G},x=()=>{b.value=!1,document.removeEventListener("mousemove",q),document.removeEventListener("mouseup",x),document.body.style.cursor="",document.body.style.userSelect="",localStorage.setItem("directPanelWidth",h.value.toString())},te=()=>{h.value=50,localStorage.setItem("directPanelWidth","50")},D=(N,O=!1)=>!_.value||N===_.value||O&&(N==="ui-state"||N==="error")?!0:(console.log("[Direct] Ignoring event for non-current rootPlanId:",N,"current:",_.value),!1),M=async N=>{var L,le,G,X,K,_e,xe,Je,Ke;let O=null;try{console.log("[DirectView] Processing send-message event:",N);const Re=(L=d.value)==null?void 0:L.addMessage("user",N.input);N.attachments&&Re&&((le=d.value)==null||le.updateMessage(Re.id,{attachments:N.attachments})),O=(G=d.value)==null?void 0:G.addMessage("assistant","",{thinking:a("chat.thinkingProcessing")}),O&&((X=d.value)==null||X.startStreaming(O.id));const{DirectApiService:at}=await qs(async()=>{const{DirectApiService:Ie}=await Promise.resolve().then(()=>gf);return{DirectApiService:Ie}},void 0);console.log("[DirectView] Calling DirectApiService.sendMessageWithDefaultPlan");const he=await at.sendMessageWithDefaultPlan(N);console.log("[DirectView] API response received:",he),he.planId&&O?((K=d.value)==null||K.updateMessage(O.id,{thinking:a("chat.planningExecution"),planExecution:{currentPlanId:he.planId,rootPlanId:he.planId,status:"running"}}),_.value=he.planId,console.log("[DirectView] Set currentRootPlanId to:",he.planId),De.handlePlanExecutionRequested(he.planId,N.input),console.log("[DirectView] Started polling for plan execution updates")):O&&((_e=d.value)==null||_e.updateMessage(O.id,{content:he.message||he.result||"No response received from backend"}),(xe=d.value)==null||xe.stopStreaming(O.id))}catch(Re){console.error("[DirectView] Send message failed:",Re),(Je=d.value)==null||Je.addMessage("assistant",`Error: ${(Re==null?void 0:Re.message)||"Failed to send message"}`),O&&((Ke=d.value)==null||Ke.stopStreaming(O.id))}},z=async N=>{console.log("[DirectView] Send message from input:",JSON.stringify(N)),await M(N)},Q=()=>{console.log("[DirectView] Input cleared"),u.value&&typeof u.value.clear=="function"&&u.value.clear()},E=()=>{console.log("[DirectView] Input focused")},A=(N,O)=>{console.log("[DirectView] Input state updated:",N,O),U.value=!N},J=N=>{console.log("[DirectView] Step selected:",N),g.value&&typeof g.value.handleStepSelected=="function"?(console.log("[DirectView] Forwarding step selection to right panel:",N),g.value.handleStepSelected(N)):console.warn("[DirectView] rightPanelRef.handleStepSelected method not available")},Y=(N,O,L,le)=>{console.log("[DirectView] Sub plan step selected:",{parentPlanId:N,subPlanId:O,stepIndex:L,subStepIndex:le}),g.value&&typeof g.value.handleSubPlanStepSelected=="function"?(console.log("[DirectView] Forwarding sub plan step selection to right panel:",{parentPlanId:N,subPlanId:O,stepIndex:L,subStepIndex:le}),g.value.handleSubPlanStepSelected(N,O,L,le)):console.warn("[DirectView] rightPanelRef.handleSubPlanStepSelected method not available")},ae=()=>{console.log("[DirectView] Plan mode button clicked"),H.toggleSidebar(),console.log("[DirectView] Sidebar toggled, isCollapsed:",H.isCollapsed)},j=()=>{n.push("/home")},Z=()=>{n.push("/configs")},V=async N=>{var le,G,X,K,_e,xe,Je,Ke,Re,at;if(console.log("[DirectView] Plan execution requested:",N),C.value){console.log("[DirectView] Plan execution already in progress, ignoring request");return}C.value=!0;let O=!1,L=null;try{console.log("[DirectView] Adding messages for plan execution:",N.title),(le=d.value)==null||le.addMessage("user",N.title),O=!0,L=(G=d.value)==null?void 0:G.addMessage("assistant","",{thinking:a("chat.planningExecution")}),L&&((X=d.value)==null||X.startStreaming(L.id),console.log("[DirectView] Added assistant message for plan execution:",L.id))}catch(he){console.warn("[DirectView] Failed to add messages:",he)}try{const he=(K=N.planData)==null?void 0:K.planTemplateId;if(!he)throw new Error(a("direct.planTemplateIdNotFound"));console.log("[Direct] Executing plan with templateId:",he,"params:",N.params),console.log("[Direct] About to call PlanActApiService.executePlan");const Ie=N.uploadedFiles||[],$t=N.uploadKey||void 0;console.log("[Direct] 🔍 DEBUG - InputArea uploadedFiles:",Ie),console.log("[Direct] 🔍 DEBUG - InputArea uploadKey:",$t),console.log("[Direct] Executing with uploaded files:",(Ie==null?void 0:Ie.length)??0),console.log("[Direct] Executing with replacement params:",N.replacementParams);let Ee;if((_e=N.params)!=null&&_e.trim()?(console.log("[Direct] Calling executePlan with rawParam:",N.params.trim()),Ee=await Ze.executePlan(he,N.params.trim(),Ie,N.replacementParams,$t)):(console.log("[Direct] Calling executePlan without rawParam"),Ee=await Ze.executePlan(he,void 0,Ie,N.replacementParams,$t)),console.log("[Direct] Plan execution API response:",Ee),Ee.planId&&L)console.log("[Direct] Got planId from response:",Ee.planId,"starting plan execution"),(xe=d.value)==null||xe.updateMessage(L.id,{thinking:a("chat.planningExecution"),planExecution:{currentPlanId:Ee.planId,rootPlanId:Ee.planId,status:"running"}}),_.value=Ee.planId,console.log("[Direct] Set currentRootPlanId to:",Ee.planId),console.log("[Direct] Delegating plan execution to planExecutionManager"),De.handlePlanExecutionRequested(Ee.planId,N.title);else throw console.error("[Direct] No planId in response:",Ee),new Error(a("direct.executionFailedNoPlanId"))}catch(he){console.error("[Direct] Plan execution failed:",he),console.error("[Direct] Error details:",{message:he.message,stack:he.stack}),_.value=null;try{console.log("[Direct] Adding error messages to chat"),O||(Je=d.value)==null||Je.addMessage("user",N.title),L?((Ke=d.value)==null||Ke.updateMessage(L.id,{content:`${a("direct.executionFailed")}: ${he.message||a("common.unknownError")}`,thinking:void 0}),(Re=d.value)==null||Re.stopStreaming(L.id)):(at=d.value)==null||at.addMessage("assistant",`${a("direct.executionFailed")}: ${he.message||a("common.unknownError")}`)}catch(Ie){console.error("[Direct] Failed to add error messages:",Ie),alert(`${a("direct.executionFailed")}: ${he.message||a("common.unknownError")}`)}}finally{console.log("[Direct] Plan execution finished, resetting isExecutingPlan flag"),C.value=!1}},w=()=>{d.value.showMemory()},W=()=>{Me.clearMemoryId(),d.value.newChat()};return(N,O)=>(m(),v("div",Kv,[s("div",Xv,[S($c,{ref_key:"sidebarRef",ref:k,onPlanExecutionRequested:V},null,512),s("div",{class:"left-panel",style:Ge({width:R.value+"%"})},[s("div",Yv,[s("button",{class:"back-button",onClick:j},[S(r(P),{icon:"carbon:arrow-left"})]),s("h2",null,c(N.$t("conversation")),1),s("div",Qv,[S(Ws),s("button",{class:"config-button",onClick:W,title:N.$t("memory.newChat")},[S(r(P),{icon:"carbon:add",width:"20"})],8,Zv),s("button",{class:"config-button",onClick:Z,title:N.$t("direct.configuration")},[S(r(P),{icon:"carbon:settings-adjust",width:"20"})],8,eg),s("button",{class:"cron-task-btn",onClick:O[0]||(O[0]=L=>y.value=!0),title:N.$t("cronTask.title")},[S(r(P),{icon:"carbon:alarm",width:"20"})],8,tg),s("button",{class:"cron-task-btn",onClick:O[1]||(O[1]=L=>r(Me).toggleSidebar()),title:N.$t("memory.selectMemory")},[S(r(P),{icon:"carbon:calendar",width:"20"})],8,sg)])]),s("div",ng,[S(Sf,{ref_key:"chatRef",ref:d,mode:"direct","initial-prompt":i.value||"",onStepSelected:J,onSubPlanStepSelected:Y},null,8,["initial-prompt"])]),(m(),ie(If,{key:N.$i18n.locale,ref_key:"inputRef",ref:u,disabled:U.value,placeholder:U.value?r(a)("input.waiting"):r(a)("input.placeholder"),"initial-value":i.value,onSend:z,onClear:Q,onFocus:E,onUpdateState:A,onPlanModeClicked:ae},null,8,["disabled","placeholder","initial-value"]))],4),s("div",{class:"panel-resizer",onMousedown:f,onDblclick:te,title:N.$t("direct.panelResizeHint")},O[3]||(O[3]=[s("div",{class:"resizer-line"},null,-1)]),40,og),S(_p,{ref_key:"rightPanelRef",ref:g,style:Ge({width:100-h.value+"%"}),"current-root-plan-id":_.value},null,8,["style","current-root-plan-id"])]),S(Jv,{modelValue:y.value,"onUpdate:modelValue":O[2]||(O[2]=L=>y.value=L)},null,8,["modelValue"]),S(vd,{onMemorySelected:w}),r(l).show?(m(),v("div",{key:0,class:oe(["message-toast",r(l).type])},[s("div",ag,[s("span",null,c(r(l).text),1)])],2)):B("",!0)]))}}),xg=me(lg,[["__scopeId","data-v-35690d5f"]]);export{xg as default};
