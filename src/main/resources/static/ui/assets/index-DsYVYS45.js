var Bs=Object.defineProperty;var Os=(o,e,n)=>e in o?Bs(o,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):o[e]=n;var ve=(o,e,n)=>Os(o,typeof e!="symbol"?e+"":e,n);import{d as pe,u as Pe,c as ue,r as U,B as st,C as de,o as we,a as f,b as p,F as ae,g as w,f as L,p as Fe,h as se,i as l,t as c,e as s,w as te,m as re,n as ne,q as ie,D as it,E as Vt,l as le,G as nt,H as qs,I as as,J as Te,z as We,j as me,T as qe,K as Qe,M as ls,A as ke,v as js,N as rs,O as Ze,y as is,P as Vs,_ as Hs}from"./index-e3AKqrr_.js";import{I as T,_ as he}from"./_plugin-vue_export-helper-JzF1S3C8.js";import{s as H,P as et,u as cs}from"./sidebar-iHN9Uj2f.js";import{M as Gs,A as Ws,T as zs,u as ds,a as Js}from"./useMessage-CCNPZjWb.js";import{L as Ht}from"./llm-check-BVkAKrj3.js";import{L as Ks}from"./LanguageSwitcher-BkM2hO-K.js";class Me{static async getCoordinatorToolConfig(){try{const e=await fetch(`${this.BASE_URL}/config`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!e.ok)throw new Error(`Failed to get coordinator tool config: ${e.status}`);return await e.json()}catch(e){return console.error("Failed to get CoordinatorTool configuration:",e),{enabled:!0,success:!1,message:e.message}}}static async getAllEndpoints(){try{const e=await fetch(`${this.BASE_URL}/endpoints`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!e.ok)throw new Error(`Failed to get endpoints: ${e.status}`);return await e.json()}catch(e){throw console.error("Failed to get endpoints:",e),new Error("Failed to get endpoints: "+e.message)}}static async getCoordinatorToolsByTemplate(e){console.log("[CoordinatorToolApiService] Starting to get coordinator tool, planTemplateId:",e),console.log("[CoordinatorToolApiService] Request URL:",`${this.BASE_URL}/get-get-or-new-by-template/${e}`);try{const n=await fetch(`${this.BASE_URL}/get-or-new-by-template/${e}`,{method:"GET",headers:{"Content-Type":"application/json"}});if(console.log("[CoordinatorToolApiService] Response status:",n.status),console.log("[CoordinatorToolApiService] Response status text:",n.statusText),n.status===404)return console.log("[CoordinatorToolApiService] 404"),null;if(!n.ok){const a=await n.text();throw console.error("[CoordinatorToolApiService] Response error content:",a),new Error(`Failed to get coordinator tools: ${n.status} - ${a}`)}const t=await n.json();return console.log("[CoordinatorToolApiService] Successfully got coordinator tool, result:",t),t}catch(n){throw console.error("[CoordinatorToolApiService] Failed to get coordinator tool:",n),new Error("Failed to get coordinator tool: "+n.message)}}static async getOrNewCoordinatorToolsByTemplate(e){console.log("[CoordinatorToolApiService] Starting to get or create coordinator tool, planTemplateId:",e),console.log("[CoordinatorToolApiService] Request URL:",`${this.BASE_URL}/get-or-new-by-template/${e}`);try{const n=await fetch(`${this.BASE_URL}/get-or-new-by-template/${e}`,{method:"GET",headers:{"Content-Type":"application/json"}});if(console.log("[CoordinatorToolApiService] Response status:",n.status),console.log("[CoordinatorToolApiService] Response status text:",n.statusText),!n.ok){const a=await n.text();throw console.error("[CoordinatorToolApiService] Response error content:",a),new Error(`Failed to get coordinator tools: ${n.status} - ${a}`)}const t=await n.json();return console.log("[CoordinatorToolApiService] Successfully got coordinator tool, result:",t),t}catch(n){throw console.error("[CoordinatorToolApiService] Failed to get coordinator tool:",n),new Error("Failed to get coordinator tool: "+n.message)}}static async createCoordinatorTool(e){console.log("[CoordinatorToolApiService] Starting to create coordinator tool"),console.log("[CoordinatorToolApiService] Original data:",JSON.stringify(e,null,2)),console.log("[CoordinatorToolApiService] Request URL:",`${this.BASE_URL}`);const n={id:e.id,toolName:e.toolName,toolDescription:e.toolDescription,inputSchema:e.inputSchema,planTemplateId:e.planTemplateId,httpEndpoint:e.httpEndpoint,mcpEndpoint:e.mcpEndpoint,serviceGroup:e.serviceGroup,enableInternalToolcall:e.enableInternalToolcall,enableHttpService:e.enableHttpService,enableMcpService:e.enableMcpService};console.log("[CoordinatorToolApiService] Cleaned sending data:",JSON.stringify(n,null,2));try{const t=await fetch(`${this.BASE_URL}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});if(console.log("[CoordinatorToolApiService] Response status:",t.status),console.log("[CoordinatorToolApiService] Response status text:",t.statusText),!t.ok){let r="Unknown error";try{const i=await t.json();r=i.message||i.error||r}catch{r=await t.text()||r}throw console.error("[CoordinatorToolApiService] Response error content:",r),new Error(`Failed to create coordinator tool: ${t.status} - ${r}`)}const a=await t.json();return console.log("[CoordinatorToolApiService] Created successfully, result:",a),a}catch(t){throw console.error("[CoordinatorToolApiService] Failed to create coordinator tool:",t),new Error("Failed to create coordinator tool: "+t.message)}}static async updateCoordinatorTool(e,n){console.log("[CoordinatorToolApiService] Starting to update coordinator tool, ID:",e),console.log("[CoordinatorToolApiService] Sending data:",n),console.log("[CoordinatorToolApiService] Request URL:",`${this.BASE_URL}/${e}`);const t={id:n.id,toolName:n.toolName,toolDescription:n.toolDescription,inputSchema:n.inputSchema,planTemplateId:n.planTemplateId,httpEndpoint:n.httpEndpoint,mcpEndpoint:n.mcpEndpoint,serviceGroup:n.serviceGroup,enableInternalToolcall:n.enableInternalToolcall,enableHttpService:n.enableHttpService,enableMcpService:n.enableMcpService};console.log("[CoordinatorToolApiService] Cleaned sending data:",t);try{const a=await fetch(`${this.BASE_URL}/${e}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(console.log("[CoordinatorToolApiService] Response status:",a.status),console.log("[CoordinatorToolApiService] Response status text:",a.statusText),!a.ok){let i="Unknown error";try{const h=await a.json();i=h.message||h.error||i}catch{i=await a.text()||i}throw console.error("[CoordinatorToolApiService] Response error content:",i),new Error(`Failed to update coordinator tool: ${a.status} - ${i}`)}const r=await a.json();return console.log("[CoordinatorToolApiService] Updated successfully, result:",r),r}catch(a){throw console.error("[CoordinatorToolApiService] Failed to update coordinator tool:",a),new Error("Failed to update coordinator tool: "+a.message)}}static async deleteCoordinatorTool(e){console.log("[CoordinatorToolApiService] Starting to delete coordinator tool, ID:",e),console.log("[CoordinatorToolApiService] Request URL:",`${this.BASE_URL}/${e}`);try{const n=await fetch(`${this.BASE_URL}/${e}`,{method:"DELETE",headers:{"Content-Type":"application/json"}});if(console.log("[CoordinatorToolApiService] Response status:",n.status),console.log("[CoordinatorToolApiService] Response status text:",n.statusText),!n.ok){const a=await n.text();throw console.error("[CoordinatorToolApiService] Response error content:",a),new Error(`Failed to delete coordinator tool: ${n.status} - ${a}`)}const t=await n.json();return console.log("[CoordinatorToolApiService] Deleted successfully, result:",t),t}catch(n){throw console.error("[CoordinatorToolApiService] Failed to delete coordinator tool:",n),new Error("Failed to delete coordinator tool: "+n.message)}}}ve(Me,"BASE_URL","/api/coordinator-tools");class Ft{static async getParameterRequirements(e){try{const n=await fetch(`${this.BASE_URL}/${e}/parameters`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!n.ok)throw new Error(`Failed to get parameter requirements: ${n.statusText}`);return await n.json()}catch(n){throw console.error("Error getting parameter requirements:",n),n}}}ve(Ft,"BASE_URL","/api/plan-template");const Xs={class:"modal-form wide-modal"},Ys={class:"form-section"},Qs={class:"form-item"},Zs=["placeholder"],en={class:"field-description"},tn={class:"form-section"},sn={class:"form-item"},nn=["placeholder"],on={class:"field-description"},an={class:"form-section"},ln={class:"form-item"},rn=["placeholder"],cn={class:"field-description"},dn={class:"form-section"},un={class:"section-title"},pn={key:0,class:"params-help-text"},hn={class:"parameter-table"},mn=["onUpdate:modelValue","placeholder","readonly"],fn=["onUpdate:modelValue","placeholder"],vn={class:"form-section"},gn={class:"service-publish-options"},bn={class:"internal-toolcall-publish-option"},yn={class:"checkbox-label"},_n={class:"checkbox-text"},$n={class:"checkbox-description"},wn={class:"http-publish-option"},Sn={class:"checkbox-label"},kn={class:"checkbox-text"},Tn={class:"checkbox-description"},Pn={class:"mcp-publish-option"},En={class:"checkbox-label"},Cn={class:"checkbox-text"},Rn={class:"checkbox-description"},In={key:0,class:"form-section"},An={class:"form-item"},Dn={class:"endpoint-description"},xn={class:"endpoint-container"},Mn={class:"endpoint-row"},Fn={class:"custom-select"},Un={class:"select-input-container"},Nn={class:"input-content"},Ln=["placeholder"],Bn={class:"dropdown-header"},On={class:"select-options"},qn=["onClick"],jn={class:"option-name"},Vn={class:"manual-input-section"},Hn={class:"manual-input-container"},Gn=["placeholder"],Wn={key:0,class:"form-item url-item"},zn={class:"url-container"},Jn=["title"],Kn={class:"url-text"},Xn={class:"button-container"},Yn=["disabled"],Qn=["disabled"],Zn=pe({__name:"PublishServiceModal",props:{modelValue:{type:Boolean,default:!1},planTemplateId:{default:""},planTitle:{default:""},planDescription:{default:""}},emits:["update:modelValue","published"],setup(o,{expose:e,emit:n}){const{t}=Pe(),a=o,r=n,i=ue({get:()=>a.modelValue,set:V=>r("update:modelValue",V)}),h=U(""),g=U(""),u=U(!1),d=U(!1),b=U([]),A=U(""),M=U(!1),_=U("bottom"),y=U(""),v=U(null),$=U(!1),P=U(!1),S=U(!1),I=U(!0),m=U({parameters:[],hasParameters:!1,requirements:""}),q=U(!1),x=st({serviceName:"",userRequest:"",endpoint:"",serviceGroup:"",parameters:[]}),z=ue(()=>{const V=v.value&&v.value.id;return t(V?"mcpService.updateService":"mcpService.createService")}),R=()=>{x.serviceName="",x.userRequest=a.planDescription||"",x.endpoint="",x.serviceGroup="",m.value.hasParameters||(x.parameters=[]),v.value=null,A.value="",$.value=!1},F=async()=>{try{b.value=await Me.getAllEndpoints()}catch(V){console.error("Failed to load endpoints:",V),k(t("mcpService.loadEndpointsFailed")+": "+V.message,"error")}},G=async()=>{if(!a.planTemplateId){m.value={parameters:[],hasParameters:!1,requirements:""};return}q.value=!0;try{const V=await Ft.getParameterRequirements(a.planTemplateId);m.value=V,V.hasParameters&&(x.parameters=V.parameters.map(Y=>({name:Y,description:""})))}catch(V){console.error("[PublishModal] Failed to load parameter requirements:",V),V instanceof Error&&!V.message.includes("404")&&console.warn("[PublishModal] Parameter requirements not available yet, will retry later"),m.value={parameters:[],hasParameters:!1,requirements:""}}finally{q.value=!1}},Q=()=>{M.value||E(),M.value=!M.value},E=()=>{const V=document.querySelector(".custom-select");if(!V)return;const Y=V.getBoundingClientRect(),X=window.innerHeight;Y.bottom+200>X?_.value="top":_.value="bottom"},C=V=>{x.endpoint=V,M.value=!1,y.value=""},B=()=>{if(y.value.trim()){const V=y.value.trim().replace(/[^a-zA-Z0-9_/]/g,"");V&&(x.endpoint=V,b.value.includes(V)||b.value.push(V),M.value=!1,y.value="")}},J=()=>{setTimeout(()=>{y.value.trim()&&B()},200)},oe=()=>{b.value.includes(x.endpoint)&&C(x.endpoint)},ee=()=>{b.value.includes(x.endpoint)&&C(x.endpoint)},ge=()=>{b.value.includes(x.endpoint)&&C(x.endpoint)},W=async()=>{if(A.value)try{await navigator.clipboard.writeText(A.value),k(t("common.copy")+" "+t("common.success"),"success")}catch(V){console.error("Copy failed:",V),k(t("common.copy")+" "+t("common.error"),"error")}},k=(V,Y)=>{Y==="success"?(g.value=V,setTimeout(()=>{g.value=""},3e3)):Y==="error"&&(h.value=V,setTimeout(()=>{h.value=""},5e3))},j=()=>{if(!x.serviceName||!x.serviceName.trim())return k(t("mcpService.toolNameRequiredError"),"error"),!1;if(!x.userRequest||!x.userRequest.trim())return k(t("mcpService.toolDescriptionRequiredError"),"error"),!1;if(!x.serviceGroup||!x.serviceGroup.trim())return k(t("mcpService.serviceGroupRequiredError"),"error"),!1;if(P.value&&(!x.endpoint||!x.endpoint.trim()))return k(t("mcpService.endpointRequiredError"),"error"),!1;if(!I.value&&!S.value&&!P.value)return k("Please select at least one service type","error"),!1;for(let V=0;V<x.parameters.length;V++){const Y=x.parameters[V];if(Y.name&&!Y.description.trim())return k(`Parameter "${Y.name}" description cannot be empty`,"error"),!1;if(Y.description&&!Y.name.trim())return k(`Parameter description "${Y.description}" corresponding name cannot be empty`,"error"),!1}return!0},N=async()=>{if(console.log("[PublishModal] Starting to handle publish request"),console.log("[PublishModal] Form data:",x),console.log("[PublishModal] Current tool:",v.value),console.log("[PublishModal] Publish as MCP service:",P.value),console.log("[PublishModal] Publish as HTTP service:",S.value),!j()){console.log("[PublishModal] Form validation failed");return}u.value=!0;try{v.value||(console.log("[PublishModal] No current tool data, getting or creating first"),v.value=await Me.getOrNewCoordinatorToolsByTemplate(a.planTemplateId)),console.log("[PublishModal] Updating tool information"),v.value.toolName=x.serviceName.trim(),v.value.toolDescription=x.userRequest.trim(),v.value.serviceGroup=x.serviceGroup.trim(),v.value.planTemplateId=a.planTemplateId,v.value.enableInternalToolcall=I.value,v.value.enableHttpService=S.value,v.value.enableMcpService=P.value,P.value?v.value.mcpEndpoint=x.endpoint.trim():v.value.mcpEndpoint=void 0;const V=x.parameters.filter(X=>X.name.trim()&&X.description.trim()).map(X=>({name:X.name.trim(),description:X.description.trim(),type:"string"}));if(v.value.inputSchema=JSON.stringify(V),console.log("[PublishModal] Updated tool information:",v.value),v.value.id)console.log("[PublishModal] Updating existing tool, ID:",v.value.id),await Me.updateCoordinatorTool(v.value.id,v.value);else{console.log("[PublishModal] Creating new tool");const X=await Me.createCoordinatorTool(v.value);v.value=X}const Y=[];if(I.value&&Y.push("Internal Method Call"),S.value&&Y.push("HTTP Service"),P.value&&Y.push("MCP Service"),Y.length>0){console.log("[PublishModal] Step 5: Publishing service, ID:",v.value.id,"Enabled services:",Y.join(", "));const X=[];if(P.value&&v.value.mcpEndpoint){const ye=window.location.origin;X.push(`MCP: ${ye}/mcp${v.value.mcpEndpoint}`)}I.value&&X.push(`Internal Call: ${x.serviceName}`),A.value=X.join(`
`),console.log("[PublishModal] Service published successfully, service URLs:",A.value),k(t("mcpService.publishSuccess"),"success"),r("published",v.value)}else console.log("[PublishModal] Only saving tool, not publishing as any service"),k(t("mcpService.saveSuccess"),"success"),r("published",v.value)}catch(V){console.error("[PublishModal] Failed to publish service:",V),k(t("mcpService.publishFailed")+": "+V.message,"error")}finally{u.value=!1}},O=async()=>{if(!d.value&&confirm(t("mcpService.deleteConfirmMessage"))){if(!v.value||!v.value.id){k(t("mcpService.deleteFailed")+": "+t("mcpService.selectPlanTemplateFirst"),"error");return}d.value=!0;try{console.log("[PublishModal] Starting to delete MCP service, ID:",v.value.id);const V=await Me.deleteCoordinatorTool(v.value.id);if(V.success)console.log("[PublishModal] Deleted successfully"),k(t("mcpService.deleteSuccess"),"success"),i.value=!1,r("published",null);else throw new Error(V.message)}catch(V){console.error("[PublishModal] Failed to delete MCP service:",V),k(t("mcpService.deleteFailed")+": "+V.message,"error")}finally{d.value=!1}}},K=async()=>{i.value&&(console.log("[PublishModal] Modal opened, starting to initialize data"),R(),await F(),await ce())},ce=async()=>{if(!a.planTemplateId){console.log("[PublishModal] "+t("mcpService.noPlanTemplateId"));return}try{console.log("[PublishModal] Starting to load coordinator tool data, planTemplateId:",a.planTemplateId);const V=await Me.getOrNewCoordinatorToolsByTemplate(a.planTemplateId);console.log("[PublishModal] Get coordinator tool data result:",V),v.value=V,$.value=!!V.id;const Y=[];if(V.enableMcpService&&V.mcpEndpoint){const X=window.location.origin;Y.push(`MCP: ${X}/mcp${V.mcpEndpoint}`)}V.enableInternalToolcall&&Y.push(`Internal Call: ${V.toolName}`),A.value=Y.join(`
`),console.log("[PublishModal] Load tool data - endpointUrl:",A.value),x.serviceName=V.toolName||"",x.userRequest=V.toolDescription||a.planDescription||"",x.serviceGroup=V.serviceGroup||"",P.value=V.enableMcpService||!1,S.value=V.enableHttpService||!1,I.value=V.enableInternalToolcall||!1,V.enableMcpService&&(x.endpoint=V.mcpEndpoint||"");try{if(V.inputSchema){const X=JSON.parse(V.inputSchema);Array.isArray(X)&&X.length>0?(x.parameters=X.map(ye=>({name:ye.name||"",description:ye.description||""})),console.log("[PublishModal] Load parameters from inputSchema:",x.parameters)):console.log("[PublishModal] inputSchema is empty, keeping existing parameters:",x.parameters)}}catch(X){console.warn("[PublishModal] "+t("mcpService.parseInputSchemaFailed")+":",X),console.log("[PublishModal] Parsing failed, keeping existing parameters:",x.parameters)}console.log("[PublishModal] Form data filled:",x)}catch(V){console.error("[PublishModal] "+t("mcpService.loadToolDataFailed")+":",V),k(t("mcpService.loadToolDataFailed")+": "+V.message,"error")}};return de(()=>a.modelValue,K),de(()=>a.planTemplateId,(V,Y)=>{V&&V!==Y&&(Y&&V.startsWith("planTemplate-")?setTimeout(()=>{G()},1e3):G())}),we(async()=>{i.value&&(console.log("[PublishModal] Initialize when component mounted"),R(),await F(),await ce(),await G())}),e({loadParameterRequirements:G}),(V,Y)=>(p(),f(ae,null,[w(Gs,{modelValue:i.value,"onUpdate:modelValue":Y[11]||(Y[11]=X=>i.value=X),title:z.value,onConfirm:N},{footer:Fe(()=>{var X;return[s("div",Xn,[$.value&&((X=v.value)!=null&&X.id)?(p(),f("button",{key:0,class:"action-btn danger",onClick:O,disabled:d.value},[d.value?(p(),le(l(T),{key:0,icon:"carbon:loading",class:"loading-icon"})):(p(),le(l(T),{key:1,icon:"carbon:trash-can"})),se(" "+c(d.value?l(t)("mcpService.deleting"):l(t)("mcpService.delete")),1)],8,Yn)):L("",!0),s("button",{class:"action-btn primary",onClick:N,disabled:u.value},[u.value?(p(),le(l(T),{key:0,icon:"carbon:loading",class:"loading-icon"})):(p(),le(l(T),{key:1,icon:"carbon:cloud-upload"})),se(" "+c(u.value?l(t)("mcpService.publishing"):l(t)("mcpService.publishAsService")),1)],8,Qn)])]}),default:Fe(()=>[s("div",Xs,[s("div",Ys,[s("div",Qs,[s("label",null,c(l(t)("mcpService.toolNameRequired")),1),te(s("input",{type:"text","onUpdate:modelValue":Y[0]||(Y[0]=X=>x.serviceName=X),placeholder:l(t)("mcpService.toolNamePlaceholder"),class:ne({error:!x.serviceName||!x.serviceName.trim()}),required:""},null,10,Zs),[[re,x.serviceName]]),s("div",en,c(l(t)("mcpService.toolNameDescription")),1)])]),s("div",tn,[s("div",sn,[s("label",null,c(l(t)("mcpService.toolDescriptionRequired")),1),te(s("textarea",{"onUpdate:modelValue":Y[1]||(Y[1]=X=>x.userRequest=X),placeholder:l(t)("mcpService.toolDescriptionPlaceholder"),class:ne([{error:!x.userRequest||!x.userRequest.trim()},"description-field"]),rows:"4",required:""},null,10,nn),[[re,x.userRequest]]),s("div",on,c(l(t)("mcpService.toolDescriptionDescription")),1)])]),s("div",an,[s("div",ln,[s("label",null,c(l(t)("mcpService.serviceGroup")),1),te(s("input",{type:"text","onUpdate:modelValue":Y[2]||(Y[2]=X=>x.serviceGroup=X),placeholder:l(t)("mcpService.serviceGroupPlaceholder"),class:ne({error:!x.serviceGroup||!x.serviceGroup.trim()}),required:""},null,10,rn),[[re,x.serviceGroup]]),s("div",cn,c(l(t)("mcpService.serviceGroupDescription")),1)])]),s("div",dn,[s("div",un,c(l(t)("mcpService.parameterConfig")),1),m.value.hasParameters?(p(),f("div",pn,c(l(t)("sidebar.parameterRequirementsHelp")),1)):L("",!0),s("div",hn,[s("table",null,[s("thead",null,[s("tr",null,[s("th",null,c(l(t)("mcpService.parameterName")),1),s("th",null,c(l(t)("mcpService.parameterDescription")),1)])]),s("tbody",null,[(p(!0),f(ae,null,ie(x.parameters,(X,ye)=>(p(),f("tr",{key:ye},[s("td",null,[te(s("input",{type:"text","onUpdate:modelValue":De=>X.name=De,placeholder:l(t)("mcpService.parameterName"),class:ne(["parameter-input",{"readonly-input":m.value.hasParameters}]),readonly:m.value.hasParameters,required:""},null,10,mn),[[re,X.name]])]),s("td",null,[te(s("input",{type:"text","onUpdate:modelValue":De=>X.description=De,placeholder:l(t)("mcpService.parameterDescription"),class:"parameter-input",required:""},null,8,fn),[[re,X.description]])])]))),128))])])])]),s("div",vn,[s("div",gn,[s("div",bn,[s("label",yn,[te(s("input",{type:"checkbox","onUpdate:modelValue":Y[3]||(Y[3]=X=>I.value=X),class:"checkbox-input"},null,512),[[it,I.value]]),s("span",_n,c(l(t)("mcpService.publishAsInternalToolcall")),1)]),s("div",$n,c(l(t)("mcpService.publishAsInternalToolcallDescription")),1)]),s("div",wn,[s("label",Sn,[te(s("input",{type:"checkbox","onUpdate:modelValue":Y[4]||(Y[4]=X=>S.value=X),class:"checkbox-input"},null,512),[[it,S.value]]),s("span",kn,c(l(t)("mcpService.publishAsHttpService")),1)]),s("div",Tn,c(l(t)("mcpService.publishAsHttpServiceDescription")),1)]),s("div",Pn,[s("label",En,[te(s("input",{type:"checkbox","onUpdate:modelValue":Y[5]||(Y[5]=X=>P.value=X),class:"checkbox-input"},null,512),[[it,P.value]]),s("span",Cn,c(l(t)("mcpService.publishAsMcpService")),1)]),s("div",Rn,c(l(t)("mcpService.publishAsMcpServiceDescription")),1),P.value?(p(),f("div",In,[s("div",An,[s("label",null,c(l(t)("mcpService.endpointRequired")),1),s("div",Dn,c(l(t)("mcpService.endpointDescription")),1),s("div",xn,[s("div",Mn,[s("div",Fn,[s("div",Un,[s("div",Nn,[w(l(T),{icon:"carbon:application",width:"16",class:"input-icon"}),te(s("input",{type:"text","onUpdate:modelValue":Y[6]||(Y[6]=X=>x.endpoint=X),placeholder:l(t)("mcpService.endpointPlaceholder"),class:"select-input",onFocus:Y[7]||(Y[7]=X=>M.value=!0),onInput:oe,onKeydown:Vt(ee,["enter"]),onBlur:ge},null,40,Ln),[[re,x.endpoint]])]),s("button",{class:"select-arrow-btn",onClick:Q,title:"Expand Options"},[w(l(T),{icon:M.value?"carbon:chevron-up":"carbon:chevron-down",width:"14",class:"chevron"},null,8,["icon"])])]),M.value?(p(),f("div",{key:0,class:ne(["select-dropdown",{"dropdown-top":_.value==="top"}])},[s("div",Bn,[s("span",null,c(l(t)("mcpService.selectEndpoint")),1),s("button",{class:"close-btn",onClick:Y[8]||(Y[8]=X=>M.value=!1)},[w(l(T),{icon:"carbon:close",width:"12"})])]),s("div",On,[(p(!0),f(ae,null,ie(b.value,X=>(p(),f("button",{key:X,class:ne(["select-option",{active:x.endpoint===X}]),onClick:ye=>C(X)},[s("span",jn,c(X),1),x.endpoint===X?(p(),le(l(T),{key:0,icon:"carbon:checkmark",width:"14",class:"check-icon"})):L("",!0)],10,qn))),128))]),s("div",Vn,[s("div",Hn,[te(s("input",{type:"text","onUpdate:modelValue":Y[9]||(Y[9]=X=>y.value=X),placeholder:l(t)("mcpService.manualInput"),class:"manual-input",onKeydown:Vt(B,["enter"]),onBlur:J},null,40,Gn),[[re,y.value]]),s("button",{class:"add-manual-btn",onClick:B},[w(l(T),{icon:"carbon:add",width:"14"})])])])],2)):L("",!0),M.value?(p(),f("div",{key:1,class:"backdrop",onClick:Y[10]||(Y[10]=X=>M.value=!1)})):L("",!0)])])])]),A.value?(p(),f("div",Wn,[s("label",null,c(l(t)("mcpService.mcpStreamableUrl")),1),s("div",zn,[s("div",{class:"url-display",onDblclick:W,title:l(t)("mcpService.copyUrl")+": "+A.value},[s("span",Kn,c(A.value||l(t)("mcpService.mcpStreamableUrlPlaceholder")),1),w(l(T),{icon:"carbon:copy",width:"16",class:"copy-icon"})],40,Jn)])])):L("",!0)])):L("",!0)])])])])]),_:1},8,["modelValue","title"]),h.value?(p(),f("div",{key:0,class:"error-toast",onClick:Y[12]||(Y[12]=X=>h.value="")},[w(l(T),{icon:"carbon:error"}),se(" "+c(h.value),1)])):L("",!0),g.value?(p(),f("div",{key:1,class:"success-toast",onClick:Y[13]||(Y[13]=X=>g.value="")},[w(l(T),{icon:"carbon:checkmark"}),se(" "+c(g.value),1)])):L("",!0)],64))}}),eo=he(Zn,[["__scopeId","data-v-bd88743f"]]);function us(o,e){const n=U(!1),t=st({title:"",steps:[],directResponse:!1,planTemplateId:o.currentPlanTemplateId||"",planType:"dynamic_agent"}),a=v=>{try{if(!v){Object.assign(t,{title:"",steps:[],directResponse:!1,planTemplateId:o.currentPlanTemplateId||"",planType:"dynamic_agent"});return}const $=JSON.parse(v);t.title=$.title||"",t.directResponse=!1,t.planTemplateId=$.planTemplateId||o.currentPlanTemplateId||"",t.planType=$.planType||"dynamic_agent",t.steps=($.steps||[]).map(P=>({stepRequirement:P.stepRequirement||"",agentName:P.agentName||"",modelName:P.modelName||null,selectedToolKeys:P.selectedToolKeys||[],terminateColumns:P.terminateColumns||""}))}catch($){console.warn("Failed to parse JSON content:",$)}},r=()=>{try{const v={title:t.title,steps:t.steps.map($=>({stepRequirement:$.stepRequirement,agentName:$.agentName,modelName:$.modelName||"",selectedToolKeys:$.selectedToolKeys,terminateColumns:$.terminateColumns})),directResponse:t.directResponse,planTemplateId:t.planTemplateId,planType:t.planType};return JSON.stringify(v,null,2)}catch(v){return console.error("Failed to convert visual data to JSON:",v),"{}"}},i=ue(()=>r());return de(()=>o.jsonContent,v=>{a(v)},{immediate:!0}),de(t,()=>{const v=r();e("update:jsonContent",v)},{deep:!0}),de(()=>o.currentPlanTemplateId,v=>{v&&(t.planTemplateId=v)}),{showJsonPreview:n,parsedData:t,formattedJsonOutput:i,addStep:()=>{const v={stepRequirement:"",agentName:"ConfigurableDynaAgent",modelName:null,selectedToolKeys:[],terminateColumns:"",agentType:"",stepContent:""};t.steps.push(v)},removeStep:v=>{v>=0&&v<t.steps.length&&t.steps.splice(v,1)},moveStepUp:v=>{if(v>0){const $=t.steps.splice(v,1)[0];t.steps.splice(v-1,0,$)}},moveStepDown:v=>{if(v<t.steps.length-1){const $=t.steps.splice(v,1)[0];t.steps.splice(v+1,0,$)}},toggleJsonPreview:()=>{n.value=!n.value},closeJsonPreview:()=>{n.value=!1},handleRollback:()=>{e("rollback")},handleRestore:()=>{e("restore")},handleSave:()=>{e("save")}}}const to={class:"config-section"},so={class:"section-header"},no={class:"visual-editor"},oo={class:"plan-basic-info"},ao={class:"form-row"},lo={class:"form-label"},ro=["placeholder"],io={class:"steps-section"},co={class:"steps-header"},uo={class:"form-label"},po={class:"steps-container"},ho={class:"step-header"},mo={class:"step-number"},fo={class:"step-actions"},vo=["onClick","disabled","title"],go=["onClick","disabled","title"],bo=["onClick","title"],yo={class:"step-content"},_o={class:"form-row"},$o={class:"form-label"},wo={class:"agent-selector"},So=["onUpdate:modelValue"],ko={value:""},To=["title"],Po={class:"form-row"},Eo={class:"form-label"},Co=["onUpdate:modelValue","placeholder"],Ro={class:"form-row"},Io={class:"form-label"},Ao=["onUpdate:modelValue","placeholder"],Do={key:0,class:"empty-steps"},xo={class:"plan-id-section"},Mo={class:"form-row"},Fo={class:"form-label"},Uo={key:0,class:"json-preview"},No={class:"preview-header"},Lo={class:"form-label"},Bo={class:"json-code"},Oo={class:"editor-footer"},qo={class:"section-actions"},jo=["disabled","title"],Vo=["disabled","title"],Ho=["disabled"],Go=pe({__name:"JsonEditor",props:{jsonContent:{},canRollback:{type:Boolean},canRestore:{type:Boolean},isGenerating:{type:Boolean},isExecuting:{type:Boolean},hiddenFields:{default:()=>["currentPlanId","userRequest","rootPlanId"]},currentPlanTemplateId:{}},emits:["rollback","restore","save","update:jsonContent"],setup(o,{emit:e}){const n=o,t=e,{showJsonPreview:a,parsedData:r,formattedJsonOutput:i,addStep:h,removeStep:g,moveStepUp:u,moveStepDown:d,handleRollback:b,handleRestore:A,handleSave:M,toggleJsonPreview:_,closeJsonPreview:y}=us(n,t),v=$=>{const P=$.target;if(!P)return;P.style.height="auto";const S=20,I=Math.ceil(P.scrollHeight/S),m=4,q=12,x=Math.max(m,Math.min(q,I)),z=x*S;P.style.height=`${z}px`,P.rows=x,I>q?P.style.overflowY="auto":P.style.overflowY="hidden"};return($,P)=>(p(),f("div",to,[s("div",so,[w(l(T),{icon:"carbon:code",width:"16"}),s("span",null,c($.$t("sidebar.jsonTemplate")),1)]),s("div",no,[s("div",oo,[s("div",ao,[s("label",lo,c($.$t("sidebar.title")),1),te(s("input",{"onUpdate:modelValue":P[0]||(P[0]=S=>l(r).title=S),type:"text",class:"form-input",placeholder:$.$t("sidebar.titlePlaceholder")},null,8,ro),[[re,l(r).title]])])]),s("div",io,[s("div",co,[s("label",uo,c($.$t("sidebar.tasks")),1)]),s("div",po,[(p(!0),f(ae,null,ie(l(r).steps,(S,I)=>(p(),f("div",{key:I,class:"step-item"},[s("div",ho,[s("span",mo,c($.$t("sidebar.subtask"))+" "+c(I+1),1),s("div",fo,[s("button",{onClick:m=>l(u)(I),disabled:I===0,class:"btn btn-xs",title:$.$t("sidebar.moveUp")},[w(l(T),{icon:"carbon:chevron-up",width:"12"})],8,vo),s("button",{onClick:m=>l(d)(I),disabled:I===l(r).steps.length-1,class:"btn btn-xs",title:$.$t("sidebar.moveDown")},[w(l(T),{icon:"carbon:chevron-down",width:"12"})],8,go),s("button",{onClick:m=>l(g)(I),class:"btn btn-xs btn-danger",title:$.$t("sidebar.removeStep")},[w(l(T),{icon:"carbon:trash-can",width:"12"})],8,bo)])]),s("div",yo,[s("div",_o,[s("label",$o,c($.$t("sidebar.agent")),1),s("div",wo,[te(s("select",{"onUpdate:modelValue":m=>S.agentName=m,class:"form-select agent-select"},[s("option",ko,c($.$t("sidebar.selectAgent")),1),P[10]||(P[10]=qs('<option value="DEFAULT_AGENT" data-v-f7391c35>DEFAULT_AGENT</option><option value="BROWSER_AGENT" data-v-f7391c35>BROWSER_AGENT</option><option value="TEXT_FILE_AGENT" data-v-f7391c35>TEXT_FILE_AGENT</option><option value="JSX_GENERATOR_AGENT" data-v-f7391c35>JSX_GENERATOR_AGENT</option><option value="FILE_MANAGER_AGENT" data-v-f7391c35>FILE_MANAGER_AGENT</option>',5))],8,So),[[nt,S.agentName]]),s("button",{onClick:P[1]||(P[1]=(...m)=>l(h)&&l(h)(...m)),class:"btn btn-sm btn-add-step",title:$.$t("sidebar.addStep")},[w(l(T),{icon:"carbon:add",width:"14"})],8,To)])]),s("div",Po,[s("label",Eo,c($.$t("sidebar.stepRequirement")),1),te(s("textarea",{"onUpdate:modelValue":m=>S.stepContent=m,class:"form-textarea auto-resize",placeholder:$.$t("sidebar.stepRequirementPlaceholder"),rows:"4",onInput:P[2]||(P[2]=m=>v(m))},null,40,Co),[[re,S.stepContent]])]),s("div",Ro,[s("label",Io,c($.$t("sidebar.terminateColumns")),1),te(s("input",{"onUpdate:modelValue":m=>S.terminateColumns=m,type:"text",class:"form-input",placeholder:$.$t("sidebar.terminateColumnsPlaceholder")},null,8,Ao),[[re,S.terminateColumns]])])])]))),128)),l(r).steps.length===0?(p(),f("div",Do,[w(l(T),{icon:"carbon:add-alt",width:"32",class:"empty-icon"}),s("p",null,c($.$t("sidebar.noSteps")),1),s("button",{onClick:P[3]||(P[3]=(...S)=>l(h)&&l(h)(...S)),class:"btn btn-primary"},[w(l(T),{icon:"carbon:add",width:"14"}),se(" "+c($.$t("sidebar.addFirstStep")),1)])])):L("",!0)])]),s("div",xo,[s("div",Mo,[s("label",Fo,c($.$t("sidebar.planId")),1),te(s("input",{"onUpdate:modelValue":P[4]||(P[4]=S=>l(r).planTemplateId=S),type:"text",class:"form-input",placeholder:"planTemplate-1756109892045"},null,512),[[re,l(r).planTemplateId]])])]),l(a)?(p(),f("div",Uo,[s("div",No,[s("label",Lo,c($.$t("sidebar.jsonPreview")),1),s("button",{onClick:P[5]||(P[5]=(...S)=>l(y)&&l(y)(...S)),class:"btn btn-xs"},[w(l(T),{icon:"carbon:close",width:"12"})])]),s("pre",Bo,c(l(i)),1)])):L("",!0),s("div",Oo,[s("button",{onClick:P[6]||(P[6]=(...S)=>l(_)&&l(_)(...S)),class:"btn btn-sm btn-secondary"},[w(l(T),{icon:"carbon:code",width:"14"}),se(" "+c(l(a)?$.$t("sidebar.hideJson"):$.$t("sidebar.showJson")),1)]),s("div",qo,[s("button",{class:"btn btn-sm",onClick:P[7]||(P[7]=(...S)=>l(b)&&l(b)(...S)),disabled:!($.canRollback??!1),title:$.$t("sidebar.rollback")},[w(l(T),{icon:"carbon:undo",width:"14"})],8,jo),s("button",{class:"btn btn-sm",onClick:P[8]||(P[8]=(...S)=>l(A)&&l(A)(...S)),disabled:!($.canRestore??!1),title:$.$t("sidebar.restore")},[w(l(T),{icon:"carbon:redo",width:"14"})],8,Vo),s("button",{class:"btn btn-primary",onClick:P[9]||(P[9]=(...S)=>l(M)&&l(M)(...S)),disabled:$.isGenerating||$.isExecuting},[w(l(T),{icon:"carbon:save",width:"14"}),P[11]||(P[11]=se(" Save "))],8,Ho)])])])]))}}),Wo=he(Go,[["__scopeId","data-v-f7391c35"]]);function ps(o,e){return function(){return o.apply(e,arguments)}}const{toString:zo}=Object.prototype,{getPrototypeOf:Ut}=Object,{iterator:ft,toStringTag:hs}=Symbol,vt=(o=>e=>{const n=zo.call(e);return o[n]||(o[n]=n.slice(8,-1).toLowerCase())})(Object.create(null)),Re=o=>(o=o.toLowerCase(),e=>vt(e)===o),gt=o=>e=>typeof e===o,{isArray:ze}=Array,tt=gt("undefined");function Jo(o){return o!==null&&!tt(o)&&o.constructor!==null&&!tt(o.constructor)&&_e(o.constructor.isBuffer)&&o.constructor.isBuffer(o)}const ms=Re("ArrayBuffer");function Ko(o){let e;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?e=ArrayBuffer.isView(o):e=o&&o.buffer&&ms(o.buffer),e}const Xo=gt("string"),_e=gt("function"),fs=gt("number"),bt=o=>o!==null&&typeof o=="object",Yo=o=>o===!0||o===!1,ct=o=>{if(vt(o)!=="object")return!1;const e=Ut(o);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(hs in o)&&!(ft in o)},Qo=Re("Date"),Zo=Re("File"),ea=Re("Blob"),ta=Re("FileList"),sa=o=>bt(o)&&_e(o.pipe),na=o=>{let e;return o&&(typeof FormData=="function"&&o instanceof FormData||_e(o.append)&&((e=vt(o))==="formdata"||e==="object"&&_e(o.toString)&&o.toString()==="[object FormData]"))},oa=Re("URLSearchParams"),[aa,la,ra,ia]=["ReadableStream","Request","Response","Headers"].map(Re),ca=o=>o.trim?o.trim():o.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function ot(o,e,{allOwnKeys:n=!1}={}){if(o===null||typeof o>"u")return;let t,a;if(typeof o!="object"&&(o=[o]),ze(o))for(t=0,a=o.length;t<a;t++)e.call(null,o[t],t,o);else{const r=n?Object.getOwnPropertyNames(o):Object.keys(o),i=r.length;let h;for(t=0;t<i;t++)h=r[t],e.call(null,o[h],h,o)}}function vs(o,e){e=e.toLowerCase();const n=Object.keys(o);let t=n.length,a;for(;t-- >0;)if(a=n[t],e===a.toLowerCase())return a;return null}const Oe=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,gs=o=>!tt(o)&&o!==Oe;function Et(){const{caseless:o}=gs(this)&&this||{},e={},n=(t,a)=>{const r=o&&vs(e,a)||a;ct(e[r])&&ct(t)?e[r]=Et(e[r],t):ct(t)?e[r]=Et({},t):ze(t)?e[r]=t.slice():e[r]=t};for(let t=0,a=arguments.length;t<a;t++)arguments[t]&&ot(arguments[t],n);return e}const da=(o,e,n,{allOwnKeys:t}={})=>(ot(e,(a,r)=>{n&&_e(a)?o[r]=ps(a,n):o[r]=a},{allOwnKeys:t}),o),ua=o=>(o.charCodeAt(0)===65279&&(o=o.slice(1)),o),pa=(o,e,n,t)=>{o.prototype=Object.create(e.prototype,t),o.prototype.constructor=o,Object.defineProperty(o,"super",{value:e.prototype}),n&&Object.assign(o.prototype,n)},ha=(o,e,n,t)=>{let a,r,i;const h={};if(e=e||{},o==null)return e;do{for(a=Object.getOwnPropertyNames(o),r=a.length;r-- >0;)i=a[r],(!t||t(i,o,e))&&!h[i]&&(e[i]=o[i],h[i]=!0);o=n!==!1&&Ut(o)}while(o&&(!n||n(o,e))&&o!==Object.prototype);return e},ma=(o,e,n)=>{o=String(o),(n===void 0||n>o.length)&&(n=o.length),n-=e.length;const t=o.indexOf(e,n);return t!==-1&&t===n},fa=o=>{if(!o)return null;if(ze(o))return o;let e=o.length;if(!fs(e))return null;const n=new Array(e);for(;e-- >0;)n[e]=o[e];return n},va=(o=>e=>o&&e instanceof o)(typeof Uint8Array<"u"&&Ut(Uint8Array)),ga=(o,e)=>{const t=(o&&o[ft]).call(o);let a;for(;(a=t.next())&&!a.done;){const r=a.value;e.call(o,r[0],r[1])}},ba=(o,e)=>{let n;const t=[];for(;(n=o.exec(e))!==null;)t.push(n);return t},ya=Re("HTMLFormElement"),_a=o=>o.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(n,t,a){return t.toUpperCase()+a}),Gt=(({hasOwnProperty:o})=>(e,n)=>o.call(e,n))(Object.prototype),$a=Re("RegExp"),bs=(o,e)=>{const n=Object.getOwnPropertyDescriptors(o),t={};ot(n,(a,r)=>{let i;(i=e(a,r,o))!==!1&&(t[r]=i||a)}),Object.defineProperties(o,t)},wa=o=>{bs(o,(e,n)=>{if(_e(o)&&["arguments","caller","callee"].indexOf(n)!==-1)return!1;const t=o[n];if(_e(t)){if(e.enumerable=!1,"writable"in e){e.writable=!1;return}e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+n+"'")})}})},Sa=(o,e)=>{const n={},t=a=>{a.forEach(r=>{n[r]=!0})};return ze(o)?t(o):t(String(o).split(e)),n},ka=()=>{},Ta=(o,e)=>o!=null&&Number.isFinite(o=+o)?o:e;function Pa(o){return!!(o&&_e(o.append)&&o[hs]==="FormData"&&o[ft])}const Ea=o=>{const e=new Array(10),n=(t,a)=>{if(bt(t)){if(e.indexOf(t)>=0)return;if(!("toJSON"in t)){e[a]=t;const r=ze(t)?[]:{};return ot(t,(i,h)=>{const g=n(i,a+1);!tt(g)&&(r[h]=g)}),e[a]=void 0,r}}return t};return n(o,0)},Ca=Re("AsyncFunction"),Ra=o=>o&&(bt(o)||_e(o))&&_e(o.then)&&_e(o.catch),ys=((o,e)=>o?setImmediate:e?((n,t)=>(Oe.addEventListener("message",({source:a,data:r})=>{a===Oe&&r===n&&t.length&&t.shift()()},!1),a=>{t.push(a),Oe.postMessage(n,"*")}))(`axios@${Math.random()}`,[]):n=>setTimeout(n))(typeof setImmediate=="function",_e(Oe.postMessage)),Ia=typeof queueMicrotask<"u"?queueMicrotask.bind(Oe):typeof process<"u"&&process.nextTick||ys,Aa=o=>o!=null&&_e(o[ft]),D={isArray:ze,isArrayBuffer:ms,isBuffer:Jo,isFormData:na,isArrayBufferView:Ko,isString:Xo,isNumber:fs,isBoolean:Yo,isObject:bt,isPlainObject:ct,isReadableStream:aa,isRequest:la,isResponse:ra,isHeaders:ia,isUndefined:tt,isDate:Qo,isFile:Zo,isBlob:ea,isRegExp:$a,isFunction:_e,isStream:sa,isURLSearchParams:oa,isTypedArray:va,isFileList:ta,forEach:ot,merge:Et,extend:da,trim:ca,stripBOM:ua,inherits:pa,toFlatObject:ha,kindOf:vt,kindOfTest:Re,endsWith:ma,toArray:fa,forEachEntry:ga,matchAll:ba,isHTMLForm:ya,hasOwnProperty:Gt,hasOwnProp:Gt,reduceDescriptors:bs,freezeMethods:wa,toObjectSet:Sa,toCamelCase:_a,noop:ka,toFiniteNumber:Ta,findKey:vs,global:Oe,isContextDefined:gs,isSpecCompliantForm:Pa,toJSONObject:Ea,isAsyncFn:Ca,isThenable:Ra,setImmediate:ys,asap:Ia,isIterable:Aa};function Z(o,e,n,t,a){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=o,this.name="AxiosError",e&&(this.code=e),n&&(this.config=n),t&&(this.request=t),a&&(this.response=a,this.status=a.status?a.status:null)}D.inherits(Z,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:D.toJSONObject(this.config),code:this.code,status:this.status}}});const _s=Z.prototype,$s={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(o=>{$s[o]={value:o}});Object.defineProperties(Z,$s);Object.defineProperty(_s,"isAxiosError",{value:!0});Z.from=(o,e,n,t,a,r)=>{const i=Object.create(_s);return D.toFlatObject(o,i,function(g){return g!==Error.prototype},h=>h!=="isAxiosError"),Z.call(i,o.message,e,n,t,a),i.cause=o,i.name=o.name,r&&Object.assign(i,r),i};const Da=null;function Ct(o){return D.isPlainObject(o)||D.isArray(o)}function ws(o){return D.endsWith(o,"[]")?o.slice(0,-2):o}function Wt(o,e,n){return o?o.concat(e).map(function(a,r){return a=ws(a),!n&&r?"["+a+"]":a}).join(n?".":""):e}function xa(o){return D.isArray(o)&&!o.some(Ct)}const Ma=D.toFlatObject(D,{},null,function(e){return/^is[A-Z]/.test(e)});function yt(o,e,n){if(!D.isObject(o))throw new TypeError("target must be an object");e=e||new FormData,n=D.toFlatObject(n,{metaTokens:!0,dots:!1,indexes:!1},!1,function(y,v){return!D.isUndefined(v[y])});const t=n.metaTokens,a=n.visitor||d,r=n.dots,i=n.indexes,g=(n.Blob||typeof Blob<"u"&&Blob)&&D.isSpecCompliantForm(e);if(!D.isFunction(a))throw new TypeError("visitor must be a function");function u(_){if(_===null)return"";if(D.isDate(_))return _.toISOString();if(!g&&D.isBlob(_))throw new Z("Blob is not supported. Use a Buffer instead.");return D.isArrayBuffer(_)||D.isTypedArray(_)?g&&typeof Blob=="function"?new Blob([_]):Buffer.from(_):_}function d(_,y,v){let $=_;if(_&&!v&&typeof _=="object"){if(D.endsWith(y,"{}"))y=t?y:y.slice(0,-2),_=JSON.stringify(_);else if(D.isArray(_)&&xa(_)||(D.isFileList(_)||D.endsWith(y,"[]"))&&($=D.toArray(_)))return y=ws(y),$.forEach(function(S,I){!(D.isUndefined(S)||S===null)&&e.append(i===!0?Wt([y],I,r):i===null?y:y+"[]",u(S))}),!1}return Ct(_)?!0:(e.append(Wt(v,y,r),u(_)),!1)}const b=[],A=Object.assign(Ma,{defaultVisitor:d,convertValue:u,isVisitable:Ct});function M(_,y){if(!D.isUndefined(_)){if(b.indexOf(_)!==-1)throw Error("Circular reference detected in "+y.join("."));b.push(_),D.forEach(_,function($,P){(!(D.isUndefined($)||$===null)&&a.call(e,$,D.isString(P)?P.trim():P,y,A))===!0&&M($,y?y.concat(P):[P])}),b.pop()}}if(!D.isObject(o))throw new TypeError("data must be an object");return M(o),e}function zt(o){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(o).replace(/[!'()~]|%20|%00/g,function(t){return e[t]})}function Nt(o,e){this._pairs=[],o&&yt(o,this,e)}const Ss=Nt.prototype;Ss.append=function(e,n){this._pairs.push([e,n])};Ss.toString=function(e){const n=e?function(t){return e.call(this,t,zt)}:zt;return this._pairs.map(function(a){return n(a[0])+"="+n(a[1])},"").join("&")};function Fa(o){return encodeURIComponent(o).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function ks(o,e,n){if(!e)return o;const t=n&&n.encode||Fa;D.isFunction(n)&&(n={serialize:n});const a=n&&n.serialize;let r;if(a?r=a(e,n):r=D.isURLSearchParams(e)?e.toString():new Nt(e,n).toString(t),r){const i=o.indexOf("#");i!==-1&&(o=o.slice(0,i)),o+=(o.indexOf("?")===-1?"?":"&")+r}return o}class Jt{constructor(){this.handlers=[]}use(e,n,t){return this.handlers.push({fulfilled:e,rejected:n,synchronous:t?t.synchronous:!1,runWhen:t?t.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){D.forEach(this.handlers,function(t){t!==null&&e(t)})}}const Ts={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},Ua=typeof URLSearchParams<"u"?URLSearchParams:Nt,Na=typeof FormData<"u"?FormData:null,La=typeof Blob<"u"?Blob:null,Ba={isBrowser:!0,classes:{URLSearchParams:Ua,FormData:Na,Blob:La},protocols:["http","https","file","blob","url","data"]},Lt=typeof window<"u"&&typeof document<"u",Rt=typeof navigator=="object"&&navigator||void 0,Oa=Lt&&(!Rt||["ReactNative","NativeScript","NS"].indexOf(Rt.product)<0),qa=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",ja=Lt&&window.location.href||"http://localhost",Va=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:Lt,hasStandardBrowserEnv:Oa,hasStandardBrowserWebWorkerEnv:qa,navigator:Rt,origin:ja},Symbol.toStringTag,{value:"Module"})),be={...Va,...Ba};function Ha(o,e){return yt(o,new be.classes.URLSearchParams,Object.assign({visitor:function(n,t,a,r){return be.isNode&&D.isBuffer(n)?(this.append(t,n.toString("base64")),!1):r.defaultVisitor.apply(this,arguments)}},e))}function Ga(o){return D.matchAll(/\w+|\[(\w*)]/g,o).map(e=>e[0]==="[]"?"":e[1]||e[0])}function Wa(o){const e={},n=Object.keys(o);let t;const a=n.length;let r;for(t=0;t<a;t++)r=n[t],e[r]=o[r];return e}function Ps(o){function e(n,t,a,r){let i=n[r++];if(i==="__proto__")return!0;const h=Number.isFinite(+i),g=r>=n.length;return i=!i&&D.isArray(a)?a.length:i,g?(D.hasOwnProp(a,i)?a[i]=[a[i],t]:a[i]=t,!h):((!a[i]||!D.isObject(a[i]))&&(a[i]=[]),e(n,t,a[i],r)&&D.isArray(a[i])&&(a[i]=Wa(a[i])),!h)}if(D.isFormData(o)&&D.isFunction(o.entries)){const n={};return D.forEachEntry(o,(t,a)=>{e(Ga(t),a,n,0)}),n}return null}function za(o,e,n){if(D.isString(o))try{return(e||JSON.parse)(o),D.trim(o)}catch(t){if(t.name!=="SyntaxError")throw t}return(n||JSON.stringify)(o)}const at={transitional:Ts,adapter:["xhr","http","fetch"],transformRequest:[function(e,n){const t=n.getContentType()||"",a=t.indexOf("application/json")>-1,r=D.isObject(e);if(r&&D.isHTMLForm(e)&&(e=new FormData(e)),D.isFormData(e))return a?JSON.stringify(Ps(e)):e;if(D.isArrayBuffer(e)||D.isBuffer(e)||D.isStream(e)||D.isFile(e)||D.isBlob(e)||D.isReadableStream(e))return e;if(D.isArrayBufferView(e))return e.buffer;if(D.isURLSearchParams(e))return n.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let h;if(r){if(t.indexOf("application/x-www-form-urlencoded")>-1)return Ha(e,this.formSerializer).toString();if((h=D.isFileList(e))||t.indexOf("multipart/form-data")>-1){const g=this.env&&this.env.FormData;return yt(h?{"files[]":e}:e,g&&new g,this.formSerializer)}}return r||a?(n.setContentType("application/json",!1),za(e)):e}],transformResponse:[function(e){const n=this.transitional||at.transitional,t=n&&n.forcedJSONParsing,a=this.responseType==="json";if(D.isResponse(e)||D.isReadableStream(e))return e;if(e&&D.isString(e)&&(t&&!this.responseType||a)){const i=!(n&&n.silentJSONParsing)&&a;try{return JSON.parse(e)}catch(h){if(i)throw h.name==="SyntaxError"?Z.from(h,Z.ERR_BAD_RESPONSE,this,null,this.response):h}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:be.classes.FormData,Blob:be.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};D.forEach(["delete","get","head","post","put","patch"],o=>{at.headers[o]={}});const Ja=D.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),Ka=o=>{const e={};let n,t,a;return o&&o.split(`
`).forEach(function(i){a=i.indexOf(":"),n=i.substring(0,a).trim().toLowerCase(),t=i.substring(a+1).trim(),!(!n||e[n]&&Ja[n])&&(n==="set-cookie"?e[n]?e[n].push(t):e[n]=[t]:e[n]=e[n]?e[n]+", "+t:t)}),e},Kt=Symbol("internals");function Ye(o){return o&&String(o).trim().toLowerCase()}function dt(o){return o===!1||o==null?o:D.isArray(o)?o.map(dt):String(o)}function Xa(o){const e=Object.create(null),n=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let t;for(;t=n.exec(o);)e[t[1]]=t[2];return e}const Ya=o=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(o.trim());function kt(o,e,n,t,a){if(D.isFunction(t))return t.call(this,e,n);if(a&&(e=n),!!D.isString(e)){if(D.isString(t))return e.indexOf(t)!==-1;if(D.isRegExp(t))return t.test(e)}}function Qa(o){return o.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,n,t)=>n.toUpperCase()+t)}function Za(o,e){const n=D.toCamelCase(" "+e);["get","set","has"].forEach(t=>{Object.defineProperty(o,t+n,{value:function(a,r,i){return this[t].call(this,e,a,r,i)},configurable:!0})})}let $e=class{constructor(e){e&&this.set(e)}set(e,n,t){const a=this;function r(h,g,u){const d=Ye(g);if(!d)throw new Error("header name must be a non-empty string");const b=D.findKey(a,d);(!b||a[b]===void 0||u===!0||u===void 0&&a[b]!==!1)&&(a[b||g]=dt(h))}const i=(h,g)=>D.forEach(h,(u,d)=>r(u,d,g));if(D.isPlainObject(e)||e instanceof this.constructor)i(e,n);else if(D.isString(e)&&(e=e.trim())&&!Ya(e))i(Ka(e),n);else if(D.isObject(e)&&D.isIterable(e)){let h={},g,u;for(const d of e){if(!D.isArray(d))throw TypeError("Object iterator must return a key-value pair");h[u=d[0]]=(g=h[u])?D.isArray(g)?[...g,d[1]]:[g,d[1]]:d[1]}i(h,n)}else e!=null&&r(n,e,t);return this}get(e,n){if(e=Ye(e),e){const t=D.findKey(this,e);if(t){const a=this[t];if(!n)return a;if(n===!0)return Xa(a);if(D.isFunction(n))return n.call(this,a,t);if(D.isRegExp(n))return n.exec(a);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,n){if(e=Ye(e),e){const t=D.findKey(this,e);return!!(t&&this[t]!==void 0&&(!n||kt(this,this[t],t,n)))}return!1}delete(e,n){const t=this;let a=!1;function r(i){if(i=Ye(i),i){const h=D.findKey(t,i);h&&(!n||kt(t,t[h],h,n))&&(delete t[h],a=!0)}}return D.isArray(e)?e.forEach(r):r(e),a}clear(e){const n=Object.keys(this);let t=n.length,a=!1;for(;t--;){const r=n[t];(!e||kt(this,this[r],r,e,!0))&&(delete this[r],a=!0)}return a}normalize(e){const n=this,t={};return D.forEach(this,(a,r)=>{const i=D.findKey(t,r);if(i){n[i]=dt(a),delete n[r];return}const h=e?Qa(r):String(r).trim();h!==r&&delete n[r],n[h]=dt(a),t[h]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const n=Object.create(null);return D.forEach(this,(t,a)=>{t!=null&&t!==!1&&(n[a]=e&&D.isArray(t)?t.join(", "):t)}),n}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,n])=>e+": "+n).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...n){const t=new this(e);return n.forEach(a=>t.set(a)),t}static accessor(e){const t=(this[Kt]=this[Kt]={accessors:{}}).accessors,a=this.prototype;function r(i){const h=Ye(i);t[h]||(Za(a,i),t[h]=!0)}return D.isArray(e)?e.forEach(r):r(e),this}};$e.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);D.reduceDescriptors($e.prototype,({value:o},e)=>{let n=e[0].toUpperCase()+e.slice(1);return{get:()=>o,set(t){this[n]=t}}});D.freezeMethods($e);function Tt(o,e){const n=this||at,t=e||n,a=$e.from(t.headers);let r=t.data;return D.forEach(o,function(h){r=h.call(n,r,a.normalize(),e?e.status:void 0)}),a.normalize(),r}function Es(o){return!!(o&&o.__CANCEL__)}function Je(o,e,n){Z.call(this,o??"canceled",Z.ERR_CANCELED,e,n),this.name="CanceledError"}D.inherits(Je,Z,{__CANCEL__:!0});function Cs(o,e,n){const t=n.config.validateStatus;!n.status||!t||t(n.status)?o(n):e(new Z("Request failed with status code "+n.status,[Z.ERR_BAD_REQUEST,Z.ERR_BAD_RESPONSE][Math.floor(n.status/100)-4],n.config,n.request,n))}function el(o){const e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(o);return e&&e[1]||""}function tl(o,e){o=o||10;const n=new Array(o),t=new Array(o);let a=0,r=0,i;return e=e!==void 0?e:1e3,function(g){const u=Date.now(),d=t[r];i||(i=u),n[a]=g,t[a]=u;let b=r,A=0;for(;b!==a;)A+=n[b++],b=b%o;if(a=(a+1)%o,a===r&&(r=(r+1)%o),u-i<e)return;const M=d&&u-d;return M?Math.round(A*1e3/M):void 0}}function sl(o,e){let n=0,t=1e3/e,a,r;const i=(u,d=Date.now())=>{n=d,a=null,r&&(clearTimeout(r),r=null),o.apply(null,u)};return[(...u)=>{const d=Date.now(),b=d-n;b>=t?i(u,d):(a=u,r||(r=setTimeout(()=>{r=null,i(a)},t-b)))},()=>a&&i(a)]}const ht=(o,e,n=3)=>{let t=0;const a=tl(50,250);return sl(r=>{const i=r.loaded,h=r.lengthComputable?r.total:void 0,g=i-t,u=a(g),d=i<=h;t=i;const b={loaded:i,total:h,progress:h?i/h:void 0,bytes:g,rate:u||void 0,estimated:u&&h&&d?(h-i)/u:void 0,event:r,lengthComputable:h!=null,[e?"download":"upload"]:!0};o(b)},n)},Xt=(o,e)=>{const n=o!=null;return[t=>e[0]({lengthComputable:n,total:o,loaded:t}),e[1]]},Yt=o=>(...e)=>D.asap(()=>o(...e)),nl=be.hasStandardBrowserEnv?((o,e)=>n=>(n=new URL(n,be.origin),o.protocol===n.protocol&&o.host===n.host&&(e||o.port===n.port)))(new URL(be.origin),be.navigator&&/(msie|trident)/i.test(be.navigator.userAgent)):()=>!0,ol=be.hasStandardBrowserEnv?{write(o,e,n,t,a,r){const i=[o+"="+encodeURIComponent(e)];D.isNumber(n)&&i.push("expires="+new Date(n).toGMTString()),D.isString(t)&&i.push("path="+t),D.isString(a)&&i.push("domain="+a),r===!0&&i.push("secure"),document.cookie=i.join("; ")},read(o){const e=document.cookie.match(new RegExp("(^|;\\s*)("+o+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove(o){this.write(o,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function al(o){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(o)}function ll(o,e){return e?o.replace(/\/?\/$/,"")+"/"+e.replace(/^\/+/,""):o}function Rs(o,e,n){let t=!al(e);return o&&(t||n==!1)?ll(o,e):e}const Qt=o=>o instanceof $e?{...o}:o;function Ve(o,e){e=e||{};const n={};function t(u,d,b,A){return D.isPlainObject(u)&&D.isPlainObject(d)?D.merge.call({caseless:A},u,d):D.isPlainObject(d)?D.merge({},d):D.isArray(d)?d.slice():d}function a(u,d,b,A){if(D.isUndefined(d)){if(!D.isUndefined(u))return t(void 0,u,b,A)}else return t(u,d,b,A)}function r(u,d){if(!D.isUndefined(d))return t(void 0,d)}function i(u,d){if(D.isUndefined(d)){if(!D.isUndefined(u))return t(void 0,u)}else return t(void 0,d)}function h(u,d,b){if(b in e)return t(u,d);if(b in o)return t(void 0,u)}const g={url:r,method:r,data:r,baseURL:i,transformRequest:i,transformResponse:i,paramsSerializer:i,timeout:i,timeoutMessage:i,withCredentials:i,withXSRFToken:i,adapter:i,responseType:i,xsrfCookieName:i,xsrfHeaderName:i,onUploadProgress:i,onDownloadProgress:i,decompress:i,maxContentLength:i,maxBodyLength:i,beforeRedirect:i,transport:i,httpAgent:i,httpsAgent:i,cancelToken:i,socketPath:i,responseEncoding:i,validateStatus:h,headers:(u,d,b)=>a(Qt(u),Qt(d),b,!0)};return D.forEach(Object.keys(Object.assign({},o,e)),function(d){const b=g[d]||a,A=b(o[d],e[d],d);D.isUndefined(A)&&b!==h||(n[d]=A)}),n}const Is=o=>{const e=Ve({},o);let{data:n,withXSRFToken:t,xsrfHeaderName:a,xsrfCookieName:r,headers:i,auth:h}=e;e.headers=i=$e.from(i),e.url=ks(Rs(e.baseURL,e.url,e.allowAbsoluteUrls),o.params,o.paramsSerializer),h&&i.set("Authorization","Basic "+btoa((h.username||"")+":"+(h.password?unescape(encodeURIComponent(h.password)):"")));let g;if(D.isFormData(n)){if(be.hasStandardBrowserEnv||be.hasStandardBrowserWebWorkerEnv)i.setContentType(void 0);else if((g=i.getContentType())!==!1){const[u,...d]=g?g.split(";").map(b=>b.trim()).filter(Boolean):[];i.setContentType([u||"multipart/form-data",...d].join("; "))}}if(be.hasStandardBrowserEnv&&(t&&D.isFunction(t)&&(t=t(e)),t||t!==!1&&nl(e.url))){const u=a&&r&&ol.read(r);u&&i.set(a,u)}return e},rl=typeof XMLHttpRequest<"u",il=rl&&function(o){return new Promise(function(n,t){const a=Is(o);let r=a.data;const i=$e.from(a.headers).normalize();let{responseType:h,onUploadProgress:g,onDownloadProgress:u}=a,d,b,A,M,_;function y(){M&&M(),_&&_(),a.cancelToken&&a.cancelToken.unsubscribe(d),a.signal&&a.signal.removeEventListener("abort",d)}let v=new XMLHttpRequest;v.open(a.method.toUpperCase(),a.url,!0),v.timeout=a.timeout;function $(){if(!v)return;const S=$e.from("getAllResponseHeaders"in v&&v.getAllResponseHeaders()),m={data:!h||h==="text"||h==="json"?v.responseText:v.response,status:v.status,statusText:v.statusText,headers:S,config:o,request:v};Cs(function(x){n(x),y()},function(x){t(x),y()},m),v=null}"onloadend"in v?v.onloadend=$:v.onreadystatechange=function(){!v||v.readyState!==4||v.status===0&&!(v.responseURL&&v.responseURL.indexOf("file:")===0)||setTimeout($)},v.onabort=function(){v&&(t(new Z("Request aborted",Z.ECONNABORTED,o,v)),v=null)},v.onerror=function(){t(new Z("Network Error",Z.ERR_NETWORK,o,v)),v=null},v.ontimeout=function(){let I=a.timeout?"timeout of "+a.timeout+"ms exceeded":"timeout exceeded";const m=a.transitional||Ts;a.timeoutErrorMessage&&(I=a.timeoutErrorMessage),t(new Z(I,m.clarifyTimeoutError?Z.ETIMEDOUT:Z.ECONNABORTED,o,v)),v=null},r===void 0&&i.setContentType(null),"setRequestHeader"in v&&D.forEach(i.toJSON(),function(I,m){v.setRequestHeader(m,I)}),D.isUndefined(a.withCredentials)||(v.withCredentials=!!a.withCredentials),h&&h!=="json"&&(v.responseType=a.responseType),u&&([A,_]=ht(u,!0),v.addEventListener("progress",A)),g&&v.upload&&([b,M]=ht(g),v.upload.addEventListener("progress",b),v.upload.addEventListener("loadend",M)),(a.cancelToken||a.signal)&&(d=S=>{v&&(t(!S||S.type?new Je(null,o,v):S),v.abort(),v=null)},a.cancelToken&&a.cancelToken.subscribe(d),a.signal&&(a.signal.aborted?d():a.signal.addEventListener("abort",d)));const P=el(a.url);if(P&&be.protocols.indexOf(P)===-1){t(new Z("Unsupported protocol "+P+":",Z.ERR_BAD_REQUEST,o));return}v.send(r||null)})},cl=(o,e)=>{const{length:n}=o=o?o.filter(Boolean):[];if(e||n){let t=new AbortController,a;const r=function(u){if(!a){a=!0,h();const d=u instanceof Error?u:this.reason;t.abort(d instanceof Z?d:new Je(d instanceof Error?d.message:d))}};let i=e&&setTimeout(()=>{i=null,r(new Z(`timeout ${e} of ms exceeded`,Z.ETIMEDOUT))},e);const h=()=>{o&&(i&&clearTimeout(i),i=null,o.forEach(u=>{u.unsubscribe?u.unsubscribe(r):u.removeEventListener("abort",r)}),o=null)};o.forEach(u=>u.addEventListener("abort",r));const{signal:g}=t;return g.unsubscribe=()=>D.asap(h),g}},dl=function*(o,e){let n=o.byteLength;if(n<e){yield o;return}let t=0,a;for(;t<n;)a=t+e,yield o.slice(t,a),t=a},ul=async function*(o,e){for await(const n of pl(o))yield*dl(n,e)},pl=async function*(o){if(o[Symbol.asyncIterator]){yield*o;return}const e=o.getReader();try{for(;;){const{done:n,value:t}=await e.read();if(n)break;yield t}}finally{await e.cancel()}},Zt=(o,e,n,t)=>{const a=ul(o,e);let r=0,i,h=g=>{i||(i=!0,t&&t(g))};return new ReadableStream({async pull(g){try{const{done:u,value:d}=await a.next();if(u){h(),g.close();return}let b=d.byteLength;if(n){let A=r+=b;n(A)}g.enqueue(new Uint8Array(d))}catch(u){throw h(u),u}},cancel(g){return h(g),a.return()}},{highWaterMark:2})},_t=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",As=_t&&typeof ReadableStream=="function",hl=_t&&(typeof TextEncoder=="function"?(o=>e=>o.encode(e))(new TextEncoder):async o=>new Uint8Array(await new Response(o).arrayBuffer())),Ds=(o,...e)=>{try{return!!o(...e)}catch{return!1}},ml=As&&Ds(()=>{let o=!1;const e=new Request(be.origin,{body:new ReadableStream,method:"POST",get duplex(){return o=!0,"half"}}).headers.has("Content-Type");return o&&!e}),es=64*1024,It=As&&Ds(()=>D.isReadableStream(new Response("").body)),mt={stream:It&&(o=>o.body)};_t&&(o=>{["text","arrayBuffer","blob","formData","stream"].forEach(e=>{!mt[e]&&(mt[e]=D.isFunction(o[e])?n=>n[e]():(n,t)=>{throw new Z(`Response type '${e}' is not supported`,Z.ERR_NOT_SUPPORT,t)})})})(new Response);const fl=async o=>{if(o==null)return 0;if(D.isBlob(o))return o.size;if(D.isSpecCompliantForm(o))return(await new Request(be.origin,{method:"POST",body:o}).arrayBuffer()).byteLength;if(D.isArrayBufferView(o)||D.isArrayBuffer(o))return o.byteLength;if(D.isURLSearchParams(o)&&(o=o+""),D.isString(o))return(await hl(o)).byteLength},vl=async(o,e)=>{const n=D.toFiniteNumber(o.getContentLength());return n??fl(e)},gl=_t&&(async o=>{let{url:e,method:n,data:t,signal:a,cancelToken:r,timeout:i,onDownloadProgress:h,onUploadProgress:g,responseType:u,headers:d,withCredentials:b="same-origin",fetchOptions:A}=Is(o);u=u?(u+"").toLowerCase():"text";let M=cl([a,r&&r.toAbortSignal()],i),_;const y=M&&M.unsubscribe&&(()=>{M.unsubscribe()});let v;try{if(g&&ml&&n!=="get"&&n!=="head"&&(v=await vl(d,t))!==0){let m=new Request(e,{method:"POST",body:t,duplex:"half"}),q;if(D.isFormData(t)&&(q=m.headers.get("content-type"))&&d.setContentType(q),m.body){const[x,z]=Xt(v,ht(Yt(g)));t=Zt(m.body,es,x,z)}}D.isString(b)||(b=b?"include":"omit");const $="credentials"in Request.prototype;_=new Request(e,{...A,signal:M,method:n.toUpperCase(),headers:d.normalize().toJSON(),body:t,duplex:"half",credentials:$?b:void 0});let P=await fetch(_);const S=It&&(u==="stream"||u==="response");if(It&&(h||S&&y)){const m={};["status","statusText","headers"].forEach(R=>{m[R]=P[R]});const q=D.toFiniteNumber(P.headers.get("content-length")),[x,z]=h&&Xt(q,ht(Yt(h),!0))||[];P=new Response(Zt(P.body,es,x,()=>{z&&z(),y&&y()}),m)}u=u||"text";let I=await mt[D.findKey(mt,u)||"text"](P,o);return!S&&y&&y(),await new Promise((m,q)=>{Cs(m,q,{data:I,headers:$e.from(P.headers),status:P.status,statusText:P.statusText,config:o,request:_})})}catch($){throw y&&y(),$&&$.name==="TypeError"&&/Load failed|fetch/i.test($.message)?Object.assign(new Z("Network Error",Z.ERR_NETWORK,o,_),{cause:$.cause||$}):Z.from($,$&&$.code,o,_)}}),At={http:Da,xhr:il,fetch:gl};D.forEach(At,(o,e)=>{if(o){try{Object.defineProperty(o,"name",{value:e})}catch{}Object.defineProperty(o,"adapterName",{value:e})}});const ts=o=>`- ${o}`,bl=o=>D.isFunction(o)||o===null||o===!1,xs={getAdapter:o=>{o=D.isArray(o)?o:[o];const{length:e}=o;let n,t;const a={};for(let r=0;r<e;r++){n=o[r];let i;if(t=n,!bl(n)&&(t=At[(i=String(n)).toLowerCase()],t===void 0))throw new Z(`Unknown adapter '${i}'`);if(t)break;a[i||"#"+r]=t}if(!t){const r=Object.entries(a).map(([h,g])=>`adapter ${h} `+(g===!1?"is not supported by the environment":"is not available in the build"));let i=e?r.length>1?`since :
`+r.map(ts).join(`
`):" "+ts(r[0]):"as no adapter specified";throw new Z("There is no suitable adapter to dispatch the request "+i,"ERR_NOT_SUPPORT")}return t},adapters:At};function Pt(o){if(o.cancelToken&&o.cancelToken.throwIfRequested(),o.signal&&o.signal.aborted)throw new Je(null,o)}function ss(o){return Pt(o),o.headers=$e.from(o.headers),o.data=Tt.call(o,o.transformRequest),["post","put","patch"].indexOf(o.method)!==-1&&o.headers.setContentType("application/x-www-form-urlencoded",!1),xs.getAdapter(o.adapter||at.adapter)(o).then(function(t){return Pt(o),t.data=Tt.call(o,o.transformResponse,t),t.headers=$e.from(t.headers),t},function(t){return Es(t)||(Pt(o),t&&t.response&&(t.response.data=Tt.call(o,o.transformResponse,t.response),t.response.headers=$e.from(t.response.headers))),Promise.reject(t)})}const Ms="1.9.0",$t={};["object","boolean","number","function","string","symbol"].forEach((o,e)=>{$t[o]=function(t){return typeof t===o||"a"+(e<1?"n ":" ")+o}});const ns={};$t.transitional=function(e,n,t){function a(r,i){return"[Axios v"+Ms+"] Transitional option '"+r+"'"+i+(t?". "+t:"")}return(r,i,h)=>{if(e===!1)throw new Z(a(i," has been removed"+(n?" in "+n:"")),Z.ERR_DEPRECATED);return n&&!ns[i]&&(ns[i]=!0,console.warn(a(i," has been deprecated since v"+n+" and will be removed in the near future"))),e?e(r,i,h):!0}};$t.spelling=function(e){return(n,t)=>(console.warn(`${t} is likely a misspelling of ${e}`),!0)};function yl(o,e,n){if(typeof o!="object")throw new Z("options must be an object",Z.ERR_BAD_OPTION_VALUE);const t=Object.keys(o);let a=t.length;for(;a-- >0;){const r=t[a],i=e[r];if(i){const h=o[r],g=h===void 0||i(h,r,o);if(g!==!0)throw new Z("option "+r+" must be "+g,Z.ERR_BAD_OPTION_VALUE);continue}if(n!==!0)throw new Z("Unknown option "+r,Z.ERR_BAD_OPTION)}}const ut={assertOptions:yl,validators:$t},Ae=ut.validators;let je=class{constructor(e){this.defaults=e||{},this.interceptors={request:new Jt,response:new Jt}}async request(e,n){try{return await this._request(e,n)}catch(t){if(t instanceof Error){let a={};Error.captureStackTrace?Error.captureStackTrace(a):a=new Error;const r=a.stack?a.stack.replace(/^.+\n/,""):"";try{t.stack?r&&!String(t.stack).endsWith(r.replace(/^.+\n.+\n/,""))&&(t.stack+=`
`+r):t.stack=r}catch{}}throw t}}_request(e,n){typeof e=="string"?(n=n||{},n.url=e):n=e||{},n=Ve(this.defaults,n);const{transitional:t,paramsSerializer:a,headers:r}=n;t!==void 0&&ut.assertOptions(t,{silentJSONParsing:Ae.transitional(Ae.boolean),forcedJSONParsing:Ae.transitional(Ae.boolean),clarifyTimeoutError:Ae.transitional(Ae.boolean)},!1),a!=null&&(D.isFunction(a)?n.paramsSerializer={serialize:a}:ut.assertOptions(a,{encode:Ae.function,serialize:Ae.function},!0)),n.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?n.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:n.allowAbsoluteUrls=!0),ut.assertOptions(n,{baseUrl:Ae.spelling("baseURL"),withXsrfToken:Ae.spelling("withXSRFToken")},!0),n.method=(n.method||this.defaults.method||"get").toLowerCase();let i=r&&D.merge(r.common,r[n.method]);r&&D.forEach(["delete","get","head","post","put","patch","common"],_=>{delete r[_]}),n.headers=$e.concat(i,r);const h=[];let g=!0;this.interceptors.request.forEach(function(y){typeof y.runWhen=="function"&&y.runWhen(n)===!1||(g=g&&y.synchronous,h.unshift(y.fulfilled,y.rejected))});const u=[];this.interceptors.response.forEach(function(y){u.push(y.fulfilled,y.rejected)});let d,b=0,A;if(!g){const _=[ss.bind(this),void 0];for(_.unshift.apply(_,h),_.push.apply(_,u),A=_.length,d=Promise.resolve(n);b<A;)d=d.then(_[b++],_[b++]);return d}A=h.length;let M=n;for(b=0;b<A;){const _=h[b++],y=h[b++];try{M=_(M)}catch(v){y.call(this,v);break}}try{d=ss.call(this,M)}catch(_){return Promise.reject(_)}for(b=0,A=u.length;b<A;)d=d.then(u[b++],u[b++]);return d}getUri(e){e=Ve(this.defaults,e);const n=Rs(e.baseURL,e.url,e.allowAbsoluteUrls);return ks(n,e.params,e.paramsSerializer)}};D.forEach(["delete","get","head","options"],function(e){je.prototype[e]=function(n,t){return this.request(Ve(t||{},{method:e,url:n,data:(t||{}).data}))}});D.forEach(["post","put","patch"],function(e){function n(t){return function(r,i,h){return this.request(Ve(h||{},{method:e,headers:t?{"Content-Type":"multipart/form-data"}:{},url:r,data:i}))}}je.prototype[e]=n(),je.prototype[e+"Form"]=n(!0)});let _l=class Fs{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let n;this.promise=new Promise(function(r){n=r});const t=this;this.promise.then(a=>{if(!t._listeners)return;let r=t._listeners.length;for(;r-- >0;)t._listeners[r](a);t._listeners=null}),this.promise.then=a=>{let r;const i=new Promise(h=>{t.subscribe(h),r=h}).then(a);return i.cancel=function(){t.unsubscribe(r)},i},e(function(r,i,h){t.reason||(t.reason=new Je(r,i,h),n(t.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const n=this._listeners.indexOf(e);n!==-1&&this._listeners.splice(n,1)}toAbortSignal(){const e=new AbortController,n=t=>{e.abort(t)};return this.subscribe(n),e.signal.unsubscribe=()=>this.unsubscribe(n),e.signal}static source(){let e;return{token:new Fs(function(a){e=a}),cancel:e}}};function $l(o){return function(n){return o.apply(null,n)}}function wl(o){return D.isObject(o)&&o.isAxiosError===!0}const Dt={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(Dt).forEach(([o,e])=>{Dt[e]=o});function Us(o){const e=new je(o),n=ps(je.prototype.request,e);return D.extend(n,je.prototype,e,{allOwnKeys:!0}),D.extend(n,e,null,{allOwnKeys:!0}),n.create=function(a){return Us(Ve(o,a))},n}const fe=Us(at);fe.Axios=je;fe.CanceledError=Je;fe.CancelToken=_l;fe.isCancel=Es;fe.VERSION=Ms;fe.toFormData=yt;fe.AxiosError=Z;fe.Cancel=fe.CanceledError;fe.all=function(e){return Promise.all(e)};fe.spread=$l;fe.isAxiosError=wl;fe.mergeConfig=Ve;fe.AxiosHeaders=$e;fe.formToJSON=o=>Ps(D.isHTMLForm(o)?new FormData(o):o);fe.getAdapter=xs.getAdapter;fe.HttpStatusCode=Dt;fe.default=fe;const{Axios:gg,AxiosError:bg,CanceledError:yg,isCancel:_g,CancelToken:$g,VERSION:wg,all:Sg,Cancel:kg,isAxiosError:Tg,spread:Pg,toFormData:Eg,AxiosHeaders:Cg,HttpStatusCode:Rg,formToJSON:Ig,getAdapter:Ag,mergeConfig:Dg}=fe;class Sl{static async getAvailableModels(){try{return(await fe({url:"/api/models/available-models",method:"GET",baseURL:""})).data}catch(e){return console.error("Failed to fetch available models:",e),{options:[],total:0}}}}const kl={class:"config-section"},Tl={class:"section-header"},Pl={key:0,class:"error-section"},El={class:"error-message"},Cl={class:"error-content"},Rl={class:"error-title"},Il={class:"error-description"},Al={key:1,class:"visual-editor"},Dl={class:"plan-basic-info"},xl={class:"form-row"},Ml={class:"form-label"},Fl=["placeholder"],Ul={key:0,class:"field-error-message"},Nl={class:"form-row"},Ll={class:"form-label"},Bl=["value","placeholder"],Ol={class:"steps-section"},ql={class:"steps-header"},jl={class:"form-label"},Vl={class:"steps-actions"},Hl=["title"],Gl={class:"steps-container"},Wl={class:"step-header"},zl={class:"step-number"},Jl={class:"step-actions"},Kl=["onClick","disabled","title"],Xl=["onClick","disabled","title"],Yl=["onClick","title"],Ql={class:"step-content"},Zl={class:"form-row"},er={class:"form-label"},tr=["onUpdate:modelValue","placeholder"],sr={class:"form-row"},nr={class:"form-label"},or=["onUpdate:modelValue","placeholder"],ar={class:"form-row"},lr={class:"form-label"},rr={class:"model-selector"},ir=["onUpdate:modelValue","disabled"],cr={key:0,disabled:"",value:""},dr={key:1,disabled:"",value:""},ur={value:"",disabled:""},pr={value:""},hr=["value","title"],mr=["title"],fr={key:0,class:"error-message"},vr={class:"form-row"},gr={key:0,class:"empty-steps"},br={key:0,class:"json-preview"},yr={class:"preview-header"},_r={class:"form-label"},$r={class:"json-code"},wr={class:"editor-footer"},Sr={class:"section-actions"},kr=["disabled","title"],Tr=["disabled","title"],Pr=["disabled"],Er=pe({__name:"JsonEditorV2",props:{jsonContent:{},canRollback:{type:Boolean},canRestore:{type:Boolean},isGenerating:{type:Boolean},isExecuting:{type:Boolean},hiddenFields:{default:()=>[]},currentPlanTemplateId:{default:""}},emits:["rollback","restore","save","update:jsonContent"],setup(o,{emit:e}){const n=o,t=e,{showJsonPreview:a,parsedData:r,formattedJsonOutput:i,addStep:h,removeStep:g,moveStepUp:u,moveStepDown:d,handleRollback:b,handleRestore:A,handleSave:M,toggleJsonPreview:_,closeJsonPreview:y}=us(n,t),v=U(null),$=U(""),P=U([]),S=U(!1),I=U(""),m=U(!1),q=U(-1),x=async()=>{if(!S.value){S.value=!0,I.value="";try{const E=await Sl.getAvailableModels();E&&E.options?P.value=E.options:P.value=[]}catch(E){console.error("Failed to load models:",E),I.value=E instanceof Error?E.message:"Failed to load models",P.value=[]}finally{S.value=!1}}},z=E=>{q.value=E,m.value=!0,console.log("[JsonEditorV2] Available tools from store:",H.availableTools)},R=E=>{q.value>=0&&q.value<r.steps.length&&(r.steps[q.value].selectedToolKeys=[...E]),m.value=!1,q.value=-1},F=(E,C)=>{E>=0&&E<r.steps.length&&(r.steps[E].selectedToolKeys=[...C])},G=()=>{try{v.value=null,r.title||(r.title=""),r.steps||(r.steps=[]),r.directResponse=!1}catch(E){const C=`Failed to initialize JsonEditorV2: ${E instanceof Error?E.message:"Unknown error"}`;v.value=C,console.error(C,E)}};de(()=>r,E=>{try{!E.title||!E.title.trim()?$.value="Title is required field":$.value="",v.value=null}catch(C){v.value=`Invalid data structure: ${C instanceof Error?C.message:"Unknown error"}`,$.value=""}},{immediate:!0,deep:!0}),we(()=>{G(),x()});const Q=E=>{const C=E.target;if(!C)return;C.style.height="auto";const B=20,J=Math.ceil(C.scrollHeight/B),oe=4,ee=12,ge=Math.max(oe,Math.min(ee,J)),W=ge*B;C.style.height=`${W}px`,C.rows=ge,J>ee?C.style.overflowY="auto":C.style.overflowY="hidden"};return(E,C)=>{var B;return p(),f("div",kl,[s("div",Tl,[w(l(T),{icon:"carbon:code",width:"16"}),s("span",null,c(E.$t("sidebar.dynamicAgentPlan")),1)]),v.value?(p(),f("div",Pl,[s("div",El,[w(l(T),{icon:"carbon:warning",width:"16"}),s("div",Cl,[s("div",Rl,c(E.$t("sidebar.planTypeError")),1),s("div",Il,c(v.value),1)])])])):(p(),f("div",Al,[s("div",Dl,[s("div",xl,[s("label",Ml,c(E.$t("sidebar.title")),1),te(s("input",{"onUpdate:modelValue":C[0]||(C[0]=J=>l(r).title=J),type:"text",class:ne(["form-input",{error:$.value}]),placeholder:E.$t("sidebar.titlePlaceholder")},null,10,Fl),[[re,l(r).title]]),$.value?(p(),f("div",Ul,[w(l(T),{icon:"carbon:warning",width:"12"}),se(" "+c($.value),1)])):L("",!0)]),s("div",Nl,[s("label",Ll,c(E.$t("sidebar.planTemplateId")),1),s("input",{value:E.currentPlanTemplateId,type:"text",class:"form-input readonly-input",readonly:"",placeholder:E.$t("sidebar.planTemplateIdPlaceholder")},null,8,Bl)])]),s("div",Ol,[s("div",ql,[s("label",jl,c(E.$t("sidebar.tasks")),1),s("div",Vl,[s("button",{onClick:C[1]||(C[1]=(...J)=>l(h)&&l(h)(...J)),class:"btn btn-xs",title:E.$t("sidebar.addStep")},[w(l(T),{icon:"carbon:add",width:"12"})],8,Hl)])]),s("div",Gl,[(p(!0),f(ae,null,ie(l(r).steps,(J,oe)=>(p(),f("div",{key:oe,class:"step-item"},[s("div",Wl,[s("span",zl,c(E.$t("sidebar.subtask"))+" "+c(oe+1),1),s("div",Jl,[s("button",{onClick:ee=>l(u)(oe),disabled:oe===0,class:"btn btn-xs",title:E.$t("sidebar.moveUp")},[w(l(T),{icon:"carbon:chevron-up",width:"12"})],8,Kl),s("button",{onClick:ee=>l(d)(oe),disabled:oe===l(r).steps.length-1,class:"btn btn-xs",title:E.$t("sidebar.moveDown")},[w(l(T),{icon:"carbon:chevron-down",width:"12"})],8,Xl),s("button",{onClick:ee=>l(g)(oe),class:"btn btn-xs btn-danger",title:E.$t("sidebar.removeStep")},[w(l(T),{icon:"carbon:trash-can",width:"12"})],8,Yl)])]),s("div",Ql,[s("div",Zl,[s("label",er,c(E.$t("sidebar.stepRequirement")),1),te(s("textarea",{"onUpdate:modelValue":ee=>J.stepRequirement=ee,class:"form-textarea auto-resize",placeholder:E.$t("sidebar.stepRequirementPlaceholder"),rows:"4",onInput:C[2]||(C[2]=ee=>Q(ee))},null,40,tr),[[re,J.stepRequirement]])]),s("div",sr,[s("label",nr,c(E.$t("sidebar.terminateColumns")),1),te(s("textarea",{"onUpdate:modelValue":ee=>J.terminateColumns=ee,class:"form-textarea auto-resize",placeholder:E.$t("sidebar.terminateColumnsPlaceholder"),rows:"4",onInput:C[3]||(C[3]=ee=>Q(ee))},null,40,or),[[re,J.terminateColumns]])]),s("div",ar,[s("label",lr,c(E.$t("sidebar.modelName")),1),s("div",rr,[te(s("select",{"onUpdate:modelValue":ee=>J.modelName=ee,class:"form-select model-select",disabled:S.value},[S.value?(p(),f("option",cr,c(E.$t("sidebar.loading")),1)):I.value?(p(),f("option",dr,c(E.$t("sidebar.modelLoadError")),1)):L("",!0),s("option",ur,c(E.$t("sidebar.modelNameDescription")),1),s("option",pr,c(E.$t("sidebar.noModelSelected")),1),(p(!0),f(ae,null,ie(P.value,ee=>(p(),f("option",{key:ee.value,value:ee.value,title:ee.label},c(ee.label),9,hr))),128))],8,ir),[[nt,J.modelName]]),I.value?(p(),f("button",{key:0,onClick:x,class:"btn btn-sm btn-danger",title:E.$t("sidebar.retryLoadModels")},[w(l(T),{icon:"carbon:warning",width:"14"}),se(" "+c(E.$t("sidebar.retry")),1)],8,mr)):L("",!0)]),I.value?(p(),f("div",fr,[w(l(T),{icon:"carbon:warning",width:"12"}),se(" "+c(I.value),1)])):L("",!0)]),s("div",vr,[w(Ws,{title:E.$t("sidebar.selectedTools"),"selected-tool-ids":J.selectedToolKeys,"available-tools":l(H).availableTools,"add-button-text":E.$t("sidebar.addRemoveTools"),"empty-text":E.$t("sidebar.noTools"),"use-grid-layout":!0,onAddTools:ee=>z(oe),onToolsFiltered:ee=>F(oe,ee)},null,8,["title","selected-tool-ids","available-tools","add-button-text","empty-text","onAddTools","onToolsFiltered"])])])]))),128)),l(r).steps.length===0?(p(),f("div",gr,[w(l(T),{icon:"carbon:add-alt",width:"32",class:"empty-icon"}),s("p",null,c(E.$t("sidebar.noSteps")),1),s("button",{onClick:C[4]||(C[4]=(...J)=>l(h)&&l(h)(...J)),class:"btn btn-primary"},[w(l(T),{icon:"carbon:add",width:"14"}),se(" "+c(E.$t("sidebar.addFirstStep")),1)])])):L("",!0)])]),l(a)?(p(),f("div",br,[s("div",yr,[s("label",_r,c(E.$t("sidebar.jsonPreview")),1),s("button",{onClick:C[5]||(C[5]=(...J)=>l(y)&&l(y)(...J)),class:"btn btn-xs"},[w(l(T),{icon:"carbon:close",width:"12"})])]),s("pre",$r,c(l(i)),1)])):L("",!0),s("div",wr,[s("button",{onClick:C[6]||(C[6]=(...J)=>l(_)&&l(_)(...J)),class:"btn btn-sm btn-secondary"},[w(l(T),{icon:"carbon:code",width:"14"}),se(" "+c(l(a)?E.$t("sidebar.hideJson"):E.$t("sidebar.showJson")),1)]),s("div",Sr,[s("button",{class:"btn btn-sm",onClick:C[7]||(C[7]=(...J)=>l(b)&&l(b)(...J)),disabled:!(E.canRollback??!1),title:E.$t("sidebar.rollback")},[w(l(T),{icon:"carbon:undo",width:"14"})],8,kr),s("button",{class:"btn btn-sm",onClick:C[8]||(C[8]=(...J)=>l(A)&&l(A)(...J)),disabled:!(E.canRestore??!1),title:E.$t("sidebar.restore")},[w(l(T),{icon:"carbon:redo",width:"14"})],8,Tr),s("button",{class:"btn btn-primary",onClick:C[9]||(C[9]=(...J)=>l(M)&&l(M)(...J)),disabled:E.isGenerating||E.isExecuting},[w(l(T),{icon:"carbon:save",width:"14"}),C[11]||(C[11]=se(" Save "))],8,Pr)])])])),w(zs,{modelValue:m.value,"onUpdate:modelValue":C[10]||(C[10]=J=>m.value=J),tools:l(H).availableTools,"selected-tool-ids":q.value>=0?((B=l(r).steps[q.value])==null?void 0:B.selectedToolKeys)||[]:[],onConfirm:R},null,8,["modelValue","tools","selected-tool-ids"])])}}}),Cr=he(Er,[["__scopeId","data-v-78f28b1a"]]),Rr={class:"config-section"},Ir={class:"section-header"},Ar={class:"execution-content"},Dr={class:"params-requirements-group"},xr={class:"params-help-text"},Mr={key:0,class:"parameter-fields"},Fr={class:"parameter-label"},Ur=["onUpdate:modelValue","placeholder","onInput"],Nr={key:0,class:"parameter-error"},Lr={key:1,class:"validation-message"},Br=["disabled"],Or=["disabled"],qr={key:1,class:"call-example-wrapper"},jr={class:"call-example-header"},Vr={class:"call-example-title"},Hr={class:"call-example-description"},Gr={class:"internal-call-wrapper"},Wr={class:"call-info"},zr={class:"call-method"},Jr={class:"call-endpoint"},Kr={key:0,class:"call-endpoint"},Xr={class:"call-description"},Yr={class:"call-example"},Qr={class:"example-code"},Zr={key:2,class:"call-example-wrapper"},ei={class:"call-example-header"},ti={class:"call-example-title"},si={class:"call-example-description"},ni={class:"http-api-urls-wrapper"},oi={class:"tab-container"},ai={class:"tab-header"},li=["onClick"],ri={class:"tab-content"},ii={class:"http-api-url-display"},ci={class:"api-method"},di={class:"api-endpoint"},ui={class:"api-description"},pi={key:0,class:"api-example"},hi={class:"example-code"},mi={key:3,class:"call-example-wrapper"},fi={class:"call-example-header"},vi={class:"call-example-title"},gi={class:"call-example-description"},bi={class:"mcp-call-wrapper"},yi={class:"call-info"},_i={class:"call-method"},$i={class:"call-endpoint"},wi={class:"call-description"},Si={class:"call-example"},ki={class:"example-code"},Ti=pe({__name:"ExecutionController",props:{currentPlanTemplateId:{default:""},isExecuting:{type:Boolean,default:!1},isGenerating:{type:Boolean,default:!1},showPublishButton:{type:Boolean,default:!0},toolInfo:{default:()=>({toolName:"",toolDescription:"",planTemplateId:"",inputSchema:"[]",enableHttpService:!1,enableMcpService:!1,enableInternalToolcall:!1,serviceGroup:""})}},emits:["executePlan","publishMcpService","clearParams","updateExecutionParams"],setup(o,{expose:e,emit:n}){const{t}=Pe(),a=o,r=n,i=U(""),h=U({parameters:[],hasParameters:!1,requirements:""}),g=U({}),u=U(!1),d=U("get-sync"),b=U({}),A=U(!1),M=U([{id:"get-sync",label:"GET + Sync",method:"GET",endpoint:"/api/executor/executeByToolNameSync/{toolName}",description:"Synchronous GET request - returns execution result immediately",example:`GET /api/executor/executeByToolNameSync/my-tool?allParams={"rawParam":"test"}
Response: {
  "status": "completed",
  "result": "Execution result here"
}`},{id:"post-sync",label:"POST + Sync",method:"POST",endpoint:"/api/executor/executeByToolNameSync",description:"Synchronous POST request - returns execution result immediately",example:`POST /api/executor/executeByToolNameSync
Content-Type: application/json

{
  "toolName": "my-tool",
  "replacementParams": {
    "rawParam": "test"
  },
  "uploadedFiles": []
}

Response: {
  "status": "completed",
  "result": "Execution result here"
}`},{id:"post-async",label:"POST + Async",method:"POST",endpoint:"/api/executor/executeByToolNameAsync",description:"Asynchronous POST request - returns task ID, check status separately",example:`POST /api/executor/executeByToolNameAsync
Content-Type: application/json

{
  "toolName": "my-tool",
  "replacementParams": {
    "rawParam": "test"
  },
  "uploadedFiles": []
}

Response: {
  "planId": "plan-123",
  "status": "processing",
  "message": "Task submitted, processing",
  "memoryId": "ABC12345",
  "toolName": "my-tool",
  "planTemplateId": "template-456"
}

# Check execution status and get detailed results:
GET /api/executor/details/{planId}
Response: {
  "currentPlanId": "plan-123",
  "title": "Plan Title",
  "status": "completed",
  "summary": "Execution completed successfully",
  "agentExecutionSequence": [...],
  "userInputWaitState": null
}`}]),_=ue(()=>{var z,R,F;return((z=a.toolInfo)==null?void 0:z.enableInternalToolcall)||((R=a.toolInfo)==null?void 0:R.enableHttpService)||((F=a.toolInfo)==null?void 0:F.enableMcpService)}),y=ue(()=>_.value?t("sidebar.updateServiceStatus"):t("sidebar.publishMcpService")),v=ue(()=>a.isExecuting||a.isGenerating?!1:h.value.hasParameters?h.value.parameters.every(z=>{var R;return(R=g.value[z])==null?void 0:R.trim()}):!0),$=()=>{if(!q()){console.log("[ExecutionController] Parameter validation failed:",b.value);return}const z=h.value.hasParameters&&Object.keys(g.value).length>0?g.value:void 0;r("executePlan",z)},P=()=>{r("publishMcpService")},S=()=>{i.value="",r("clearParams")},I=async()=>{if(!a.currentPlanTemplateId){h.value={parameters:[],hasParameters:!1,requirements:""},g.value={};return}u.value=!0;try{const z=await Ft.getParameterRequirements(a.currentPlanTemplateId);h.value=z;const R={};z.parameters.forEach(F=>{R[F]=g.value[F]||""}),g.value=R,x()}catch(z){console.error("Failed to load parameter requirements:",z),z instanceof Error&&!z.message.includes("404")&&console.warn("Parameter requirements not available yet, will retry later"),h.value={parameters:[],hasParameters:!1,requirements:""}}finally{u.value=!1}},m=(z,R)=>{g.value[z]=R,b.value[z]&&delete b.value[z],x()},q=()=>{if(b.value={},A.value=!1,!h.value.hasParameters)return!0;let z=!1;return h.value.parameters.forEach(R=>{var G;((G=g.value[R])==null?void 0:G.trim())||(b.value[R]=`${R} is required`,z=!0)}),A.value=z,!z},x=()=>{h.value.hasParameters?i.value=JSON.stringify(g.value,null,2):i.value="",r("updateExecutionParams",i.value)};return de(()=>a.currentPlanTemplateId,(z,R)=>{z&&z!==R&&(R&&z.startsWith("planTemplate-")?setTimeout(()=>{I()},1e3):I())}),de(()=>i.value,z=>{r("updateExecutionParams",z)}),we(()=>{I()}),e({executionParams:i,clearExecutionParams:S,loadParameterRequirements:I}),(z,R)=>{var F,G,Q,E,C;return p(),f("div",Rr,[s("div",Ir,[w(l(T),{icon:"carbon:play",width:"16"}),s("span",null,c(l(t)("sidebar.executionController")),1)]),s("div",Ar,[s("div",Dr,[s("label",null,c(l(t)("sidebar.parameterRequirements")),1),s("div",xr,c(l(t)("sidebar.parameterRequirementsHelp")),1),h.value.hasParameters?(p(),f("div",Mr,[(p(!0),f(ae,null,ie(h.value.parameters,B=>(p(),f("div",{key:B,class:"parameter-field"},[s("label",Fr,[se(c(B)+" ",1),R[0]||(R[0]=s("span",{class:"required"},"*",-1))]),te(s("input",{"onUpdate:modelValue":J=>g.value[B]=J,class:ne(["parameter-input",{error:b.value[B]}]),placeholder:l(t)("sidebar.enterValueFor",{param:B}),onInput:J=>m(B,J.target.value),required:""},null,42,Ur),[[re,g.value[B]]]),b.value[B]?(p(),f("div",Nr,c(b.value[B]),1)):L("",!0)]))),128))])):L("",!0),h.value.hasParameters&&!v.value&&!a.isExecuting&&!a.isGenerating?(p(),f("div",Lr,[w(l(T),{icon:"carbon:warning",width:"14"}),se(" "+c(l(t)("sidebar.fillAllRequiredParameters")),1)])):L("",!0)]),s("button",{class:"btn btn-primary execute-btn",onClick:$,disabled:!v.value},[w(l(T),{icon:a.isExecuting?"carbon:circle-dash":"carbon:play",width:"16",class:ne({spinning:a.isExecuting})},null,8,["icon","class"]),se(" "+c(a.isExecuting?l(t)("sidebar.executing"):l(t)("sidebar.executePlan")),1)],8,Br),z.showPublishButton?(p(),f("button",{key:0,class:"btn publish-mcp-btn",onClick:P,disabled:!z.currentPlanTemplateId},[w(l(T),{icon:"carbon:application",width:"16"}),se(" "+c(y.value),1)],8,Or)):L("",!0),(F=z.toolInfo)!=null&&F.enableInternalToolcall?(p(),f("div",qr,[s("div",jr,[s("h4",Vr,c(l(t)("sidebar.internalCall")),1),s("p",Hr,c(l(t)("sidebar.internalCallDescription")),1)]),s("div",Gr,[s("div",Wr,[s("div",zr,c(l(t)("sidebar.internalMethodCall")),1),s("div",Jr,c(l(t)("sidebar.toolName"))+": "+c(((G=z.toolInfo)==null?void 0:G.toolName)||z.currentPlanTemplateId),1),(Q=z.toolInfo)!=null&&Q.serviceGroup?(p(),f("div",Kr,c(l(t)("sidebar.serviceGroup"))+": "+c(z.toolInfo.serviceGroup),1)):L("",!0),s("div",Xr,c(l(t)("sidebar.internalCallUsage")),1),s("div",Yr,[s("strong",null,c(l(t)("sidebar.usage"))+":",1),s("pre",Qr,c(l(t)("sidebar.internalCallExample")),1)])])])])):L("",!0),(E=z.toolInfo)!=null&&E.enableHttpService?(p(),f("div",Zr,[s("div",ei,[s("h4",ti,c(l(t)("sidebar.httpCallExample")),1),s("p",si,c(l(t)("sidebar.httpCallDescription")),1)]),s("div",ni,[s("div",oi,[s("div",ai,[(p(!0),f(ae,null,ie(M.value,B=>(p(),f("button",{key:B.id,class:ne(["tab-button",{active:d.value===B.id}]),onClick:J=>d.value=B.id},c(B.label),11,li))),128))]),s("div",ri,[(p(!0),f(ae,null,ie(M.value,B=>te((p(),f("div",{key:B.id,class:"tab-panel"},[s("div",ii,[s("div",ci,c(B.method),1),s("div",di,c(B.endpoint),1),s("div",ui,c(B.description),1),B.example?(p(),f("div",pi,[s("strong",null,c(l(t)("sidebar.example"))+":",1),s("pre",hi,c(B.example),1)])):L("",!0)])])),[[as,d.value===B.id]])),128))])])])])):L("",!0),(C=z.toolInfo)!=null&&C.enableMcpService?(p(),f("div",mi,[s("div",fi,[s("h4",vi,c(l(t)("sidebar.mcpCall")),1),s("p",gi,c(l(t)("sidebar.mcpCallDescription")),1)]),s("div",bi,[s("div",yi,[s("div",_i,c(l(t)("sidebar.mcpServiceCall")),1),s("div",$i,c(l(t)("sidebar.mcpEndpoint"))+": /mcp/execute",1),s("div",wi,c(l(t)("sidebar.mcpCallUsage")),1),s("div",Si,[s("strong",null,c(l(t)("sidebar.usage"))+":",1),s("pre",ki,c(l(t)("sidebar.mcpCallExample")),1)])])])])):L("",!0)])])}}}),Pi=he(Ti,[["__scopeId","data-v-cf1e6ebf"]]),Ei={class:"config-section"},Ci={class:"section-header"},Ri={class:"generator-content"},Ii={class:"plan-type-selection"},Ai={class:"form-label"},Di={value:"simple"},xi={value:"dynamic_agent"},Mi={key:0,class:"dynamic-agent-instruction"},Fi=["value"],Ui=["placeholder"],Ni={class:"generator-actions"},Li=["disabled"],Bi=["disabled"],Oi=pe({__name:"PlanGenerator",props:{generatorPrompt:{},jsonContent:{},isGenerating:{type:Boolean},planType:{default:"dynamic_agent"}},emits:["generatePlan","updatePlan","updateGeneratorPrompt","updatePlanType"],setup(o,{expose:e,emit:n}){const{t}=Pe(),a=o,r=n,i=U(a.generatorPrompt),h=U(a.planType);de(()=>a.generatorPrompt,d=>{i.value=d}),de(i,d=>{r("updateGeneratorPrompt",d)}),de(()=>a.planType,d=>{h.value=d}),de(h,d=>{r("updatePlanType",d)});const g=()=>{r("generatePlan")},u=()=>{r("updatePlan")};return e({generatorPrompt:i}),(d,b)=>(p(),f("div",Ei,[s("div",Ci,[w(l(T),{icon:"carbon:generate",width:"16"}),s("span",null,c(l(t)("sidebar.planGenerator")),1)]),s("div",Ri,[s("div",Ii,[s("label",Ai,c(l(t)("sidebar.planType")),1),te(s("select",{"onUpdate:modelValue":b[0]||(b[0]=A=>h.value=A),class:"form-select"},[s("option",Di,c(l(t)("sidebar.simplePlan")),1),s("option",xi,c(l(t)("sidebar.dynamicAgentPlan")),1)],512),[[nt,h.value]])]),h.value==="dynamic_agent"?(p(),f("div",Mi,[s("textarea",{readonly:"",class:"instruction-textarea",rows:"2",value:l(t)("sidebar.dynamicAgentInstruction")},null,8,Fi)])):(p(),f(ae,{key:1},[te(s("textarea",{"onUpdate:modelValue":b[1]||(b[1]=A=>i.value=A),class:"prompt-input",placeholder:l(t)("sidebar.generatorPlaceholder"),rows:"3"},null,8,Ui),[[re,i.value]]),s("div",Ni,[s("button",{class:"btn btn-primary btn-sm",onClick:g,disabled:d.isGenerating||!i.value.trim()},[w(l(T),{icon:d.isGenerating?"carbon:circle-dash":"carbon:generate",width:"14",class:ne({spinning:d.isGenerating})},null,8,["icon","class"]),se(" "+c(d.isGenerating?l(t)("sidebar.generating"):l(t)("sidebar.generatePlan")),1)],8,Li),s("button",{class:"btn btn-secondary btn-sm",onClick:u,disabled:d.isGenerating||!i.value.trim()||!d.jsonContent.trim()},[w(l(T),{icon:"carbon:edit",width:"14"}),se(" "+c(l(t)("sidebar.updatePlan")),1)],8,Bi)])],64))])]))}}),qi=he(Oi,[["__scopeId","data-v-ef6f6cb4"]]),ji={class:"sidebar-content"},Vi={class:"sidebar-content-header"},Hi={class:"sidebar-content-title"},Gi={class:"tab-switcher"},Wi=["disabled"],zi={key:0,class:"tab-content"},Ji={class:"new-task-section"},Ki={class:"sidebar-content-list"},Xi={key:0,class:"loading-state"},Yi={key:1,class:"error-state"},Qi={key:2,class:"empty-state"},Zi=["onClick"],ec={class:"task-icon"},tc={class:"task-details"},sc={class:"task-title"},nc={class:"task-preview"},oc={class:"task-time"},ac={class:"task-actions"},lc=["title","onClick"],rc={key:1,class:"tab-content config-tab"},ic={key:0,class:"config-container"},cc={class:"template-info-header"},dc={class:"template-info"},uc={class:"template-id"},pc=["title"],hc=pe({__name:"Sidebar",emits:["planExecutionRequested"],setup(o,{expose:e,emit:n}){const{t}=Pe(),a=ds(),r=U(80),i=U(!1),h=U(0),g=U(0),u=U(null),d=U({toolName:"",toolDescription:"",planTemplateId:"",inputSchema:"[]",enableHttpService:!1,enableMcpService:!1,enableInternalToolcall:!1,serviceGroup:""}),b=U(null),A=U({enabled:!0,success:!0}),M=ue(()=>A.value.enabled),_=async()=>{try{const k=await Me.getCoordinatorToolConfig();A.value=k}catch(k){console.error("Failed to load CoordinatorTool configuration:",k),A.value={enabled:!0,success:!1,message:k instanceof Error?k.message:"Unknown error"}}},y=n,v=async()=>{try{const k=await H.saveTemplate();k!=null&&k.duplicate?a.success(t("sidebar.saveCompleted",{message:k.message,versionCount:k.versionCount})):k!=null&&k.saved?(a.success(t("sidebar.saveSuccess",{message:k.message,versionCount:k.versionCount})),$()):k!=null&&k.message&&a.success(t("sidebar.saveStatus",{message:k.message}))}catch(k){console.error("Failed to save plan modifications:",k),a.error(k.message||t("sidebar.saveFailed"))}},$=async()=>{await new Promise(k=>setTimeout(k,500)),u.value&&u.value.loadParameterRequirements(),b.value&&b.value.loadParameterRequirements()},P=async()=>{var k;try{await H.generatePlan(),a.success(t("sidebar.generateSuccess",{templateId:((k=H.selectedTemplate)==null?void 0:k.id)??t("sidebar.unknown")}))}catch(j){console.error("Failed to generate plan:",j),a.error(t("sidebar.generateFailed")+": "+j.message)}},S=async()=>{try{await H.updatePlan(),a.success(t("sidebar.updateSuccess"))}catch(k){console.error("Failed to update plan:",k),a.error(t("sidebar.updateFailed")+": "+k.message)}},I=()=>{try{H&&typeof H.rollbackVersion=="function"?H.rollbackVersion():console.warn("sidebarStore or rollbackVersion method is not available")}catch(k){console.error("Error during rollback operation:",k),a.error(t("sidebar.rollbackFailed")||"Rollback failed")}},m=()=>{try{H&&typeof H.restoreVersion=="function"?H.restoreVersion():console.warn("sidebarStore or restoreVersion method is not available")}catch(k){console.error("Error during restore operation:",k),a.error(t("sidebar.restoreFailed")||"Restore failed")}},q=async k=>{console.log("[Sidebar] handleExecutePlan called with replacementParams:",k);try{const j=H.preparePlanExecution();if(!j){console.log("[Sidebar] No plan data available, returning");return}k&&Object.keys(k).length>0&&(j.replacementParams=k,console.log("[Sidebar] Added replacement parameters to plan data:",k)),console.log("[Sidebar] Triggering plan execution request:",j),console.log("[Sidebar] Emitting planExecutionRequested event"),y("planExecutionRequested",{title:j.title,planData:j.planData,params:j.params,replacementParams:k}),console.log("[Sidebar] Event emitted")}catch(j){console.error("Error executing plan:",j),a.error(t("sidebar.executeFailed")+": "+j.message)}finally{H.finishPlanExecution()}},x=U(!1),z=()=>{if(console.log("[Sidebar] Publish MCP service button clicked"),console.log("[Sidebar] currentPlanTemplateId:",H.currentPlanTemplateId),!H.currentPlanTemplateId){console.log("[Sidebar] No plan template selected, showing warning"),a.error(t("mcpService.selectPlanTemplateFirst"));return}console.log("[Sidebar] Opening publish MCP service modal"),x.value=!0},R=k=>{k===null?(console.log("MCP service deleted successfully"),a.success(t("mcpService.deleteSuccess")),d.value={toolName:"",toolDescription:"",planTemplateId:"",inputSchema:"[]",enableHttpService:!1,enableMcpService:!1,enableInternalToolcall:!1,serviceGroup:""}):(console.log("MCP service published successfully:",k),a.success(t("mcpService.publishSuccess")),d.value={...k,toolName:k.toolName||"",serviceGroup:k.serviceGroup||""})},F=()=>{H.clearExecutionParams()},G=k=>{H.executionParams=k},Q=k=>{H.generatorPrompt=k},E=k=>{H.planType=k},C=async k=>{if(!k){d.value={toolName:"",toolDescription:"",planTemplateId:"",inputSchema:"[]",enableHttpService:!1,enableMcpService:!1,enableInternalToolcall:!1,serviceGroup:""};return}try{const j=await Me.getCoordinatorToolsByTemplate(k);j?d.value={...j,toolName:j.toolName||"",serviceGroup:j.serviceGroup||""}:d.value={toolName:"",toolDescription:"",planTemplateId:k,inputSchema:"[]",enableHttpService:!1,enableMcpService:!1,enableInternalToolcall:!1,serviceGroup:""}}catch(j){console.error("Failed to load tool information:",j),d.value={toolName:"",toolDescription:"",planTemplateId:k,inputSchema:"[]",enableHttpService:!1,enableMcpService:!1,enableInternalToolcall:!1,serviceGroup:""}}},B=k=>{if(isNaN(k.getTime()))return console.warn("Invalid date received:",k),t("time.unknown");const N=new Date().getTime()-k.getTime(),O=Math.floor(N/6e4),K=Math.floor(N/36e5),ce=Math.floor(N/864e5);return O<1?t("time.now"):O<60?t("time.minuteAgo",{count:O}):K<24?t("time.hourAgo",{count:K}):ce<30?t("time.dayAgo",{count:ce}):k.toLocaleDateString("zh-CN")},J=(k,j)=>!k||k.length<=j?k:k.substring(0,j)+"...",oe=k=>{i.value=!0,h.value=k.clientX,g.value=r.value,document.addEventListener("mousemove",ee),document.addEventListener("mouseup",ge),document.body.style.cursor="col-resize",document.body.style.userSelect="none",k.preventDefault()},ee=k=>{if(!i.value)return;const j=window.innerWidth,O=(k.clientX-h.value)/j*100;let K=g.value+O;K=Math.max(15,Math.min(100,K)),r.value=K},ge=()=>{i.value=!1,document.removeEventListener("mousemove",ee),document.removeEventListener("mouseup",ge),document.body.style.cursor="",document.body.style.userSelect="",localStorage.setItem("sidebarWidth",r.value.toString())},W=()=>{r.value=80,localStorage.setItem("sidebarWidth","80")};return de(()=>H.currentPlanTemplateId,k=>{C(k)},{immediate:!0}),we(()=>{H.loadPlanTemplateList(),_(),H.loadAvailableTools();const k=localStorage.getItem("sidebarWidth");k&&(r.value=parseFloat(k))}),Te(()=>{document.removeEventListener("mousemove",ee),document.removeEventListener("mouseup",ge)}),e({loadPlanTemplateList:H.loadPlanTemplateList,toggleSidebar:H.toggleSidebar,currentPlanTemplateId:H.currentPlanTemplateId}),(k,j)=>{var N,O;return p(),f(ae,null,[s("div",{class:ne(["sidebar-wrapper",{"sidebar-wrapper-collapsed":l(H).isCollapsed}]),style:We({width:r.value+"%"})},[s("div",ji,[s("div",Vi,[s("div",Hi,c(k.$t("sidebar.title")),1)]),s("div",Gi,[s("button",{class:ne(["tab-button",{active:l(H).currentTab==="list"}]),onClick:j[0]||(j[0]=K=>l(H).switchToTab("list"))},[w(l(T),{icon:"carbon:list",width:"16"}),se(" "+c(k.$t("sidebar.templateList")),1)],2),s("button",{class:ne(["tab-button",{active:l(H).currentTab==="config"}]),onClick:j[1]||(j[1]=K=>l(H).switchToTab("config")),disabled:!l(H).selectedTemplate},[w(l(T),{icon:"carbon:settings",width:"16"}),se(" "+c(k.$t("sidebar.configuration")),1)],10,Wi)]),l(H).currentTab==="list"?(p(),f("div",zi,[s("div",Ji,[s("button",{class:"new-task-btn",onClick:j[2]||(j[2]=K=>l(H).createNewTemplate(l(H).planType))},[w(l(T),{icon:"carbon:add",width:"16"}),se(" "+c(k.$t("sidebar.newPlan"))+" ",1),j[8]||(j[8]=s("span",{class:"shortcut"},"⌘ K",-1))])]),s("div",Ki,[l(H).isLoading?(p(),f("div",Xi,[w(l(T),{icon:"carbon:circle-dash",width:"20",class:"spinning"}),s("span",null,c(k.$t("sidebar.loading")),1)])):l(H).errorMessage?(p(),f("div",Yi,[w(l(T),{icon:"carbon:warning",width:"20"}),s("span",null,c(l(H).errorMessage),1),s("button",{onClick:j[3]||(j[3]=(...K)=>l(H).loadPlanTemplateList&&l(H).loadPlanTemplateList(...K)),class:"retry-btn"},c(k.$t("sidebar.retry")),1)])):l(H).planTemplateList.length===0?(p(),f("div",Qi,[w(l(T),{icon:"carbon:document",width:"32"}),s("span",null,c(k.$t("sidebar.noTemplates")),1)])):(p(!0),f(ae,{key:3},ie(l(H).sortedTemplates,K=>(p(),f("div",{key:K.id,class:ne(["sidebar-content-list-item",{"sidebar-content-list-item-active":K.id===l(H).currentPlanTemplateId}]),onClick:ce=>l(H).selectTemplate(K)},[s("div",ec,[w(l(T),{icon:"carbon:document",width:"20"})]),s("div",tc,[s("div",sc,c(K.title||k.$t("sidebar.unnamedPlan")),1),s("div",nc,c(J(K.description||k.$t("sidebar.noDescription"),40)),1)]),s("div",oc,c(B(l(H).parseDateTime(K.updateTime||K.createTime))),1),s("div",ac,[s("button",{class:"delete-task-btn",title:k.$t("sidebar.deleteTemplate"),onClick:me(ce=>l(H).deleteTemplate(K),["stop"])},[w(l(T),{icon:"carbon:close",width:"16"})],8,lc)])],10,Zi))),128))])])):l(H).currentTab==="config"?(p(),f("div",rc,[l(H).selectedTemplate?(p(),f("div",ic,[s("div",cc,[s("div",dc,[s("h3",null,c(l(H).selectedTemplate.title||k.$t("sidebar.unnamedPlan")),1),s("span",uc,"ID: "+c(l(H).selectedTemplate.id),1)]),s("button",{class:"back-to-list-btn",onClick:j[4]||(j[4]=K=>l(H).switchToTab("list"))},[w(l(T),{icon:"carbon:arrow-left",width:"16"})])]),w(qi,{"generator-prompt":l(H).generatorPrompt,"json-content":l(H).jsonContent,"is-generating":l(H).isGenerating,"plan-type":l(H).planType,onGeneratePlan:P,onUpdatePlan:S,onUpdateGeneratorPrompt:Q,onUpdatePlanType:E},null,8,["generator-prompt","json-content","is-generating","plan-type"]),l(H).planType==="dynamic_agent"?(p(),le(Cr,{key:0,"json-content":l(H).jsonContent,"can-rollback":l(H).canRollback,"can-restore":l(H).canRestore,"is-generating":l(H).isGenerating,"is-executing":l(H).isExecuting,"current-plan-template-id":l(H).currentPlanTemplateId||"",onRollback:I,onRestore:m,onSave:v,"onUpdate:jsonContent":j[5]||(j[5]=K=>l(H).jsonContent=K)},null,8,["json-content","can-rollback","can-restore","is-generating","is-executing","current-plan-template-id"])):(p(),le(Wo,{key:1,"json-content":l(H).jsonContent,"can-rollback":l(H).canRollback,"can-restore":l(H).canRestore,"is-generating":l(H).isGenerating,"is-executing":l(H).isExecuting,"current-plan-template-id":l(H).currentPlanTemplateId||"",onRollback:I,onRestore:m,onSave:v,"onUpdate:jsonContent":j[6]||(j[6]=K=>l(H).jsonContent=K)},null,8,["json-content","can-rollback","can-restore","is-generating","is-executing","current-plan-template-id"])),w(Pi,{ref_key:"executionControllerRef",ref:u,"current-plan-template-id":l(H).currentPlanTemplateId||"","is-executing":l(H).isExecuting,"is-generating":l(H).isGenerating,"show-publish-button":M.value,"tool-info":d.value,onExecutePlan:q,onPublishMcpService:z,onClearParams:F,onUpdateExecutionParams:G},null,8,["current-plan-template-id","is-executing","is-generating","show-publish-button","tool-info"])])):L("",!0)])):L("",!0)]),s("div",{class:"sidebar-resizer",onMousedown:oe,onDblclick:W,title:k.$t("sidebar.resizeHint")},j[9]||(j[9]=[s("div",{class:"resizer-line"},null,-1)]),40,pc)],6),w(eo,{ref_key:"publishMcpModalRef",ref:b,modelValue:x.value,"onUpdate:modelValue":j[7]||(j[7]=K=>x.value=K),"plan-template-id":l(H).currentPlanTemplateId||"","plan-title":((N=l(H).selectedTemplate)==null?void 0:N.title)||"","plan-description":((O=l(H).selectedTemplate)==null?void 0:O.description)||"",onPublished:R},null,8,["modelValue","plan-template-id","plan-title","plan-description"])],64)}}}),mc=he(hc,[["__scopeId","data-v-7b9b059f"]]);class pt{static async handleResponse(e){if(!e.ok)try{const n=await e.json();throw new Error(n.message||`API request failed: ${e.status}`)}catch{throw new Error(`API request failed: ${e.status} ${e.statusText}`)}return e}static async getMemories(){try{const e=await fetch(`${this.BASE_URL}`);return(await(await this.handleResponse(e)).json()).memories||[]}catch(e){throw console.error("Failed to get memory list:",e),e}}static async getMemory(e){try{const n=await fetch(`${this.BASE_URL}/single?conversationId=${e}`),a=await(await this.handleResponse(n)).json();if(!a.data)throw new Error("Memory not found");return a.data}catch(n){throw console.error("Failed to get memory:",n),n}}static async createMemory(e,n){try{const t=await fetch(`${this.BASE_URL}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({conversation_id:e,memory_name:n})}),r=await(await this.handleResponse(t)).json();if(!r.data)throw new Error("Failed to create memory");return r.data}catch(t){throw console.error("Failed to create memory:",t),t}}static async updateMemory(e,n){try{const t=await fetch(`${this.BASE_URL}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({conversation_id:e,memory_name:n})}),r=await(await this.handleResponse(t)).json();if(!r.data)throw new Error("Failed to update memory");return r.data}catch(t){throw console.error("Failed to update memory:",t),t}}static async deleteMemory(e){try{const n=await fetch(`${this.BASE_URL}/${e}`,{method:"DELETE"});await this.handleResponse(n)}catch(n){throw console.error("Failed to delete memory:",n),n}}static async generateConversationId(){try{const e=await fetch(`${this.BASE_URL}/generate-id`),t=await(await this.handleResponse(e)).json();if(!t.data)throw new Error("Failed to generate conversation ID");return t.data}catch(e){throw console.error("Failed to generate conversation ID:",e),e}}}ve(pt,"BASE_URL","/api/memories");class fc{constructor(){ve(this,"isCollapsed",!1);ve(this,"selectMemoryId","");ve(this,"loadMessages",()=>{});ve(this,"intervalId")}toggleSidebar(){this.isCollapsed=!this.isCollapsed,this.isCollapsed?(this.loadMessages(),this.intervalId=window.setInterval(()=>{this.loadMessages()},3e3)):clearInterval(this.intervalId)}selectMemory(e){this.toggleSidebar(),this.selectMemoryId=e}setMemory(e){this.selectMemoryId=e}defaultMemoryId(){this.selectMemoryId=this.generateRandomId()}clearMemoryId(){this.selectMemoryId=""}generateRandomId(){return Math.random().toString(36).substring(2,10)}setLoadMessages(e){this.loadMessages=e}}const Ne=st(new fc),vc={key:0,class:"app-container"},gc={class:"app-content"},bc={class:"header"},yc={class:"relative"},_c={class:"title-edit-group"},$c={id:"main-title",class:"main-title"},wc={key:0,id:"title-edit-container",class:"title-edit-container"},Sc={class:"search-bar"},kc={class:"search-container"},Tc=["placeholder"],Pc={class:"message-list",id:"message-list"},Ec={class:"message-header"},Cc={class:"message-content"},Rc={class:"sender-info"},Ic=["onClick"],Ac={class:"sender-name"},Dc=["onClick"],xc={class:"action-buttons"},Mc=["onClick"],Fc={class:"action-buttons"},Uc=["onClick"],Nc={class:"message-preview"},Lc={class:"preview-line"},Bc={key:0,class:"preview-line",style:{opacity:"0.8"}},Oc={class:"message-meta"},qc={class:"message-id"},jc={class:"meta-right"},Vc={key:0,class:"unread-count"},Hc={class:"message-time"},Gc=["id"],Wc={style:{display:"flex","flex-direction":"column",gap:"0.75rem"}},zc={class:"bubble-avatar"},Jc={class:"bubble-content"},Kc={class:"bubble-text"},Xc={key:0,class:"empty-state"},Yc={class:"modal-content"},Qc={class:"modal-header"},Zc={class:"modal-title"},ed=["placeholder"],td={id:"name-char-count",class:"char-count",style:{"text-align":"right",display:"block","margin-top":"0.25rem"}},sd={class:"modal-footer"},nd={class:"modal-content"},od={class:"modal-header"},ad={class:"modal-title"},ld={class:"state-text",id:"delete-message"},rd={class:"modal-footer"},id=pe({__name:"Memory",emits:["memory-selected"],setup(o,{emit:e}){const n=U(!1),t=U(""),a=U([]),r=U([]),i=U(!1),h=U(null),g=U(""),u=U(!1),d=U(null),b=new Map,A=e,M=R=>{R.key==="Escape"&&(u.value?x():i.value&&S())};we(()=>{Ne.setLoadMessages(_),document.addEventListener("keydown",M)}),Te(()=>{document.removeEventListener("keydown",M)});const _=async()=>{try{const R=await pt.getMemories();a.value?a.value=R.map(F=>({...F,expanded:b.has(F.conversation_id)?b.get(F.conversation_id):!1})):a.value=R.map(F=>({...F,expanded:!1})),r.value=[...a.value],$()}catch(R){console.error("error:",R),a.value=[],r.value=[]}},y=R=>{Ne.selectMemory(R),A("memory-selected")},v=R=>{const F=typeof R=="string"?parseInt(R,10):R;return isNaN(F)||F<=0?"unknow time":new Date(F.toString().length===13?F:F*1e3).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1}).replace(","," ")},$=()=>{const R=t.value.toLowerCase().trim();if(!R){r.value=[...a.value];return}r.value=a.value.filter(F=>{var C;const G=F.memory_name.toLowerCase().includes(R),Q=F.conversation_id.toLowerCase().includes(R),E=((C=F.messages)==null?void 0:C.some(B=>B.text.toLowerCase().includes(R)))||!1;return G||Q||E})},P=(R,F)=>{h.value=R,g.value=F,i.value=!0},S=()=>{i.value=!1,h.value=null},I=async()=>{if(!h.value)return;const R=g.value.trim()||"unknow name",F=a.value.findIndex(G=>G.conversation_id===h.value);if(F!==-1){const G=a.value[F];try{const Q=await pt.updateMemory(G.conversation_id,R);Q.messages||(Q.messages=[]),a.value[F]={...Q,expanded:G.expanded},$(),i.value=!1}catch(Q){console.error("error:",Q)}}},m=R=>{const F=a.value.find(G=>G.conversation_id===R);if(F){F.expanded=!F.expanded,b.set(R,F.expanded);const G=r.value.findIndex(Q=>Q.conversation_id===R);G!==-1&&(r.value[G]={...F})}},q=R=>{d.value=R,u.value=!0},x=()=>{u.value=!1,d.value=null},z=async()=>{if(d.value)try{await pt.deleteMemory(d.value),a.value=a.value.filter(R=>R.conversation_id!==d.value),$(),a.value.length===0&&Ne.clearMemoryId(),u.value=!1,d.value=null}catch(R){console.error("error:",R)}};return(R,F)=>(p(),le(Qe,{to:"body"},[w(qe,{name:"modal"},{default:Fe(()=>[l(Ne).isCollapsed?(p(),f("div",vc,[s("div",gc,[s("div",bc,[s("div",yc,[s("div",_c,[s("h1",$c,[s("span",null,c(R.$t("memory.title")),1)])]),n.value?(p(),f("div",wc)):L("",!0)]),s("button",{class:"close-btn",onClick:F[0]||(F[0]=G=>l(Ne).toggleSidebar())},[w(l(T),{icon:"carbon:close"})])]),s("div",Sc,[s("div",kc,[w(l(T),{class:"search-container-icon",icon:"carbon:search"}),te(s("input",{type:"text",placeholder:R.$t("memory.searchPlaceholder"),class:"search-input","onUpdate:modelValue":F[1]||(F[1]=G=>t.value=G),onInput:$},null,40,Tc),[[re,t.value]])])]),s("div",Pc,[s("div",null,[(p(!0),f(ae,null,ie(r.value,G=>(p(),f("div",{class:ne(["message-item",{expanded:G.expanded}]),key:G.conversation_id},[s("div",Ec,[s("div",Cc,[s("div",Rc,[s("div",{class:"sender-div",onClick:me(Q=>y(G.conversation_id),["stop"])},[s("h3",Ac,c(G.memory_name),1)],8,Ic),s("div",{class:"toggle-container",onClick:me(Q=>P(G.conversation_id,G.memory_name),["stop"])},[w(l(T),{icon:"carbon:edit",class:"edit-btn"})],8,Dc),s("div",xc,[s("button",{class:"delete-btn",onClick:me(Q=>m(G.conversation_id),["stop"])},[w(l(T),{id:"toggle-"+G.conversation_id,icon:"carbon:chevron-down",class:"down-btn"},null,8,["id"])],8,Mc)]),s("div",Fc,[s("button",{class:"delete-btn",onClick:me(Q=>q(G.conversation_id),["stop"])},[w(l(T),{icon:"carbon:delete"})],8,Uc)])]),s("div",Nc,[s("p",Lc,c(G.messages&&G.messages.length>0?G.messages[0].text:"none message"),1),G.messages&&G.messages.length>1?(p(),f("p",Bc,c(G.messages[1].text),1)):L("",!0)]),s("div",Oc,[s("span",qc,"ID: "+c(G.conversation_id),1),s("div",jc,[G.messages&&G.messages.length>0?(p(),f("span",Vc,c(G.messages.length)+" "+c(R.$t("memory.size")),1)):L("",!0),s("span",Hc,c(v(G.create_time)),1)])])])]),G.expanded?(p(),f("div",{key:0,id:"content-"+G.conversation_id,class:"expanded-content"},[s("div",Wc,[(p(!0),f(ae,null,ie(G.messages,(Q,E)=>(p(),f("div",{class:"message-bubble",key:E},[s("div",zc,c(Q.messageType),1),s("div",Jc,[s("p",Kc,c(Q.text),1)])]))),128))])],8,Gc)):L("",!0)],2))),128))]),r.value.length===0&&t.value?(p(),f("div",Xc,F[3]||(F[3]=[s("p",{class:"state-text"},"none message",-1)]))):L("",!0)]),i.value?(p(),f("div",{key:0,id:"name-edit-modal",class:"modal-overlay",onClick:me(S,["self"])},[s("div",Yc,[s("div",Qc,[s("h3",Zc,c(R.$t("memory.changeName")),1),te(s("input",{type:"text","onUpdate:modelValue":F[2]||(F[2]=G=>g.value=G),class:"edit-input",placeholder:R.$t("memory.newNamePlaceholder")},null,8,ed),[[re,g.value]]),s("span",td,c(g.value.length),1)]),s("div",sd,[s("button",{id:"cancel-name",class:"modal-btn cancel-btn",onClick:S},c(R.$t("memory.cancel")),1),s("button",{id:"save-name",class:"modal-btn confirm-btn",onClick:I},c(R.$t("memory.save")),1)])])])):L("",!0),u.value?(p(),f("div",{key:1,id:"delete-modal",class:"modal-overlay",onClick:me(x,["self"])},[s("div",nd,[s("div",od,[s("h3",ad,c(R.$t("memory.deleteHint")),1),s("p",ld,c(R.$t("memory.deleteHintPrefix"))+" "+c(d.value)+" "+c(R.$t("memory.deleteHintSuffix")),1)]),s("div",rd,[s("button",{id:"cancel-delete",class:"modal-btn cancel-btn",onClick:x},c(R.$t("memory.cancel")),1),s("button",{id:"confirm-delete",class:"modal-btn delete-btn-confirm",onClick:z},c(R.$t("memory.delete")),1)])])])):L("",!0)])])):L("",!0)]),_:1})]))}}),cd=he(id,[["__scopeId","data-v-ca286acb"]]),dd="/api/executor";async function Ns(o){try{const e=await fetch(`${dd}/agent-execution/${o}`);if(!e.ok){if(e.status===404)return console.warn(`Agent execution detail not found for stepId: ${o}`),null;throw new Error(`HTTP error! status: ${e.status}`)}return await e.json()}catch(e){return console.error(`Error fetching agent execution detail for stepId: ${o}:`,e),null}}async function ud(o){return console.log(`Refreshing agent execution detail for stepId: ${o}`),Ns(o)}class Le{static async handleResponse(e){if(!e.ok)try{const n=await e.json();throw new Error(n.message||`API request failed: ${e.status}`)}catch{throw new Error(`API request failed: ${e.status} ${e.statusText}`)}return e}static async getFileTree(e){try{const n=await fetch(`${this.BASE_URL}/tree/${e}`),a=await(await this.handleResponse(n)).json();if(!a.success)throw new Error(a.message||"Failed to get file tree");return a.data}catch(n){throw console.error("Failed to get file tree:",n),n}}static async getFileContent(e,n){try{const t=await fetch(`${this.BASE_URL}/content/${e}?path=${encodeURIComponent(n)}`),r=await(await this.handleResponse(t)).json();if(!r.success)throw new Error(r.message||"Failed to get file content");return r.data}catch(t){throw console.error("Failed to get file content:",t),t}}static async downloadFile(e,n,t){try{const a=await fetch(`${this.BASE_URL}/download/${e}?path=${encodeURIComponent(n)}`);await this.handleResponse(a);const r=await a.blob(),i=window.URL.createObjectURL(r),h=document.createElement("a");h.href=i,h.download=t||n.split("/").pop()||"download",document.body.appendChild(h),h.click(),window.URL.revokeObjectURL(i),document.body.removeChild(h)}catch(a){throw console.error("Failed to download file:",a),a}}static isTextFile(e,n){const t=["text/","application/json","application/xml","application/javascript","application/typescript"],a=[".txt",".md",".json",".xml",".html",".css",".js",".ts",".vue",".jsx",".tsx",".py",".java",".cpp",".c",".h",".sh",".bat",".yml",".yaml",".properties",".conf",".cfg"];if(t.some(i=>e.startsWith(i)))return!0;const r=n.toLowerCase();return a.some(i=>r.endsWith(i))}static getFileIcon(e){if(e.type==="directory")return"carbon:folder";const n=e.name.toLowerCase();return n.endsWith(".js")?"vscode-icons:file-type-js":n.endsWith(".ts")?"vscode-icons:file-type-typescript":n.endsWith(".vue")?"vscode-icons:file-type-vue":n.endsWith(".java")?"vscode-icons:file-type-java":n.endsWith(".py")?"vscode-icons:file-type-python":n.endsWith(".json")?"vscode-icons:file-type-json":n.endsWith(".xml")?"vscode-icons:file-type-xml":n.endsWith(".html")?"vscode-icons:file-type-html":n.endsWith(".css")?"vscode-icons:file-type-css":n.endsWith(".md")?"vscode-icons:file-type-markdown":n.endsWith(".yml")||n.endsWith(".yaml")?"vscode-icons:file-type-yaml":n.endsWith(".pdf")?"vscode-icons:file-type-pdf2":n.endsWith(".doc")||n.endsWith(".docx")?"vscode-icons:file-type-word":n.endsWith(".xls")||n.endsWith(".xlsx")?"vscode-icons:file-type-excel":n.endsWith(".ppt")||n.endsWith(".pptx")?"vscode-icons:file-type-powerpoint":n.match(/\.(jpg|jpeg|png|gif|bmp|svg)$/)?"carbon:image":n.match(/\.(zip|rar|7z|tar|gz)$/)?"carbon:archive":"carbon:document"}}ve(Le,"BASE_URL","/api/file-browser");const pd={class:"file-tree-node"},hd={class:"node-icon"},md={class:"node-name"},fd={key:1,class:"file-size"},vd={key:2,class:"node-actions"},gd={key:0,class:"children"},bd=pe({__name:"FileTreeNode",props:{node:{},level:{}},emits:["file-selected","download-file"],setup(o,{emit:e}){const n=o,t=e,a=U(n.level===0),r=U(!1),i=U(!1),h=U({}),g=()=>{n.node.type==="directory"&&(a.value=!a.value)},u=()=>{n.node.type==="directory"?g():d()},d=()=>{n.node.type==="file"&&t("file-selected",n.node),M()},b=()=>{t("download-file",n.node),M()},A=$=>{$.preventDefault(),i.value=!0,h.value={position:"fixed",top:`${$.clientY}px`,left:`${$.clientX}px`,zIndex:1e3},setTimeout(()=>{document.addEventListener("click",M)},0)},M=()=>{i.value=!1,document.removeEventListener("click",M)},_=async()=>{try{await navigator.clipboard.writeText(n.node.path)}catch($){console.error("Failed to copy path:",$)}M()},y=()=>n.node.type==="directory"?a.value?"carbon:folder-open":"carbon:folder":Le.getFileIcon(n.node),v=$=>{if($===0)return"0 B";const P=1024,S=["B","KB","MB","GB"],I=Math.floor(Math.log($)/Math.log(P));return parseFloat(($/Math.pow(P,I)).toFixed(1))+" "+S[I]};return Te(()=>{document.removeEventListener("click",M)}),($,P)=>{const S=ls("FileTreeNode",!0);return p(),f("div",pd,[s("div",{class:ne(["node-content",{"is-directory":$.node.type==="directory","is-file":$.node.type==="file","is-expanded":a.value}]),style:We({paddingLeft:`${$.level*16+12}px`}),onClick:u,onContextmenu:me(A,["prevent"])},[$.node.type==="directory"?(p(),f("div",{key:0,class:"expand-icon",onClick:me(g,["stop"])},[w(l(T),{icon:a.value?"carbon:chevron-down":"carbon:chevron-right",class:"chevron-icon"},null,8,["icon"])])):L("",!0),s("div",hd,[w(l(T),{icon:y()},null,8,["icon"])]),s("span",md,c($.node.name),1),$.node.type==="file"?(p(),f("span",fd,c(v($.node.size)),1)):L("",!0),r.value?(p(),f("div",vd,[$.node.type==="file"?(p(),f("button",{key:0,onClick:P[0]||(P[0]=me(I=>$.$emit("download-file",$.node),["stop"])),class:"action-btn download-btn",title:"Download"},[w(l(T),{icon:"carbon:download"})])):L("",!0)])):L("",!0)],38),$.node.type==="directory"&&a.value&&$.node.children?(p(),f("div",gd,[(p(!0),f(ae,null,ie($.node.children,I=>(p(),le(S,{key:I.path,node:I,level:$.level+1,onFileSelected:P[1]||(P[1]=m=>$.$emit("file-selected",m)),onDownloadFile:P[2]||(P[2]=m=>$.$emit("download-file",m))},null,8,["node","level"]))),128))])):L("",!0),i.value?(p(),f("div",{key:1,class:"context-menu",style:We(h.value),onClick:P[3]||(P[3]=me(()=>{},["stop"]))},[s("div",{class:"context-menu-item",onClick:d},[w(l(T),{icon:"carbon:view"}),P[4]||(P[4]=s("span",null,"Open",-1))]),$.node.type==="file"?(p(),f("div",{key:0,class:"context-menu-item",onClick:b},[w(l(T),{icon:"carbon:download"}),P[5]||(P[5]=s("span",null,"Download",-1))])):L("",!0),P[7]||(P[7]=s("div",{class:"context-menu-divider"},null,-1)),s("div",{class:"context-menu-item",onClick:_},[w(l(T),{icon:"carbon:copy"}),P[6]||(P[6]=s("span",null,"Copy Path",-1))])],4)):L("",!0)])}}}),yd=he(bd,[["__scopeId","data-v-e4a376d5"]]),_d={class:"file-browser"},$d={class:"file-browser-header"},wd={class:"header-actions"},Sd=["disabled","title"],kd={class:"file-browser-content"},Td={class:"file-tree-panel"},Pd={key:0,class:"loading-state"},Ed={key:1,class:"error-state"},Cd={key:0,class:"waiting-for-files"},Rd={class:"message-content"},Id={class:"tips"},Ad=["disabled"],Dd={key:1,class:"actual-error"},xd={key:2,class:"empty-state"},Md={key:3,class:"file-tree"},Fd={key:0,class:"file-content-panel"},Ud={class:"file-content-header"},Nd={class:"file-info"},Ld={class:"file-name"},Bd={class:"file-size"},Od={class:"file-actions"},qd=["title"],jd=["title"],Vd={class:"file-content-body"},Hd={key:0,class:"loading-content"},Gd={key:1,class:"content-error"},Wd={key:2,class:"file-content"},zd={key:0,class:"text-content"},Jd={key:1,class:"binary-content"},Kd=pe({__name:"index",props:{planId:{}},setup(o){const e=o,{t:n}=Pe(),t=U(!1),a=U(null),r=U(null),i=U(null),h=U(null),g=U(!1),u=U(null),d=U(null),b=ue(()=>!h.value||!i.value?!1:Le.isTextFile(h.value.mimeType,i.value.name)),A=ue(()=>a.value&&(a.value.includes("Plan directory not found")||a.value.includes("not found"))),M=()=>{d.value&&(clearTimeout(d.value),d.value=null)},_=()=>{M(),d.value=window.setTimeout(()=>{A.value&&y()},5e3)},y=async()=>{if(e.planId){t.value=!0,a.value=null,M();try{r.value=await Le.getFileTree(e.planId)}catch(m){a.value=m instanceof Error?m.message:n("fileBrowser.loadError"),console.error("Failed to load file tree:",m);const q=m instanceof Error?m.message:"";(q.includes("Plan directory not found")||q.includes("not found"))&&_()}finally{t.value=!1}}},v=async m=>{if(m.type!=="directory"){i.value=m,h.value=null,g.value=!0,u.value=null;try{h.value=await Le.getFileContent(e.planId,m.path)}catch(q){u.value=q instanceof Error?q.message:n("fileBrowser.contentLoadError"),console.error("Failed to load file content:",q)}finally{g.value=!1}}},$=async m=>{try{await Le.downloadFile(e.planId,m.path,m.name)}catch(q){console.error("Failed to download file:",q)}},P=()=>{i.value=null,h.value=null,u.value=null},S=m=>Le.getFileIcon(m),I=m=>{if(m===0)return"0 B";const q=1024,x=["B","KB","MB","GB"],z=Math.floor(Math.log(m)/Math.log(q));return parseFloat((m/Math.pow(q,z)).toFixed(1))+" "+x[z]};return de(()=>e.planId,m=>{m&&(i.value=null,h.value=null,y())},{immediate:!0}),we(()=>{e.planId&&y()}),Te(()=>{M()}),(m,q)=>(p(),f("div",_d,[s("div",$d,[s("h3",null,c(m.$t("fileBrowser.title")),1),s("div",wd,[s("button",{class:"refresh-btn",onClick:y,disabled:t.value,title:m.$t("fileBrowser.refresh")},[w(l(T),{icon:"carbon:refresh",class:ne({rotating:t.value}),style:{color:"#ffffff",fontSize:"18px",width:"18px",height:"18px"}},null,8,["class"])],8,Sd)])]),s("div",kd,[s("div",Td,[t.value?(p(),f("div",Pd,[w(l(T),{icon:"carbon:loading",class:"rotating"}),s("span",null,c(m.$t("fileBrowser.loading")),1)])):a.value?(p(),f("div",Ed,[A.value?(p(),f("div",Cd,[w(l(T),{icon:"carbon:time",class:"rotating"}),s("div",Rd,[s("h3",null,c(m.$t("fileBrowser.waitingForGeneration")),1),s("p",null,c(m.$t("fileBrowser.planExecuting")),1),s("div",Id,[w(l(T),{icon:"carbon:information"}),s("span",null,c(m.$t("fileBrowser.filesTip")),1)])]),s("button",{onClick:y,class:"retry-btn",disabled:t.value},[w(l(T),{icon:"carbon:refresh",class:ne({rotating:t.value})},null,8,["class"]),se(" "+c(t.value?m.$t("fileBrowser.checking"):m.$t("fileBrowser.checkNow")),1)],8,Ad)])):(p(),f("div",Dd,[w(l(T),{icon:"carbon:warning"}),s("span",null,c(a.value),1),s("button",{onClick:y,class:"retry-btn"},c(m.$t("fileBrowser.retry")),1)]))])):r.value?(p(),f("div",Md,[w(yd,{node:r.value,level:0,onFileSelected:v,onDownloadFile:$},null,8,["node"])])):(p(),f("div",xd,[w(l(T),{icon:"carbon:folder-off"}),s("span",null,c(m.$t("fileBrowser.noFiles")),1)]))]),i.value?(p(),f("div",Fd,[s("div",Ud,[s("div",Nd,[w(l(T),{icon:S(i.value)},null,8,["icon"]),s("span",Ld,c(i.value.name),1),s("span",Bd,"("+c(I(i.value.size))+")",1)]),s("div",Od,[s("button",{onClick:q[0]||(q[0]=x=>$(i.value)),class:"download-btn",title:m.$t("fileBrowser.download")},[w(l(T),{icon:"carbon:download"})],8,qd),s("button",{onClick:P,class:"close-btn",title:m.$t("common.close")},[w(l(T),{icon:"carbon:close"})],8,jd)])]),s("div",Vd,[g.value?(p(),f("div",Hd,[w(l(T),{icon:"carbon:loading",class:"rotating"}),s("span",null,c(m.$t("fileBrowser.loadingContent")),1)])):u.value?(p(),f("div",Gd,[w(l(T),{icon:"carbon:warning"}),s("span",null,c(u.value),1)])):h.value?(p(),f("div",Wd,[b.value?(p(),f("div",zd,[s("pre",null,[s("code",null,c(h.value.content),1)])])):(p(),f("div",Jd,[w(l(T),{icon:"carbon:document-unknown"}),s("p",null,c(m.$t("fileBrowser.binaryFile")),1),s("button",{onClick:q[1]||(q[1]=x=>$(i.value)),class:"download-btn-large"},[w(l(T),{icon:"carbon:download"}),se(" "+c(m.$t("fileBrowser.downloadToView")),1)])]))])):L("",!0)])])):L("",!0)])]))}}),Xd=he(Kd,[["__scopeId","data-v-e7c74fe4"]]),Yd={class:"right-panel"},Qd={class:"preview-header"},Zd={class:"preview-tabs"},eu={class:"preview-content"},tu={key:0,class:"step-details"},su={key:0,class:"step-info"},nu={key:0,class:"agent-info"},ou={class:"info-item"},au={class:"label"},lu={class:"value"},ru={class:"info-item"},iu={class:"label"},cu={class:"value"},du={class:"info-item"},uu={class:"label"},pu={class:"execution-status"},hu={class:"status-item"},mu={class:"status-text"},fu={key:0},vu={key:0,class:"think-act-steps"},gu={class:"steps-container"},bu={class:"step-header"},yu={class:"step-number"},_u={class:"think-section"},$u={class:"think-content"},wu={class:"input"},Su={class:"label"},ku={class:"output"},Tu={class:"label"},Pu={key:0,class:"action-section"},Eu={class:"action-content"},Cu={class:"tool-info"},Ru={class:"label"},Iu={class:"value"},Au={class:"input"},Du={class:"label"},xu={class:"output"},Mu={class:"label"},Fu={key:0,class:"sub-plan-section"},Uu={class:"sub-plan-content"},Nu={class:"sub-plan-header"},Lu={class:"sub-plan-info"},Bu={class:"label"},Ou={class:"value"},qu={key:0,class:"sub-plan-info"},ju={class:"label"},Vu={class:"value"},Hu={class:"sub-plan-status"},Gu={class:"status-text"},Wu={key:0,class:"no-steps-message"},zu={key:1,class:"no-execution-message"},Ju={class:"step-basic-info"},Ku={class:"info-item"},Xu={class:"label"},Yu={class:"value"},Qu={key:0,class:"info-item"},Zu={class:"label"},ep={class:"value"},tp={class:"info-item"},sp={class:"label"},np={class:"no-execution-hint"},op={key:2,class:"execution-indicator"},ap={class:"execution-text"},lp={key:1,class:"no-selection"},rp=["title"],ip={key:1,class:"file-browser-container"},cp={key:1,class:"no-plan-message"},dp={class:"message-content"},up={class:"tips"},pp=pe({__name:"RightPanel",props:{currentRootPlanId:{},selectedStepId:{}},setup(o,{expose:e}){const n=o,{t}=Pe(),a=U(),r=U(),i=U("details"),h=U(localStorage.getItem("jmanus-last-plan-id")),g=U(localStorage.getItem("jmanus-has-executed-plan")==="true"),u=U(!1),d=U(!0),b=U(!0),A=ue(()=>r.value?r.value.completed?t("rightPanel.status.completed"):r.value.current?t("rightPanel.status.executing"):t("rightPanel.status.waiting"):""),M=ue(()=>n.currentRootPlanId?n.currentRootPlanId:h.value),_=ue(()=>!M.value&&!g.value),y=async R=>{var F,G,Q;if(console.log("[RightPanel] Step selected:",{stepId:R}),!R){console.warn("[RightPanel] No stepId provided"),r.value=null;return}try{const E=await Ns(R);if(!E){console.warn("[RightPanel] Agent execution detail not found for stepId:",R),r.value=null;return}const C={stepId:R,title:E.agentName||`Step ${R}`,description:E.agentDescription||"",agentExecution:E,completed:E.status==="FINISHED",current:E.status==="RUNNING"};r.value=C,console.log("[RightPanel] Step details updated:",C),console.log("[RightPanel] activeTab:",i.value),console.log("[RightPanel] selectedStep.value:",r.value),console.log("[RightPanel] agentExecution:",r.value.agentExecution),console.log("[RightPanel] thinkActSteps:",(F=r.value.agentExecution)==null?void 0:F.thinkActSteps),console.log("[RightPanel] thinkActSteps length:",(Q=(G=r.value.agentExecution)==null?void 0:G.thinkActSteps)==null?void 0:Q.length),await ke(),console.log("[RightPanel] After nextTick - selectedStep:",r.value),setTimeout(()=>{P()},100),I()}catch(E){console.error("[RightPanel] Error fetching step details:",E),r.value=null}},v=async()=>{var R;if(!((R=r.value)!=null&&R.stepId)){console.warn("[RightPanel] No step selected for refresh");return}console.log("[RightPanel] Refreshing current step:",r.value.stepId);try{const F=await ud(r.value.stepId);F&&r.value&&(r.value.agentExecution=F,r.value.completed=F.status==="FINISHED",r.value.current=F.status==="RUNNING",console.log("[RightPanel] Step refreshed successfully"),I())}catch(F){console.error("[RightPanel] Error refreshing step:",F)}};de(()=>n.selectedStepId,async R=>{R?await y(R):r.value=null},{immediate:!0});const $=R=>{a.value=R??void 0},P=()=>{if(!a.value)return;const{scrollTop:R,scrollHeight:F,clientHeight:G}=a.value,Q=F-R-G<50,E=F>G;d.value=Q,u.value=E&&!Q,Q?b.value=!0:F-R-G>100&&(b.value=!1),console.log("[RightPanel] Scroll state check:",{scrollTop:R,scrollHeight:F,clientHeight:G,isAtBottom:Q,hasScrollableContent:E,showButton:u.value,shouldAutoScroll:b.value})},S=()=>{a.value&&(a.value.scrollTo({top:a.value.scrollHeight,behavior:"smooth"}),ke(()=>{b.value=!0,P()}))},I=()=>{!b.value||!a.value||ke(()=>{a.value&&(a.value.scrollTop=a.value.scrollHeight,console.log("[RightPanel] Auto scroll to bottom"))})},m=R=>{if(R===null||typeof R>"u"||R==="")return"N/A";try{const F=typeof R=="object"?R:JSON.parse(R);return JSON.stringify(F,null,2)}catch{return String(R)}},q=()=>{r.value=null,b.value=!0,a.value&&a.value.removeEventListener("scroll",P)},x=()=>{const R=()=>{const F=a.value;return F?($(F),F.addEventListener("scroll",P),b.value=!0,P(),console.log("[RightPanel] Scroll listener initialized successfully"),!0):(console.log("[RightPanel] Scroll container not found, retrying..."),!1)};ke(()=>{R()||setTimeout(()=>{R()},100)})};return de(()=>n.currentRootPlanId,(R,F)=>{R&&R!==F?(h.value=R,g.value=!0,localStorage.setItem("jmanus-last-plan-id",R),localStorage.setItem("jmanus-has-executed-plan","true"),console.log("[RightPanel] New plan started:",R)):!R&&F&&console.log("[RightPanel] Plan execution finished, keeping last plan:",h.value)},{immediate:!0}),we(()=>{console.log("[RightPanel] Component mounted"),ke(()=>{x()})}),Te(()=>{console.log("[RightPanel] Component unmounting, cleaning up..."),q()}),e({handleStepSelected:y,refreshCurrentStep:v,updateDisplayedPlanProgress:R=>{console.log("[RightPanel] updateDisplayedPlanProgress called with rootPlanId:",R),R&&(h.value=R,g.value=!0,localStorage.setItem("jmanus-last-plan-id",R),localStorage.setItem("jmanus-has-executed-plan","true"),console.log("[RightPanel] Plan progress updated:",R))}}),(R,F)=>{var G,Q;return p(),f("div",Yd,[s("div",Qd,[s("div",Zd,[s("div",{class:ne(["tab-item",{active:i.value==="details"}]),onClick:F[0]||(F[0]=E=>i.value="details")},[w(l(T),{icon:"carbon:events"}),s("span",null,c(l(t)("rightPanel.stepExecutionDetails")),1)],2),s("div",{class:ne(["tab-item",{active:i.value==="files"}]),onClick:F[1]||(F[1]=E=>i.value="files")},[w(l(T),{icon:"carbon:folder"}),s("span",null,c(l(t)("fileBrowser.title")),1)],2)])]),s("div",eu,[i.value==="details"?(p(),f("div",tu,[r.value?(p(),f("div",su,[s("h3",null,c(r.value.title||r.value.description||l(t)("rightPanel.defaultStepTitle",{number:1})),1),r.value.agentExecution?(p(),f("div",nu,[s("div",ou,[s("span",au,c(l(t)("rightPanel.executingAgent"))+":",1),s("span",lu,c(r.value.agentExecution.agentName),1)]),s("div",ru,[s("span",iu,c(l(t)("rightPanel.callingModel"))+":",1),s("span",cu,c(r.value.agentExecution.modelName),1)]),s("div",du,[s("span",uu,c(l(t)("rightPanel.executionResult"))+":",1),s("span",{class:ne(["value",{success:r.value.agentExecution.status==="FINISHED"}])},c(r.value.agentExecution.status||l(t)("rightPanel.executing")),3)])])):L("",!0),s("div",pu,[s("div",hu,[r.value.completed?(p(),le(l(T),{key:0,icon:"carbon:checkmark-filled",class:"status-icon success"})):r.value.current?(p(),le(l(T),{key:1,icon:"carbon:in-progress",class:"status-icon progress"})):(p(),le(l(T),{key:2,icon:"carbon:time",class:"status-icon pending"})),s("span",mu,c(A.value),1)])])])):L("",!0),s("div",{ref_key:"scrollContainer",ref:a,class:"step-details-scroll-container",onScroll:P},[r.value?(p(),f("div",fu,[(G=r.value.agentExecution)!=null&&G.thinkActSteps&&r.value.agentExecution.thinkActSteps.length>0?(p(),f("div",vu,[s("h4",null,c(l(t)("rightPanel.thinkAndActionSteps")),1),s("div",gu,[(p(!0),f(ae,null,ie(r.value.agentExecution.thinkActSteps,(E,C)=>(p(),f("div",{key:C,class:"think-act-step"},[s("div",bu,[s("span",yu,"#"+c(C+1),1),s("span",{class:ne(["step-status",E.status])},c(E.status||l(t)("rightPanel.executing")),3)]),s("div",_u,[s("h5",null,[w(l(T),{icon:"carbon:thinking"}),se(" "+c(l(t)("rightPanel.thinking")),1)]),s("div",$u,[s("div",wu,[s("span",Su,c(l(t)("rightPanel.input"))+":",1),s("pre",null,c(m(E.thinkInput)),1)]),s("div",ku,[s("span",Tu,c(l(t)("rightPanel.output"))+":",1),s("pre",null,c(m(E.thinkOutput)),1)])])]),E.actionNeeded?(p(),f("div",Pu,[s("h5",null,[w(l(T),{icon:"carbon:play"}),se(" "+c(l(t)("rightPanel.action")),1)]),s("div",Eu,[(p(!0),f(ae,null,ie(E.actToolInfoList,(B,J)=>(p(),f("div",{key:J},[s("div",Cu,[s("span",Ru,c(l(t)("rightPanel.tool"))+":",1),s("span",Iu,c(B.name||""),1)]),s("div",Au,[s("span",Du,c(l(t)("rightPanel.toolParameters"))+":",1),s("pre",null,c(m(B.parameters)),1)]),s("div",xu,[s("span",Mu,c(l(t)("rightPanel.executionResult"))+":",1),s("pre",null,c(m(B.result)),1)])]))),128))]),E.subPlanExecutionRecord?(p(),f("div",Fu,[s("h5",null,[w(l(T),{icon:"carbon:tree-view"}),se(" "+c(l(t)("rightPanel.subPlan")),1)]),s("div",Uu,[s("div",Nu,[s("div",Lu,[s("span",Bu,c(R.$t("rightPanel.subPlanId"))+":",1),s("span",Ou,c(E.subPlanExecutionRecord.currentPlanId),1)]),E.subPlanExecutionRecord.title?(p(),f("div",qu,[s("span",ju,c(R.$t("rightPanel.title"))+":",1),s("span",Vu,c(E.subPlanExecutionRecord.title),1)])):L("",!0),s("div",Hu,[E.subPlanExecutionRecord.completed?(p(),le(l(T),{key:0,icon:"carbon:checkmark-filled",class:"status-icon success"})):(p(),le(l(T),{key:1,icon:"carbon:in-progress",class:"status-icon progress"})),s("span",Gu,c(E.subPlanExecutionRecord.completed?R.$t("rightPanel.status.completed"):R.$t("rightPanel.status.executing")),1)])])])])):L("",!0)])):L("",!0)]))),128))]),r.value.agentExecution&&!((Q=r.value.agentExecution.thinkActSteps)!=null&&Q.length)?(p(),f("div",Wu,[s("p",null,c(l(t)("rightPanel.noStepDetails")),1)])):r.value.agentExecution?L("",!0):(p(),f("div",zu,[w(l(T),{icon:"carbon:information",class:"info-icon"}),s("h4",null,c(l(t)("rightPanel.stepInfo")),1),s("div",Ju,[s("div",Ku,[s("span",Xu,c(l(t)("rightPanel.stepName"))+":",1),s("span",Yu,c(r.value.title||r.value.description||r.value.stepId),1)]),r.value.description?(p(),f("div",Qu,[s("span",Zu,c(R.$t("rightPanel.description"))+":",1),s("span",ep,c(r.value.description),1)])):L("",!0),s("div",tp,[s("span",sp,c(R.$t("rightPanel.status.label"))+":",1),s("span",{class:ne(["value",{"status-completed":r.value.completed,"status-current":r.value.current,"status-pending":!r.value.completed&&!r.value.current}])},c(r.value.completed?R.$t("rightPanel.status.completed"):r.value.current?R.$t("rightPanel.status.executing"):R.$t("rightPanel.status.pending")),3)])]),s("p",np,c(l(t)("rightPanel.noExecutionInfo")),1)])),r.value.current&&!r.value.completed?(p(),f("div",op,[F[2]||(F[2]=s("div",{class:"execution-waves"},[s("div",{class:"wave wave-1"}),s("div",{class:"wave wave-2"}),s("div",{class:"wave wave-3"})],-1)),s("p",ap,[w(l(T),{icon:"carbon:in-progress",class:"rotating-icon"}),se(" "+c(l(t)("rightPanel.stepExecuting")),1)])])):L("",!0)])):(p(),f("div",lp,[w(l(T),{icon:"carbon:events",class:"empty-icon"}),s("h3",null,c(l(t)("rightPanel.noStepSelected")),1),s("p",null,c(l(t)("rightPanel.selectStepHint")),1)]))])):L("",!0),w(qe,{name:"scroll-button"},{default:Fe(()=>[u.value?(p(),f("button",{key:0,onClick:S,class:"scroll-to-bottom-btn",title:l(t)("rightPanel.scrollToBottom")},[w(l(T),{icon:"carbon:chevron-down"})],8,rp)):L("",!0)]),_:1})],544)])):L("",!0),i.value==="files"?(p(),f("div",ip,[M.value?(p(),le(Xd,{key:0,"plan-id":M.value},null,8,["plan-id"])):_.value?(p(),f("div",cp,[w(l(T),{icon:"carbon:folder-off"}),s("div",dp,[s("h3",null,c(l(t)("fileBrowser.noFilesYet")),1),s("p",null,c(l(t)("fileBrowser.noPlanExecuting")),1),s("div",up,[w(l(T),{icon:"carbon:information"}),s("span",null,c(l(t)("fileBrowser.startTaskTip")),1)])])])):L("",!0)])):L("",!0)])])}}}),hp=he(pp,[["__scopeId","data-v-ea214380"]]);function Bt(){return{formatResponseText:g=>g?g.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/\*(.*?)\*/g,"<em>$1</em>").replace(/`([^`]+)`/g,"<code>$1</code>").replace(/\n/g,"<br>").replace(/```([\s\S]*?)```/g,"<pre><code>$1</code></pre>"):"",formatTimestamp:g=>{const d=new Date().getTime()-g.getTime();return d<6e4?"Just now":d<36e5?`${Math.floor(d/6e4)} minutes ago`:d<864e5?`${Math.floor(d/36e5)} hours ago`:g.toLocaleDateString("zh-CN",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})},getMessageClasses:g=>ue(()=>({user:g.type==="user",assistant:g.type==="assistant",streaming:g.isStreaming,"has-error":!!g.error,"has-thinking":!!g.thinking,"has-execution":!!g.planExecution})),formatFileSize:g=>{if(g===0)return"0 B";const u=1024,d=["B","KB","MB","GB"],b=Math.floor(Math.log(g)/Math.log(u));return parseFloat((g/Math.pow(u,b)).toFixed(2))+" "+d[b]},truncateText:(g,u=100)=>!g||g.length<=u?g:g.substring(0,u)+"...",stripHtml:g=>g.replace(/<[^>]*>/g,""),hasDisplayableContent:g=>!!(g.content||g.thinking||g.planExecution||g.error),getMessageStatus:g=>g.error?"Send failed":g.isStreaming?"Typing...":g.type==="assistant"&&!g.content&&!g.thinking?"Waiting for response":""}}const mp=["data-message-id"],fp={class:"user-content"},vp={class:"message-text"},gp={key:0,class:"attachments"},bp={class:"attachment-name"},yp={class:"attachment-size"},_p={class:"message-timestamp"},$p={key:0,class:"message-status error"},wp={class:"status-text"},Sp=pe({__name:"UserMessage",props:{message:{}},setup(o){const{formatTimestamp:e,formatFileSize:n}=Bt();return(t,a)=>{var r;return p(),f("div",{class:"user-message","data-message-id":t.message.id},[s("div",fp,[s("div",vp,c(t.message.content),1),(r=t.message.attachments)!=null&&r.length?(p(),f("div",gp,[(p(!0),f(ae,null,ie(t.message.attachments,(i,h)=>(p(),f("div",{key:h,class:"attachment-item"},[w(l(T),{icon:"carbon:document",class:"attachment-icon"}),s("span",bp,c(i.name),1),s("span",yp,c(l(n)(i.size)),1)]))),128))])):L("",!0),s("div",_p,c(l(e)(t.message.timestamp)),1)]),t.message.error?(p(),f("div",$p,[w(l(T),{icon:"carbon:warning",class:"status-icon"}),s("span",wp,c(t.message.error),1)])):L("",!0)],8,mp)}}}),kp=he(Sp,[["__scopeId","data-v-94372507"]]),Tp={class:"sub-plan-info"},Pp={class:"sub-plan-details"},Ep={class:"sub-plan-title"},Cp={key:0,class:"nesting-level"},Rp={class:"sub-plan-id"},Ip={class:"sub-plan-meta"},Ap={key:0,class:"trigger-tool"},Dp={class:"trigger-text"},xp={key:0,class:"sub-plan-progress"},Mp={class:"progress-info"},Fp={class:"progress-text"},Up={class:"progress-bar"},Np={key:1,class:"sub-plan-agents-steps"},Lp={class:"agents-steps-header"},Bp={class:"agents-label"},Op={class:"agents-steps-list"},qp=["onClick"],jp={class:"agent-step-header"},Vp={class:"agent-name"},Hp={class:"sub-agent-execution-info"},Gp={key:0,class:"agent-result"},Wp={class:"result-header"},zp={class:"result-label"},Jp={class:"result-content"},Kp={key:1,class:"agent-error"},Xp={class:"error-header"},Yp={class:"error-label"},Qp={class:"error-content"},Zp={key:2,class:"think-act-preview"},eh={class:"think-act-header"},th={class:"think-act-label"},sh={class:"think-act-steps-preview"},nh=["onClick"],oh={class:"step-number"},ah={class:"step-description"},lh={key:0,class:"more-steps"},rh={class:"more-steps-text"},ih={key:3,class:"nested-sub-plans"},ch={class:"nested-sub-plans-header"},dh={class:"nested-label"},uh={class:"nested-sub-plans-list"},ph={key:4,class:"direct-sub-plans"},hh={class:"direct-sub-plans-header"},mh={class:"direct-label"},fh={class:"direct-sub-plans-list"},vh=pe({__name:"RecursiveSubPlan",props:{subPlan:{},subPlanIndex:{},nestingLevel:{default:0},maxNestingDepth:{default:3},maxVisibleSteps:{default:2}},emits:["sub-plan-selected","step-selected"],setup(o,{emit:e}){const n=o,t=e,{t:a}=Pe(),r=()=>`nesting-level-${n.nestingLevel}`,i=()=>{var x,z;return n.subPlan.completed?"completed":((x=n.subPlan.agentExecutionSequence)==null?void 0:x.some(R=>R.status==="RUNNING"))?"running":((z=n.subPlan.agentExecutionSequence)==null?void 0:z.some(R=>R.status==="FINISHED"))?"in-progress":"pending"},h=()=>{switch(i()){case"completed":return a("chat.status.completed");case"running":return a("chat.status.executing");case"in-progress":return a("chat.status.inProgress");case"pending":return a("chat.status.pending");default:return a("chat.status.unknown")}},g=()=>{switch(i()){case"completed":return"carbon:checkmark";case"running":return"carbon:play";case"in-progress":return"carbon:in-progress";case"pending":default:return"carbon:dot-mark"}},u=()=>{var q;if(!((q=n.subPlan.agentExecutionSequence)!=null&&q.length))return 0;if(n.subPlan.completed)return 100;const m=d();return Math.min(100,m/n.subPlan.agentExecutionSequence.length*100)},d=()=>{var m;return(m=n.subPlan.agentExecutionSequence)!=null&&m.length?n.subPlan.agentExecutionSequence.filter(q=>q.status==="FINISHED").length:0},b=m=>{switch(m){case"FINISHED":return"completed";case"RUNNING":return"running";case"IDLE":default:return"pending"}},A=m=>{switch(m){case"FINISHED":return"carbon:checkmark";case"RUNNING":return"carbon:play";case"IDLE":default:return"carbon:dot-mark"}},M=m=>{switch(m){case"RUNNING":return a("chat.status.executing");case"FINISHED":return a("chat.status.completed");case"IDLE":default:return a("chat.status.pending")}},_=m=>{var q;return((q=m.thinkActSteps)==null?void 0:q.some(x=>x.subPlanExecutionRecord))??!1},y=m=>{var q;return((q=m.thinkActSteps)==null?void 0:q.filter(x=>x.subPlanExecutionRecord))??[]},v=()=>{t("sub-plan-selected",-1,n.subPlanIndex,n.subPlan)},$=(m,q)=>{const x=q.stepId||`subplan-${n.subPlanIndex}-agent-${m}`;t("step-selected",x)},P=(m,q,x)=>{const z=x.stepId||`subplan-${n.subPlanIndex}-agent-${m}`;t("step-selected",z)},S=(m,q,x)=>{t("sub-plan-selected",m,q,x)},I=m=>{t("step-selected",m)};return(m,q)=>{var z,R;const x=ls("RecursiveSubPlan",!0);return p(),f("div",{class:ne(["recursive-sub-plan",r()])},[s("div",{class:"sub-plan-header",onClick:v},[s("div",Tp,[w(l(T),{icon:g(),class:"sub-plan-status-icon"},null,8,["icon"]),s("div",Pp,[s("div",Ep,[se(c(m.subPlan.title||m.$t("chat.subPlan"))+" #"+c(m.subPlanIndex+1)+" ",1),(m.nestingLevel??0)>0?(p(),f("span",Cp,"(L"+c((m.nestingLevel??0)+1)+")",1)):L("",!0)]),s("div",Rp,c(m.subPlan.currentPlanId),1)])]),s("div",Ip,[s("div",{class:ne(["sub-plan-status-badge",i()])},c(h()),3),m.subPlan.parentActToolCall?(p(),f("div",Ap,[w(l(T),{icon:"carbon:function",class:"trigger-icon"}),s("span",Dp,c(m.subPlan.parentActToolCall.name),1)])):L("",!0)])]),(z=m.subPlan.agentExecutionSequence)!=null&&z.length?(p(),f("div",xp,[s("div",Mp,[s("span",Fp,c(m.$t("chat.progress"))+": "+c(d())+" / "+c(m.subPlan.agentExecutionSequence.length),1),s("div",Up,[s("div",{class:"progress-fill",style:We({width:u()+"%"})},null,4)])])])):L("",!0),(R=m.subPlan.agentExecutionSequence)!=null&&R.length?(p(),f("div",Np,[s("div",Lp,[s("span",Bp,c(m.$t("chat.agentExecutions"))+":",1)]),s("div",Op,[(p(!0),f(ae,null,ie(m.subPlan.agentExecutionSequence,(F,G)=>{var Q,E;return p(),f("div",{key:F.id||G,class:ne(["agent-step-item",b(F.status)]),onClick:C=>$(G,F)},[s("div",jp,[w(l(T),{icon:A(F.status),class:"agent-icon"},null,8,["icon"]),s("span",Vp,c(F.agentName||m.$t("chat.unknownAgent")),1),s("div",{class:ne(["agent-status-badge",b(F.status)])},c(M(F.status)),3)]),s("div",Hp,[F.result?(p(),f("div",Gp,[s("div",Wp,[w(l(T),{icon:"carbon:checkmark",class:"result-icon"}),s("span",zp,c(m.$t("chat.agentResult"))+":",1)]),s("pre",Jp,c(F.result),1)])):L("",!0),F.errorMessage?(p(),f("div",Kp,[s("div",Xp,[w(l(T),{icon:"carbon:warning",class:"error-icon"}),s("span",Yp,c(m.$t("chat.errorMessage"))+":",1)]),s("pre",Qp,c(F.errorMessage),1)])):L("",!0),(Q=F.thinkActSteps)!=null&&Q.length?(p(),f("div",Zp,[s("div",eh,[w(l(T),{icon:"carbon:thinking",class:"think-act-icon"}),s("span",th,c(m.$t("chat.thinkActSteps"))+" ("+c(F.thinkActSteps.length)+")",1)]),s("div",sh,[(p(!0),f(ae,null,ie(F.thinkActSteps.slice(0,m.maxVisibleSteps??2),(C,B)=>(p(),f("div",{key:C.id||B,class:"think-act-step-preview",onClick:me(J=>P(G,B,F),["stop"])},[s("span",oh,"#"+c(B+1),1),s("span",ah,c(C.actionDescription||m.$t("chat.thinking")),1),w(l(T),{icon:"carbon:arrow-right",class:"step-arrow"})],8,nh))),128)),F.thinkActSteps.length>(m.maxVisibleSteps??2)?(p(),f("div",lh,[s("span",rh,c(m.$t("chat.andMoreSteps",{count:F.thinkActSteps.length-(m.maxVisibleSteps??2)})),1)])):L("",!0)])])):L("",!0),_(F)?(p(),f("div",ih,[s("div",ch,[w(l(T),{icon:"carbon:tree-view-alt",class:"nested-icon"}),s("span",dh,c(m.$t("chat.nestedSubPlans")),1)]),s("div",uh,[(p(!0),f(ae,null,ie(y(F),(C,B)=>(p(),le(x,{key:C.id||B,"sub-plan":C.subPlanExecutionRecord,"sub-plan-index":B,"nesting-level":(m.nestingLevel??0)+1,"max-nesting-depth":m.maxNestingDepth??3,"max-visible-steps":m.maxVisibleSteps??2,onSubPlanSelected:S,onStepSelected:I},null,8,["sub-plan","sub-plan-index","nesting-level","max-nesting-depth","max-visible-steps"]))),128))])])):L("",!0),(E=F.subPlanExecutionRecords)!=null&&E.length?(p(),f("div",ph,[s("div",hh,[w(l(T),{icon:"carbon:tree-view",class:"direct-icon"}),s("span",mh,c(m.$t("chat.directSubPlans")),1)]),s("div",fh,[(p(!0),f(ae,null,ie(F.subPlanExecutionRecords,(C,B)=>(p(),le(x,{key:C.currentPlanId||B,"sub-plan":C,"sub-plan-index":B,"nesting-level":(m.nestingLevel??0)+1,"max-nesting-depth":m.maxNestingDepth??3,"max-visible-steps":m.maxVisibleSteps??2,onSubPlanSelected:S,onStepSelected:I},null,8,["sub-plan","sub-plan-index","nesting-level","max-nesting-depth","max-visible-steps"]))),128))])])):L("",!0)])],10,qp)}),128))])])):L("",!0)],2)}}}),gh=he(vh,[["__scopeId","data-v-5ef3cbb7"]]),bh={class:"execution-details"},yh={key:0,class:"plan-overview"},_h={class:"plan-header"},$h={class:"plan-title"},wh={key:0,class:"parent-tool-call"},Sh={class:"parent-tool-header"},kh={class:"tool-label"},Th={class:"tool-name"},Ph={key:0,class:"tool-parameters"},Eh={class:"param-label"},Ch={class:"param-content"},Rh={key:1,class:"agent-execution-container"},Ih={class:"section-title"},Ah=["onClick"],Dh={class:"agent-info"},xh={class:"agent-details"},Mh={class:"agent-name"},Fh={class:"request-content"},Uh={class:"agent-controls"},Nh={class:"agent-execution-info"},Lh={key:0,class:"agent-result"},Bh={class:"result-header"},Oh={class:"result-label"},qh={class:"result-content"},jh={key:1,class:"agent-error"},Vh={class:"error-header"},Hh={class:"error-label"},Gh={class:"error-content"},Wh={key:0,class:"sub-plans-container"},zh={class:"sub-plans-header"},Jh={class:"sub-plans-title"},Kh={class:"sub-plans-list"},Xh=pe({__name:"ExecutionDetails",props:{planExecution:{},genericInput:{}},emits:["agent-selected","sub-plan-selected","user-input-submitted","step-selected"],setup(o,{emit:e}){const n=o,t=e,{t:a}=Pe(),r=ue(()=>{var y;return((y=n.planExecution)==null?void 0:y.agentExecutionSequence)??[]}),i=y=>{y.stepId?t("step-selected",y.stepId):console.warn("[ExecutionDetails] Agent execution has no stepId:",y)},h=()=>n.planExecution?n.planExecution.completed?"completed":r.value.some($=>$.status==="RUNNING")?"running":r.value.some($=>$.status==="FINISHED")?"in-progress":"pending":"unknown",g=()=>{switch(h()){case"completed":return a("chat.status.completed");case"running":return a("chat.status.executing");case"in-progress":return a("chat.status.inProgress");case"pending":return a("chat.status.pending");default:return a("chat.status.unknown")}},u=y=>{switch(y){case"RUNNING":return"running";case"FINISHED":return"completed";case"IDLE":default:return"pending"}},d=y=>{switch(y){case"RUNNING":return a("chat.status.executing");case"FINISHED":return a("chat.status.completed");case"IDLE":default:return a("chat.status.pending")}},b=y=>{switch(y){case"RUNNING":return"carbon:play";case"FINISHED":return"carbon:checkmark";case"IDLE":default:return"carbon:dot-mark"}},A=(y,v,$)=>{t("sub-plan-selected",y,v,$)},M=y=>{t("step-selected",y)},_=y=>{if(!y)return"";try{const v=JSON.parse(y);return JSON.stringify(v,null,2)}catch{return y}};return(y,v)=>{var $,P,S;return p(),f("div",bh,[y.planExecution?(p(),f("div",yh,[s("div",_h,[s("h3",$h,c(y.planExecution.title||y.$t("chat.planExecution")),1),s("div",{class:ne(["plan-status-badge",h()])},c(g()),3)]),y.planExecution.parentActToolCall?(p(),f("div",wh,[s("div",Sh,[w(l(T),{icon:"carbon:flow",class:"tool-icon"}),s("span",kh,c(y.$t("chat.triggeredByTool"))+":",1),s("span",Th,c(y.planExecution.parentActToolCall.name),1)]),y.planExecution.parentActToolCall.parameters?(p(),f("div",Ph,[s("span",Eh,c(y.$t("common.parameters"))+":",1),s("pre",Ch,c(_(y.planExecution.parentActToolCall.parameters)),1)])):L("",!0)])):L("",!0)])):L("",!0),(((P=($=y.planExecution)==null?void 0:$.agentExecutionSequence)==null?void 0:P.length)??0)>0?(p(),f("div",Rh,[s("h4",Ih,c(y.$t("chat.agentExecutionSequence")),1),(p(!0),f(ae,null,ie((S=y.planExecution)==null?void 0:S.agentExecutionSequence,(I,m)=>{var q;return p(),f("div",{key:I.id||m,class:ne(["agent-execution-item",u(I.status)])},[s("div",{class:"agent-header",onClick:x=>i(I)},[s("div",Dh,[w(l(T),{icon:b(I.status),class:"agent-status-icon"},null,8,["icon"]),s("div",xh,[s("div",Mh,c(I.agentName||y.$t("chat.unknownAgent")),1),s("pre",Fh,c(I.agentRequest),1)])]),s("div",Uh,[s("div",{class:ne(["agent-status-badge",u(I.status)])},c(d(I.status)),3),w(l(T),{icon:"carbon:arrow-right",class:"step-select-icon"})])],8,Ah),s("div",Nh,[I.result?(p(),f("div",Lh,[s("div",Bh,[w(l(T),{icon:"carbon:checkmark",class:"result-icon"}),s("span",Oh,c(y.$t("chat.agentResult"))+":",1)]),s("pre",qh,c(I.result),1)])):L("",!0),I.errorMessage?(p(),f("div",jh,[s("div",Vh,[w(l(T),{icon:"carbon:warning",class:"error-icon"}),s("span",Hh,c(y.$t("chat.errorMessage"))+":",1)]),s("pre",Gh,c(I.errorMessage),1)])):L("",!0)]),(q=I.subPlanExecutionRecords)!=null&&q.length?(p(),f("div",Wh,[s("div",zh,[w(l(T),{icon:"carbon:tree-view",class:"sub-plans-icon"}),s("span",Jh,c(y.$t("chat.subPlanExecutions"))+" ("+c(I.subPlanExecutionRecords.length)+") ",1)]),s("div",Kh,[(p(!0),f(ae,null,ie(I.subPlanExecutionRecords,(x,z)=>(p(),le(gh,{key:x.currentPlanId||z,"sub-plan":x,"sub-plan-index":z,"nesting-level":0,"max-nesting-depth":3,"max-visible-steps":2,onSubPlanSelected:A,onStepSelected:M},null,8,["sub-plan","sub-plan-index"]))),128))])])):L("",!0)],2)}),128))])):L("",!0)])}}}),Ls=he(Xh,[["__scopeId","data-v-2d936ebb"]]),Yh={key:0,class:"thinking-section"},Qh={class:"thinking-header"},Zh={class:"thinking-avatar"},em={class:"thinking-label"},tm={class:"thinking-content"},sm={key:0,class:"thinking"},nm={key:2,class:"default-processing"},om={class:"processing-indicator"},am=pe({__name:"ThinkingSection",props:{thinking:{},thinkingDetails:{},planExecution:{},stepActions:{},genericInput:{},hasContent:{type:Boolean}},emits:["agent-selected","sub-plan-selected","user-input-submitted","step-selected"],setup(o,{emit:e}){const n=o,t=e,a=ue(()=>{var u,d,b,A;return n.thinking||(((d=(u=n.thinkingDetails)==null?void 0:u.agentExecutionSequence)==null?void 0:d.length)??0)>0||(((A=(b=n.planExecution)==null?void 0:b.agentExecutionSequence)==null?void 0:A.length)??0)>0}),r=(u,d)=>{t("agent-selected",u,d)},i=(u,d,b)=>{t("sub-plan-selected",u,d,b)},h=u=>{t("user-input-submitted",u)},g=u=>{t("step-selected",u)};return(u,d)=>a.value?(p(),f("div",Yh,[s("div",Qh,[s("div",Zh,[w(l(T),{icon:"carbon:thinking",class:"thinking-icon"})]),s("div",em,c(u.$t("chat.thinkingLabel")),1)]),s("div",tm,[u.thinking?(p(),f("div",sm,[w(l(T),{icon:"carbon:thinking",class:"thinking-icon"}),s("span",null,c(u.thinking),1)])):L("",!0),u.thinkingDetails||u.planExecution?(p(),le(Ls,{key:1,"plan-execution":u.thinkingDetails||u.planExecution,"step-actions":u.stepActions||[],"generic-input":u.genericInput||"",onAgentSelected:r,onSubPlanSelected:i,onUserInputSubmitted:h,onStepSelected:g},null,8,["plan-execution","step-actions","generic-input"])):!u.hasContent&&u.thinking?(p(),f("div",nm,[s("div",om,[d[0]||(d[0]=s("div",{class:"thinking-dots"},[s("span"),s("span"),s("span")],-1)),s("span",null,c(u.thinking||u.$t("chat.thinkingProcessing")),1)])])):L("",!0)])])):L("",!0)}}),lm=he(am,[["__scopeId","data-v-c341487f"]]);class wt{static async getDetails(e){try{const n=await fetch(`${this.BASE_URL}/details/${e}`);if(n.status===404)return null;if(!n.ok){const r=await n.text();throw new Error(`Failed to get detailed information: ${n.status} - ${r}`)}const t=await n.text(),a=JSON.parse(t);return a&&typeof a=="object"&&!a.currentPlanId&&(a.currentPlanId=e),a}catch(n){return console.error("[CommonApiService] Failed to get plan details:",n),null}}static async submitFormInput(e,n){const t=await fetch(`${this.BASE_URL}/submit-input/${e}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});if(!t.ok){let r;try{r=await t.json()}catch{r={message:`Failed to submit form input: ${t.status}`}}throw new Error(r.message||`Failed to submit form input: ${t.status}`)}const a=t.headers.get("content-type");return a&&a.indexOf("application/json")!==-1?await t.json():{success:!0}}static async getAllPrompts(){try{const e=await fetch(this.BASE_URL);return await(await this.handleResponse(e)).json()}catch(e){throw console.error("Failed to get Prompt list:",e),e}}static async handleResponse(e){if(!e.ok)try{const n=await e.json();throw new Error(n.message||`API request failed: ${e.status}`)}catch{throw new Error(`API request failed: ${e.status} ${e.statusText}`)}return e}}ve(wt,"BASE_URL","/api/executor");const rm={class:"user-input-form-container"},im={class:"user-input-header"},cm={class:"user-input-title"},dm={class:"user-input-message"},um={key:0,class:"form-description"},pm={key:0,class:"form-grid"},hm=["for"],mm=["id","name","placeholder","required","onUpdate:modelValue"],fm=["id","name","placeholder","required","onUpdate:modelValue"],vm=["id","name","placeholder","required","onUpdate:modelValue"],gm=["id","name","placeholder","required","onUpdate:modelValue"],bm=["id","name","placeholder","required","onUpdate:modelValue"],ym=["id","name","required","onUpdate:modelValue"],_m={value:""},$m=["value"],wm={key:6,class:"checkbox-group"},Sm=["id","name","value","onUpdate:modelValue"],km={class:"checkbox-label"},Tm={key:7,class:"radio-group"},Pm=["id","name","value","onUpdate:modelValue"],Em={class:"radio-label"},Cm=["id","name","placeholder","required","onUpdate:modelValue"],Rm={key:1,class:"form-group"},Im={for:"form-input-genericInput"},Am={type:"submit",class:"submit-user-input-btn"},Dm=pe({__name:"UserInputForm",props:{userInputWaitState:{},planId:{},genericInput:{}},emits:["user-input-submitted"],setup(o,{emit:e}){const n=o,t=e;Pe();const a=st({}),r=U(n.genericInput||""),i=U(!1),h=U(null),g=()=>{var M;const A=(M=n.userInputWaitState)==null?void 0:M.formInputs;A&&A.length>0&&(!i.value||Object.keys(a).length!==A.length)&&(A.forEach((y,v)=>{(!(v in a)||y.type==="checkbox"&&!Array.isArray(a[v])||y.type!=="checkbox"&&a[v]==="")&&(y.type==="checkbox"?a[v]=[]:a[v]="")}),i.value=!0)};we(()=>{g()}),de(()=>{var A;return(A=n.userInputWaitState)==null?void 0:A.formInputs},()=>{h.value&&clearTimeout(h.value),h.value=setTimeout(()=>{i.value=!1,g()},100)},{deep:!0});const u=async()=>{var A;try{const M={},_=(A=n.userInputWaitState)==null?void 0:A.formInputs;_&&_.length>0?Object.entries(a).forEach(([y,v])=>{const $=parseInt(y,10),P=_[$];if(P){const S=P.label||`input_${y}`;Array.isArray(v)?M[S]=v.join(", "):M[S]=v}}):M.genericInput=r.value,console.log("[UserInputForm] Submitting user input:",M,"for planId:",n.planId),n.planId?(await wt.submitFormInput(n.planId,M),console.log("[UserInputForm] User input submitted successfully")):console.error("[UserInputForm] No planId available for user input submission"),t("user-input-submitted",M)}catch(M){console.error("[UserInputForm] User input submission failed:",M)}},d=A=>A?Array.isArray(A)?A:typeof A=="string"?A.split(",").map(M=>M.trim()).filter(M=>M.length>0):[]:[],b=A=>typeof A=="boolean"?A:typeof A=="string"?A==="true":!1;return Te(()=>{h.value&&clearTimeout(h.value)}),(A,M)=>{var _,y,v,$,P;return p(),f("div",rm,[s("div",im,[w(l(T),{icon:"carbon:user",class:"user-icon"}),s("h4",cm,c(A.$t("chat.userInputRequired")),1)]),s("p",dm,c(((_=A.userInputWaitState)==null?void 0:_.title)??A.$t("chat.userInput.message")),1),(y=A.userInputWaitState)!=null&&y.formDescription?(p(),f("p",um,c((v=A.userInputWaitState)==null?void 0:v.formDescription),1)):L("",!0),s("form",{onSubmit:me(u,["prevent"]),class:"user-input-form"},[($=A.userInputWaitState)!=null&&$.formInputs&&A.userInputWaitState.formInputs.length>0?(p(),f("div",pm,[(p(!0),f(ae,null,ie((P=A.userInputWaitState)==null?void 0:P.formInputs,(S,I)=>(p(),f("div",{key:I,class:"form-group"},[s("label",{for:`form-input-${S.label.replace(/\W+/g,"_")}`},c(S.label)+c(b(S.required)?" *":"")+": ",9,hm),!S.type||S.type==="text"?te((p(),f("input",{key:0,type:"text",id:`form-input-${S.label.replace(/\W+/g,"_")}`,name:S.label,placeholder:S.placeholder||"",required:b(S.required),"onUpdate:modelValue":m=>a[I]=m,class:"form-input"},null,8,mm)),[[re,a[I]]]):S.type==="email"?te((p(),f("input",{key:1,type:"email",id:`form-input-${S.label.replace(/\W+/g,"_")}`,name:S.label,placeholder:S.placeholder||"",required:b(S.required),"onUpdate:modelValue":m=>a[I]=m,class:"form-input"},null,8,fm)),[[re,a[I]]]):S.type==="number"?te((p(),f("input",{key:2,type:"number",id:`form-input-${S.label.replace(/\W+/g,"_")}`,name:S.label,placeholder:S.placeholder||"",required:b(S.required),"onUpdate:modelValue":m=>a[I]=m,class:"form-input"},null,8,vm)),[[re,a[I]]]):S.type==="password"?te((p(),f("input",{key:3,type:"password",id:`form-input-${S.label.replace(/\W+/g,"_")}`,name:S.label,placeholder:S.placeholder||"",required:b(S.required),"onUpdate:modelValue":m=>a[I]=m,class:"form-input"},null,8,gm)),[[re,a[I]]]):S.type==="textarea"?te((p(),f("textarea",{key:4,id:`form-input-${S.label.replace(/\W+/g,"_")}`,name:S.label,placeholder:S.placeholder||"",required:b(S.required),"onUpdate:modelValue":m=>a[I]=m,class:"form-input form-textarea",rows:"4"},null,8,bm)),[[re,a[I]]]):S.type==="select"&&S.options?te((p(),f("select",{key:5,id:`form-input-${S.label.replace(/\W+/g,"_")}`,name:S.label,required:b(S.required),"onUpdate:modelValue":m=>a[I]=m,class:"form-input form-select"},[s("option",_m,c(A.$t("selectCommon.pleaseSelect")),1),(p(!0),f(ae,null,ie(d(S.options),m=>(p(),f("option",{key:m,value:m},c(m),9,$m))),128))],8,ym)),[[nt,a[I]]]):S.type==="checkbox"&&S.options?(p(),f("div",wm,[(p(!0),f(ae,null,ie(d(S.options),m=>(p(),f("label",{key:m,class:"checkbox-item"},[te(s("input",{type:"checkbox",id:`form-input-${S.label.replace(/\W+/g,"_")}-${m.replace(/\W+/g,"_")}`,name:S.label,value:m,"onUpdate:modelValue":q=>a[I]=q,class:"form-checkbox"},null,8,Sm),[[it,a[I]]]),s("span",km,c(m),1)]))),128))])):S.type==="radio"&&S.options?(p(),f("div",Tm,[(p(!0),f(ae,null,ie(d(S.options),m=>(p(),f("label",{key:m,class:"radio-item"},[te(s("input",{type:"radio",id:`form-input-${S.label.replace(/\W+/g,"_")}-${m.replace(/\W+/g,"_")}`,name:S.label,value:m,"onUpdate:modelValue":q=>a[I]=q,class:"form-radio"},null,8,Pm),[[js,a[I]]]),s("span",Em,c(m),1)]))),128))])):te((p(),f("input",{key:8,type:"text",id:`form-input-${S.label.replace(/\W+/g,"_")}`,name:S.label,placeholder:S.placeholder||"",required:b(S.required),"onUpdate:modelValue":m=>a[I]=m,class:"form-input"},null,8,Cm)),[[re,a[I]]])]))),128))])):(p(),f("div",Rm,[s("label",Im,c(A.$t("common.input"))+":",1),te(s("input",{type:"text",id:"form-input-genericInput",name:"genericInput","onUpdate:modelValue":M[0]||(M[0]=S=>r.value=S),class:"form-input"},null,512),[[re,r.value]])])),s("button",Am,c(A.$t("chat.userInput.submit")),1)],32)])}}}),xm=he(Dm,[["__scopeId","data-v-043b591c"]]),Mm={class:"response-section"},Fm={class:"response-header"},Um={class:"response-avatar"},Nm={class:"response-name"},Lm={key:0,class:"response-timestamp"},Bm={class:"response-content"},Om={key:1,class:"final-response"},qm=["innerHTML"],jm={class:"response-actions"},Vm=["title"],Hm=["title"],Gm={key:2,class:"response-placeholder"},Wm={class:"typing-indicator"},zm={class:"typing-text"},Jm={key:3,class:"response-error"},Km={class:"error-text"},Xm={key:4,class:"response-empty"},Ym={class:"empty-text"},Qm=pe({__name:"ResponseSection",props:{content:{},isStreaming:{type:Boolean},error:{},timestamp:{},userInputWaitState:{},planId:{},genericInput:{}},emits:["copy","regenerate","retry","user-input-submitted"],setup(o,{emit:e}){const n=o,t=e,{formatResponseText:a,formatTimestamp:r}=Bt(),i=async()=>{if(n.content)try{const d=n.content.replace(/<[^>]*>/g,"");await navigator.clipboard.writeText(d),t("copy")}catch(d){console.error("Failed to copy to clipboard:",d)}},h=()=>{t("regenerate")},g=()=>{t("retry")},u=d=>{console.log("[ResponseSection] User input submitted:",d),t("user-input-submitted",d)};return(d,b)=>{var A;return p(),f("div",Mm,[s("div",Fm,[s("div",Um,[w(l(T),{icon:"carbon:bot",class:"bot-icon"})]),s("div",Nm,c(d.$t("chat.botName")),1),d.timestamp?(p(),f("div",Lm,c(l(r)(d.timestamp)),1)):L("",!0)]),s("div",Bm,[(A=d.userInputWaitState)!=null&&A.waiting?(p(),le(xm,rs({key:0,"user-input-wait-state":d.userInputWaitState},d.planId?{"plan-id":d.planId}:{},{"generic-input":d.genericInput??"",onUserInputSubmitted:u}),null,16,["user-input-wait-state","generic-input"])):L("",!0),d.content?(p(),f("div",Om,[s("div",{class:"response-text",innerHTML:l(a)(d.content)},null,8,qm),s("div",jm,[s("button",{class:"action-btn copy-btn",onClick:i,title:d.$t("chat.copyResponse")},[w(l(T),{icon:"carbon:copy"})],8,Vm),s("button",{class:"action-btn regenerate-btn",onClick:h,title:d.$t("chat.regenerateResponse")},[w(l(T),{icon:"carbon:renew"})],8,Hm)])])):d.isStreaming?(p(),f("div",Gm,[s("div",Wm,[b[0]||(b[0]=s("div",{class:"typing-dots"},[s("span"),s("span"),s("span")],-1)),s("span",zm,c(d.$t("chat.thinkingResponse")),1)])])):d.error?(p(),f("div",Jm,[w(l(T),{icon:"carbon:warning",class:"error-icon"}),s("span",Km,c(d.error),1),s("button",{class:"retry-btn",onClick:g},c(d.$t("chat.retry")),1)])):(p(),f("div",Xm,[s("span",Ym,c(d.$t("chat.waitingForResponse")),1)]))])])}}}),Zm=he(Qm,[["__scopeId","data-v-6581a34f"]]),ef={class:"assistant-message"},tf=pe({__name:"AssistantMessage",props:{message:{},isStreaming:{type:Boolean}},emits:["copy","regenerate","retry","step-selected"],setup(o,{emit:e}){const n=o,t=e,a=()=>{t("copy",n.message.id)},r=()=>{t("regenerate",n.message.id)},i=()=>{t("retry",n.message.id)},h=(u,d)=>{console.log("[AssistantMessage] User input submitted:",d,"for message:",u.id)},g=u=>{console.log("[AssistantMessage] Step selected:",u),t("step-selected",u)};return(u,d)=>{var b,A,M,_;return p(),f("div",ef,[u.message.thinkingDetails?(p(),le(lm,{key:0,"thinking-details":u.message.thinkingDetails,onStepSelected:g},null,8,["thinking-details"])):L("",!0),u.message.planExecution?(p(),le(Ls,{key:1,"plan-execution":u.message.planExecution,"step-actions":u.message.stepActions||[],"generic-input":u.message.genericInput||"",onStepSelected:g},null,8,["plan-execution","step-actions","generic-input"])):L("",!0),u.message.content||u.message.error||u.isStreaming||(A=(b=u.message.planExecution)==null?void 0:b.userInputWaitState)!=null&&A.waiting?(p(),le(Zm,rs({key:2,content:u.message.content||"","is-streaming":u.isStreaming||!1},{...u.message.error?{error:u.message.error}:{},...(M=u.message.planExecution)!=null&&M.userInputWaitState?{userInputWaitState:u.message.planExecution.userInputWaitState}:{},...(_=u.message.planExecution)!=null&&_.currentPlanId?{planId:u.message.planExecution.currentPlanId}:{}},{timestamp:u.message.timestamp,"generic-input":u.message.genericInput||"",onCopy:a,onRegenerate:r,onRetry:i,onUserInputSubmitted:d[0]||(d[0]=y=>h(u.message,y))}),null,16,["content","is-streaming","timestamp","generic-input"])):L("",!0)])}}}),sf=he(tf,[["__scopeId","data-v-3810c279"]]),nf=pe({__name:"ChatMessage",props:{message:{},isStreaming:{type:Boolean}},emits:["copy","regenerate","retry","step-selected"],setup(o,{emit:e}){const n=o,t=e,{getMessageClasses:a}=Bt(),r=ue(()=>a(n.message)),i=d=>{t("copy",d)},h=d=>{t("regenerate",d)},g=d=>{t("retry",d)},u=d=>{t("step-selected",d)};return(d,b)=>(p(),f("div",{class:ne(["chat-message",r.value])},[d.message.type==="user"?(p(),le(kp,{key:0,message:d.message},null,8,["message"])):d.message.type==="assistant"?(p(),le(sf,{key:1,message:d.message,"is-streaming":d.isStreaming||!1,onCopy:i,onRegenerate:h,onRetry:g,onStepSelected:u},null,8,["message","is-streaming"])):L("",!0)],2))}}),of=he(nf,[["__scopeId","data-v-218b3735"]]);function xt(o){const e={...o};return"agentExecutionSequence"in o&&Array.isArray(o.agentExecutionSequence)&&(e.agentExecutionSequence=o.agentExecutionSequence.map(n=>af(n))),e}function af(o){const e={...o};return"subPlanExecutionRecords"in o&&Array.isArray(o.subPlanExecutionRecords)&&(e.subPlanExecutionRecords=o.subPlanExecutionRecords.map(n=>xt(n))),e}function lf(o){const e={...o};return"thinkingDetails"in o&&o.thinkingDetails&&(e.thinkingDetails=xt(o.thinkingDetails)),"planExecution"in o&&o.planExecution&&(e.planExecution=xt(o.planExecution)),"attachments"in o&&Array.isArray(o.attachments)&&(e.attachments=[...o.attachments]),e}function rf(){const o=U([]),e=U(!1),n=U(null),t=U(null),a=ue(()=>o.value.length>0?o.value[o.value.length-1]:null),r=ue(()=>n.value!==null),i=ue(()=>o.value.length>0),h=(I,m,q)=>{const x={id:`msg_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,type:I,content:m,timestamp:new Date,isStreaming:!1,...q};return o.value.push(x),x},g=(I,m)=>{const q=o.value.findIndex(x=>x.id===I);q!==-1&&(o.value[q]={...o.value[q],...m})},u=I=>{const m=o.value.findIndex(q=>q.id===I);m!==-1&&o.value.splice(m,1)},d=()=>{o.value=[],n.value=null,t.value=null},b=I=>{n.value=I,g(I,{isStreaming:!0})},A=I=>{I&&g(I,{isStreaming:!1}),n.value===I&&(n.value=null)},M=I=>{t.value=I},_=(I,m,q="content")=>{const x=o.value.find(z=>z.id===I);x&&typeof x[q]=="string"&&g(I,{[q]:x[q]+m})},y=(I,m)=>{g(I,{thinkingDetails:m})},v=(I,m)=>{g(I,{thinking:m})},$=(I,m)=>{g(I,{planExecution:m})},P=I=>o.value.find(m=>m.id===I),S=I=>o.value.findIndex(m=>m.id===I);return{messages:Ze(o),isLoading:e,streamingMessageId:Ze(n),activeMessageId:Ze(t),lastMessage:a,isStreaming:r,hasMessages:i,addMessage:h,updateMessage:g,removeMessage:u,clearMessages:d,startStreaming:b,stopStreaming:A,setActiveMessage:M,appendToMessage:_,updateMessageThinking:v,updateMessageThinkingDetails:y,updateMessagePlanExecution:$,findMessage:P,getMessageIndex:S}}function cf(o){const e=U(!1),n=U(!0),t=150,a=async(v=!0)=>{o.value&&(await ke(),o.value.scrollTo({top:o.value.scrollHeight,behavior:v?"smooth":"auto"}))},r=()=>{if(!o.value)return!1;const{scrollTop:v,scrollHeight:$,clientHeight:P}=o.value;return $-v-P<t},i=()=>{if(!o.value)return;const v=r();e.value=!v&&o.value.scrollHeight>o.value.clientHeight,v&&(n.value=!0)},h=()=>{i(),r()||(n.value=!1)},g=async()=>{n.value&&await a()},u=async()=>{n.value=!0,await a()},d=(v,$=!0)=>{if(!o.value)return;const P=o.value.querySelector(`[data-message-id="${v}"]`);P&&P.scrollIntoView({behavior:$?"smooth":"auto",block:"center"})},b=()=>{if(!o.value)return{scrollTop:0,scrollHeight:0,clientHeight:0,isAtTop:!0,isAtBottom:!0,scrollPercentage:0};const{scrollTop:v,scrollHeight:$,clientHeight:P}=o.value,S=v===0,I=v+P>=$-5,m=$>P?v/($-P)*100:100;return{scrollTop:v,scrollHeight:$,clientHeight:P,isAtTop:S,isAtBottom:I,scrollPercentage:m}},A=()=>{o.value&&o.value.addEventListener("scroll",h,{passive:!0})},M=()=>{o.value&&o.value.removeEventListener("scroll",h)},_=()=>{A(),i()},y=()=>{M()};return we(()=>{ke(()=>{_()})}),Te(()=>{y()}),{showScrollToBottom:Ze(e),isAutoScrollEnabled:Ze(n),scrollToBottom:a,autoScrollToBottom:g,forceScrollToBottom:u,scrollToMessage:d,isNearBottom:r,checkScrollPosition:i,getScrollInfo:b,addScrollListener:A,removeScrollListener:M,initializeScrollBehavior:_,cleanupScrollBehavior:y}}class Ot{static async sendMessage(e){return Ht.withLlmCheck(async()=>{const n={...e,isVueRequest:!0},t=await fetch(`${this.BASE_URL}/execute`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});if(!t.ok)throw new Error(`API request failed: ${t.status}`);return await t.json()})}static async sendMessageWithDefaultPlan(e){return Ht.withLlmCheck(async()=>{const n="default-plan-id-001000222",t={userRequirement:e.input},a={toolName:n,replacementParams:t,isVueRequest:!0};e.uploadedFiles&&e.uploadedFiles.length>0&&(a.uploadedFiles=e.uploadedFiles,console.log("[DirectApiService] Including uploaded files:",e.uploadedFiles.length)),e.uploadKey&&(a.uploadKey=e.uploadKey,console.log("[DirectApiService] Including uploadKey:",e.uploadKey)),console.log("[DirectApiService] Sending message with default plan:",a);const r=await fetch(`${this.BASE_URL}/executeByToolNameAsync`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!r.ok)throw new Error(`API request failed: ${r.status}`);return await r.json()})}}ve(Ot,"BASE_URL","/api/executor");const df=Object.freeze(Object.defineProperty({__proto__:null,DirectApiService:Ot},Symbol.toStringTag,{value:"Module"})),Be=class Be{constructor(){ve(this,"POLL_INTERVAL",5e3);ve(this,"state",st({activePlanId:null,lastSequenceSize:0,isPolling:!1,pollTimer:null}));ve(this,"callbacks",{});ve(this,"planExecutionCache",new Map);ve(this,"uiStateCache",new Map);console.log("[PlanExecutionManager] Initialized with callback-based event system")}getCachedPlanRecord(e){return this.planExecutionCache.get(e)}getCachedUIState(e){return this.uiStateCache.get(e)}setCachedUIState(e,n){this.uiStateCache.set(e,n),console.log(`[PlanExecutionManager] Cached UI state for rootPlanId: ${e}`)}getAllCachedRecords(){return new Map(this.planExecutionCache)}hasCachedPlanRecord(e){return this.planExecutionCache.has(e)}setCachedPlanRecord(e,n){this.planExecutionCache.set(e,n),console.log(`[PlanExecutionManager] Cached plan execution record for rootPlanId: ${e}`)}clearCachedPlanRecord(e){const n=this.planExecutionCache.delete(e);return n&&console.log(`[PlanExecutionManager] Cleared cached plan execution record for rootPlanId: ${e}`),n}clearAllCachedRecords(){const e=this.planExecutionCache.size,n=this.uiStateCache.size;this.planExecutionCache.clear(),this.uiStateCache.clear(),console.log(`[PlanExecutionManager] Cleared all caches - Plans: ${e}, UI States: ${n}`)}static getInstance(){return Be.instance||(Be.instance=new Be),Be.instance}getActivePlanId(){return this.state.activePlanId}getState(){return this.state}setEventCallbacks(e){this.callbacks={...this.callbacks,...e},console.log("[PlanExecutionManager] Event callbacks set:",Object.keys(e))}async handleUserMessageSendRequested(e){if(this.validateAndPrepareUIForNewRequest(e))try{if(await this.sendUserMessageAndSetPlanId(e),this.state.activePlanId)this.initiatePlanExecutionSequence(e,this.state.activePlanId);else throw new Error("Failed to get valid plan ID")}catch(n){console.error("[PlanExecutionManager] Failed to send user message:",n);const t=this.state.activePlanId??"error";this.setCachedUIState(t,{enabled:!0}),this.emitChatInputUpdateState(t),this.state.activePlanId=null}}handlePlanExecutionRequested(e,n){console.log("[PlanExecutionManager] Received plan execution request:",{planId:e,query:n}),e?(this.state.activePlanId=e,this.initiatePlanExecutionSequence(n??"Execute Plan",e)):console.error("[PlanExecutionManager] Invalid plan execution request: missing planId")}handleCachedPlanExecution(e,n){const t=this.getCachedPlanRecord(e);return t!=null&&t.currentPlanId?(console.log(`[PlanExecutionManager] Found cached plan execution record for rootPlanId: ${e}`),this.handlePlanExecutionRequested(t.currentPlanId,n),!0):(console.log(`[PlanExecutionManager] No cached plan execution record found for rootPlanId: ${e}`),!1)}validateAndPrepareUIForNewRequest(e){if(!e)return console.warn("[PlanExecutionManager] Query is empty"),!1;if(this.state.activePlanId)return!1;this.emitChatInputClear();const n=this.state.activePlanId??"ui-state";return this.setCachedUIState(n,{enabled:!1,placeholder:"Processing..."}),this.emitChatInputUpdateState(n),!0}async sendUserMessageAndSetPlanId(e){try{const n=await Ot.sendMessage({input:e});if(n!=null&&n.planId)return this.state.activePlanId=n.planId,n;if(n!=null&&n.planTemplateId)return this.state.activePlanId=n.planTemplateId,{...n,planId:n.planTemplateId};throw console.error("[PlanExecutionManager] Failed to get planId from response:",n),new Error("Failed to get valid planId from API response")}catch(n){throw console.error("[PlanExecutionManager] API call failed:",n),n}}initiatePlanExecutionSequence(e,n){console.log(`[PlanExecutionManager] Starting plan execution sequence for query: "${e}", planId: ${n}`);const t=n;this.emitDialogRoundStart(t),this.startPolling()}handlePlanCompletion(e){this.emitPlanCompleted(e.rootPlanId??""),this.state.lastSequenceSize=0,this.stopPolling();try{setTimeout(async()=>{if(this.state.activePlanId)try{await et.deletePlanTemplate(this.state.activePlanId),console.log(`[PlanExecutionManager] Plan template ${this.state.activePlanId} deleted successfully`)}catch(n){console.log(`Delete plan execution record failed: ${n.message}`)}},5e3)}catch(n){console.log(`Delete plan execution record failed: ${n.message}`)}e.completed&&(this.state.activePlanId=null,this.emitChatInputUpdateState(e.rootPlanId??""))}handlePlanError(e){this.emitPlanError(e.message??""),this.state.lastSequenceSize=0,this.stopPolling();try{setTimeout(async()=>{if(this.state.activePlanId)try{await et.deletePlanTemplate(this.state.activePlanId),console.log(`[PlanExecutionManager] Plan template ${this.state.activePlanId} deleted successfully`)}catch(n){console.log(`Delete plan execution record failed: ${n.message}`)}},5e3)}catch(n){console.log(`Delete plan execution record failed: ${n.message}`)}}async pollPlanStatus(){if(this.state.activePlanId){if(this.state.isPolling){console.log("[PlanExecutionManager] Previous polling still in progress, skipping");return}try{this.state.isPolling=!0;const e=await this.getPlanDetails(this.state.activePlanId);if(!e){console.warn("[PlanExecutionManager] No details received from API - this might be a temporary network issue");return}if(e.status&&e.status==="failed"&&e.message&&!e.message.includes("Failed to get detailed information")){this.handlePlanError(e);return}e.rootPlanId&&this.setCachedPlanRecord(e.rootPlanId,e),this.emitPlanUpdate(e.rootPlanId??""),e.completed&&this.handlePlanCompletion(e)}catch(e){console.error("[PlanExecutionManager] Failed to poll plan status:",e)}finally{this.state.isPolling=!1}}}async getPlanDetails(e){try{const n=await wt.getDetails(e);return n!=null&&n.rootPlanId&&(this.planExecutionCache.set(n.rootPlanId,n),console.log(`[PlanExecutionManager] Cached plan execution record for rootPlanId: ${n.rootPlanId}`)),n}catch(n){return console.error("[PlanExecutionManager] Failed to get plan details:",n),{currentPlanId:e,status:"failed",message:n instanceof Error?n.message:"Failed to get plan"}}}startPolling(){this.state.pollTimer&&clearInterval(this.state.pollTimer),this.state.pollTimer=window.setInterval(()=>{this.pollPlanStatus()},this.POLL_INTERVAL),console.log("[PlanExecutionManager] Started polling")}async pollPlanStatusImmediately(){console.log("[PlanExecutionManager] Polling plan status immediately"),await this.pollPlanStatus()}stopPolling(){this.state.pollTimer&&(clearInterval(this.state.pollTimer),this.state.pollTimer=null),console.log("[PlanExecutionManager] Stopped polling")}cleanup(){this.stopPolling(),this.state.activePlanId=null,this.state.lastSequenceSize=0,this.state.isPolling=!1,this.clearAllCachedRecords()}emitChatInputClear(){this.callbacks.onChatInputClear&&this.callbacks.onChatInputClear()}emitChatInputUpdateState(e){this.callbacks.onChatInputUpdateState&&this.callbacks.onChatInputUpdateState(e)}emitDialogRoundStart(e){this.callbacks.onDialogRoundStart&&this.callbacks.onDialogRoundStart(e)}emitPlanUpdate(e){this.callbacks.onPlanUpdate&&this.callbacks.onPlanUpdate(e)}emitPlanCompleted(e){this.callbacks.onPlanCompleted&&this.callbacks.onPlanCompleted(e)}emitPlanError(e){this.callbacks.onPlanError&&this.callbacks.onPlanError(e)}};ve(Be,"instance",null);let Mt=Be;const xe=Mt.getInstance(),uf={class:"chat-container"},pf={key:0,class:"loading-message"},hf={class:"loading-content"},mf=["title"],ff=pe({__name:"ChatContainer",props:{mode:{default:"plan"},initialPrompt:{default:""}},emits:["step-selected"],setup(o,{expose:e,emit:n}){const t=n,{t:a}=Pe(),{messages:r,isLoading:i,streamingMessageId:h,addMessage:g,updateMessage:u,startStreaming:d,stopStreaming:b,findMessage:A}=rf(),M=U(null),{scrollToBottom:_,autoScrollToBottom:y,showScrollToBottom:v}=cf(M),$=U(),P=C=>h.value===C,S=ue(()=>r.value.map(lf)),I=()=>{},m=C=>{const B=C.target;if(B.classList.contains("md-copy-btn")){const J=B.getAttribute("data-raw");if(J){const oe=decodeURIComponent(J);navigator.clipboard.writeText(oe).then(()=>{B.textContent=a("chat.copied"),setTimeout(()=>{B.textContent=a("chat.copy")},1e3)})}}},q=async C=>{const B=A(C);if(B)try{const J=B.content.replace(/<[^>]*>/g,"");await navigator.clipboard.writeText(J)}catch(J){console.error("Failed to copy message:",J)}},x=C=>{const B=A(C);B&&B.type==="assistant"&&(u(C,{content:""}),d(C))},z=C=>{A(C)&&(u(C,{content:""}),d(C))},R=C=>{console.log("[ChatContainer] Step selected:",C),t("step-selected",C)},F=C=>{console.log("[ChatContainer] Plan update received:",C);const B=xe.getCachedPlanRecord(C);if(!B){console.warn("[ChatContainer] No cached plan data found for rootPlanId:",C);return}console.log("[ChatContainer] Retrieved plan details from cache:",B);const J=r.value.findIndex(oe=>{var ee;return((ee=oe.planExecution)==null?void 0:ee.currentPlanId)===B.currentPlanId&&oe.type==="assistant"});if(J!==-1){const oe=r.value[J],ee={planExecution:JSON.parse(JSON.stringify(B))};if(!B.agentExecutionSequence||B.agentExecutionSequence.length===0){if(console.log("[ChatContainer] Handling simple response without agent execution sequence"),B.completed){ee.thinking="";const ge=B.summary??B.result??B.message??"Execution completed";ee.content=ge,console.log("[ChatContainer] Set simple response content:",ge)}}else console.log("[ChatContainer] Handling detailed plan with agent execution sequence");u(oe.id,ee)}},G=C=>{if(console.log("[ChatContainer] Plan completed:",C),C.rootPlanId){const B=r.value.findIndex(J=>{var oe;return((oe=J.planExecution)==null?void 0:oe.currentPlanId)===C.rootPlanId});if(B!==-1){const J=r.value[B],oe=C.summary??C.result??"Execution completed";u(J.id,{thinking:"",content:oe}),console.log("[ChatContainer] Updated completed message:",oe)}}},Q=C=>{console.log("[ChatContainer] Dialog round start:",C)},E=C=>{console.log("[ChatContainer] Plan error:",C),g("assistant",`Error: ${C}`),console.error("[ChatContainer] Plan execution error:",C)};return we(()=>{de(r,()=>{ke(()=>{y()})},{deep:!0}),xe.setEventCallbacks({onPlanUpdate:F,onPlanCompleted:G,onDialogRoundStart:Q,onPlanError:E})}),Te(()=>{$.value&&clearInterval($.value)}),e({scrollToBottom:_,handlePlanUpdate:F,handlePlanCompleted:G,handleDialogRoundStart:Q,handlePlanError:E,addMessage:g,updateMessage:u,startStreaming:d,stopStreaming:b}),(C,B)=>(p(),f("div",uf,[s("div",{class:"messages",ref_key:"messagesRef",ref:M,onScroll:I,onClick:m},[(p(!0),f(ae,null,ie(S.value,J=>(p(),le(of,{key:J.id,message:J,"is-streaming":P(J.id),onCopy:q,onRegenerate:x,onRetry:z,onStepSelected:R},null,8,["message","is-streaming"]))),128)),l(i)?(p(),f("div",pf,[s("div",hf,[w(l(T),{icon:"carbon:circle-dash",class:"loading-icon"}),s("span",null,c(C.$t("chat.processing")),1)])])):L("",!0)],544),w(qe,{name:"scroll-button"},{default:Fe(()=>[l(v)?(p(),f("button",{key:0,class:"scroll-to-bottom",onClick:B[0]||(B[0]=()=>l(_)()),title:C.$t("chat.scrollToBottom")},[w(l(T),{icon:"carbon:chevron-down"})],8,mf)):L("",!0)]),_:1})]))}}),vf=he(ff,[["__scopeId","data-v-e7a5d6c9"]]);class os{static async uploadFiles(e){try{console.log("[FileUploadApiService] Uploading files:",e.length);const n=new FormData;e.forEach(r=>{n.append("files",r)});const t=await fetch("/api/file-upload/upload",{method:"POST",body:n});if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const a=await t.json();return console.log("[FileUploadApiService] Files uploaded successfully:",a.successfulFiles,"uploadKey:",a.uploadKey),a}catch(n){throw console.error("[FileUploadApiService] Error uploading files:",n),n}}static async getUploadedFiles(e){try{console.log("[FileUploadApiService] Getting uploaded files for uploadKey:",e);const n=await fetch(`/api/file-upload/files/${encodeURIComponent(e)}`);if(!n.ok)throw new Error(`HTTP error! status: ${n.status}`);const t=await n.json();return console.log("[FileUploadApiService] Got uploaded files:",t.totalCount,"for uploadKey:",e),t}catch(n){throw console.error("[FileUploadApiService] Error getting uploaded files:",n),n}}static async deleteFile(e,n){try{console.log("[FileUploadApiService] Deleting file:",n,"from uploadKey:",e);const t=await fetch(`/api/file-upload/files/${encodeURIComponent(e)}/${encodeURIComponent(n)}`,{method:"DELETE",headers:{"Content-Type":"application/json"}});if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const a=await t.json();return console.log("[FileUploadApiService] File deleted successfully:",a.success),a}catch(t){throw console.error("[FileUploadApiService] Error deleting file:",t),t}}static async getUploadConfig(){try{console.log("[FileUploadApiService] Getting upload configuration");const e=await fetch("/api/file-upload/config");if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);const n=await e.json();return console.log("[FileUploadApiService] Got upload configuration:",n),n}catch(e){throw console.error("[FileUploadApiService] Error getting upload configuration:",e),e}}}const gf={class:"input-area"},bf={class:"input-container"},yf=["title"],_f=["placeholder","disabled"],$f=["title"],wf=["disabled","title"],Sf={key:0,class:"uploaded-files"},kf={class:"files-header"},Tf={class:"files-list"},Pf={class:"file-name"},Ef={class:"file-size"},Cf=["onClick","title"],Rf={key:1,class:"upload-progress"},If=pe({__name:"InputArea",props:{placeholder:{default:""},disabled:{type:Boolean,default:!1},initialValue:{default:""}},emits:["send","clear","update-state","plan-mode-clicked"],setup(o,{expose:e,emit:n}){const{t}=Pe(),a=o,r=n,i=U(),h=U(),g=U(""),u=ue(()=>a.placeholder||t("input.placeholder")),d=U(u.value),b=U([]),A=U(!1),M=U(null),_=()=>{console.log("[FileUpload] Resetting session and clearing uploadKey"),b.value=[],M.value=null};Te(()=>{_()}),de(()=>b.value.length,(E,C)=>{});const y=ue(()=>!!a.disabled),v=()=>{ke(()=>{i.value&&(i.value.style.height="auto",i.value.style.height=Math.min(i.value.scrollHeight,120)+"px")})},$=E=>{E.key==="Enter"&&!E.shiftKey&&(E.preventDefault(),P())},P=()=>{if(!g.value.trim()||y.value)return;let E=g.value.trim();if(b.value.length>0){const B=b.value.map(J=>`${J.originalName}`).join(", ");E+=` [Uploaded files: ${B}]`}const C={input:E,memoryId:Ne.selectMemoryId,uploadedFiles:b.value};M.value?(C.uploadKey=M.value,console.log("[InputArea] Including uploadKey in message:",M.value)):console.log("[InputArea] No uploadKey available for message"),r("send",C),R(),b.value=[]},S=()=>{r("plan-mode-clicked")},I=()=>{h.value&&h.value.click()},m=async E=>{const C=E.target,B=C.files;if(!B||B.length===0)return;const J=Array.from(B);console.log("[FileUpload] Selected files for upload:",J.map(oe=>oe.name)),await q(J),C&&(C.value="")},q=async E=>{if(E.length!==0){A.value=!0;try{const C=await os.uploadFiles(E);C.success&&C.uploadedFiles&&(!M.value&&C.uploadKey?(M.value=C.uploadKey,console.log("[FileUpload] Set uploadKey:",M.value),b.value=C.uploadedFiles):M.value?(console.log("[FileUpload] Using existing uploadKey:",M.value),b.value=[...b.value,...C.uploadedFiles]):(console.warn("[FileUpload] No uploadKey returned from upload"),b.value=C.uploadedFiles),C.uploadKey&&(M.value=C.uploadKey,console.log("[Input] Saved uploadKey locally:",C.uploadKey)),console.log("[Input] Updated global uploadedFiles state:",b.value),b.value.length>0&&(d.value=t("input.filesAttached",{count:b.value.length}))),console.log("Files uploaded successfully:",C)}catch(C){console.error("File upload error:",C)}finally{A.value=!1}}},x=async E=>{try{if(console.log("🗑️ Removing file:",E.originalName,"from uploadKey:",M),M.value){const C=await os.deleteFile(M.value,E.originalName);C.success?console.log("✅ File deleted from server successfully"):console.error("❌ Failed to delete file from server:",C.error)}b.value=b.value.filter(C=>C.originalName!==E.originalName),b.value.length===0?(d.value=u.value,console.log("[FileUpload] 🧹 Clearing uploadKey to force new plan for new files"),M.value=null):d.value=t("input.filesAttached",{count:b.value.length}),console.log("🎉 File removal completed, remaining files:",b.value.length)}catch(C){console.error("❌ Error removing file:",C),alert(t("input.fileDeleteError")||"Failed to delete file")}},z=E=>{if(E===0)return"0 Bytes";const C=1024,B=["Bytes","KB","MB","GB"],J=Math.floor(Math.log(E)/Math.log(C));return parseFloat((E/Math.pow(C,J)).toFixed(2))+" "+B[J]},R=()=>{g.value="",v(),r("clear")},F=(E,C)=>{C&&(d.value=E?C:t("input.waiting")),r("update-state",E,C)},G=E=>{g.value=E,v()},Q=()=>g.value.trim();return de(()=>a.initialValue,E=>{E&&E.trim()&&(g.value=E,v())},{immediate:!0}),e({clearInput:R,updateState:F,setInputValue:G,getQuery:Q,resetSession:_,focus:()=>{var E;return(E=i.value)==null?void 0:E.focus()},uploadedFiles:b,uploadKey:M}),we(()=>{}),Te(()=>{}),(E,C)=>(p(),f("div",gf,[s("div",bf,[s("button",{class:"attach-btn",title:E.$t("input.attachFile"),onClick:I},[w(l(T),{icon:"carbon:attachment"})],8,yf),s("input",{ref_key:"fileInputRef",ref:h,type:"file",multiple:"",style:{display:"none"},onChange:m,accept:".pdf,.txt,.md,.doc,.docx,.csv,.xlsx,.xls,.json,.xml,.html,.htm,.log,.java,.py,.js,.ts,.sql,.sh,.bat,.yaml,.yml,.properties,.conf,.ini"},null,544),te(s("textarea",{"onUpdate:modelValue":C[0]||(C[0]=B=>g.value=B),ref_key:"inputRef",ref:i,class:"chat-input",placeholder:d.value,disabled:y.value,onKeydown:$,onInput:v},null,40,_f),[[re,g.value]]),s("button",{class:"plan-mode-btn",title:E.$t("input.planMode"),onClick:S},[w(l(T),{icon:"carbon:document"}),se(" "+c(E.$t("input.planMode")),1)],8,$f),s("button",{class:"send-button",disabled:!g.value.trim()||y.value,onClick:P,title:E.$t("input.send")},[w(l(T),{icon:"carbon:send-alt"}),se(" "+c(E.$t("input.send")),1)],8,wf)]),b.value.length>0?(p(),f("div",Sf,[s("div",kf,[w(l(T),{icon:"carbon:document"}),s("span",null,c(l(t)("input.attachedFiles"))+" ("+c(b.value.length)+")",1)]),s("div",Tf,[(p(!0),f(ae,null,ie(b.value,B=>(p(),f("div",{key:B.originalName,class:"file-item"},[w(l(T),{icon:"carbon:document",class:"file-icon"}),s("span",Pf,c(B.originalName),1),s("span",Ef,"("+c(z(B.size))+")",1),s("button",{onClick:J=>x(B),class:"remove-btn",title:l(t)("input.removeFile")},[w(l(T),{icon:"carbon:close"})],8,Cf)]))),128))])])):L("",!0),A.value?(p(),f("div",Rf,[w(l(T),{icon:"carbon:rotate--clockwise",class:"loading-icon"}),s("span",null,c(l(t)("input.uploading")),1)])):L("",!0)]))}}),Af=he(If,[["__scopeId","data-v-e6c4da38"]]);class He{static async getAllCronTasks(){try{const e=await fetch(this.BASE_URL);return await(await this.handleResponse(e)).json()}catch(e){throw console.error("Failed to get cron tasks:",e),e}}static async getCronTaskById(e){try{const n=await fetch(`${this.BASE_URL}/${e}`);return await(await this.handleResponse(n)).json()}catch(n){throw console.error("Failed to get cron task by id:",n),n}}static async createCronTask(e){try{const n=await fetch(this.BASE_URL,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});return await(await this.handleResponse(n)).json()}catch(n){throw console.error("Failed to create cron task:",n),n}}static async updateCronTask(e,n){try{const t=await fetch(`${this.BASE_URL}/${e}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});return await(await this.handleResponse(t)).json()}catch(t){throw console.error("Failed to update cron task:",t),t}}static async updateTaskStatus(e,n){try{const t=await fetch(`${this.BASE_URL}/${e}/status?status=${n}`,{method:"PUT"});await this.handleResponse(t)}catch(t){throw console.error("Failed to update task status:",t),t}}static async deleteCronTask(e){try{const n=await fetch(`${this.BASE_URL}/${e}`,{method:"DELETE"});await this.handleResponse(n)}catch(n){throw console.error("Failed to delete cron task:",n),n}}static async handleResponse(e){if(!e.ok)try{const n=await e.json();throw new Error(n.message||`API request failed: ${e.status}`)}catch{throw new Error(`API request failed: ${e.status} ${e.statusText}`)}return e}}ve(He,"BASE_URL","/api/cron-tasks");const Ge={validateCronExpression(o){const e=o.trim().split(/\s+/);return e.length>=5&&e.length<=6},formatTime(o){return new Date(o).toLocaleString()},async saveTask(o){try{let e;return o.id?e=await He.updateCronTask(Number(o.id),o):e=await He.createCronTask(o),e}catch(e){throw console.error("Failed to save cron task:",e),e}},async deleteTask(o){try{await He.deleteCronTask(String(o))}catch(e){throw console.error("Failed to delete cron task:",e),e}},async toggleTaskStatus(o){if(!o.id)throw new Error("Task ID is required");const e=o.status===0?1:0;return await He.updateCronTask(Number(o.id),{...o,status:e})},prepareTaskExecution(o){return o.planTemplateId?{useTemplate:!0,planData:{title:o.cronName||"Scheduled Task Execution",planData:{id:o.planTemplateId,planTemplateId:o.planTemplateId,planId:o.planTemplateId},params:o.executionParams||void 0}}:{useTemplate:!1,taskContent:o.planDesc||o.cronName||""}}},Df={class:"modal-header"},xf={class:"header-actions"},Mf={class:"status-switch"},Ff={class:"status-label"},Uf={class:"toggle-switch"},Nf=["checked"],Lf={class:"modal-content"},Bf={class:"form-group"},Of={class:"form-label"},qf=["placeholder"],jf={class:"form-group"},Vf={class:"form-label"},Hf=["placeholder"],Gf={class:"form-help"},Wf={class:"form-group"},zf={class:"form-label"},Jf=["placeholder"],Kf={class:"form-group"},Xf={class:"form-label"},Yf={class:"template-toggle"},Qf={key:0,class:"template-selector"},Zf={value:""},ev=["value"],tv={class:"form-help"},sv={key:0,class:"form-group"},nv={class:"time-info"},ov={class:"time-label"},av={class:"time-value"},lv={key:1,class:"form-group"},rv={class:"time-info"},iv={class:"time-label"},cv={class:"time-value"},dv={class:"modal-footer"},uv=["disabled"],pv=pe({__name:"TaskDetailModal",props:{modelValue:{type:Boolean},task:{}},emits:["update:modelValue","save"],setup(o,{emit:e}){const n=o,t=e,a=U(!1),r=U([]),i=U({cronName:"",cronTime:"",planDesc:"",status:1,linkTemplate:!1,templateId:"",planTemplateId:""}),h=async()=>{try{const _=await et.getAllPlanTemplates();_&&_.templates&&(r.value=_.templates.map(y=>({id:y.id,name:y.title||"Unnamed Template"})))}catch(_){console.error("Failed to get template list:",_)}},g=_=>{_.key==="Escape"&&n.modelValue&&t("update:modelValue",!1)};we(()=>{h(),document.addEventListener("keydown",g)}),Te(()=>{document.removeEventListener("keydown",g)});const u=_=>{_.target===_.currentTarget&&t("update:modelValue",!1)},d=()=>{i.value.linkTemplate=!1,i.value.templateId="",i.value.planTemplateId=""},b=()=>i.value.cronName.trim()?i.value.cronTime.trim()?Ge.validateCronExpression(i.value.cronTime)?i.value.planDesc.trim()?i.value.linkTemplate&&!i.value.templateId?(alert("Please select a plan template"),!1):!0:(alert("Task description cannot be empty"),!1):(alert("Invalid Cron expression format, should be 5-6 parts separated by spaces"),!1):(alert("Cron expression cannot be empty"),!1):(alert("Task name cannot be empty"),!1),A=_=>Ge.formatTime(_),M=async()=>{var _;if(b()){a.value=!0;try{const y={...i.value,...((_=n.task)==null?void 0:_.id)!==void 0&&{id:n.task.id},cronName:i.value.cronName.trim(),cronTime:i.value.cronTime.trim(),planDesc:i.value.planDesc.trim(),status:i.value.status,planTemplateId:i.value.linkTemplate&&i.value.templateId||""};t("save",y)}finally{a.value=!1}}};return de(()=>n.task,_=>{if(_){const y=_.templateId||_.planTemplateId||"";i.value={cronName:_.cronName||"",cronTime:_.cronTime||"",planDesc:_.planDesc||"",status:_.status??1,linkTemplate:!!y,templateId:y,planTemplateId:y}}else i.value={cronName:"",cronTime:"",planDesc:"",status:1,linkTemplate:!1,templateId:"",planTemplateId:""}},{immediate:!0}),de(()=>n.modelValue,_=>{_||(i.value={cronName:"",cronTime:"",planDesc:"",status:1,linkTemplate:!1,templateId:"",planTemplateId:""})}),(_,y)=>(p(),le(Qe,{to:"body"},[w(qe,{name:"modal"},{default:Fe(()=>{var v,$,P;return[_.modelValue?(p(),f("div",{key:0,class:"modal-overlay",onClick:u},[s("div",{class:"modal-container",onClick:y[8]||(y[8]=me(()=>{},["stop"]))},[s("div",Df,[s("h3",null,c(_.$t("cronTask.taskDetail")),1),s("div",xf,[s("div",Mf,[s("span",Ff,c(_.$t("cronTask.taskStatus")),1),s("label",Uf,[s("input",{type:"checkbox",checked:i.value.status===0,onChange:y[0]||(y[0]=S=>i.value.status=i.value.status===0?1:0)},null,40,Nf),y[9]||(y[9]=s("span",{class:"toggle-slider"},null,-1))])]),s("button",{class:"close-btn",onClick:y[1]||(y[1]=S=>_.$emit("update:modelValue",!1))},[w(l(T),{icon:"carbon:close"})])])]),s("div",Lf,[s("form",{onSubmit:me(M,["prevent"]),class:"task-form"},[s("div",Bf,[s("label",Of,c(_.$t("cronTask.taskName")),1),te(s("input",{"onUpdate:modelValue":y[2]||(y[2]=S=>i.value.cronName=S),type:"text",class:"form-input",placeholder:_.$t("cronTask.taskNamePlaceholder"),required:""},null,8,qf),[[re,i.value.cronName]])]),s("div",jf,[s("label",Vf,c(_.$t("cronTask.cronExpression")),1),te(s("input",{"onUpdate:modelValue":y[3]||(y[3]=S=>i.value.cronTime=S),type:"text",class:"form-input",placeholder:_.$t("cronTask.cronExpressionPlaceholder"),required:""},null,8,Hf),[[re,i.value.cronTime]]),s("div",Gf,c(_.$t("cronTask.cronExpressionHelp")),1)]),s("div",Wf,[s("label",zf,c(_.$t("cronTask.taskDescription")),1),te(s("textarea",{"onUpdate:modelValue":y[4]||(y[4]=S=>i.value.planDesc=S),class:"form-textarea",placeholder:_.$t("cronTask.taskDescriptionPlaceholder"),rows:"4",required:""},null,8,Jf),[[re,i.value.planDesc]])]),s("div",Kf,[s("label",Xf,c(_.$t("cronTask.planTemplate")),1),s("div",Yf,[s("button",{type:"button",class:ne(["template-btn",i.value.linkTemplate?"active":""]),onClick:y[5]||(y[5]=S=>i.value.linkTemplate=!0)},[w(l(T),{icon:"carbon:checkmark"}),se(" "+c(_.$t("cronTask.linkTemplate")),1)],2),s("button",{type:"button",class:ne(["template-btn",i.value.linkTemplate?"":"active"]),onClick:d},[w(l(T),{icon:"carbon:close"}),se(" "+c(_.$t("cronTask.noTemplate")),1)],2)]),i.value.linkTemplate?(p(),f("div",Qf,[te(s("select",{"onUpdate:modelValue":y[6]||(y[6]=S=>i.value.templateId=S),class:"form-select"},[s("option",Zf,c(_.$t("cronTask.selectTemplate")),1),(p(!0),f(ae,null,ie(r.value,S=>(p(),f("option",{key:S.id,value:S.id},c(S.name),9,ev))),128))],512),[[nt,i.value.templateId]]),s("div",tv,c(_.$t("cronTask.templateHelpText")),1)])):L("",!0)]),(v=_.task)!=null&&v.createTime?(p(),f("div",sv,[s("div",nv,[s("span",ov,c(_.$t("cronTask.createTime"))+":",1),s("span",av,c(A(_.task.createTime)),1)])])):L("",!0),($=_.task)!=null&&$.updateTime?(p(),f("div",lv,[s("div",rv,[s("span",iv,c(_.$t("cronTask.updateTime"))+":",1),s("span",cv,c(A(_.task.updateTime)),1)])])):L("",!0)],32)]),s("div",dv,[s("button",{type:"button",class:"cancel-btn",onClick:y[7]||(y[7]=S=>_.$emit("update:modelValue",!1))},c(_.$t("common.cancel")),1),s("button",{type:"button",class:"save-btn",onClick:M,disabled:a.value},[a.value?(p(),le(l(T),{key:0,icon:"carbon:loading",class:"loading-icon"})):L("",!0),se(" "+c((P=n.task)!=null&&P.id?_.$t("common.save"):_.$t("common.create")),1)],8,uv)])])])):L("",!0)]}),_:1})]))}}),hv=he(pv,[["__scopeId","data-v-45bbcf14"]]),mv={class:"modal-header"},fv={class:"header-actions"},vv={class:"modal-content"},gv={key:0,class:"loading-container"},bv={key:1,class:"empty-container"},yv={key:2,class:"task-list"},_v=["onClick"],$v={class:"task-main"},wv={class:"task-info"},Sv={class:"task-header"},kv={class:"task-name"},Tv={class:"task-description"},Pv={class:"task-time"},Ev=["onClick"],Cv=["onClick","disabled","title"],Rv=["onClick","title"],Iv={class:"dropdown-menu"},Av=["onClick"],Dv=["onClick","disabled"],xv=["onClick","disabled"],Mv={class:"confirm-header"},Fv={class:"confirm-content"},Uv={class:"confirm-actions"},Nv=["disabled"],Lv={class:"confirm-header"},Bv={class:"confirm-content"},Ov={class:"create-options"},qv={class:"option-content"},jv={class:"option-title"},Vv={class:"option-desc"},Hv={class:"option-content"},Gv={class:"option-title"},Wv={class:"option-desc"},zv={class:"confirm-actions"},Jv=pe({__name:"CronTaskModal",props:{modelValue:{type:Boolean,required:!0}},emits:["update:modelValue"],setup(o,{emit:e}){const n=is(),t=cs(),a=ds(),{t:r}=Pe(),i=o,h=e,g=U([]),u=U(!1),d=U(null),b=U(null),A=U(null),M=U(null),_=U(!1),y=U(null),v=U(!1),$=U(null),P=U(!1),S=W=>{W.target===W.currentTarget&&h("update:modelValue",!1)},I=async()=>{u.value=!0;try{g.value=await He.getAllCronTasks()}catch(W){console.error("Failed to load cron tasks:",W),a.error(`Failed to load tasks: ${W instanceof Error?W.message:String(W)}`)}finally{u.value=!1}},m=async W=>{d.value=W;try{const k=g.value.find(O=>O.id===W);if(!k){console.error("Task not found:",W);return}h("update:modelValue",!1);const j=Date.now().toString();await n.push({name:"direct",params:{id:j}}),await new Promise(O=>setTimeout(O,100));const N=Ge.prepareTaskExecution(k);N.useTemplate&&N.planData?t.emitPlanExecutionRequested(N.planData):N.taskContent&&t.setTask(N.taskContent)}catch(k){console.error("Failed to execute task:",k),a.error(`Execution failed: ${k instanceof Error?k.message:String(k)}`)}finally{d.value=null}},q=W=>{y.value={...W},_.value=!0,M.value=null},x=async W=>{try{await Ge.saveTask(W),await I(),_.value=!1,a.success("Task saved successfully")}catch(k){console.error("Failed to save task:",k),a.error(`Save failed: ${k instanceof Error?k.message:String(k)}`)}},z=W=>{$.value=W,v.value=!0},R=async()=>{var W;if((W=$.value)!=null&&W.id){b.value=$.value.id;try{await Ge.deleteTask($.value.id),await I(),v.value=!1,$.value=null,a.success("Task deleted successfully")}catch(k){console.error("Failed to delete task:",k),a.error(`Delete failed: ${k instanceof Error?k.message:String(k)}`)}finally{b.value=null}}},F=()=>{v.value=!1,$.value=null},G=W=>{M.value=M.value===W?null:W},Q=async W=>{if(W.id){A.value=W.id;try{await Ge.toggleTaskStatus(W),await I(),M.value=null,a.success(`Task ${W.status===0?"disabled":"enabled"} successfully`)}catch(k){console.error("Failed to toggle task status:",k),a.error(`Status toggle failed: ${k instanceof Error?k.message:String(k)}`)}finally{A.value=null}}},E=async W=>{try{await navigator.clipboard.writeText(W),a.success("Cron expression copied successfully")}catch(k){a.error(`Copy failed: ${k instanceof Error?k.message:String(k)}`)}},C=()=>{P.value=!0},B=()=>{P.value=!1;try{h("update:modelValue",!1);const W=r("cronTask.template");t.setTaskToInput(W);const k=Date.now().toString();n.push({name:"direct",params:{id:k}})}catch(W){console.error("Error in createWithJmanus:",W),a.error(`Creation failed: ${W instanceof Error?W.message:String(W)}`)}},J=()=>{P.value=!1,y.value={cronName:"",cronTime:"",planDesc:"",status:0,planTemplateId:""},_.value=!0},oe=()=>{P.value=!1},ee=W=>{const k=W.target;!k.closest(".action-dropdown")&&!k.closest(".dropdown-menu")&&(M.value=null)},ge=W=>{W.key==="Escape"&&(v.value?F():P.value?oe():i.modelValue&&h("update:modelValue",!1))};return we(()=>{document.addEventListener("click",ee,!0),document.addEventListener("keydown",ge)}),Te(()=>{document.removeEventListener("click",ee,!0),document.removeEventListener("keydown",ge)}),de(()=>i.modelValue,W=>{W&&I()}),(W,k)=>(p(),f(ae,null,[(p(),le(Qe,{to:"body"},[w(qe,{name:"modal"},{default:Fe(()=>[o.modelValue?(p(),f("div",{key:0,class:"modal-overlay",onClick:S},[s("div",{class:"modal-container",onClick:k[3]||(k[3]=me(()=>{},["stop"]))},[s("div",mv,[s("h3",null,c(W.$t("cronTask.title")),1),s("div",fv,[s("button",{class:"add-task-btn",onClick:[C,k[0]||(k[0]=me(()=>{},["stop"]))]},[w(l(T),{icon:"carbon:add"}),se(" "+c(W.$t("cronTask.addTask")),1)]),s("button",{class:"close-btn",onClick:k[1]||(k[1]=j=>W.$emit("update:modelValue",!1))},[w(l(T),{icon:"carbon:close"})])])]),s("div",vv,[u.value?(p(),f("div",gv,[w(l(T),{icon:"carbon:loading",class:"loading-icon"}),s("span",null,c(W.$t("common.loading")),1)])):g.value.length===0?(p(),f("div",bv,[w(l(T),{icon:"carbon:time",class:"empty-icon"}),s("span",null,c(W.$t("cronTask.noTasks")),1)])):(p(),f("div",yv,[(p(!0),f(ae,null,ie(g.value,j=>(p(),f("div",{key:j.id||"",class:"task-item",onClick:N=>q(j)},[s("div",$v,[s("div",wv,[s("div",Sv,[s("div",kv,c(j.cronName),1),s("div",{class:ne(["task-status-badge",j.status===0?"active":"inactive"])},[w(l(T),{icon:j.status===0?"carbon:checkmark-filled":"carbon:pause-filled"},null,8,["icon"]),s("span",null,c(j.status===0?W.$t("cronTask.active"):W.$t("cronTask.inactive")),1)],2)]),s("div",Tv,c(j.planDesc),1),s("div",Pv,[w(l(T),{icon:"carbon:time"}),s("span",{class:"cron-readable",style:{cursor:"pointer"},onClick:me(N=>E(j.cronTime),["stop"])},c(j.cronTime),9,Ev)])])]),s("div",{class:"task-actions",onClick:k[2]||(k[2]=me(()=>{},["stop"]))},[s("button",{class:"action-btn execute-btn",onClick:N=>m(j.id),disabled:d.value===j.id,title:W.$t("cronTask.executeOnce")},[w(l(T),{icon:d.value===j.id?"carbon:loading":"carbon:play-filled"},null,8,["icon"]),se(" "+c(W.$t("cronTask.executeOnce")),1)],8,Cv),s("div",{class:ne(["action-dropdown",{active:M.value===j.id}])},[s("button",{class:"action-btn dropdown-btn",onClick:N=>G(j.id),title:W.$t("cronTask.operations")},[w(l(T),{icon:"carbon:overflow-menu-horizontal"}),se(" "+c(W.$t("cronTask.operations")),1)],8,Rv),te(s("div",Iv,[s("button",{class:"dropdown-item edit-btn",onClick:N=>q(j)},[w(l(T),{icon:"carbon:edit"}),se(" "+c(W.$t("cronTask.edit")),1)],8,Av),s("button",{class:"dropdown-item toggle-btn",onClick:N=>Q(j),disabled:A.value===j.id},[w(l(T),{icon:A.value===j.id?"carbon:loading":j.status===0?"carbon:pause-filled":"carbon:play-filled"},null,8,["icon"]),se(" "+c(j.status===0?W.$t("cronTask.disable"):W.$t("cronTask.enable")),1)],8,Dv),s("button",{class:"dropdown-item delete-btn",onClick:N=>z(j),disabled:b.value===j.id},[w(l(T),{icon:b.value===j.id?"carbon:loading":"carbon:trash-can"},null,8,["icon"]),se(" "+c(W.$t("cronTask.delete")),1)],8,xv)],512),[[as,M.value===j.id]])],2)])],8,_v))),128))]))])])])):L("",!0)]),_:1})])),w(hv,{modelValue:_.value,"onUpdate:modelValue":k[4]||(k[4]=j=>_.value=j),task:y.value,onSave:x},null,8,["modelValue","task"]),(p(),le(Qe,{to:"body"},[w(qe,{name:"modal"},{default:Fe(()=>{var j,N,O,K;return[v.value?(p(),f("div",{key:0,class:"modal-overlay",onClick:F},[s("div",{class:"confirm-modal",onClick:k[5]||(k[5]=me(()=>{},["stop"]))},[s("div",Mv,[w(l(T),{icon:"carbon:warning",class:"warning-icon"}),s("h3",null,c(W.$t("cronTask.deleteConfirm")),1)]),s("div",Fv,[s("p",null,c(W.$t("cronTask.deleteConfirmMessage",{taskName:((j=$.value)==null?void 0:j.cronName)||((N=$.value)==null?void 0:N.planDesc)||""})),1)]),s("div",Uv,[s("button",{class:"confirm-btn cancel-btn",onClick:F},c(W.$t("common.cancel")),1),s("button",{class:"confirm-btn delete-btn",onClick:R,disabled:b.value===((O=$.value)==null?void 0:O.id)},[w(l(T),{icon:b.value===((K=$.value)==null?void 0:K.id)?"carbon:loading":"carbon:trash-can"},null,8,["icon"]),se(" "+c(W.$t("cronTask.delete")),1)],8,Nv)])])])):L("",!0)]}),_:1})])),(p(),le(Qe,{to:"body"},[w(qe,{name:"modal"},{default:Fe(()=>[P.value?(p(),f("div",{key:0,class:"modal-overlay",onClick:oe},[s("div",{class:"confirm-modal create-options-modal",onClick:k[6]||(k[6]=me(()=>{},["stop"]))},[s("div",Lv,[w(l(T),{icon:"carbon:time",class:"create-icon"}),s("h3",null,c(W.$t("cronTask.createTask")),1)]),s("div",Bv,[s("p",null,c(W.$t("cronTask.selectCreateMethod")),1),s("div",Ov,[s("button",{class:"create-option-btn jmanus-btn",onClick:B},[w(l(T),{icon:"carbon:ai-status"}),s("div",qv,[s("span",jv,c(W.$t("cronTask.createWithJmanus")),1),s("span",Vv,c(W.$t("cronTask.createWithJmanusDesc")),1)])]),s("button",{class:"create-option-btn manual-btn",onClick:J},[w(l(T),{icon:"carbon:edit"}),s("div",Hv,[s("span",Gv,c(W.$t("cronTask.createManually")),1),s("span",Wv,c(W.$t("cronTask.createManuallyDesc")),1)])])])]),s("div",zv,[s("button",{class:"confirm-btn cancel-btn",onClick:oe},c(W.$t("common.cancel")),1)])])])):L("",!0)]),_:1})]))],64))}}),Kv=he(Jv,[["__scopeId","data-v-a90a3961"]]),Xv={class:"direct-page"},Yv={class:"direct-chat"},Qv={class:"chat-header"},Zv={class:"header-actions"},eg=["title"],tg=["title"],sg=["title"],ng=["title"],og={class:"chat-content"},ag=["title"],lg={class:"message-content"},rg=pe({__name:"index",setup(o){const e=Vs(),n=is(),t=cs(),{t:a}=Pe(),{message:r}=Js(),i=U(""),h=U(""),g=U(),u=U(),d=U(),b=U(),A=U(!1),M=U(!1),_=U(null),y=U(!1),v=U(50),$=U(!1),P=U(0),S=U(0),I=ue(()=>{if(H.isCollapsed)return v.value;let N=26;b.value&&b.value.sidebarWidth!==void 0&&(N=b.value.sidebarWidth);const O=100-N;return Math.max(20,Math.min(O,v.value))});we(()=>{if(console.log("[Direct] onMounted called"),console.log("[Direct] taskStore.currentTask:",t.currentTask),console.log("[Direct] taskStore.hasUnprocessedTask():",t.hasUnprocessedTask()),xe.setEventCallbacks({onPlanUpdate:O=>{console.log("[Direct] Plan update event received for rootPlanId:",O),R(O)&&(console.log("[Direct] Processing plan update for current rootPlanId:",O),u.value&&typeof u.value.handlePlanUpdate=="function"?(console.log("[Direct] Calling chatRef.handlePlanUpdate with rootPlanId:",O),u.value.handlePlanUpdate(O)):console.warn("[Direct] chatRef.handlePlanUpdate method not available"),g.value&&typeof g.value.updateDisplayedPlanProgress=="function"?(console.log("[Direct] Calling rightPanelRef.updateDisplayedPlanProgress with rootPlanId:",O),g.value.updateDisplayedPlanProgress(O)):console.warn("[Direct] rightPanelRef.updateDisplayedPlanProgress method not available"))},onPlanCompleted:O=>{if(console.log("[Direct] Plan completed event received for rootPlanId:",O),!!R(O)){if(console.log("[Direct] Processing plan completion for current rootPlanId:",O),u.value&&typeof u.value.handlePlanCompleted=="function"){const K=xe.getCachedPlanRecord(O);K&&K.completed?K.summary&&K.summary.trim().length>0?(console.log("[Direct]  Plan details are valid and complete from polling cache, updating UI"),u.value.handlePlanCompleted(K)):(console.warn("[Direct]  Plan completed but summary is empty, still proceeding with available data"),u.value.handlePlanCompleted(K)):(console.warn("[Direct]  Plan details incomplete in cache, attempting API fallback"),wt.getDetails(O).then(ce=>{console.log("[Direct]  Got fresh details from API:",ce),ce&&ce.completed?(console.log("[Direct] Fresh details from API are valid, updating UI"),xe.setCachedPlanRecord(O,ce),u.value.handlePlanCompleted(ce)):(console.warn("[Direct]  API details also incomplete, using best available data"),u.value.handlePlanCompleted(K??{planId:O}))}).catch(ce=>{console.error("[Direct] API call failed (likely record deleted), using cached data:",ce),u.value.handlePlanCompleted(K??{planId:O})}))}else console.warn("[Direct] chatRef.handlePlanCompleted method not available");_.value=null,console.log("[Direct] 🧹 Cleared currentRootPlanId after plan completion"),d.value&&typeof d.value.resetSession=="function"&&(console.log("[Direct] 🧹 Calling inputRef.resetSession to clear sessionPlanId"),d.value.resetSession())}},onDialogRoundStart:O=>{console.log("[Direct] Dialog round start event received for rootPlanId:",O),_.value=O,console.log("[Direct] Set currentRootPlanId to:",O),u.value&&typeof u.value.handleDialogRoundStart=="function"?(console.log("[Direct] Calling chatRef.handleDialogRoundStart with planId:",O),u.value.handleDialogRoundStart(O)):console.warn("[Direct] chatRef.handleDialogRoundStart method not available")},onChatInputClear:()=>{console.log("[Direct] Chat input clear event received"),Q()},onChatInputUpdateState:O=>{if(console.log("[Direct] Chat input update state event received for rootPlanId:",O),!R(O,!0))return;const K=xe.getCachedUIState(O);K&&C(K.enabled,K.placeholder)},onPlanError:O=>{u.value.handlePlanError(O)}}),console.log("[Direct] Event callbacks registered to planExecutionManager"),H.loadPlanTemplateList(),t.hasUnprocessedTask()&&t.currentTask){const O=t.currentTask.prompt;console.log("[Direct] Found unprocessed task from store:",O),t.markTaskAsProcessed(),ke(async()=>{try{console.log("[Direct] Calling handleChatSendMessage with taskContent:",O),await F({input:O})}catch(K){console.warn("[Direct] handleChatSendMessage failed, falling back to prompt:",K),i.value=O}})}else{const O=t.getAndClearTaskToInput();O?(h.value=O,console.log("[Direct] Setting inputOnlyContent for input only:",h.value)):(i.value=e.query.prompt||"",console.log("[Direct] Received task from URL:",i.value),console.log("[Direct] No unprocessed task in store"))}const N=localStorage.getItem("directPanelWidth");N&&(v.value=parseFloat(N)),console.log("[Direct] Final prompt value:",i.value),h.value&&ke(()=>{d.value&&typeof d.value.setInputValue=="function"&&(d.value.setInputValue(h.value),console.log("[Direct] Set input value:",h.value),h.value="")}),window.addEventListener("plan-execution-requested",O=>{console.log("[DirectView] Received plan-execution-requested event:",O.detail),W(O.detail)})}),de(()=>t.currentTask,N=>{if(console.log("[Direct] Watch taskStore.currentTask triggered, newTask:",N),N&&!N.processed){const O=N.prompt;t.markTaskAsProcessed(),console.log("[Direct] Received new task from store:",O),ke(async()=>{try{console.log("[Direct] Directly executing new task via handleChatSendMessage:",O),await F({input:O})}catch(K){console.warn("[Direct] handleChatSendMessage failed for new task:",K)}})}else console.log("[Direct] Task is null or already processed, ignoring")},{immediate:!1}),de(()=>i.value,(N,O)=>{console.log("[Direct] prompt value changed from:",O,"to:",N)},{immediate:!1}),de(()=>t.taskToInput,N=>{console.log("[Direct] Watch taskStore.taskToInput triggered, newTaskToInput:",N),N!=null&&N.trim()&&(console.log("[Direct] Setting input value from taskToInput:",N),ke(()=>{d.value&&typeof d.value.setInputValue=="function"&&(d.value.setInputValue(N.trim()),console.log("[Direct] Input value set from taskToInput watch:",N.trim()),t.getAndClearTaskToInput())}))},{immediate:!1}),Te(()=>{console.log("[Direct] onUnmounted called, cleaning up resources"),_.value=null,xe.cleanup(),document.removeEventListener("mousemove",q),document.removeEventListener("mouseup",x),window.removeEventListener("plan-execution-requested",N=>{W(N.detail)})});const m=N=>{$.value=!0,P.value=N.clientX,S.value=v.value,document.addEventListener("mousemove",q),document.addEventListener("mouseup",x),document.body.style.cursor="col-resize",document.body.style.userSelect="none",N.preventDefault()},q=N=>{if(!$.value)return;const O=window.innerWidth,ce=(N.clientX-P.value)/O*100;let V=S.value+ce;V=Math.max(20,Math.min(80,V)),v.value=V},x=()=>{$.value=!1,document.removeEventListener("mousemove",q),document.removeEventListener("mouseup",x),document.body.style.cursor="",document.body.style.userSelect="",localStorage.setItem("directPanelWidth",v.value.toString())},z=()=>{v.value=50,localStorage.setItem("directPanelWidth","50")},R=(N,O=!1)=>!_.value||N===_.value||O&&(N==="ui-state"||N==="error")?!0:(console.log("[Direct] Ignoring event for non-current rootPlanId:",N,"current:",_.value),!1),F=async N=>{var K,ce,V,Y,X,ye,De,Ke,Xe;let O=null;try{console.log("[DirectView] Processing send-message event:",N);const Ie=(K=u.value)==null?void 0:K.addMessage("user",N.input);N.attachments&&Ie&&((ce=u.value)==null||ce.updateMessage(Ie.id,{attachments:N.attachments})),O=(V=u.value)==null?void 0:V.addMessage("assistant","",{thinking:a("chat.thinkingProcessing")}),O&&((Y=u.value)==null||Y.startStreaming(O.id));const{DirectApiService:lt}=await Hs(async()=>{const{DirectApiService:rt}=await Promise.resolve().then(()=>df);return{DirectApiService:rt}},void 0);console.log("[DirectView] Calling DirectApiService.sendMessageWithDefaultPlan");const Ee=await lt.sendMessageWithDefaultPlan(N);console.log("[DirectView] API response received:",Ee),Ee.planId&&O?((X=u.value)==null||X.updateMessage(O.id,{thinking:a("chat.planningExecution"),planExecution:{currentPlanId:Ee.planId,rootPlanId:Ee.planId,status:"running"}}),_.value=Ee.planId,console.log("[DirectView] Set currentRootPlanId to:",Ee.planId),xe.handlePlanExecutionRequested(Ee.planId,N.input),console.log("[DirectView] Started polling for plan execution updates")):O&&((ye=u.value)==null||ye.updateMessage(O.id,{content:Ee.message||Ee.result||"No response received from backend"}),(De=u.value)==null||De.stopStreaming(O.id))}catch(Ie){console.error("[DirectView] Send message failed:",Ie),(Ke=u.value)==null||Ke.addMessage("assistant",`Error: ${(Ie==null?void 0:Ie.message)||"Failed to send message"}`),O&&((Xe=u.value)==null||Xe.stopStreaming(O.id))}},G=async N=>{console.log("[DirectView] Send message from input:",JSON.stringify(N)),await F(N)},Q=()=>{console.log("[DirectView] Input cleared"),d.value&&typeof d.value.clear=="function"&&d.value.clear()},E=()=>{console.log("[DirectView] Input focused")},C=(N,O)=>{console.log("[DirectView] Input state updated:",N,O),M.value=!N},B=N=>{console.log("[DirectView] Step selected:",N),g.value&&typeof g.value.handleStepSelected=="function"?(console.log("[DirectView] Forwarding step selection to right panel:",N),g.value.handleStepSelected(N)):console.warn("[DirectView] rightPanelRef.handleStepSelected method not available")},J=(N,O,K,ce)=>{console.log("[DirectView] Sub plan step selected:",{parentPlanId:N,subPlanId:O,stepIndex:K,subStepIndex:ce}),g.value&&typeof g.value.handleSubPlanStepSelected=="function"?(console.log("[DirectView] Forwarding sub plan step selection to right panel:",{parentPlanId:N,subPlanId:O,stepIndex:K,subStepIndex:ce}),g.value.handleSubPlanStepSelected(N,O,K,ce)):console.warn("[DirectView] rightPanelRef.handleSubPlanStepSelected method not available")},oe=()=>{console.log("[DirectView] Plan mode button clicked"),H.toggleSidebar(),console.log("[DirectView] Sidebar toggled, isCollapsed:",H.isCollapsed)},ee=()=>{n.push("/home")},ge=()=>{n.push("/configs")},W=async N=>{var ce,V,Y,X,ye,De,Ke,Xe,Ie,lt,Ee,rt,qt,jt;if(console.log("[DirectView] Plan execution requested:",N),A.value){console.log("[DirectView] Plan execution already in progress, ignoring request");return}A.value=!0;let O=!1,K=null;try{console.log("[DirectView] Adding messages for plan execution:",N.title),(ce=u.value)==null||ce.addMessage("user",N.title),O=!0,K=(V=u.value)==null?void 0:V.addMessage("assistant","",{thinking:a("chat.planningExecution")}),K&&((Y=u.value)==null||Y.startStreaming(K.id),console.log("[DirectView] Added assistant message for plan execution:",K.id))}catch(Se){console.warn("[DirectView] Failed to add messages:",Se)}try{const Se=((X=N.planData)==null?void 0:X.planTemplateId)||((ye=N.planData)==null?void 0:ye.id)||((De=N.planData)==null?void 0:De.planId);if(!Se)throw new Error(a("direct.planTemplateIdNotFound"));console.log("[Direct] Executing plan with templateId:",Se,"params:",N.params),console.log("[Direct] About to call PlanActApiService.executePlan");const Ue=((Ke=d.value)==null?void 0:Ke.uploadedFiles)||[],St=((Xe=d.value)==null?void 0:Xe.uploadKey)||null;console.log("[Direct] 🔍 DEBUG - InputArea uploadedFiles:",Ue),console.log("[Direct] 🔍 DEBUG - InputArea uploadKey:",St),console.log("[Direct] Executing with uploaded files:",(Ue==null?void 0:Ue.length)??0),console.log("[Direct] Executing with replacement params:",N.replacementParams);let Ce;if((Ie=N.params)!=null&&Ie.trim()?(console.log("[Direct] Calling executePlan with rawParam:",N.params.trim()),Ce=await et.executePlan(Se,N.params.trim(),Ue,N.replacementParams,St)):(console.log("[Direct] Calling executePlan without rawParam"),Ce=await et.executePlan(Se,void 0,Ue,N.replacementParams,St)),console.log("[Direct] Plan execution API response:",Ce),Ce.planId&&K)console.log("[Direct] Got planId from response:",Ce.planId,"starting plan execution"),(lt=u.value)==null||lt.updateMessage(K.id,{thinking:a("chat.planningExecution"),planExecution:{currentPlanId:Ce.planId,rootPlanId:Ce.planId,status:"running"}}),_.value=Ce.planId,console.log("[Direct] Set currentRootPlanId to:",Ce.planId),console.log("[Direct] Delegating plan execution to planExecutionManager"),xe.handlePlanExecutionRequested(Ce.planId,N.title);else throw console.error("[Direct] No planId in response:",Ce),new Error(a("direct.executionFailedNoPlanId"))}catch(Se){console.error("[Direct] Plan execution failed:",Se),console.error("[Direct] Error details:",{message:Se.message,stack:Se.stack}),_.value=null;try{console.log("[Direct] Adding error messages to chat"),O||(Ee=u.value)==null||Ee.addMessage("user",N.title),K?((rt=u.value)==null||rt.updateMessage(K.id,{content:`${a("direct.executionFailed")}: ${Se.message||a("common.unknownError")}`,thinking:void 0}),(qt=u.value)==null||qt.stopStreaming(K.id)):(jt=u.value)==null||jt.addMessage("assistant",`${a("direct.executionFailed")}: ${Se.message||a("common.unknownError")}`)}catch(Ue){console.error("[Direct] Failed to add error messages:",Ue),alert(`${a("direct.executionFailed")}: ${Se.message||a("common.unknownError")}`)}}finally{console.log("[Direct] Plan execution finished, resetting isExecutingPlan flag"),A.value=!1}},k=()=>{u.value.showMemory()},j=()=>{Ne.clearMemoryId(),u.value.newChat()};return(N,O)=>(p(),f("div",Xv,[s("div",Yv,[w(mc,{ref_key:"sidebarRef",ref:b,onPlanExecutionRequested:W},null,512),s("div",{class:"left-panel",style:We({width:I.value+"%"})},[s("div",Qv,[s("button",{class:"back-button",onClick:ee},[w(l(T),{icon:"carbon:arrow-left"})]),s("h2",null,c(N.$t("conversation")),1),s("div",Zv,[w(Ks),s("button",{class:"config-button",onClick:j,title:N.$t("memory.newChat")},[w(l(T),{icon:"carbon:add",width:"20"})],8,eg),s("button",{class:"config-button",onClick:ge,title:N.$t("direct.configuration")},[w(l(T),{icon:"carbon:settings-adjust",width:"20"})],8,tg),s("button",{class:"cron-task-btn",onClick:O[0]||(O[0]=K=>y.value=!0),title:N.$t("cronTask.title")},[w(l(T),{icon:"carbon:alarm",width:"20"})],8,sg),s("button",{class:"cron-task-btn",onClick:O[1]||(O[1]=K=>l(Ne).toggleSidebar()),title:N.$t("memory.selectMemory")},[w(l(T),{icon:"carbon:calendar",width:"20"})],8,ng)])]),s("div",og,[w(vf,{ref_key:"chatRef",ref:u,mode:"direct","initial-prompt":i.value||"",onStepSelected:B,onSubPlanStepSelected:J},null,8,["initial-prompt"])]),(p(),le(Af,{key:N.$i18n.locale,ref_key:"inputRef",ref:d,disabled:M.value,placeholder:M.value?l(a)("input.waiting"):l(a)("input.placeholder"),"initial-value":i.value,onSend:G,onClear:Q,onFocus:E,onUpdateState:C,onPlanModeClicked:oe},null,8,["disabled","placeholder","initial-value"]))],4),s("div",{class:"panel-resizer",onMousedown:m,onDblclick:z,title:N.$t("direct.panelResizeHint")},O[3]||(O[3]=[s("div",{class:"resizer-line"},null,-1)]),40,ag),w(hp,{ref_key:"rightPanelRef",ref:g,style:We({width:100-v.value+"%"}),"current-root-plan-id":_.value},null,8,["style","current-root-plan-id"])]),w(Kv,{modelValue:y.value,"onUpdate:modelValue":O[2]||(O[2]=K=>y.value=K)},null,8,["modelValue"]),w(cd,{onMemorySelected:k}),l(r).show?(p(),f("div",{key:0,class:ne(["message-toast",l(r).type])},[s("div",lg,[s("span",null,c(l(r).text),1)])],2)):L("",!0)]))}}),xg=he(rg,[["__scopeId","data-v-ef1d9796"]]);export{xg as default};
