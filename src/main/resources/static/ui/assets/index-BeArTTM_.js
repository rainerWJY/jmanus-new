const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/sidebar-DD9JCzEa.js","assets/index-PXbr5Lw7.js","assets/index-DN-vOy2S.css","assets/llm-check-S84pbv31.js"])))=>i.map(i=>d[i]);
var Fs=Object.defineProperty;var Ms=(n,e,t)=>e in n?Fs(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var fe=(n,e,t)=>Ms(n,typeof e!="symbol"?e+"":e,t);import{d as de,u as Te,c as re,r as N,B as ot,C as ie,o as we,a as g,b as p,F as ne,g as k,f as O,p as Ie,h as Z,i as r,t as c,e as s,w as se,m as ce,n as oe,q as le,D as kt,l as ae,E as Se,G as Zt,H as nt,I as Us,j as pe,A as ye,z as Ve,J as Ns,_ as Ye,T as Ne,K as Ze,M as es,v as Ls,N as ts,O as et,y as ss,P as Os}from"./index-PXbr5Lw7.js";import{I as P,_ as ue}from"./_plugin-vue_export-helper-Dng2XUQP.js";import{M as os,u as ns,a as Bs}from"./useMessage-CvNi0w1O.js";import{s as H,D as qs,P as tt,u as Dt}from"./sidebar-DD9JCzEa.js";import{L as Vs}from"./LanguageSwitcher-DtwaZplv.js";import"./llm-check-S84pbv31.js";class xe{static async getCoordinatorToolConfig(){try{const e=await fetch(`${this.BASE_URL}/config`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!e.ok)throw new Error(`Failed to get coordinator tool config: ${e.status}`);return await e.json()}catch(e){return console.error("Failed to get CoordinatorTool configuration:",e),{enabled:!0,success:!1,message:e.message}}}static async getAllEndpoints(){try{const e=await fetch(`${this.BASE_URL}/endpoints`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!e.ok)throw new Error(`Failed to get endpoints: ${e.status}`);return await e.json()}catch(e){throw console.error("Failed to get endpoints:",e),new Error("Failed to get endpoints: "+e.message)}}static async getCoordinatorToolsByTemplate(e){console.log("[CoordinatorToolApiService] Starting to get coordinator tool, planTemplateId:",e),console.log("[CoordinatorToolApiService] Request URL:",`${this.BASE_URL}/get-get-or-new-by-template/${e}`);try{const t=await fetch(`${this.BASE_URL}/get-or-new-by-template/${e}`,{method:"GET",headers:{"Content-Type":"application/json"}});if(console.log("[CoordinatorToolApiService] Response status:",t.status),console.log("[CoordinatorToolApiService] Response status text:",t.statusText),t.status===404)return console.log("[CoordinatorToolApiService] 404"),null;if(!t.ok){const a=await t.text();throw console.error("[CoordinatorToolApiService] Response error content:",a),new Error(`Failed to get coordinator tools: ${t.status} - ${a}`)}const o=await t.json();return console.log("[CoordinatorToolApiService] Successfully got coordinator tool, result:",o),o}catch(t){throw console.error("[CoordinatorToolApiService] Failed to get coordinator tool:",t),new Error("Failed to get coordinator tool: "+t.message)}}static async getOrNewCoordinatorToolsByTemplate(e){console.log("[CoordinatorToolApiService] Starting to get or create coordinator tool, planTemplateId:",e),console.log("[CoordinatorToolApiService] Request URL:",`${this.BASE_URL}/get-or-new-by-template/${e}`);try{const t=await fetch(`${this.BASE_URL}/get-or-new-by-template/${e}`,{method:"GET",headers:{"Content-Type":"application/json"}});if(console.log("[CoordinatorToolApiService] Response status:",t.status),console.log("[CoordinatorToolApiService] Response status text:",t.statusText),!t.ok){const a=await t.text();throw console.error("[CoordinatorToolApiService] Response error content:",a),new Error(`Failed to get coordinator tools: ${t.status} - ${a}`)}const o=await t.json();return console.log("[CoordinatorToolApiService] Successfully got coordinator tool, result:",o),o}catch(t){throw console.error("[CoordinatorToolApiService] Failed to get coordinator tool:",t),new Error("Failed to get coordinator tool: "+t.message)}}static async createCoordinatorTool(e){console.log("[CoordinatorToolApiService] Starting to create coordinator tool"),console.log("[CoordinatorToolApiService] Original data:",JSON.stringify(e,null,2)),console.log("[CoordinatorToolApiService] Request URL:",`${this.BASE_URL}`);const t={id:e.id,toolName:e.toolName,toolDescription:e.toolDescription,inputSchema:e.inputSchema,planTemplateId:e.planTemplateId,httpEndpoint:e.httpEndpoint,mcpEndpoint:e.mcpEndpoint,serviceGroup:e.serviceGroup,enableInternalToolcall:e.enableInternalToolcall,enableHttpService:e.enableHttpService,enableMcpService:e.enableMcpService};console.log("[CoordinatorToolApiService] Cleaned sending data:",JSON.stringify(t,null,2));try{const o=await fetch(`${this.BASE_URL}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(console.log("[CoordinatorToolApiService] Response status:",o.status),console.log("[CoordinatorToolApiService] Response status text:",o.statusText),!o.ok){let l="Unknown error";try{const i=await o.json();l=i.message||i.error||l}catch{l=await o.text()||l}throw console.error("[CoordinatorToolApiService] Response error content:",l),new Error(`Failed to create coordinator tool: ${o.status} - ${l}`)}const a=await o.json();return console.log("[CoordinatorToolApiService] Created successfully, result:",a),a}catch(o){throw console.error("[CoordinatorToolApiService] Failed to create coordinator tool:",o),new Error("Failed to create coordinator tool: "+o.message)}}static async updateCoordinatorTool(e,t){console.log("[CoordinatorToolApiService] Starting to update coordinator tool, ID:",e),console.log("[CoordinatorToolApiService] Sending data:",t),console.log("[CoordinatorToolApiService] Request URL:",`${this.BASE_URL}/${e}`);const o={id:t.id,toolName:t.toolName,toolDescription:t.toolDescription,inputSchema:t.inputSchema,planTemplateId:t.planTemplateId,httpEndpoint:t.httpEndpoint,mcpEndpoint:t.mcpEndpoint,serviceGroup:t.serviceGroup,enableInternalToolcall:t.enableInternalToolcall,enableHttpService:t.enableHttpService,enableMcpService:t.enableMcpService};console.log("[CoordinatorToolApiService] Cleaned sending data:",o);try{const a=await fetch(`${this.BASE_URL}/${e}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)});if(console.log("[CoordinatorToolApiService] Response status:",a.status),console.log("[CoordinatorToolApiService] Response status text:",a.statusText),!a.ok){let i="Unknown error";try{const u=await a.json();i=u.message||u.error||i}catch{i=await a.text()||i}throw console.error("[CoordinatorToolApiService] Response error content:",i),new Error(`Failed to update coordinator tool: ${a.status} - ${i}`)}const l=await a.json();return console.log("[CoordinatorToolApiService] Updated successfully, result:",l),l}catch(a){throw console.error("[CoordinatorToolApiService] Failed to update coordinator tool:",a),new Error("Failed to update coordinator tool: "+a.message)}}static async deleteCoordinatorTool(e){console.log("[CoordinatorToolApiService] Starting to delete coordinator tool, ID:",e),console.log("[CoordinatorToolApiService] Request URL:",`${this.BASE_URL}/${e}`);try{const t=await fetch(`${this.BASE_URL}/${e}`,{method:"DELETE",headers:{"Content-Type":"application/json"}});if(console.log("[CoordinatorToolApiService] Response status:",t.status),console.log("[CoordinatorToolApiService] Response status text:",t.statusText),!t.ok){const a=await t.text();throw console.error("[CoordinatorToolApiService] Response error content:",a),new Error(`Failed to delete coordinator tool: ${t.status} - ${a}`)}const o=await t.json();return console.log("[CoordinatorToolApiService] Deleted successfully, result:",o),o}catch(t){throw console.error("[CoordinatorToolApiService] Failed to delete coordinator tool:",t),new Error("Failed to delete coordinator tool: "+t.message)}}}fe(xe,"BASE_URL","/api/coordinator-tools");class Ft{static async getParameterRequirements(e){try{const t=await fetch(`${this.BASE_URL}/${e}/parameters`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!t.ok)throw new Error(`Failed to get parameter requirements: ${t.statusText}`);return await t.json()}catch(t){throw console.error("Error getting parameter requirements:",t),t}}}fe(Ft,"BASE_URL","/api/plan-template");const js={class:"modal-form wide-modal"},Js={class:"form-section"},Hs={class:"form-item"},Gs=["placeholder"],Ws={class:"field-description"},zs={class:"form-section"},Ks={class:"form-item"},Xs=["placeholder"],Qs={class:"field-description"},Ys={class:"form-section"},Zs={class:"form-item"},eo=["placeholder"],to={class:"field-description"},so={class:"form-section"},oo={class:"section-title"},no={key:0,class:"params-help-text"},ao={class:"parameter-table"},lo=["onUpdate:modelValue","placeholder","readonly"],ro=["onUpdate:modelValue","placeholder"],io={class:"form-section"},co={class:"service-publish-options"},uo={class:"internal-toolcall-publish-option"},po={class:"checkbox-label"},mo={class:"checkbox-text"},ho={class:"checkbox-description"},fo={class:"http-publish-option"},vo={class:"checkbox-label"},go={class:"checkbox-text"},bo={class:"checkbox-description"},yo={class:"button-container"},_o=["disabled"],$o=["disabled"],So=de({__name:"PublishServiceModal",props:{modelValue:{type:Boolean,default:!1},planTemplateId:{default:""},planDescription:{default:""}},emits:["update:modelValue","published"],setup(n,{expose:e,emit:t}){const{t:o}=Te(),a=n,l=t,i=re({get:()=>a.modelValue,set:F=>l("update:modelValue",F)}),u=N(""),f=N(""),d=N(!1),h=N(!1),$=N(null),M=N(!1),L=N(!1),y=N(!0),S=N({parameters:[],hasParameters:!1,requirements:""}),_=N(!1),m=ot({serviceName:"",userRequest:"",endpoint:"",serviceGroup:"",parameters:[]}),C=re(()=>{var B;const F=(B=$.value)==null?void 0:B.id;return o(F?"mcpService.updateService":"mcpService.createService")}),w=()=>{m.serviceName="",m.userRequest=a.planDescription||"",m.endpoint="",m.serviceGroup="",S.value.hasParameters||(m.parameters=[]),$.value=null,M.value=!1},D=async()=>{if(!a.planTemplateId){S.value={parameters:[],hasParameters:!1,requirements:""};return}_.value=!0;try{const F=await Ft.getParameterRequirements(a.planTemplateId);S.value=F,F.hasParameters&&(m.parameters=F.parameters.map(B=>({name:B,description:""})))}catch(F){console.error("[PublishModal] Failed to load parameter requirements:",F),F instanceof Error&&!F.message.includes("404")&&console.warn("[PublishModal] Parameter requirements not available yet, will retry later"),S.value={parameters:[],hasParameters:!1,requirements:""}}finally{_.value=!1}},v=(F,B)=>{B==="success"?(f.value=F,setTimeout(()=>{f.value=""},3e3)):B==="error"&&(u.value=F,setTimeout(()=>{u.value=""},5e3))},E=()=>{if(!m.serviceName.trim())return v(o("mcpService.toolNameRequiredError"),"error"),!1;if(!m.userRequest.trim())return v(o("mcpService.toolDescriptionRequiredError"),"error"),!1;if(!m.serviceGroup.trim())return v(o("mcpService.serviceGroupRequiredError"),"error"),!1;if(!y.value&&!L.value)return v("Please select at least one service type","error"),!1;for(let F=0;F<m.parameters.length;F++){const B=m.parameters[F];if(B.name&&!B.description.trim())return v(`Parameter "${B.name}" description cannot be empty`,"error"),!1;if(B.description&&!B.name.trim())return v(`Parameter description "${B.description}" corresponding name cannot be empty`,"error"),!1}return!0},A=async()=>{if(console.log("[PublishModal] Starting to handle publish request"),console.log("[PublishModal] Form data:",m),console.log("[PublishModal] Current tool:",$.value),console.log("[PublishModal] Publish as HTTP service:",L.value),!E()){console.log("[PublishModal] Form validation failed");return}d.value=!0;try{$.value||(console.log("[PublishModal] No current tool data, getting or creating first"),$.value=await xe.getOrNewCoordinatorToolsByTemplate(a.planTemplateId)),console.log("[PublishModal] Updating tool information"),$.value.toolName=m.serviceName.trim(),$.value.toolDescription=m.userRequest.trim(),$.value.serviceGroup=m.serviceGroup.trim(),$.value.planTemplateId=a.planTemplateId,$.value.enableInternalToolcall=y.value,$.value.enableHttpService=L.value,$.value.enableMcpService=!1,$.value.mcpEndpoint=void 0;const F=m.parameters.filter(V=>V.name.trim()&&V.description.trim()).map(V=>({name:V.name.trim(),description:V.description.trim(),type:"string"}));if($.value.inputSchema=JSON.stringify(F),console.log("[PublishModal] Updated tool information:",$.value),$.value.id)console.log("[PublishModal] Updating existing tool, ID:",$.value.id),await xe.updateCoordinatorTool($.value.id,$.value);else{console.log("[PublishModal] Creating new tool");const V=await xe.createCoordinatorTool($.value);$.value=V}const B=[];if(y.value&&B.push("Internal Method Call"),L.value&&B.push("HTTP Service"),B.length>0){console.log("[PublishModal] Step 5: Publishing service, ID:",$.value.id,"Enabled services:",B.join(", "));const V=[];y.value&&V.push(`Internal Call: ${m.serviceName}`),console.log("[PublishModal] Service published successfully"),v(o("mcpService.publishSuccess"),"success"),l("published",$.value)}else console.log("[PublishModal] Only saving tool, not publishing as any service"),v(o("mcpService.saveSuccess"),"success"),l("published",$.value)}catch(F){console.error("[PublishModal] Failed to publish service:",F),v(o("mcpService.publishFailed")+": "+F.message,"error")}finally{d.value=!1}},G=async()=>{var F;if(!h.value&&confirm(o("mcpService.deleteConfirmMessage"))){if(!((F=$.value)!=null&&F.id)){v(o("mcpService.deleteFailed")+": "+o("mcpService.selectPlanTemplateFirst"),"error");return}h.value=!0;try{console.log("[PublishModal] Starting to delete MCP service, ID:",$.value.id);const B=await xe.deleteCoordinatorTool($.value.id);if(B.success)console.log("[PublishModal] Deleted successfully"),v(o("mcpService.deleteSuccess"),"success"),i.value=!1,l("published",null);else throw new Error(B.message)}catch(B){console.error("[PublishModal] Failed to delete MCP service:",B),v(o("mcpService.deleteFailed")+": "+B.message,"error")}finally{h.value=!1}}},R=async()=>{i.value&&(console.log("[PublishModal] Modal opened, starting to initialize data"),w(),await U())},U=async()=>{if(!a.planTemplateId){console.log("[PublishModal] "+o("mcpService.noPlanTemplateId"));return}try{console.log("[PublishModal] Starting to load coordinator tool data, planTemplateId:",a.planTemplateId);const F=await xe.getOrNewCoordinatorToolsByTemplate(a.planTemplateId);console.log("[PublishModal] Get coordinator tool data result:",F),$.value=F,M.value=!!F.id;const B=[];if(F.enableMcpService&&F.mcpEndpoint){const V=window.location.origin;B.push(`MCP: ${V}/mcp${F.mcpEndpoint}`)}F.enableInternalToolcall&&B.push(`Internal Call: ${F.toolName}`),console.log("[PublishModal] Load tool data completed"),m.serviceName=F.toolName||"",m.userRequest=F.toolDescription||a.planDescription||"",m.serviceGroup=F.serviceGroup??"",L.value=F.enableHttpService??!1,y.value=F.enableInternalToolcall??!1;try{if(F.inputSchema){const V=JSON.parse(F.inputSchema);Array.isArray(V)&&V.length>0?(m.parameters=V.map(z=>({name:z.name||"",description:z.description||""})),console.log("[PublishModal] Load parameters from inputSchema:",m.parameters)):console.log("[PublishModal] inputSchema is empty, keeping existing parameters:",m.parameters)}}catch(V){console.warn("[PublishModal] "+o("mcpService.parseInputSchemaFailed")+":",V),console.log("[PublishModal] Parsing failed, keeping existing parameters:",m.parameters)}console.log("[PublishModal] Form data filled:",m)}catch(F){console.error("[PublishModal] "+o("mcpService.loadToolDataFailed")+":",F),v(o("mcpService.loadToolDataFailed")+": "+F.message,"error")}};return ie(()=>a.modelValue,R),ie(()=>a.planTemplateId,(F,B)=>{F&&F!==B&&(B&&F.startsWith("planTemplate-")?setTimeout(()=>{D()},1e3):D())}),we(async()=>{i.value&&(console.log("[PublishModal] Initialize when component mounted"),w(),await U(),await D())}),e({loadParameterRequirements:D}),(F,B)=>(p(),g(ne,null,[k(os,{modelValue:i.value,"onUpdate:modelValue":B[5]||(B[5]=V=>i.value=V),title:C.value,onConfirm:A},{footer:Ie(()=>{var V;return[s("div",yo,[M.value&&((V=$.value)!=null&&V.id)?(p(),g("button",{key:0,class:"action-btn danger",onClick:G,disabled:h.value},[h.value?(p(),ae(r(P),{key:0,icon:"carbon:loading",class:"loading-icon"})):(p(),ae(r(P),{key:1,icon:"carbon:trash-can"})),Z(" "+c(h.value?r(o)("mcpService.deleting"):r(o)("mcpService.delete")),1)],8,_o)):O("",!0),s("button",{class:"action-btn primary",onClick:A,disabled:d.value},[d.value?(p(),ae(r(P),{key:0,icon:"carbon:loading",class:"loading-icon"})):(p(),ae(r(P),{key:1,icon:"carbon:cloud-upload"})),Z(" "+c(d.value?r(o)("mcpService.publishing"):r(o)("mcpService.publishAsService")),1)],8,$o)])]}),default:Ie(()=>[s("div",js,[s("div",Js,[s("div",Hs,[s("label",null,c(r(o)("mcpService.toolNameRequired")),1),se(s("input",{type:"text","onUpdate:modelValue":B[0]||(B[0]=V=>m.serviceName=V),placeholder:r(o)("mcpService.toolNamePlaceholder"),class:oe({error:!m.serviceName||!m.serviceName.trim()}),required:""},null,10,Gs),[[ce,m.serviceName]]),s("div",Ws,c(r(o)("mcpService.toolNameDescription")),1)])]),s("div",zs,[s("div",Ks,[s("label",null,c(r(o)("mcpService.toolDescriptionRequired")),1),se(s("textarea",{"onUpdate:modelValue":B[1]||(B[1]=V=>m.userRequest=V),placeholder:r(o)("mcpService.toolDescriptionPlaceholder"),class:oe([{error:!m.userRequest||!m.userRequest.trim()},"description-field"]),rows:"4",required:""},null,10,Xs),[[ce,m.userRequest]]),s("div",Qs,c(r(o)("mcpService.toolDescriptionDescription")),1)])]),s("div",Ys,[s("div",Zs,[s("label",null,c(r(o)("mcpService.serviceGroup")),1),se(s("input",{type:"text","onUpdate:modelValue":B[2]||(B[2]=V=>m.serviceGroup=V),placeholder:r(o)("mcpService.serviceGroupPlaceholder"),class:oe({error:!m.serviceGroup||!m.serviceGroup.trim()}),required:""},null,10,eo),[[ce,m.serviceGroup]]),s("div",to,c(r(o)("mcpService.serviceGroupDescription")),1)])]),s("div",so,[s("div",oo,c(r(o)("mcpService.parameterConfig")),1),S.value.hasParameters?(p(),g("div",no,c(r(o)("sidebar.parameterRequirementsHelp")),1)):O("",!0),s("div",ao,[s("table",null,[s("thead",null,[s("tr",null,[s("th",null,c(r(o)("mcpService.parameterName")),1),s("th",null,c(r(o)("mcpService.parameterDescription")),1)])]),s("tbody",null,[(p(!0),g(ne,null,le(m.parameters,(V,z)=>(p(),g("tr",{key:z},[s("td",null,[se(s("input",{type:"text","onUpdate:modelValue":Y=>V.name=Y,placeholder:r(o)("mcpService.parameterName"),class:oe(["parameter-input",{"readonly-input":S.value.hasParameters}]),readonly:S.value.hasParameters,required:""},null,10,lo),[[ce,V.name]])]),s("td",null,[se(s("input",{type:"text","onUpdate:modelValue":Y=>V.description=Y,placeholder:r(o)("mcpService.parameterDescription"),class:"parameter-input",required:""},null,8,ro),[[ce,V.description]])])]))),128))])])])]),s("div",io,[s("div",co,[s("div",uo,[s("label",po,[se(s("input",{type:"checkbox","onUpdate:modelValue":B[3]||(B[3]=V=>y.value=V),class:"checkbox-input"},null,512),[[kt,y.value]]),s("span",mo,c(r(o)("mcpService.publishAsInternalToolcall")),1)]),s("div",ho,c(r(o)("mcpService.publishAsInternalToolcallDescription")),1)]),s("div",fo,[s("label",vo,[se(s("input",{type:"checkbox","onUpdate:modelValue":B[4]||(B[4]=V=>L.value=V),class:"checkbox-input"},null,512),[[kt,L.value]]),s("span",go,c(r(o)("mcpService.publishAsHttpService")),1)]),s("div",bo,c(r(o)("mcpService.publishAsHttpServiceDescription")),1)])])])])]),_:1},8,["modelValue","title"]),u.value?(p(),g("div",{key:0,class:"error-toast",onClick:B[6]||(B[6]=V=>u.value="")},[k(r(P),{icon:"carbon:error"}),Z(" "+c(u.value),1)])):O("",!0),f.value?(p(),g("div",{key:1,class:"success-toast",onClick:B[7]||(B[7]=V=>f.value="")},[k(r(P),{icon:"carbon:checkmark"}),Z(" "+c(f.value),1)])):O("",!0)],64))}}),wo=ue(So,[["__scopeId","data-v-a5ee389e"]]);class Ot{static async uploadFiles(e){try{console.log("[FileUploadApiService] Uploading files:",e.length);const t=new FormData;e.forEach(l=>{t.append("files",l)});const o=await fetch("/api/file-upload/upload",{method:"POST",body:t});if(!o.ok)throw new Error(`HTTP error! status: ${o.status}`);const a=await o.json();return console.log("[FileUploadApiService] Files uploaded successfully:",a.successfulFiles,"uploadKey:",a.uploadKey),a}catch(t){throw console.error("[FileUploadApiService] Error uploading files:",t),t}}static async getUploadedFiles(e){try{console.log("[FileUploadApiService] Getting uploaded files for uploadKey:",e);const t=await fetch(`/api/file-upload/files/${encodeURIComponent(e)}`);if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const o=await t.json();return console.log("[FileUploadApiService] Got uploaded files:",o.totalCount,"for uploadKey:",e),o}catch(t){throw console.error("[FileUploadApiService] Error getting uploaded files:",t),t}}static async deleteFile(e,t){try{console.log("[FileUploadApiService] Deleting file:",t,"from uploadKey:",e);const o=await fetch(`/api/file-upload/files/${encodeURIComponent(e)}/${encodeURIComponent(t)}`,{method:"DELETE",headers:{"Content-Type":"application/json"}});if(!o.ok)throw new Error(`HTTP error! status: ${o.status}`);const a=await o.json();return console.log("[FileUploadApiService] File deleted successfully:",a.success),a}catch(o){throw console.error("[FileUploadApiService] Error deleting file:",o),o}}static async getUploadConfig(){try{console.log("[FileUploadApiService] Getting upload configuration");const e=await fetch("/api/file-upload/config");if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);const t=await e.json();return console.log("[FileUploadApiService] Got upload configuration:",t),t}catch(e){throw console.error("[FileUploadApiService] Error getting upload configuration:",e),e}}}const ko={class:"file-upload-component"},To=["accept"],Po={key:0},Co={key:1},Eo={key:0,class:"files-list"},Ro={class:"file-name"},Io={class:"file-size"},Ao=["onClick","title"],xo={key:0,class:"upload-progress"},Do=de({__name:"FileUploadComponent",props:{acceptedFileTypes:{default:".pdf,.txt,.md,.doc,.docx,.csv,.xlsx,.xls,.json,.xml,.html,.htm,.log,.java,.py,.js,.ts,.sql,.sh,.bat,.yaml,.yml,.properties,.conf,.ini,.jpg,.jpeg,.png,.gif"},disabled:{type:Boolean,default:!1}},emits:["files-uploaded","files-removed","upload-key-changed","upload-started","upload-completed","upload-error"],setup(n,{expose:e,emit:t}){const{t:o}=Te(),a=n,l=t,i=N(),u=N([]),f=N(!1),d=N(null),h=()=>{console.log("[FileUpload] Resetting session and clearing uploadKey"),u.value=[],d.value=null,l("upload-key-changed",null)};Se(()=>{h()}),ie(()=>u.value,_=>{l("files-removed",_)},{deep:!0});const $=()=>{a.disabled||i.value&&i.value.click()},M=async _=>{const m=_.target,C=m.files;if(!C||C.length===0)return;const w=Array.from(C);console.log("[FileUpload] Selected files for upload:",w.map(D=>D.name)),await L(w),m.value=""},L=async _=>{if(_.length!==0){f.value=!0,l("upload-started");try{const m=await Ot.uploadFiles(_);m.success&&(!d.value&&m.uploadKey?(d.value=m.uploadKey,console.log("[FileUpload] Set uploadKey:",d.value),u.value=m.uploadedFiles):d.value?(console.log("[FileUpload] Using existing uploadKey:",d.value),u.value=[...u.value,...m.uploadedFiles]):(console.warn("[FileUpload] No uploadKey returned from upload"),u.value=m.uploadedFiles),m.uploadKey&&(d.value=m.uploadKey,console.log("[Input] Saved uploadKey locally:",m.uploadKey),l("upload-key-changed",d.value)),console.log("[Input] Updated global uploadedFiles state:",u.value),l("files-uploaded",u.value,d.value)),console.log("Files uploaded successfully:",m),l("upload-completed")}catch(m){console.error("File upload error:",m),l("upload-error",m)}finally{f.value=!1}}},y=async _=>{try{if(console.log("🗑️ Removing file:",_.originalName,"from uploadKey:",d),d.value){const m=await Ot.deleteFile(d.value,_.originalName);m.success?console.log("✅ File deleted from server successfully"):console.error("❌ Failed to delete file from server:",m.error)}u.value=u.value.filter(m=>m.originalName!==_.originalName),u.value.length===0&&(console.log("[FileUpload] 🧹 Clearing uploadKey to force new plan for new files"),d.value=null,l("upload-key-changed",null)),console.log("🎉 File removal completed, remaining files:",u.value.length)}catch(m){console.error("❌ Error removing file:",m),l("upload-error",m)}},S=_=>{if(_===0)return"0 Bytes";const m=1024,C=["Bytes","KB","MB","GB"],w=Math.floor(Math.log(_)/Math.log(m));return parseFloat((_/Math.pow(m,w)).toFixed(2))+" "+C[w]};return e({uploadedFiles:u,uploadKey:d,resetSession:h,uploadFiles:L,removeFile:y,isUploading:f}),(_,m)=>(p(),g("div",ko,[s("input",{ref_key:"fileInputRef",ref:i,type:"file",multiple:"",style:{display:"none"},onChange:M,accept:_.acceptedFileTypes||""},null,40,To),s("div",{class:oe(["uploaded-files",{"has-files":u.value.length>0}])},[s("div",{class:"files-header",onClick:$},[k(r(P),{icon:"carbon:attachment"}),u.value.length===0?(p(),g("span",Po,c(r(o)("input.attachFile")),1)):(p(),g("span",Co,c(r(o)("input.attachedFiles"))+" ("+c(u.value.length)+")",1))]),u.value.length>0?(p(),g("div",Eo,[(p(!0),g(ne,null,le(u.value,C=>(p(),g("div",{key:C.originalName,class:"file-item"},[k(r(P),{icon:"carbon:document",class:"file-icon"}),s("span",Ro,c(C.originalName),1),s("span",Io,"("+c(S(C.size))+")",1),s("button",{onClick:w=>y(C),class:"remove-btn",title:r(o)("input.removeFile")},[k(r(P),{icon:"carbon:close"})],8,Ao)]))),128))])):O("",!0)],2),f.value?(p(),g("div",xo,[k(r(P),{icon:"carbon:rotate--clockwise",class:"loading-icon"}),s("span",null,c(r(o)("input.uploading")),1)])):O("",!0)]))}}),as=ue(Do,[["__scopeId","data-v-d1f7078c"]]),Fo={class:"config-section"},Mo={class:"section-header"},Uo={class:"execution-content"},No={class:"params-requirements-group"},Lo={class:"params-help-text"},Oo={key:0,class:"parameter-fields"},Bo={class:"parameter-label"},qo=["onUpdate:modelValue","placeholder","onInput"],Vo={key:0,class:"parameter-error"},jo={key:1,class:"validation-message"},Jo=["disabled"],Ho=["disabled"],Go={key:1,class:"call-example-wrapper"},Wo={class:"call-example-header"},zo={class:"call-example-title"},Ko={class:"call-example-description"},Xo={class:"internal-call-wrapper"},Qo={class:"call-info"},Yo={class:"call-method"},Zo={class:"call-endpoint"},en={key:0,class:"call-endpoint"},tn={class:"call-description"},sn={class:"call-example"},on={class:"example-code"},nn={key:2,class:"call-example-wrapper"},an={class:"call-example-header"},ln={class:"call-example-title"},rn={class:"call-example-description"},cn={class:"http-api-urls-wrapper"},dn={class:"tab-container"},un={class:"tab-header"},pn=["onClick"],mn={class:"tab-content"},hn={class:"http-api-url-display"},fn={class:"api-method"},vn={class:"api-endpoint"},gn={class:"api-description"},bn={key:0,class:"api-example"},yn={class:"example-code"},_n={key:3,class:"call-example-wrapper"},$n={class:"call-example-header"},Sn={class:"call-example-title"},wn={class:"call-example-description"},kn={class:"mcp-call-wrapper"},Tn={class:"call-info"},Pn={class:"call-method"},Cn={class:"call-endpoint"},En={class:"call-description"},Rn={class:"call-example"},In={class:"example-code"},An=de({__name:"ExecutionController",props:{currentPlanTemplateId:{default:""},isExecuting:{type:Boolean,default:!1},isGenerating:{type:Boolean,default:!1},showPublishButton:{type:Boolean,default:!0},toolInfo:{default:()=>({toolName:"",toolDescription:"",planTemplateId:"",inputSchema:"[]",enableHttpService:!1,enableMcpService:!1,enableInternalToolcall:!1,serviceGroup:""})}},emits:["executePlan","publishMcpService","clearParams","updateExecutionParams"],setup(n,{expose:e,emit:t}){const{t:o}=Te(),a=n,l=t,i=N(""),u=N({parameters:[],hasParameters:!1,requirements:""}),f=N({}),d=N(!1),h=N("get-sync"),$=N({}),M=N(!1),L=N(!1),y=N(),S=N([]),_=N(null),m=N([{id:"get-sync",label:"GET + Sync",method:"GET",endpoint:"/api/executor/executeByToolNameSync/{toolName}",description:"Synchronous GET request - returns execution result immediately",example:`GET /api/executor/executeByToolNameSync/my-tool?allParams={"rawParam":"test"}
Response: {
  "status": "completed",
  "result": "Execution result here"
}`},{id:"post-sync",label:"POST + Sync",method:"POST",endpoint:"/api/executor/executeByToolNameSync",description:"Synchronous POST request - returns execution result immediately",example:`POST /api/executor/executeByToolNameSync
Content-Type: application/json

{
  "toolName": "my-tool",
  "replacementParams": {
    "rawParam": "test"
  },
  "uploadedFiles": []
}

Response: {
  "status": "completed",
  "result": "Execution result here"
}`},{id:"post-async",label:"POST + Async",method:"POST",endpoint:"/api/executor/executeByToolNameAsync",description:"Asynchronous POST request - returns task ID, check status separately",example:`POST /api/executor/executeByToolNameAsync
Content-Type: application/json

{
  "toolName": "my-tool",
  "replacementParams": {
    "rawParam": "test"
  },
  "uploadedFiles": []
}

Response: {
  "planId": "plan-123",
  "status": "processing",
  "message": "Task submitted, processing",
  "memoryId": "ABC12345",
  "toolName": "my-tool",
  "planTemplateId": "template-456"
}

# Check execution status and get detailed results:
GET /api/executor/details/{planId}
Response: {
  "currentPlanId": "plan-123",
  "title": "Plan Title",
  "status": "completed",
  "summary": "Execution completed successfully",
  "agentExecutionSequence": [...],
  "userInputWaitState": null
}`}]),C=re(()=>a.toolInfo.enableInternalToolcall??a.toolInfo.enableHttpService??a.toolInfo.enableMcpService),w=re(()=>C.value?o("sidebar.updateServiceStatus"):o("sidebar.publishMcpService")),D=re(()=>a.isExecuting||a.isGenerating?!1:u.value.hasParameters?u.value.parameters.every(J=>f.value[J].trim()):!0),v=(J,X)=>{S.value=J.map(q=>q.originalName),_.value=X,console.log("[ExecutionController] Files uploaded:",J.length,"uploadKey:",X)},E=J=>{S.value=J.map(X=>X.originalName),console.log("[ExecutionController] Files removed, remaining:",J.length)},A=J=>{_.value=J,console.log("[ExecutionController] Upload key changed:",J)},G=()=>{console.log("[ExecutionController] Upload started")},R=()=>{console.log("[ExecutionController] Upload completed")},U=J=>{console.error("[ExecutionController] Upload error:",J)},F=()=>{if(console.log("[ExecutionController] 🚀 Execute button clicked"),L.value=!0,console.log("[ExecutionController] 🔒 Set isExecutingPlan to true"),!T()){console.log("[ExecutionController] ❌ Parameter validation failed:",$.value),L.value=!1;return}const J=u.value.hasParameters&&Object.keys(f.value).length>0?f.value:void 0;console.log("[ExecutionController] 🔄 Replacement params:",J);const X={title:"",planData:{title:"",steps:[],directResponse:!1},params:void 0,replacementParams:J,uploadedFiles:S.value,uploadKey:_.value};console.log("[ExecutionController] 📤 Emitting executePlan with payload:",JSON.stringify(X,null,2)),l("executePlan",X)},B=()=>{l("publishMcpService")},V=()=>{console.log("[ExecutionController] 🧹 clearExecutionParams called"),i.value="",f.value={},L.value=!1,console.log("[ExecutionController] 🔓 Reset isExecutingPlan to false"),console.log("[ExecutionController] ✅ After clear - parameterValues cleared"),l("clearParams")},z=async()=>{if(console.log("[ExecutionController] 🔄 loadParameterRequirements called for templateId:",a.currentPlanTemplateId),console.log("[ExecutionController] 📊 Current parameterRequirements before load:",JSON.stringify(u.value,null,2)),!a.currentPlanTemplateId){console.log("[ExecutionController] ❌ No template ID, resetting parameters"),u.value={parameters:[],hasParameters:!1,requirements:""},f.value={};return}u.value={parameters:[],hasParameters:!1,requirements:""},f.value={},console.log("[ExecutionController] 🧹 Cleared previous data before loading new template"),d.value=!0;try{console.log("[ExecutionController] 🌐 Fetching parameter requirements from API...");const J=await Ft.getParameterRequirements(a.currentPlanTemplateId);console.log("[ExecutionController] 📥 Received requirements from API:",JSON.stringify(J,null,2)),u.value=J;const X={};J.parameters.forEach(q=>{X[q]=f.value[q]||""}),f.value=X,console.log("[ExecutionController] ✅ Updated parameterRequirements:",JSON.stringify(u.value,null,2)),console.log("[ExecutionController] ✅ Updated parameterValues:",JSON.stringify(f.value,null,2)),j()}catch(J){console.error("[ExecutionController] ❌ Failed to load parameter requirements:",J),J instanceof Error&&!J.message.includes("404")&&console.warn("[ExecutionController] ⚠️ Parameter requirements not available yet, will retry later"),u.value={parameters:[],hasParameters:!1,requirements:""},f.value={},console.log("[ExecutionController] 🔄 Reset parameterRequirements due to error:",JSON.stringify(u.value,null,2)),console.log("[ExecutionController] 🔄 Cleared parameterValues:",JSON.stringify(f.value,null,2))}finally{d.value=!1,console.log("[ExecutionController] ✅ loadParameterRequirements completed")}},Y=(J,X)=>{f.value[J]=X,$.value[J]&&delete $.value[J],j()},T=()=>{if($.value={},M.value=!1,!u.value.hasParameters)return!0;let J=!1;return u.value.parameters.forEach(X=>{f.value[X].trim()||($.value[X]=`${X} is required`,J=!0)}),M.value=J,!J},j=()=>{u.value.hasParameters?i.value=JSON.stringify(f.value,null,2):i.value="",l("updateExecutionParams",i.value)};return ie(()=>a.currentPlanTemplateId,(J,X)=>{if(J&&J!==X){if(L.value){console.log("[ExecutionController] ⏸️ Skipping parameter reload - plan is executing");return}console.log("[ExecutionController] 🔄 Template ID changed, will reload parameters"),X&&J.startsWith("planTemplate-")?(console.log("[ExecutionController] ⏰ New template detected, retrying with delay..."),setTimeout(()=>{console.log("[ExecutionController] ⏰ Delay timeout, calling loadParameterRequirements"),z()},1e3)):(console.log("[ExecutionController] 🚀 Immediate reload of parameters"),z())}}),ie(()=>i.value,J=>{l("updateExecutionParams",J)}),we(()=>{z()}),e({executionParams:i,clearExecutionParams:V,loadParameterRequirements:z,fileUploadRef:y,uploadedFiles:S,uploadKey:_}),(J,X)=>{var q,K,ee,b,I;return p(),g("div",Fo,[s("div",Mo,[k(r(P),{icon:"carbon:play",width:"16"}),s("span",null,c(r(o)("sidebar.executionController")),1)]),s("div",Uo,[s("div",No,[s("label",null,c(r(o)("sidebar.parameterRequirements")),1),s("div",Lo,c(r(o)("sidebar.parameterRequirementsHelp")),1),u.value.hasParameters?(p(),g("div",Oo,[(p(!0),g(ne,null,le(u.value.parameters,W=>(p(),g("div",{key:W,class:"parameter-field"},[s("label",Bo,[Z(c(W)+" ",1),X[0]||(X[0]=s("span",{class:"required"},"*",-1))]),se(s("input",{"onUpdate:modelValue":Q=>f.value[W]=Q,class:oe(["parameter-input",{error:$.value[W]}]),placeholder:r(o)("sidebar.enterValueFor",{param:W}),onInput:Q=>Y(W,Q.target.value),required:""},null,42,qo),[[ce,f.value[W]]]),$.value[W]?(p(),g("div",Vo,c($.value[W]),1)):O("",!0)]))),128))])):O("",!0),u.value.hasParameters&&!D.value&&!a.isExecuting&&!a.isGenerating?(p(),g("div",jo,[k(r(P),{icon:"carbon:warning",width:"14"}),Z(" "+c(r(o)("sidebar.fillAllRequiredParameters")),1)])):O("",!0)]),k(as,{ref_key:"fileUploadRef",ref:y,disabled:a.isExecuting||a.isGenerating,onFilesUploaded:v,onFilesRemoved:E,onUploadKeyChanged:A,onUploadStarted:G,onUploadCompleted:R,onUploadError:U},null,8,["disabled"]),s("button",{class:"btn btn-primary execute-btn",onClick:F,disabled:!D.value},[k(r(P),{icon:a.isExecuting?"carbon:circle-dash":"carbon:play",width:"16",class:oe({spinning:a.isExecuting})},null,8,["icon","class"]),Z(" "+c(a.isExecuting?r(o)("sidebar.executing"):r(o)("sidebar.executePlan")),1)],8,Jo),J.showPublishButton?(p(),g("button",{key:0,class:"btn publish-mcp-btn",onClick:B,disabled:!J.currentPlanTemplateId},[k(r(P),{icon:"carbon:application",width:"16"}),Z(" "+c(w.value),1)],8,Ho)):O("",!0),(q=J.toolInfo)!=null&&q.enableInternalToolcall?(p(),g("div",Go,[s("div",Wo,[s("h4",zo,c(r(o)("sidebar.internalCall")),1),s("p",Ko,c(r(o)("sidebar.internalCallDescription")),1)]),s("div",Xo,[s("div",Qo,[s("div",Yo,c(r(o)("sidebar.internalMethodCall")),1),s("div",Zo,c(r(o)("sidebar.toolName"))+": "+c(((K=J.toolInfo)==null?void 0:K.toolName)||J.currentPlanTemplateId),1),(ee=J.toolInfo)!=null&&ee.serviceGroup?(p(),g("div",en,c(r(o)("sidebar.serviceGroup"))+": "+c(J.toolInfo.serviceGroup),1)):O("",!0),s("div",tn,c(r(o)("sidebar.internalCallUsage")),1),s("div",sn,[s("strong",null,c(r(o)("sidebar.usage"))+":",1),s("pre",on,c(r(o)("sidebar.internalCallExample")),1)])])])])):O("",!0),(b=J.toolInfo)!=null&&b.enableHttpService?(p(),g("div",nn,[s("div",an,[s("h4",ln,c(r(o)("sidebar.httpCallExample")),1),s("p",rn,c(r(o)("sidebar.httpCallDescription")),1)]),s("div",cn,[s("div",dn,[s("div",un,[(p(!0),g(ne,null,le(m.value,W=>(p(),g("button",{key:W.id,class:oe(["tab-button",{active:h.value===W.id}]),onClick:Q=>h.value=W.id},c(W.label),11,pn))),128))]),s("div",mn,[(p(!0),g(ne,null,le(m.value,W=>se((p(),g("div",{key:W.id,class:"tab-panel"},[s("div",hn,[s("div",fn,c(W.method),1),s("div",vn,c(W.endpoint),1),s("div",gn,c(W.description),1),W.example?(p(),g("div",bn,[s("strong",null,c(r(o)("sidebar.example"))+":",1),s("pre",yn,c(W.example),1)])):O("",!0)])])),[[Zt,h.value===W.id]])),128))])])])])):O("",!0),(I=J.toolInfo)!=null&&I.enableMcpService?(p(),g("div",_n,[s("div",$n,[s("h4",Sn,c(r(o)("sidebar.mcpCall")),1),s("p",wn,c(r(o)("sidebar.mcpCallDescription")),1)]),s("div",kn,[s("div",Tn,[s("div",Pn,c(r(o)("sidebar.mcpServiceCall")),1),s("div",Cn,c(r(o)("sidebar.mcpEndpoint"))+": /mcp/execute",1),s("div",En,c(r(o)("sidebar.mcpCallUsage")),1),s("div",Rn,[s("strong",null,c(r(o)("sidebar.usage"))+":",1),s("pre",In,c(r(o)("sidebar.mcpCallExample")),1)])])])])):O("",!0)])])}}}),xn=ue(An,[["__scopeId","data-v-b90ad8af"]]);function ls(n,e){const t=N(!1),o=ot({title:"",steps:[],directResponse:!1,planTemplateId:n.currentPlanTemplateId||"",planType:"dynamic_agent"}),a=_=>{console.log("[JsonEditorLogic] parseJsonToVisual called with jsonContent:",_),console.log("[JsonEditorLogic] parseJsonToVisual called with currentPlanTemplateId:",n.currentPlanTemplateId);try{if(!_){console.log("[JsonEditorLogic] No jsonContent, resetting to default"),Object.assign(o,{title:"",steps:[],directResponse:!1,planTemplateId:n.currentPlanTemplateId||"",planType:"dynamic_agent"}),console.log("[JsonEditorLogic] Reset displayData to:",o);return}const m=JSON.parse(_);console.log("[JsonEditorLogic] Parsed JSON:",m),o.title=m.title||"",o.directResponse=!1,o.planTemplateId=m.planTemplateId||n.currentPlanTemplateId||"",o.planType=m.planType||"dynamic_agent",o.steps=(m.steps||[]).map(C=>({stepRequirement:C.stepRequirement||"",agentName:C.agentName||"",modelName:C.modelName||null,selectedToolKeys:C.selectedToolKeys||[],terminateColumns:C.terminateColumns||""})),console.log("[JsonEditorLogic] Updated displayData to:",o)}catch(m){console.warn("Failed to parse JSON content:",m),Object.assign(o,{title:"",steps:[],directResponse:!1,planTemplateId:n.currentPlanTemplateId||"",planType:"dynamic_agent"}),console.log("[JsonEditorLogic] Error occurred, reset displayData to:",o)}},l=()=>{try{const _={title:o.title,steps:o.steps.map(m=>({stepRequirement:m.stepRequirement,agentName:m.agentName,modelName:m.modelName??"",selectedToolKeys:m.selectedToolKeys,terminateColumns:m.terminateColumns})),directResponse:o.directResponse,planTemplateId:o.planTemplateId,planType:o.planType};return JSON.stringify(_,null,2)}catch(_){return console.error("Failed to convert visual data to JSON:",_),"{}"}},i=re(()=>l());return ie(()=>n.jsonContent,(_,m)=>{console.log("[JsonEditorLogic] Watch triggered - jsonContent changed from",m,"to",_),a(_)},{immediate:!0}),ie(o,()=>{const _=l();e("update:jsonContent",_)},{deep:!0}),ie(()=>n.currentPlanTemplateId,_=>{_&&(o.planTemplateId=_)}),{showJsonPreview:t,displayData:o,formattedJsonOutput:i,addStep:()=>{const _={stepRequirement:"",agentName:"ConfigurableDynaAgent",modelName:null,selectedToolKeys:[],terminateColumns:"",agentType:"",stepContent:""};o.steps.push(_)},removeStep:_=>{_>=0&&_<o.steps.length&&o.steps.splice(_,1)},moveStepUp:_=>{if(_>0){const m=o.steps.splice(_,1)[0];o.steps.splice(_-1,0,m)}},moveStepDown:_=>{if(_<o.steps.length-1){const m=o.steps.splice(_,1)[0];o.steps.splice(_+1,0,m)}},toggleJsonPreview:()=>{t.value=!t.value},closeJsonPreview:()=>{t.value=!1},handleRollback:()=>{e("rollback")},handleRestore:()=>{e("restore")},handleSave:()=>{e("save")}}}const Dn={class:"config-section"},Fn={class:"section-header"},Mn={class:"visual-editor"},Un={class:"plan-basic-info"},Nn={class:"form-row"},Ln={class:"form-label"},On=["placeholder"],Bn={class:"steps-section"},qn={class:"steps-header"},Vn={class:"form-label"},jn={class:"steps-container"},Jn={class:"step-header"},Hn={class:"step-number"},Gn={class:"step-actions"},Wn=["onClick","disabled","title"],zn=["onClick","disabled","title"],Kn=["onClick","title"],Xn={class:"step-content"},Qn={class:"form-row"},Yn={class:"form-label"},Zn={class:"agent-selector"},ea=["onUpdate:modelValue"],ta={value:""},sa=["title"],oa={class:"form-row"},na={class:"form-label"},aa=["onUpdate:modelValue","placeholder"],la={class:"form-row"},ra={class:"form-label"},ia=["onUpdate:modelValue","placeholder"],ca={key:0,class:"empty-steps"},da={class:"plan-id-section"},ua={class:"form-row"},pa={class:"form-label"},ma={key:0,class:"json-preview"},ha={class:"preview-header"},fa={class:"form-label"},va={class:"json-code"},ga={class:"editor-footer"},ba={class:"section-actions"},ya=["disabled","title"],_a=["disabled","title"],$a=["disabled"],Sa=de({__name:"JsonEditor",props:{jsonContent:{},canRollback:{type:Boolean},canRestore:{type:Boolean},isGenerating:{type:Boolean},isExecuting:{type:Boolean},hiddenFields:{default:()=>[]},currentPlanTemplateId:{default:""}},emits:["rollback","restore","save","update:jsonContent"],setup(n,{emit:e}){const t=n,o=e,{showJsonPreview:a,displayData:l,formattedJsonOutput:i,addStep:u,removeStep:f,moveStepUp:d,moveStepDown:h,handleRollback:$,handleRestore:M,handleSave:L,toggleJsonPreview:y,closeJsonPreview:S}=ls(t,o),_=m=>{const C=m.target;C.style.height="auto";const w=20,D=Math.ceil(C.scrollHeight/w),v=4,E=12,A=Math.max(v,Math.min(E,D)),G=A*w;C.style.height=`${G}px`,C.rows=A,D>E?C.style.overflowY="auto":C.style.overflowY="hidden"};return(m,C)=>(p(),g("div",Dn,[s("div",Fn,[k(r(P),{icon:"carbon:code",width:"16"}),s("span",null,c(m.$t("sidebar.jsonTemplate")),1)]),s("div",Mn,[s("div",Un,[s("div",Nn,[s("label",Ln,c(m.$t("sidebar.title")),1),se(s("input",{"onUpdate:modelValue":C[0]||(C[0]=w=>r(l).title=w),type:"text",class:"form-input",placeholder:m.$t("sidebar.titlePlaceholder")},null,8,On),[[ce,r(l).title]])])]),s("div",Bn,[s("div",qn,[s("label",Vn,c(m.$t("sidebar.tasks")),1)]),s("div",jn,[(p(!0),g(ne,null,le(r(l).steps,(w,D)=>(p(),g("div",{key:D,class:"step-item"},[s("div",Jn,[s("span",Hn,c(m.$t("sidebar.subtask"))+" "+c(D+1),1),s("div",Gn,[s("button",{onClick:v=>r(d)(D),disabled:D===0,class:"btn btn-xs",title:m.$t("sidebar.moveUp")},[k(r(P),{icon:"carbon:chevron-up",width:"12"})],8,Wn),s("button",{onClick:v=>r(h)(D),disabled:D===r(l).steps.length-1,class:"btn btn-xs",title:m.$t("sidebar.moveDown")},[k(r(P),{icon:"carbon:chevron-down",width:"12"})],8,zn),s("button",{onClick:v=>r(f)(D),class:"btn btn-xs btn-danger",title:m.$t("sidebar.removeStep")},[k(r(P),{icon:"carbon:trash-can",width:"12"})],8,Kn)])]),s("div",Xn,[s("div",Qn,[s("label",Yn,c(m.$t("sidebar.agent")),1),s("div",Zn,[se(s("select",{"onUpdate:modelValue":v=>w.agentName=v,class:"form-select agent-select"},[s("option",ta,c(m.$t("sidebar.selectAgent")),1),C[10]||(C[10]=Us('<option value="DEFAULT_AGENT" data-v-91f01967>DEFAULT_AGENT</option><option value="BROWSER_AGENT" data-v-91f01967>BROWSER_AGENT</option><option value="TEXT_FILE_AGENT" data-v-91f01967>TEXT_FILE_AGENT</option><option value="JSX_GENERATOR_AGENT" data-v-91f01967>JSX_GENERATOR_AGENT</option><option value="FILE_MANAGER_AGENT" data-v-91f01967>FILE_MANAGER_AGENT</option>',5))],8,ea),[[nt,w.agentName]]),s("button",{onClick:C[1]||(C[1]=(...v)=>r(u)&&r(u)(...v)),class:"btn btn-sm btn-add-step",title:m.$t("sidebar.addStep")},[k(r(P),{icon:"carbon:add",width:"14"})],8,sa)])]),s("div",oa,[s("label",na,c(m.$t("sidebar.stepRequirement")),1),se(s("textarea",{"onUpdate:modelValue":v=>w.stepContent=v,class:"form-textarea auto-resize",placeholder:m.$t("sidebar.stepRequirementPlaceholder"),rows:"4",onInput:C[2]||(C[2]=v=>_(v))},null,40,aa),[[ce,w.stepContent]])]),s("div",la,[s("label",ra,c(m.$t("sidebar.terminateColumns")),1),se(s("input",{"onUpdate:modelValue":v=>w.terminateColumns=v,type:"text",class:"form-input",placeholder:m.$t("sidebar.terminateColumnsPlaceholder")},null,8,ia),[[ce,w.terminateColumns]])])])]))),128)),r(l).steps.length===0?(p(),g("div",ca,[k(r(P),{icon:"carbon:add-alt",width:"32",class:"empty-icon"}),s("p",null,c(m.$t("sidebar.noSteps")),1),s("button",{onClick:C[3]||(C[3]=(...w)=>r(u)&&r(u)(...w)),class:"btn btn-primary"},[k(r(P),{icon:"carbon:add",width:"14"}),Z(" "+c(m.$t("sidebar.addFirstStep")),1)])])):O("",!0)])]),s("div",da,[s("div",ua,[s("label",pa,c(m.$t("sidebar.planId")),1),se(s("input",{"onUpdate:modelValue":C[4]||(C[4]=w=>r(l).planTemplateId=w),type:"text",class:"form-input",placeholder:"planTemplate-1756109892045"},null,512),[[ce,r(l).planTemplateId]])])]),r(a)?(p(),g("div",ma,[s("div",ha,[s("label",fa,c(m.$t("sidebar.jsonPreview")),1),s("button",{onClick:C[5]||(C[5]=(...w)=>r(S)&&r(S)(...w)),class:"btn btn-xs"},[k(r(P),{icon:"carbon:close",width:"12"})])]),s("pre",va,c(r(i)),1)])):O("",!0),s("div",ga,[s("button",{onClick:C[6]||(C[6]=(...w)=>r(y)&&r(y)(...w)),class:"btn btn-sm btn-secondary"},[k(r(P),{icon:"carbon:code",width:"14"}),Z(" "+c(r(a)?m.$t("sidebar.hideJson"):m.$t("sidebar.showJson")),1)]),s("div",ba,[s("button",{class:"btn btn-sm",onClick:C[7]||(C[7]=(...w)=>r($)&&r($)(...w)),disabled:!(m.canRollback??!1),title:m.$t("sidebar.rollback")},[k(r(P),{icon:"carbon:undo",width:"14"})],8,ya),s("button",{class:"btn btn-sm",onClick:C[8]||(C[8]=(...w)=>r(M)&&r(M)(...w)),disabled:!(m.canRestore??!1),title:m.$t("sidebar.restore")},[k(r(P),{icon:"carbon:redo",width:"14"})],8,_a),s("button",{class:"btn btn-primary",onClick:C[9]||(C[9]=(...w)=>r(L)&&r(L)(...w)),disabled:m.isGenerating||m.isExecuting},[k(r(P),{icon:"carbon:save",width:"14"}),C[11]||(C[11]=Z(" Save "))],8,$a)])])])]))}}),wa=ue(Sa,[["__scopeId","data-v-91f01967"]]);function rs(n,e){return function(){return n.apply(e,arguments)}}const{toString:ka}=Object.prototype,{getPrototypeOf:Mt}=Object,{iterator:mt,toStringTag:is}=Symbol,ht=(n=>e=>{const t=ka.call(e);return n[t]||(n[t]=t.slice(8,-1).toLowerCase())})(Object.create(null)),Pe=n=>(n=n.toLowerCase(),e=>ht(e)===n),ft=n=>e=>typeof e===n,{isArray:je}=Array,st=ft("undefined");function Ta(n){return n!==null&&!st(n)&&n.constructor!==null&&!st(n.constructor)&&_e(n.constructor.isBuffer)&&n.constructor.isBuffer(n)}const cs=Pe("ArrayBuffer");function Pa(n){let e;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?e=ArrayBuffer.isView(n):e=n&&n.buffer&&cs(n.buffer),e}const Ca=ft("string"),_e=ft("function"),ds=ft("number"),vt=n=>n!==null&&typeof n=="object",Ea=n=>n===!0||n===!1,rt=n=>{if(ht(n)!=="object")return!1;const e=Mt(n);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(is in n)&&!(mt in n)},Ra=Pe("Date"),Ia=Pe("File"),Aa=Pe("Blob"),xa=Pe("FileList"),Da=n=>vt(n)&&_e(n.pipe),Fa=n=>{let e;return n&&(typeof FormData=="function"&&n instanceof FormData||_e(n.append)&&((e=ht(n))==="formdata"||e==="object"&&_e(n.toString)&&n.toString()==="[object FormData]"))},Ma=Pe("URLSearchParams"),[Ua,Na,La,Oa]=["ReadableStream","Request","Response","Headers"].map(Pe),Ba=n=>n.trim?n.trim():n.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function at(n,e,{allOwnKeys:t=!1}={}){if(n===null||typeof n>"u")return;let o,a;if(typeof n!="object"&&(n=[n]),je(n))for(o=0,a=n.length;o<a;o++)e.call(null,n[o],o,n);else{const l=t?Object.getOwnPropertyNames(n):Object.keys(n),i=l.length;let u;for(o=0;o<i;o++)u=l[o],e.call(null,n[u],u,n)}}function us(n,e){e=e.toLowerCase();const t=Object.keys(n);let o=t.length,a;for(;o-- >0;)if(a=t[o],e===a.toLowerCase())return a;return null}const Ue=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,ps=n=>!st(n)&&n!==Ue;function Tt(){const{caseless:n}=ps(this)&&this||{},e={},t=(o,a)=>{const l=n&&us(e,a)||a;rt(e[l])&&rt(o)?e[l]=Tt(e[l],o):rt(o)?e[l]=Tt({},o):je(o)?e[l]=o.slice():e[l]=o};for(let o=0,a=arguments.length;o<a;o++)arguments[o]&&at(arguments[o],t);return e}const qa=(n,e,t,{allOwnKeys:o}={})=>(at(e,(a,l)=>{t&&_e(a)?n[l]=rs(a,t):n[l]=a},{allOwnKeys:o}),n),Va=n=>(n.charCodeAt(0)===65279&&(n=n.slice(1)),n),ja=(n,e,t,o)=>{n.prototype=Object.create(e.prototype,o),n.prototype.constructor=n,Object.defineProperty(n,"super",{value:e.prototype}),t&&Object.assign(n.prototype,t)},Ja=(n,e,t,o)=>{let a,l,i;const u={};if(e=e||{},n==null)return e;do{for(a=Object.getOwnPropertyNames(n),l=a.length;l-- >0;)i=a[l],(!o||o(i,n,e))&&!u[i]&&(e[i]=n[i],u[i]=!0);n=t!==!1&&Mt(n)}while(n&&(!t||t(n,e))&&n!==Object.prototype);return e},Ha=(n,e,t)=>{n=String(n),(t===void 0||t>n.length)&&(t=n.length),t-=e.length;const o=n.indexOf(e,t);return o!==-1&&o===t},Ga=n=>{if(!n)return null;if(je(n))return n;let e=n.length;if(!ds(e))return null;const t=new Array(e);for(;e-- >0;)t[e]=n[e];return t},Wa=(n=>e=>n&&e instanceof n)(typeof Uint8Array<"u"&&Mt(Uint8Array)),za=(n,e)=>{const o=(n&&n[mt]).call(n);let a;for(;(a=o.next())&&!a.done;){const l=a.value;e.call(n,l[0],l[1])}},Ka=(n,e)=>{let t;const o=[];for(;(t=n.exec(e))!==null;)o.push(t);return o},Xa=Pe("HTMLFormElement"),Qa=n=>n.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(t,o,a){return o.toUpperCase()+a}),Bt=(({hasOwnProperty:n})=>(e,t)=>n.call(e,t))(Object.prototype),Ya=Pe("RegExp"),ms=(n,e)=>{const t=Object.getOwnPropertyDescriptors(n),o={};at(t,(a,l)=>{let i;(i=e(a,l,n))!==!1&&(o[l]=i||a)}),Object.defineProperties(n,o)},Za=n=>{ms(n,(e,t)=>{if(_e(n)&&["arguments","caller","callee"].indexOf(t)!==-1)return!1;const o=n[t];if(_e(o)){if(e.enumerable=!1,"writable"in e){e.writable=!1;return}e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+t+"'")})}})},el=(n,e)=>{const t={},o=a=>{a.forEach(l=>{t[l]=!0})};return je(n)?o(n):o(String(n).split(e)),t},tl=()=>{},sl=(n,e)=>n!=null&&Number.isFinite(n=+n)?n:e;function ol(n){return!!(n&&_e(n.append)&&n[is]==="FormData"&&n[mt])}const nl=n=>{const e=new Array(10),t=(o,a)=>{if(vt(o)){if(e.indexOf(o)>=0)return;if(!("toJSON"in o)){e[a]=o;const l=je(o)?[]:{};return at(o,(i,u)=>{const f=t(i,a+1);!st(f)&&(l[u]=f)}),e[a]=void 0,l}}return o};return t(n,0)},al=Pe("AsyncFunction"),ll=n=>n&&(vt(n)||_e(n))&&_e(n.then)&&_e(n.catch),hs=((n,e)=>n?setImmediate:e?((t,o)=>(Ue.addEventListener("message",({source:a,data:l})=>{a===Ue&&l===t&&o.length&&o.shift()()},!1),a=>{o.push(a),Ue.postMessage(t,"*")}))(`axios@${Math.random()}`,[]):t=>setTimeout(t))(typeof setImmediate=="function",_e(Ue.postMessage)),rl=typeof queueMicrotask<"u"?queueMicrotask.bind(Ue):typeof process<"u"&&process.nextTick||hs,il=n=>n!=null&&_e(n[mt]),x={isArray:je,isArrayBuffer:cs,isBuffer:Ta,isFormData:Fa,isArrayBufferView:Pa,isString:Ca,isNumber:ds,isBoolean:Ea,isObject:vt,isPlainObject:rt,isReadableStream:Ua,isRequest:Na,isResponse:La,isHeaders:Oa,isUndefined:st,isDate:Ra,isFile:Ia,isBlob:Aa,isRegExp:Ya,isFunction:_e,isStream:Da,isURLSearchParams:Ma,isTypedArray:Wa,isFileList:xa,forEach:at,merge:Tt,extend:qa,trim:Ba,stripBOM:Va,inherits:ja,toFlatObject:Ja,kindOf:ht,kindOfTest:Pe,endsWith:Ha,toArray:Ga,forEachEntry:za,matchAll:Ka,isHTMLForm:Xa,hasOwnProperty:Bt,hasOwnProp:Bt,reduceDescriptors:ms,freezeMethods:Za,toObjectSet:el,toCamelCase:Qa,noop:tl,toFiniteNumber:sl,findKey:us,global:Ue,isContextDefined:ps,isSpecCompliantForm:ol,toJSONObject:nl,isAsyncFn:al,isThenable:ll,setImmediate:hs,asap:rl,isIterable:il};function te(n,e,t,o,a){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=n,this.name="AxiosError",e&&(this.code=e),t&&(this.config=t),o&&(this.request=o),a&&(this.response=a,this.status=a.status?a.status:null)}x.inherits(te,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:x.toJSONObject(this.config),code:this.code,status:this.status}}});const fs=te.prototype,vs={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(n=>{vs[n]={value:n}});Object.defineProperties(te,vs);Object.defineProperty(fs,"isAxiosError",{value:!0});te.from=(n,e,t,o,a,l)=>{const i=Object.create(fs);return x.toFlatObject(n,i,function(f){return f!==Error.prototype},u=>u!=="isAxiosError"),te.call(i,n.message,e,t,o,a),i.cause=n,i.name=n.name,l&&Object.assign(i,l),i};const cl=null;function Pt(n){return x.isPlainObject(n)||x.isArray(n)}function gs(n){return x.endsWith(n,"[]")?n.slice(0,-2):n}function qt(n,e,t){return n?n.concat(e).map(function(a,l){return a=gs(a),!t&&l?"["+a+"]":a}).join(t?".":""):e}function dl(n){return x.isArray(n)&&!n.some(Pt)}const ul=x.toFlatObject(x,{},null,function(e){return/^is[A-Z]/.test(e)});function gt(n,e,t){if(!x.isObject(n))throw new TypeError("target must be an object");e=e||new FormData,t=x.toFlatObject(t,{metaTokens:!0,dots:!1,indexes:!1},!1,function(S,_){return!x.isUndefined(_[S])});const o=t.metaTokens,a=t.visitor||h,l=t.dots,i=t.indexes,f=(t.Blob||typeof Blob<"u"&&Blob)&&x.isSpecCompliantForm(e);if(!x.isFunction(a))throw new TypeError("visitor must be a function");function d(y){if(y===null)return"";if(x.isDate(y))return y.toISOString();if(!f&&x.isBlob(y))throw new te("Blob is not supported. Use a Buffer instead.");return x.isArrayBuffer(y)||x.isTypedArray(y)?f&&typeof Blob=="function"?new Blob([y]):Buffer.from(y):y}function h(y,S,_){let m=y;if(y&&!_&&typeof y=="object"){if(x.endsWith(S,"{}"))S=o?S:S.slice(0,-2),y=JSON.stringify(y);else if(x.isArray(y)&&dl(y)||(x.isFileList(y)||x.endsWith(S,"[]"))&&(m=x.toArray(y)))return S=gs(S),m.forEach(function(w,D){!(x.isUndefined(w)||w===null)&&e.append(i===!0?qt([S],D,l):i===null?S:S+"[]",d(w))}),!1}return Pt(y)?!0:(e.append(qt(_,S,l),d(y)),!1)}const $=[],M=Object.assign(ul,{defaultVisitor:h,convertValue:d,isVisitable:Pt});function L(y,S){if(!x.isUndefined(y)){if($.indexOf(y)!==-1)throw Error("Circular reference detected in "+S.join("."));$.push(y),x.forEach(y,function(m,C){(!(x.isUndefined(m)||m===null)&&a.call(e,m,x.isString(C)?C.trim():C,S,M))===!0&&L(m,S?S.concat(C):[C])}),$.pop()}}if(!x.isObject(n))throw new TypeError("data must be an object");return L(n),e}function Vt(n){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(n).replace(/[!'()~]|%20|%00/g,function(o){return e[o]})}function Ut(n,e){this._pairs=[],n&&gt(n,this,e)}const bs=Ut.prototype;bs.append=function(e,t){this._pairs.push([e,t])};bs.toString=function(e){const t=e?function(o){return e.call(this,o,Vt)}:Vt;return this._pairs.map(function(a){return t(a[0])+"="+t(a[1])},"").join("&")};function pl(n){return encodeURIComponent(n).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function ys(n,e,t){if(!e)return n;const o=t&&t.encode||pl;x.isFunction(t)&&(t={serialize:t});const a=t&&t.serialize;let l;if(a?l=a(e,t):l=x.isURLSearchParams(e)?e.toString():new Ut(e,t).toString(o),l){const i=n.indexOf("#");i!==-1&&(n=n.slice(0,i)),n+=(n.indexOf("?")===-1?"?":"&")+l}return n}class jt{constructor(){this.handlers=[]}use(e,t,o){return this.handlers.push({fulfilled:e,rejected:t,synchronous:o?o.synchronous:!1,runWhen:o?o.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){x.forEach(this.handlers,function(o){o!==null&&e(o)})}}const _s={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},ml=typeof URLSearchParams<"u"?URLSearchParams:Ut,hl=typeof FormData<"u"?FormData:null,fl=typeof Blob<"u"?Blob:null,vl={isBrowser:!0,classes:{URLSearchParams:ml,FormData:hl,Blob:fl},protocols:["http","https","file","blob","url","data"]},Nt=typeof window<"u"&&typeof document<"u",Ct=typeof navigator=="object"&&navigator||void 0,gl=Nt&&(!Ct||["ReactNative","NativeScript","NS"].indexOf(Ct.product)<0),bl=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",yl=Nt&&window.location.href||"http://localhost",_l=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:Nt,hasStandardBrowserEnv:gl,hasStandardBrowserWebWorkerEnv:bl,navigator:Ct,origin:yl},Symbol.toStringTag,{value:"Module"})),ge={..._l,...vl};function $l(n,e){return gt(n,new ge.classes.URLSearchParams,Object.assign({visitor:function(t,o,a,l){return ge.isNode&&x.isBuffer(t)?(this.append(o,t.toString("base64")),!1):l.defaultVisitor.apply(this,arguments)}},e))}function Sl(n){return x.matchAll(/\w+|\[(\w*)]/g,n).map(e=>e[0]==="[]"?"":e[1]||e[0])}function wl(n){const e={},t=Object.keys(n);let o;const a=t.length;let l;for(o=0;o<a;o++)l=t[o],e[l]=n[l];return e}function $s(n){function e(t,o,a,l){let i=t[l++];if(i==="__proto__")return!0;const u=Number.isFinite(+i),f=l>=t.length;return i=!i&&x.isArray(a)?a.length:i,f?(x.hasOwnProp(a,i)?a[i]=[a[i],o]:a[i]=o,!u):((!a[i]||!x.isObject(a[i]))&&(a[i]=[]),e(t,o,a[i],l)&&x.isArray(a[i])&&(a[i]=wl(a[i])),!u)}if(x.isFormData(n)&&x.isFunction(n.entries)){const t={};return x.forEachEntry(n,(o,a)=>{e(Sl(o),a,t,0)}),t}return null}function kl(n,e,t){if(x.isString(n))try{return(e||JSON.parse)(n),x.trim(n)}catch(o){if(o.name!=="SyntaxError")throw o}return(t||JSON.stringify)(n)}const lt={transitional:_s,adapter:["xhr","http","fetch"],transformRequest:[function(e,t){const o=t.getContentType()||"",a=o.indexOf("application/json")>-1,l=x.isObject(e);if(l&&x.isHTMLForm(e)&&(e=new FormData(e)),x.isFormData(e))return a?JSON.stringify($s(e)):e;if(x.isArrayBuffer(e)||x.isBuffer(e)||x.isStream(e)||x.isFile(e)||x.isBlob(e)||x.isReadableStream(e))return e;if(x.isArrayBufferView(e))return e.buffer;if(x.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let u;if(l){if(o.indexOf("application/x-www-form-urlencoded")>-1)return $l(e,this.formSerializer).toString();if((u=x.isFileList(e))||o.indexOf("multipart/form-data")>-1){const f=this.env&&this.env.FormData;return gt(u?{"files[]":e}:e,f&&new f,this.formSerializer)}}return l||a?(t.setContentType("application/json",!1),kl(e)):e}],transformResponse:[function(e){const t=this.transitional||lt.transitional,o=t&&t.forcedJSONParsing,a=this.responseType==="json";if(x.isResponse(e)||x.isReadableStream(e))return e;if(e&&x.isString(e)&&(o&&!this.responseType||a)){const i=!(t&&t.silentJSONParsing)&&a;try{return JSON.parse(e)}catch(u){if(i)throw u.name==="SyntaxError"?te.from(u,te.ERR_BAD_RESPONSE,this,null,this.response):u}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:ge.classes.FormData,Blob:ge.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};x.forEach(["delete","get","head","post","put","patch"],n=>{lt.headers[n]={}});const Tl=x.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),Pl=n=>{const e={};let t,o,a;return n&&n.split(`
`).forEach(function(i){a=i.indexOf(":"),t=i.substring(0,a).trim().toLowerCase(),o=i.substring(a+1).trim(),!(!t||e[t]&&Tl[t])&&(t==="set-cookie"?e[t]?e[t].push(o):e[t]=[o]:e[t]=e[t]?e[t]+", "+o:o)}),e},Jt=Symbol("internals");function Qe(n){return n&&String(n).trim().toLowerCase()}function it(n){return n===!1||n==null?n:x.isArray(n)?n.map(it):String(n)}function Cl(n){const e=Object.create(null),t=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let o;for(;o=t.exec(n);)e[o[1]]=o[2];return e}const El=n=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(n.trim());function $t(n,e,t,o,a){if(x.isFunction(o))return o.call(this,e,t);if(a&&(e=t),!!x.isString(e)){if(x.isString(o))return e.indexOf(o)!==-1;if(x.isRegExp(o))return o.test(e)}}function Rl(n){return n.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,t,o)=>t.toUpperCase()+o)}function Il(n,e){const t=x.toCamelCase(" "+e);["get","set","has"].forEach(o=>{Object.defineProperty(n,o+t,{value:function(a,l,i){return this[o].call(this,e,a,l,i)},configurable:!0})})}let $e=class{constructor(e){e&&this.set(e)}set(e,t,o){const a=this;function l(u,f,d){const h=Qe(f);if(!h)throw new Error("header name must be a non-empty string");const $=x.findKey(a,h);(!$||a[$]===void 0||d===!0||d===void 0&&a[$]!==!1)&&(a[$||f]=it(u))}const i=(u,f)=>x.forEach(u,(d,h)=>l(d,h,f));if(x.isPlainObject(e)||e instanceof this.constructor)i(e,t);else if(x.isString(e)&&(e=e.trim())&&!El(e))i(Pl(e),t);else if(x.isObject(e)&&x.isIterable(e)){let u={},f,d;for(const h of e){if(!x.isArray(h))throw TypeError("Object iterator must return a key-value pair");u[d=h[0]]=(f=u[d])?x.isArray(f)?[...f,h[1]]:[f,h[1]]:h[1]}i(u,t)}else e!=null&&l(t,e,o);return this}get(e,t){if(e=Qe(e),e){const o=x.findKey(this,e);if(o){const a=this[o];if(!t)return a;if(t===!0)return Cl(a);if(x.isFunction(t))return t.call(this,a,o);if(x.isRegExp(t))return t.exec(a);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,t){if(e=Qe(e),e){const o=x.findKey(this,e);return!!(o&&this[o]!==void 0&&(!t||$t(this,this[o],o,t)))}return!1}delete(e,t){const o=this;let a=!1;function l(i){if(i=Qe(i),i){const u=x.findKey(o,i);u&&(!t||$t(o,o[u],u,t))&&(delete o[u],a=!0)}}return x.isArray(e)?e.forEach(l):l(e),a}clear(e){const t=Object.keys(this);let o=t.length,a=!1;for(;o--;){const l=t[o];(!e||$t(this,this[l],l,e,!0))&&(delete this[l],a=!0)}return a}normalize(e){const t=this,o={};return x.forEach(this,(a,l)=>{const i=x.findKey(o,l);if(i){t[i]=it(a),delete t[l];return}const u=e?Rl(l):String(l).trim();u!==l&&delete t[l],t[u]=it(a),o[u]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const t=Object.create(null);return x.forEach(this,(o,a)=>{o!=null&&o!==!1&&(t[a]=e&&x.isArray(o)?o.join(", "):o)}),t}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,t])=>e+": "+t).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...t){const o=new this(e);return t.forEach(a=>o.set(a)),o}static accessor(e){const o=(this[Jt]=this[Jt]={accessors:{}}).accessors,a=this.prototype;function l(i){const u=Qe(i);o[u]||(Il(a,i),o[u]=!0)}return x.isArray(e)?e.forEach(l):l(e),this}};$e.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);x.reduceDescriptors($e.prototype,({value:n},e)=>{let t=e[0].toUpperCase()+e.slice(1);return{get:()=>n,set(o){this[t]=o}}});x.freezeMethods($e);function St(n,e){const t=this||lt,o=e||t,a=$e.from(o.headers);let l=o.data;return x.forEach(n,function(u){l=u.call(t,l,a.normalize(),e?e.status:void 0)}),a.normalize(),l}function Ss(n){return!!(n&&n.__CANCEL__)}function Je(n,e,t){te.call(this,n??"canceled",te.ERR_CANCELED,e,t),this.name="CanceledError"}x.inherits(Je,te,{__CANCEL__:!0});function ws(n,e,t){const o=t.config.validateStatus;!t.status||!o||o(t.status)?n(t):e(new te("Request failed with status code "+t.status,[te.ERR_BAD_REQUEST,te.ERR_BAD_RESPONSE][Math.floor(t.status/100)-4],t.config,t.request,t))}function Al(n){const e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(n);return e&&e[1]||""}function xl(n,e){n=n||10;const t=new Array(n),o=new Array(n);let a=0,l=0,i;return e=e!==void 0?e:1e3,function(f){const d=Date.now(),h=o[l];i||(i=d),t[a]=f,o[a]=d;let $=l,M=0;for(;$!==a;)M+=t[$++],$=$%n;if(a=(a+1)%n,a===l&&(l=(l+1)%n),d-i<e)return;const L=h&&d-h;return L?Math.round(M*1e3/L):void 0}}function Dl(n,e){let t=0,o=1e3/e,a,l;const i=(d,h=Date.now())=>{t=h,a=null,l&&(clearTimeout(l),l=null),n.apply(null,d)};return[(...d)=>{const h=Date.now(),$=h-t;$>=o?i(d,h):(a=d,l||(l=setTimeout(()=>{l=null,i(a)},o-$)))},()=>a&&i(a)]}const ut=(n,e,t=3)=>{let o=0;const a=xl(50,250);return Dl(l=>{const i=l.loaded,u=l.lengthComputable?l.total:void 0,f=i-o,d=a(f),h=i<=u;o=i;const $={loaded:i,total:u,progress:u?i/u:void 0,bytes:f,rate:d||void 0,estimated:d&&u&&h?(u-i)/d:void 0,event:l,lengthComputable:u!=null,[e?"download":"upload"]:!0};n($)},t)},Ht=(n,e)=>{const t=n!=null;return[o=>e[0]({lengthComputable:t,total:n,loaded:o}),e[1]]},Gt=n=>(...e)=>x.asap(()=>n(...e)),Fl=ge.hasStandardBrowserEnv?((n,e)=>t=>(t=new URL(t,ge.origin),n.protocol===t.protocol&&n.host===t.host&&(e||n.port===t.port)))(new URL(ge.origin),ge.navigator&&/(msie|trident)/i.test(ge.navigator.userAgent)):()=>!0,Ml=ge.hasStandardBrowserEnv?{write(n,e,t,o,a,l){const i=[n+"="+encodeURIComponent(e)];x.isNumber(t)&&i.push("expires="+new Date(t).toGMTString()),x.isString(o)&&i.push("path="+o),x.isString(a)&&i.push("domain="+a),l===!0&&i.push("secure"),document.cookie=i.join("; ")},read(n){const e=document.cookie.match(new RegExp("(^|;\\s*)("+n+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove(n){this.write(n,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function Ul(n){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(n)}function Nl(n,e){return e?n.replace(/\/?\/$/,"")+"/"+e.replace(/^\/+/,""):n}function ks(n,e,t){let o=!Ul(e);return n&&(o||t==!1)?Nl(n,e):e}const Wt=n=>n instanceof $e?{...n}:n;function Oe(n,e){e=e||{};const t={};function o(d,h,$,M){return x.isPlainObject(d)&&x.isPlainObject(h)?x.merge.call({caseless:M},d,h):x.isPlainObject(h)?x.merge({},h):x.isArray(h)?h.slice():h}function a(d,h,$,M){if(x.isUndefined(h)){if(!x.isUndefined(d))return o(void 0,d,$,M)}else return o(d,h,$,M)}function l(d,h){if(!x.isUndefined(h))return o(void 0,h)}function i(d,h){if(x.isUndefined(h)){if(!x.isUndefined(d))return o(void 0,d)}else return o(void 0,h)}function u(d,h,$){if($ in e)return o(d,h);if($ in n)return o(void 0,d)}const f={url:l,method:l,data:l,baseURL:i,transformRequest:i,transformResponse:i,paramsSerializer:i,timeout:i,timeoutMessage:i,withCredentials:i,withXSRFToken:i,adapter:i,responseType:i,xsrfCookieName:i,xsrfHeaderName:i,onUploadProgress:i,onDownloadProgress:i,decompress:i,maxContentLength:i,maxBodyLength:i,beforeRedirect:i,transport:i,httpAgent:i,httpsAgent:i,cancelToken:i,socketPath:i,responseEncoding:i,validateStatus:u,headers:(d,h,$)=>a(Wt(d),Wt(h),$,!0)};return x.forEach(Object.keys(Object.assign({},n,e)),function(h){const $=f[h]||a,M=$(n[h],e[h],h);x.isUndefined(M)&&$!==u||(t[h]=M)}),t}const Ts=n=>{const e=Oe({},n);let{data:t,withXSRFToken:o,xsrfHeaderName:a,xsrfCookieName:l,headers:i,auth:u}=e;e.headers=i=$e.from(i),e.url=ys(ks(e.baseURL,e.url,e.allowAbsoluteUrls),n.params,n.paramsSerializer),u&&i.set("Authorization","Basic "+btoa((u.username||"")+":"+(u.password?unescape(encodeURIComponent(u.password)):"")));let f;if(x.isFormData(t)){if(ge.hasStandardBrowserEnv||ge.hasStandardBrowserWebWorkerEnv)i.setContentType(void 0);else if((f=i.getContentType())!==!1){const[d,...h]=f?f.split(";").map($=>$.trim()).filter(Boolean):[];i.setContentType([d||"multipart/form-data",...h].join("; "))}}if(ge.hasStandardBrowserEnv&&(o&&x.isFunction(o)&&(o=o(e)),o||o!==!1&&Fl(e.url))){const d=a&&l&&Ml.read(l);d&&i.set(a,d)}return e},Ll=typeof XMLHttpRequest<"u",Ol=Ll&&function(n){return new Promise(function(t,o){const a=Ts(n);let l=a.data;const i=$e.from(a.headers).normalize();let{responseType:u,onUploadProgress:f,onDownloadProgress:d}=a,h,$,M,L,y;function S(){L&&L(),y&&y(),a.cancelToken&&a.cancelToken.unsubscribe(h),a.signal&&a.signal.removeEventListener("abort",h)}let _=new XMLHttpRequest;_.open(a.method.toUpperCase(),a.url,!0),_.timeout=a.timeout;function m(){if(!_)return;const w=$e.from("getAllResponseHeaders"in _&&_.getAllResponseHeaders()),v={data:!u||u==="text"||u==="json"?_.responseText:_.response,status:_.status,statusText:_.statusText,headers:w,config:n,request:_};ws(function(A){t(A),S()},function(A){o(A),S()},v),_=null}"onloadend"in _?_.onloadend=m:_.onreadystatechange=function(){!_||_.readyState!==4||_.status===0&&!(_.responseURL&&_.responseURL.indexOf("file:")===0)||setTimeout(m)},_.onabort=function(){_&&(o(new te("Request aborted",te.ECONNABORTED,n,_)),_=null)},_.onerror=function(){o(new te("Network Error",te.ERR_NETWORK,n,_)),_=null},_.ontimeout=function(){let D=a.timeout?"timeout of "+a.timeout+"ms exceeded":"timeout exceeded";const v=a.transitional||_s;a.timeoutErrorMessage&&(D=a.timeoutErrorMessage),o(new te(D,v.clarifyTimeoutError?te.ETIMEDOUT:te.ECONNABORTED,n,_)),_=null},l===void 0&&i.setContentType(null),"setRequestHeader"in _&&x.forEach(i.toJSON(),function(D,v){_.setRequestHeader(v,D)}),x.isUndefined(a.withCredentials)||(_.withCredentials=!!a.withCredentials),u&&u!=="json"&&(_.responseType=a.responseType),d&&([M,y]=ut(d,!0),_.addEventListener("progress",M)),f&&_.upload&&([$,L]=ut(f),_.upload.addEventListener("progress",$),_.upload.addEventListener("loadend",L)),(a.cancelToken||a.signal)&&(h=w=>{_&&(o(!w||w.type?new Je(null,n,_):w),_.abort(),_=null)},a.cancelToken&&a.cancelToken.subscribe(h),a.signal&&(a.signal.aborted?h():a.signal.addEventListener("abort",h)));const C=Al(a.url);if(C&&ge.protocols.indexOf(C)===-1){o(new te("Unsupported protocol "+C+":",te.ERR_BAD_REQUEST,n));return}_.send(l||null)})},Bl=(n,e)=>{const{length:t}=n=n?n.filter(Boolean):[];if(e||t){let o=new AbortController,a;const l=function(d){if(!a){a=!0,u();const h=d instanceof Error?d:this.reason;o.abort(h instanceof te?h:new Je(h instanceof Error?h.message:h))}};let i=e&&setTimeout(()=>{i=null,l(new te(`timeout ${e} of ms exceeded`,te.ETIMEDOUT))},e);const u=()=>{n&&(i&&clearTimeout(i),i=null,n.forEach(d=>{d.unsubscribe?d.unsubscribe(l):d.removeEventListener("abort",l)}),n=null)};n.forEach(d=>d.addEventListener("abort",l));const{signal:f}=o;return f.unsubscribe=()=>x.asap(u),f}},ql=function*(n,e){let t=n.byteLength;if(t<e){yield n;return}let o=0,a;for(;o<t;)a=o+e,yield n.slice(o,a),o=a},Vl=async function*(n,e){for await(const t of jl(n))yield*ql(t,e)},jl=async function*(n){if(n[Symbol.asyncIterator]){yield*n;return}const e=n.getReader();try{for(;;){const{done:t,value:o}=await e.read();if(t)break;yield o}}finally{await e.cancel()}},zt=(n,e,t,o)=>{const a=Vl(n,e);let l=0,i,u=f=>{i||(i=!0,o&&o(f))};return new ReadableStream({async pull(f){try{const{done:d,value:h}=await a.next();if(d){u(),f.close();return}let $=h.byteLength;if(t){let M=l+=$;t(M)}f.enqueue(new Uint8Array(h))}catch(d){throw u(d),d}},cancel(f){return u(f),a.return()}},{highWaterMark:2})},bt=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",Ps=bt&&typeof ReadableStream=="function",Jl=bt&&(typeof TextEncoder=="function"?(n=>e=>n.encode(e))(new TextEncoder):async n=>new Uint8Array(await new Response(n).arrayBuffer())),Cs=(n,...e)=>{try{return!!n(...e)}catch{return!1}},Hl=Ps&&Cs(()=>{let n=!1;const e=new Request(ge.origin,{body:new ReadableStream,method:"POST",get duplex(){return n=!0,"half"}}).headers.has("Content-Type");return n&&!e}),Kt=64*1024,Et=Ps&&Cs(()=>x.isReadableStream(new Response("").body)),pt={stream:Et&&(n=>n.body)};bt&&(n=>{["text","arrayBuffer","blob","formData","stream"].forEach(e=>{!pt[e]&&(pt[e]=x.isFunction(n[e])?t=>t[e]():(t,o)=>{throw new te(`Response type '${e}' is not supported`,te.ERR_NOT_SUPPORT,o)})})})(new Response);const Gl=async n=>{if(n==null)return 0;if(x.isBlob(n))return n.size;if(x.isSpecCompliantForm(n))return(await new Request(ge.origin,{method:"POST",body:n}).arrayBuffer()).byteLength;if(x.isArrayBufferView(n)||x.isArrayBuffer(n))return n.byteLength;if(x.isURLSearchParams(n)&&(n=n+""),x.isString(n))return(await Jl(n)).byteLength},Wl=async(n,e)=>{const t=x.toFiniteNumber(n.getContentLength());return t??Gl(e)},zl=bt&&(async n=>{let{url:e,method:t,data:o,signal:a,cancelToken:l,timeout:i,onDownloadProgress:u,onUploadProgress:f,responseType:d,headers:h,withCredentials:$="same-origin",fetchOptions:M}=Ts(n);d=d?(d+"").toLowerCase():"text";let L=Bl([a,l&&l.toAbortSignal()],i),y;const S=L&&L.unsubscribe&&(()=>{L.unsubscribe()});let _;try{if(f&&Hl&&t!=="get"&&t!=="head"&&(_=await Wl(h,o))!==0){let v=new Request(e,{method:"POST",body:o,duplex:"half"}),E;if(x.isFormData(o)&&(E=v.headers.get("content-type"))&&h.setContentType(E),v.body){const[A,G]=Ht(_,ut(Gt(f)));o=zt(v.body,Kt,A,G)}}x.isString($)||($=$?"include":"omit");const m="credentials"in Request.prototype;y=new Request(e,{...M,signal:L,method:t.toUpperCase(),headers:h.normalize().toJSON(),body:o,duplex:"half",credentials:m?$:void 0});let C=await fetch(y);const w=Et&&(d==="stream"||d==="response");if(Et&&(u||w&&S)){const v={};["status","statusText","headers"].forEach(R=>{v[R]=C[R]});const E=x.toFiniteNumber(C.headers.get("content-length")),[A,G]=u&&Ht(E,ut(Gt(u),!0))||[];C=new Response(zt(C.body,Kt,A,()=>{G&&G(),S&&S()}),v)}d=d||"text";let D=await pt[x.findKey(pt,d)||"text"](C,n);return!w&&S&&S(),await new Promise((v,E)=>{ws(v,E,{data:D,headers:$e.from(C.headers),status:C.status,statusText:C.statusText,config:n,request:y})})}catch(m){throw S&&S(),m&&m.name==="TypeError"&&/Load failed|fetch/i.test(m.message)?Object.assign(new te("Network Error",te.ERR_NETWORK,n,y),{cause:m.cause||m}):te.from(m,m&&m.code,n,y)}}),Rt={http:cl,xhr:Ol,fetch:zl};x.forEach(Rt,(n,e)=>{if(n){try{Object.defineProperty(n,"name",{value:e})}catch{}Object.defineProperty(n,"adapterName",{value:e})}});const Xt=n=>`- ${n}`,Kl=n=>x.isFunction(n)||n===null||n===!1,Es={getAdapter:n=>{n=x.isArray(n)?n:[n];const{length:e}=n;let t,o;const a={};for(let l=0;l<e;l++){t=n[l];let i;if(o=t,!Kl(t)&&(o=Rt[(i=String(t)).toLowerCase()],o===void 0))throw new te(`Unknown adapter '${i}'`);if(o)break;a[i||"#"+l]=o}if(!o){const l=Object.entries(a).map(([u,f])=>`adapter ${u} `+(f===!1?"is not supported by the environment":"is not available in the build"));let i=e?l.length>1?`since :
`+l.map(Xt).join(`
`):" "+Xt(l[0]):"as no adapter specified";throw new te("There is no suitable adapter to dispatch the request "+i,"ERR_NOT_SUPPORT")}return o},adapters:Rt};function wt(n){if(n.cancelToken&&n.cancelToken.throwIfRequested(),n.signal&&n.signal.aborted)throw new Je(null,n)}function Qt(n){return wt(n),n.headers=$e.from(n.headers),n.data=St.call(n,n.transformRequest),["post","put","patch"].indexOf(n.method)!==-1&&n.headers.setContentType("application/x-www-form-urlencoded",!1),Es.getAdapter(n.adapter||lt.adapter)(n).then(function(o){return wt(n),o.data=St.call(n,n.transformResponse,o),o.headers=$e.from(o.headers),o},function(o){return Ss(o)||(wt(n),o&&o.response&&(o.response.data=St.call(n,n.transformResponse,o.response),o.response.headers=$e.from(o.response.headers))),Promise.reject(o)})}const Rs="1.9.0",yt={};["object","boolean","number","function","string","symbol"].forEach((n,e)=>{yt[n]=function(o){return typeof o===n||"a"+(e<1?"n ":" ")+n}});const Yt={};yt.transitional=function(e,t,o){function a(l,i){return"[Axios v"+Rs+"] Transitional option '"+l+"'"+i+(o?". "+o:"")}return(l,i,u)=>{if(e===!1)throw new te(a(i," has been removed"+(t?" in "+t:"")),te.ERR_DEPRECATED);return t&&!Yt[i]&&(Yt[i]=!0,console.warn(a(i," has been deprecated since v"+t+" and will be removed in the near future"))),e?e(l,i,u):!0}};yt.spelling=function(e){return(t,o)=>(console.warn(`${o} is likely a misspelling of ${e}`),!0)};function Xl(n,e,t){if(typeof n!="object")throw new te("options must be an object",te.ERR_BAD_OPTION_VALUE);const o=Object.keys(n);let a=o.length;for(;a-- >0;){const l=o[a],i=e[l];if(i){const u=n[l],f=u===void 0||i(u,l,n);if(f!==!0)throw new te("option "+l+" must be "+f,te.ERR_BAD_OPTION_VALUE);continue}if(t!==!0)throw new te("Unknown option "+l,te.ERR_BAD_OPTION)}}const ct={assertOptions:Xl,validators:yt},Re=ct.validators;let Le=class{constructor(e){this.defaults=e||{},this.interceptors={request:new jt,response:new jt}}async request(e,t){try{return await this._request(e,t)}catch(o){if(o instanceof Error){let a={};Error.captureStackTrace?Error.captureStackTrace(a):a=new Error;const l=a.stack?a.stack.replace(/^.+\n/,""):"";try{o.stack?l&&!String(o.stack).endsWith(l.replace(/^.+\n.+\n/,""))&&(o.stack+=`
`+l):o.stack=l}catch{}}throw o}}_request(e,t){typeof e=="string"?(t=t||{},t.url=e):t=e||{},t=Oe(this.defaults,t);const{transitional:o,paramsSerializer:a,headers:l}=t;o!==void 0&&ct.assertOptions(o,{silentJSONParsing:Re.transitional(Re.boolean),forcedJSONParsing:Re.transitional(Re.boolean),clarifyTimeoutError:Re.transitional(Re.boolean)},!1),a!=null&&(x.isFunction(a)?t.paramsSerializer={serialize:a}:ct.assertOptions(a,{encode:Re.function,serialize:Re.function},!0)),t.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?t.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:t.allowAbsoluteUrls=!0),ct.assertOptions(t,{baseUrl:Re.spelling("baseURL"),withXsrfToken:Re.spelling("withXSRFToken")},!0),t.method=(t.method||this.defaults.method||"get").toLowerCase();let i=l&&x.merge(l.common,l[t.method]);l&&x.forEach(["delete","get","head","post","put","patch","common"],y=>{delete l[y]}),t.headers=$e.concat(i,l);const u=[];let f=!0;this.interceptors.request.forEach(function(S){typeof S.runWhen=="function"&&S.runWhen(t)===!1||(f=f&&S.synchronous,u.unshift(S.fulfilled,S.rejected))});const d=[];this.interceptors.response.forEach(function(S){d.push(S.fulfilled,S.rejected)});let h,$=0,M;if(!f){const y=[Qt.bind(this),void 0];for(y.unshift.apply(y,u),y.push.apply(y,d),M=y.length,h=Promise.resolve(t);$<M;)h=h.then(y[$++],y[$++]);return h}M=u.length;let L=t;for($=0;$<M;){const y=u[$++],S=u[$++];try{L=y(L)}catch(_){S.call(this,_);break}}try{h=Qt.call(this,L)}catch(y){return Promise.reject(y)}for($=0,M=d.length;$<M;)h=h.then(d[$++],d[$++]);return h}getUri(e){e=Oe(this.defaults,e);const t=ks(e.baseURL,e.url,e.allowAbsoluteUrls);return ys(t,e.params,e.paramsSerializer)}};x.forEach(["delete","get","head","options"],function(e){Le.prototype[e]=function(t,o){return this.request(Oe(o||{},{method:e,url:t,data:(o||{}).data}))}});x.forEach(["post","put","patch"],function(e){function t(o){return function(l,i,u){return this.request(Oe(u||{},{method:e,headers:o?{"Content-Type":"multipart/form-data"}:{},url:l,data:i}))}}Le.prototype[e]=t(),Le.prototype[e+"Form"]=t(!0)});let Ql=class Is{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let t;this.promise=new Promise(function(l){t=l});const o=this;this.promise.then(a=>{if(!o._listeners)return;let l=o._listeners.length;for(;l-- >0;)o._listeners[l](a);o._listeners=null}),this.promise.then=a=>{let l;const i=new Promise(u=>{o.subscribe(u),l=u}).then(a);return i.cancel=function(){o.unsubscribe(l)},i},e(function(l,i,u){o.reason||(o.reason=new Je(l,i,u),t(o.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const t=this._listeners.indexOf(e);t!==-1&&this._listeners.splice(t,1)}toAbortSignal(){const e=new AbortController,t=o=>{e.abort(o)};return this.subscribe(t),e.signal.unsubscribe=()=>this.unsubscribe(t),e.signal}static source(){let e;return{token:new Is(function(a){e=a}),cancel:e}}};function Yl(n){return function(t){return n.apply(null,t)}}function Zl(n){return x.isObject(n)&&n.isAxiosError===!0}const It={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(It).forEach(([n,e])=>{It[e]=n});function As(n){const e=new Le(n),t=rs(Le.prototype.request,e);return x.extend(t,Le.prototype,e,{allOwnKeys:!0}),x.extend(t,e,null,{allOwnKeys:!0}),t.create=function(a){return As(Oe(n,a))},t}const he=As(lt);he.Axios=Le;he.CanceledError=Je;he.CancelToken=Ql;he.isCancel=Ss;he.VERSION=Rs;he.toFormData=gt;he.AxiosError=te;he.Cancel=he.CanceledError;he.all=function(e){return Promise.all(e)};he.spread=Yl;he.isAxiosError=Zl;he.mergeConfig=Oe;he.AxiosHeaders=$e;he.formToJSON=n=>$s(x.isHTMLForm(n)?new FormData(n):n);he.getAdapter=Es.getAdapter;he.HttpStatusCode=It;he.default=he;const{Axios:_g,AxiosError:$g,CanceledError:Sg,isCancel:wg,CancelToken:kg,VERSION:Tg,all:Pg,Cancel:Cg,isAxiosError:Eg,spread:Rg,toFormData:Ig,AxiosHeaders:Ag,HttpStatusCode:xg,formToJSON:Dg,getAdapter:Fg,mergeConfig:Mg}=he;class er{static async getAvailableModels(){try{return(await he({url:"/api/models/available-models",method:"GET",baseURL:""})).data}catch(e){return console.error("Failed to fetch available models:",e),{options:[],total:0}}}}const tr={class:"assigned-tools"},sr={class:"section-header"},or={class:"tool-info"},nr={class:"tool-name"},ar={class:"tool-desc"},lr={key:0,class:"no-tools"},rr=de({__name:"AssignedTools",props:{title:{},selectedToolIds:{},availableTools:{},addButtonText:{default:"Add/Remove Tools"},emptyText:{default:"No tools assigned"},showAddButton:{type:Boolean,default:!0},useGridLayout:{type:Boolean,default:!1}},emits:["add-tools","tools-filtered"],setup(n,{emit:e}){const t=n,o=e,a=re(()=>t.selectedToolIds.filter(u=>t.availableTools.some(f=>f.key===u)));ie(a,u=>{u.length!==t.selectedToolIds.length&&o("tools-filtered",u)},{immediate:!0});const l=u=>{const f=t.availableTools.find(d=>d.key===u);return f?f.name:u},i=u=>{const f=t.availableTools.find(d=>d.key===u);return f?f.description:""};return(u,f)=>(p(),g("div",tr,[s("div",sr,[s("span",null,c(u.title)+" ("+c(a.value.length)+")",1),u.showAddButton?(p(),g("button",{key:0,class:"action-btn small",onClick:f[0]||(f[0]=d=>u.$emit("add-tools"))},[k(r(P),{icon:"carbon:add"}),Z(" "+c(u.addButtonText),1)])):O("",!0)]),s("div",{class:oe(["tools-grid",{"grid-layout":u.useGridLayout}])},[(p(!0),g(ne,null,le(a.value,d=>(p(),g("div",{key:d,class:"tool-item assigned"},[s("div",or,[s("span",nr,c(l(d)),1),s("span",ar,c(i(d)),1)])]))),128)),a.value.length===0?(p(),g("div",lr,[k(r(P),{icon:"carbon:tool-box"}),s("span",null,c(u.emptyText),1)])):O("",!0)],2)]))}}),ir=ue(rr,[["__scopeId","data-v-b5fd8074"]]),cr={class:"tool-selection-content"},dr={class:"tool-controls"},ur={class:"search-container"},pr=["placeholder"],mr={class:"sort-container"},hr={value:"group"},fr={value:"name"},vr={value:"enabled"},gr={class:"tool-summary"},br={class:"summary-text"},yr={key:0,class:"tool-groups"},_r=["onClick"],$r={class:"group-title-area"},Sr={class:"group-name"},wr={class:"group-count"},kr={class:"group-enable-all"},Tr=["checked","onChange","data-group"],Pr={class:"enable-label"},Cr={class:"tool-info"},Er={class:"tool-selection-name"},Rr={key:0,class:"tool-selection-desc"},Ir={class:"tool-actions"},Ar=["checked","onChange"],xr={key:1,class:"empty-state"},Dr=de({__name:"ToolSelectionModal",props:{modelValue:{type:Boolean},tools:{},selectedToolIds:{}},emits:["update:modelValue","confirm"],setup(n,{emit:e}){const t=n,o=e,a=re({get:()=>t.modelValue,set:E=>o("update:modelValue",E)}),l=N(""),i=N("group"),u=N(new Set),f=N([]),d=(E,A)=>{const G=document.querySelector(`input[data-group="${E}"]`);G&&(G.indeterminate=m(A))};ie(()=>t.selectedToolIds,E=>{f.value=[...E]},{immediate:!0});const h=re(()=>{let E=t.tools.filter(A=>A.key);if(E=E.filter(A=>A.selectable===!0),l.value){const A=l.value.toLowerCase();E=E.filter(G=>G.name.toLowerCase().includes(A)||G.description.toLowerCase().includes(A)||G.serviceGroup.toLowerCase().includes(A))}switch(i.value){case"name":E=[...E].sort((A,G)=>A.name.localeCompare(G.name));break;case"enabled":E=[...E].sort((A,G)=>{const R=f.value.includes(A.key),U=f.value.includes(G.key);return R&&!U?-1:!R&&U?1:A.name.localeCompare(G.name)});break;case"group":default:E=[...E].sort((A,G)=>{const R=A.serviceGroup||"Ungrouped",U=G.serviceGroup||"Ungrouped";return R!==U?R.localeCompare(U):A.name.localeCompare(G.name)});break}return E}),$=re(()=>{const E=new Map;return h.value.forEach(A=>{const G=A.serviceGroup||"Ungrouped";E.has(G)||E.set(G,[]),E.get(G).push(A)}),new Map([...E.entries()].sort())}),M=re(()=>h.value.length);ie([f,$],()=>{ye(()=>{for(const[E,A]of $.value)d(E,A)})},{flush:"post",deep:!1});const L=E=>f.value.includes(E),y=(E,A)=>{A.stopPropagation();const R=A.target.checked;if(!E){console.error("toolKey is undefined, cannot proceed");return}R?f.value.includes(E)||(f.value=[...f.value,E]):f.value=f.value.filter(U=>U!==E)},S=E=>E.filter(A=>f.value.includes(A.key)),_=E=>E.length>0&&E.every(A=>f.value.includes(A.key)),m=E=>{const A=S(E).length;return A>0&&A<E.length},C=(E,A)=>{A.stopPropagation();const R=A.target.checked,U=E.map(F=>F.key);if(R){const F=[...f.value];U.forEach(B=>{F.includes(B)||F.push(B)}),f.value=F}else f.value=f.value.filter(F=>!U.includes(F))},w=E=>{u.value.has(E)?u.value.delete(E):u.value.add(E)},D=()=>{o("confirm",[...f.value]),o("update:modelValue",!1)},v=()=>{f.value=[...t.selectedToolIds],o("update:modelValue",!1)};return ie(a,E=>{if(E){u.value.clear();const A=Array.from($.value.keys());A.length>1&&A.slice(1).forEach(G=>{u.value.add(G)})}}),(E,A)=>(p(),ae(os,{modelValue:a.value,"onUpdate:modelValue":[A[4]||(A[4]=G=>a.value=G),v],title:E.$t("toolSelection.title"),onConfirm:D},{default:Ie(()=>[s("div",cr,[s("div",dr,[s("div",ur,[se(s("input",{"onUpdate:modelValue":A[0]||(A[0]=G=>l.value=G),type:"text",class:"search-input",placeholder:E.$t("toolSelection.searchPlaceholder")},null,8,pr),[[ce,l.value]])]),s("div",mr,[se(s("select",{"onUpdate:modelValue":A[1]||(A[1]=G=>i.value=G),class:"sort-select"},[s("option",hr,c(E.$t("toolSelection.sortByGroup")),1),s("option",fr,c(E.$t("toolSelection.sortByName")),1),s("option",vr,c(E.$t("toolSelection.sortByStatus")),1)],512),[[nt,i.value]])])]),s("div",gr,[s("span",br,c(E.$t("toolSelection.summary",{groups:$.value.size,tools:M.value,selected:f.value.length})),1)]),$.value.size>0?(p(),g("div",yr,[(p(!0),g(ne,null,le($.value,([G,R])=>(p(),g("div",{key:G,class:"tool-group"},[s("div",{class:oe(["tool-group-header",{collapsed:u.value.has(G)}]),onClick:U=>w(G)},[s("div",$r,[k(r(P),{icon:u.value.has(G)?"carbon:chevron-right":"carbon:chevron-down",class:"collapse-icon"},null,8,["icon"]),k(r(P),{icon:"carbon:folder",class:"group-icon"}),s("span",Sr,c(G),1),s("span",wr," ("+c(S(R).length)+"/"+c(R.length)+") ",1)]),s("div",{class:"group-actions",onClick:A[2]||(A[2]=pe(()=>{},["stop"]))},[s("label",kr,[s("input",{type:"checkbox",class:"group-enable-checkbox",checked:_(R),onChange:U=>C(R,U),"data-group":G},null,40,Tr),s("span",Pr,c(E.$t("toolSelection.enableAll")),1)])])],10,_r),s("div",{class:oe(["tool-group-content",{collapsed:u.value.has(G)}])},[(p(!0),g(ne,null,le(R,U=>(p(),g("div",{key:U.key,class:"tool-selection-item"},[s("div",Cr,[s("div",Er,c(U.name),1),U.description?(p(),g("div",Rr,c(U.description),1)):O("",!0)]),s("div",Ir,[s("label",{class:"tool-enable-switch",onClick:A[3]||(A[3]=pe(()=>{},["stop"]))},[s("input",{type:"checkbox",class:"tool-enable-checkbox",checked:L(U.key),onChange:F=>y(U.key,F)},null,40,Ar),A[5]||(A[5]=s("span",{class:"tool-enable-slider"},null,-1))])])]))),128))],2)]))),128))])):(p(),g("div",xr,[k(r(P),{icon:"carbon:tools",class:"empty-icon"}),s("p",null,c(E.$t("toolSelection.noToolsFound")),1)]))])]),_:1},8,["modelValue","title"]))}}),Fr=ue(Dr,[["__scopeId","data-v-94a4d9ce"]]),Mr={class:"config-section"},Ur={class:"section-header"},Nr={key:0,class:"error-section"},Lr={class:"error-message"},Or={class:"error-content"},Br={class:"error-title"},qr={class:"error-description"},Vr={key:1,class:"visual-editor"},jr={class:"plan-basic-info"},Jr={class:"form-row"},Hr={class:"form-label"},Gr=["placeholder"],Wr={key:0,class:"field-error-message"},zr={class:"form-row"},Kr={class:"form-label"},Xr=["value","placeholder"],Qr={class:"steps-section"},Yr={class:"steps-header"},Zr={class:"form-label"},ei={class:"steps-actions"},ti=["title"],si={class:"steps-container"},oi={class:"step-header"},ni={class:"step-number"},ai={class:"step-actions"},li=["onClick","disabled","title"],ri=["onClick","disabled","title"],ii=["onClick","title"],ci={class:"step-content"},di={class:"form-row"},ui={class:"form-label"},pi=["onUpdate:modelValue","placeholder"],mi={class:"form-row"},hi={class:"form-label"},fi=["onUpdate:modelValue","placeholder"],vi={key:0,class:"preview-section"},gi={class:"preview-label"},bi={class:"preview-content"},yi={class:"preview-text"},_i={class:"preview-table-header"},$i={class:"form-row"},Si={class:"form-label"},wi={class:"model-selector"},ki=["onUpdate:modelValue","disabled"],Ti={key:0,disabled:"",value:""},Pi={key:1,disabled:"",value:""},Ci={value:"",disabled:""},Ei={value:""},Ri=["value","title"],Ii=["title"],Ai={key:0,class:"error-message"},xi={class:"form-row"},Di={key:0,class:"empty-steps"},Fi={key:0,class:"json-preview"},Mi={class:"preview-header"},Ui={class:"form-label"},Ni={class:"json-code"},Li={class:"editor-footer"},Oi={class:"section-actions"},Bi=["disabled","title"],qi=["disabled","title"],Vi=["disabled","title"],ji=["disabled"],Ji=de({__name:"JsonEditorV2",props:{jsonContent:{},canRollback:{type:Boolean},canRestore:{type:Boolean},isGenerating:{type:Boolean},isExecuting:{type:Boolean},currentPlanTemplateId:{default:""}},emits:["rollback","restore","save","copy-plan","update:jsonContent"],setup(n,{emit:e}){const t=n,o=e,a={...t,hiddenFields:[]},{showJsonPreview:l,displayData:i,formattedJsonOutput:u,addStep:f,removeStep:d,moveStepUp:h,moveStepDown:$,handleRollback:M,handleRestore:L,handleSave:y,toggleJsonPreview:S,closeJsonPreview:_}=ls(a,o),m=N(null),C=N(""),w=N([]),D=N(!1),v=N(""),E=N(!1),A=N(-1),G=async()=>{if(!D.value){D.value=!0,v.value="";try{const T=await er.getAvailableModels();w.value=T.options}catch(T){console.error("Failed to load models:",T),v.value=T instanceof Error?T.message:"Failed to load models",w.value=[]}finally{D.value=!1}}},R=T=>{A.value=T,E.value=!0,console.log("[JsonEditorV2] Available tools from store:",H.availableTools)},U=T=>{A.value>=0&&A.value<i.steps.length&&(i.steps[A.value].selectedToolKeys=[...T]),E.value=!1,A.value=-1},F=(T,j)=>{T>=0&&T<i.steps.length&&(i.steps[T].selectedToolKeys=[...j])},B=()=>{o("copy-plan")},V=()=>{try{m.value=null,i.title||(i.title=""),i.directResponse=!1}catch(T){const j=`Failed to initialize JsonEditorV2: ${T instanceof Error?T.message:"Unknown error"}`;m.value=j,console.error(j,T)}};ie(()=>i,T=>{try{T.title.trim()?C.value="":C.value="Title is required field",m.value=null}catch(j){m.value=`Invalid data structure: ${j instanceof Error?j.message:"Unknown error"}`,C.value=""}},{immediate:!0,deep:!0}),ie(()=>t.jsonContent,(T,j)=>{if(console.log("[JsonEditorV2] Props watch triggered - jsonContent changed from",j,"to",T),T&&T!==j){console.log("[JsonEditorV2] Force parsing new jsonContent:",T);try{const J=JSON.parse(T);console.log("[JsonEditorV2] Parsed new jsonContent:",J),Object.assign(i,{title:J.title||"",steps:J.steps||[],directResponse:!1,planTemplateId:J.planTemplateId||t.currentPlanTemplateId||"",planType:J.planType||"dynamic_agent"}),console.log("[JsonEditorV2] Updated displayData with new content:",i)}catch(J){console.warn("[JsonEditorV2] Failed to parse new jsonContent:",J)}}},{immediate:!0}),we(()=>{if(console.log("[JsonEditorV2] Component mounted with jsonContent:",t.jsonContent),console.log("[JsonEditorV2] Component mounted with currentPlanTemplateId:",t.currentPlanTemplateId),console.log("[JsonEditorV2] Component mounted with displayData:",i),t.jsonContent){console.log("[JsonEditorV2] Force parsing jsonContent on mount:",t.jsonContent);try{const T=JSON.parse(t.jsonContent);console.log("[JsonEditorV2] Parsed jsonContent on mount:",T),Object.assign(i,{title:T.title||"",steps:T.steps||[],directResponse:!1,planTemplateId:T.planTemplateId||t.currentPlanTemplateId||"",planType:T.planType||"dynamic_agent"}),console.log("[JsonEditorV2] Updated displayData on mount:",i)}catch(T){console.warn("[JsonEditorV2] Failed to parse jsonContent on mount:",T)}}V(),G()});const z=T=>{const j=T.target;j.style.height="auto";const J=20,X=Math.ceil(j.scrollHeight/J),q=4,K=12,ee=Math.max(q,Math.min(K,X)),b=ee*J;j.style.height=`${b}px`,j.rows=ee,X>K?j.style.overflowY="auto":j.style.overflowY="hidden"},Y=T=>{if(!T.trim())return"";const j=T.split(",").map(J=>J.trim()).filter(J=>J.length>0);return j.length===0?"":`|${j.join("|")}|`};return(T,j)=>{var J;return p(),g("div",Mr,[s("div",Ur,[k(r(P),{icon:"carbon:code",width:"16"}),s("span",null,c(T.$t("sidebar.dynamicAgentPlan")),1)]),m.value?(p(),g("div",Nr,[s("div",Lr,[k(r(P),{icon:"carbon:warning",width:"16"}),s("div",Or,[s("div",Br,c(T.$t("sidebar.planTypeError")),1),s("div",qr,c(m.value),1)])])])):(p(),g("div",Vr,[s("div",jr,[s("div",Jr,[s("label",Hr,c(T.$t("sidebar.title")),1),se(s("input",{"onUpdate:modelValue":j[0]||(j[0]=X=>r(i).title=X),type:"text",class:oe(["form-input",{error:C.value}]),placeholder:T.$t("sidebar.titlePlaceholder")},null,10,Gr),[[ce,r(i).title]]),C.value?(p(),g("div",Wr,[k(r(P),{icon:"carbon:warning",width:"12"}),Z(" "+c(C.value),1)])):O("",!0)]),s("div",zr,[s("label",Kr,c(T.$t("sidebar.planTemplateId")),1),s("input",{value:T.currentPlanTemplateId,type:"text",class:"form-input readonly-input",readonly:"",placeholder:T.$t("sidebar.planTemplateIdPlaceholder")},null,8,Xr)])]),s("div",Qr,[s("div",Yr,[s("label",Zr,c(T.$t("sidebar.tasks")),1),s("div",ei,[s("button",{onClick:j[1]||(j[1]=(...X)=>r(f)&&r(f)(...X)),class:"btn btn-xs",title:T.$t("sidebar.addStep")},[k(r(P),{icon:"carbon:add",width:"12"})],8,ti)])]),s("div",si,[(p(!0),g(ne,null,le(r(i).steps,(X,q)=>(p(),g("div",{key:q,class:"step-item"},[s("div",oi,[s("span",ni,c(T.$t("sidebar.subtask"))+" "+c(q+1),1),s("div",ai,[s("button",{onClick:K=>r(h)(q),disabled:q===0,class:"btn btn-xs",title:T.$t("sidebar.moveUp")},[k(r(P),{icon:"carbon:chevron-up",width:"12"})],8,li),s("button",{onClick:K=>r($)(q),disabled:q===r(i).steps.length-1,class:"btn btn-xs",title:T.$t("sidebar.moveDown")},[k(r(P),{icon:"carbon:chevron-down",width:"12"})],8,ri),s("button",{onClick:K=>r(d)(q),class:"btn btn-xs btn-danger",title:T.$t("sidebar.removeStep")},[k(r(P),{icon:"carbon:trash-can",width:"12"})],8,ii)])]),s("div",ci,[s("div",di,[s("label",ui,c(T.$t("sidebar.stepRequirement")),1),se(s("textarea",{"onUpdate:modelValue":K=>X.stepRequirement=K,class:"form-textarea auto-resize",placeholder:T.$t("sidebar.stepRequirementPlaceholder"),rows:"4",onInput:j[2]||(j[2]=K=>z(K))},null,40,pi),[[ce,X.stepRequirement]])]),s("div",mi,[s("label",hi,c(T.$t("sidebar.terminateColumns")),1),se(s("textarea",{"onUpdate:modelValue":K=>X.terminateColumns=K,class:"form-textarea auto-resize",placeholder:T.$t("sidebar.terminateColumnsPlaceholder"),rows:"4",onInput:j[3]||(j[3]=K=>z(K))},null,40,fi),[[ce,X.terminateColumns]]),X.terminateColumns&&X.terminateColumns.trim()?(p(),g("div",vi,[s("div",gi,c(T.$t("sidebar.preview"))+":",1),s("div",bi,[s("div",yi,[Z(c(T.$t("sidebar.systemWillReturnListWithTableHeaderFormat"))+": ",1),s("span",_i,c(Y(X.terminateColumns)),1)])])])):O("",!0)]),s("div",$i,[s("label",Si,c(T.$t("sidebar.modelName")),1),s("div",wi,[se(s("select",{"onUpdate:modelValue":K=>X.modelName=K,class:"form-select model-select",disabled:D.value},[D.value?(p(),g("option",Ti,c(T.$t("sidebar.loading")),1)):v.value?(p(),g("option",Pi,c(T.$t("sidebar.modelLoadError")),1)):O("",!0),s("option",Ci,c(T.$t("sidebar.modelNameDescription")),1),s("option",Ei,c(T.$t("sidebar.noModelSelected")),1),(p(!0),g(ne,null,le(w.value,K=>(p(),g("option",{key:K.value,value:K.value,title:K.label},c(K.label),9,Ri))),128))],8,ki),[[nt,X.modelName]]),v.value?(p(),g("button",{key:0,onClick:G,class:"btn btn-sm btn-danger",title:T.$t("sidebar.retryLoadModels")},[k(r(P),{icon:"carbon:warning",width:"14"}),Z(" "+c(T.$t("sidebar.retry")),1)],8,Ii)):O("",!0)]),v.value?(p(),g("div",Ai,[k(r(P),{icon:"carbon:warning",width:"12"}),Z(" "+c(v.value),1)])):O("",!0)]),s("div",xi,[k(ir,{title:T.$t("sidebar.selectedTools"),"selected-tool-ids":X.selectedToolKeys,"available-tools":r(H).availableTools,"add-button-text":T.$t("sidebar.addRemoveTools"),"empty-text":T.$t("sidebar.noTools"),"use-grid-layout":!0,onAddTools:K=>R(q),onToolsFiltered:K=>F(q,K)},null,8,["title","selected-tool-ids","available-tools","add-button-text","empty-text","onAddTools","onToolsFiltered"])])])]))),128)),r(i).steps.length===0?(p(),g("div",Di,[k(r(P),{icon:"carbon:add-alt",width:"32",class:"empty-icon"}),s("p",null,c(T.$t("sidebar.noSteps")),1),s("button",{onClick:j[4]||(j[4]=(...X)=>r(f)&&r(f)(...X)),class:"btn btn-primary"},[k(r(P),{icon:"carbon:add",width:"14"}),Z(" "+c(T.$t("sidebar.addFirstStep")),1)])])):O("",!0)])]),r(l)?(p(),g("div",Fi,[s("div",Mi,[s("label",Ui,c(T.$t("sidebar.jsonPreview")),1),s("button",{onClick:j[5]||(j[5]=(...X)=>r(_)&&r(_)(...X)),class:"btn btn-xs"},[k(r(P),{icon:"carbon:close",width:"12"})])]),s("pre",Ni,c(r(u)),1)])):O("",!0),s("div",Li,[s("button",{onClick:j[6]||(j[6]=(...X)=>r(S)&&r(S)(...X)),class:"btn btn-sm btn-secondary"},[k(r(P),{icon:"carbon:code",width:"14"}),Z(" "+c(r(l)?T.$t("sidebar.hideJson"):T.$t("sidebar.showJson")),1)]),s("div",Oi,[s("button",{class:"btn btn-sm",onClick:B,disabled:T.isGenerating||T.isExecuting,title:T.$t("sidebar.copyPlan")},[k(r(P),{icon:"carbon:copy",width:"14"}),Z(" "+c(T.$t("sidebar.copyPlan")),1)],8,Bi),s("button",{class:"btn btn-sm",onClick:j[7]||(j[7]=(...X)=>r(M)&&r(M)(...X)),disabled:!(T.canRollback??!1),title:T.$t("sidebar.rollback")},[k(r(P),{icon:"carbon:undo",width:"14"})],8,qi),s("button",{class:"btn btn-sm",onClick:j[8]||(j[8]=(...X)=>r(L)&&r(L)(...X)),disabled:!(T.canRestore??!1),title:T.$t("sidebar.restore")},[k(r(P),{icon:"carbon:redo",width:"14"})],8,Vi),s("button",{class:"btn btn-primary",onClick:j[9]||(j[9]=(...X)=>r(y)&&r(y)(...X)),disabled:T.isGenerating||T.isExecuting},[k(r(P),{icon:"carbon:save",width:"14"}),j[11]||(j[11]=Z(" Save "))],8,ji)])])])),k(Fr,{modelValue:E.value,"onUpdate:modelValue":j[10]||(j[10]=X=>E.value=X),tools:r(H).availableTools,"selected-tool-ids":A.value>=0?((J=r(i).steps[A.value])==null?void 0:J.selectedToolKeys)||[]:[],onConfirm:U},null,8,["modelValue","tools","selected-tool-ids"])])}}}),Hi=ue(Ji,[["__scopeId","data-v-59ef8b14"]]),Gi={class:"sidebar-content"},Wi={class:"sidebar-content-header"},zi={class:"sidebar-content-title"},Ki={class:"tab-switcher"},Xi=["disabled"],Qi={key:0,class:"tab-content"},Yi={class:"new-task-section"},Zi={class:"sidebar-content-list"},ec={key:0,class:"loading-state"},tc={key:1,class:"error-state"},sc={key:2,class:"empty-state"},oc=["onClick"],nc={class:"task-icon"},ac={class:"task-details"},lc={class:"task-title"},rc={class:"task-preview"},ic={class:"task-time"},cc={class:"task-actions"},dc=["title","onClick"],uc={key:1,class:"tab-content config-tab"},pc={key:0,class:"config-container"},mc={class:"template-info-header"},hc={class:"template-info"},fc={class:"template-id"},vc=["title"],gc={class:"modal-header"},bc={class:"modal-body"},yc={class:"form-row"},_c={class:"form-label"},$c=["placeholder"],Sc={class:"modal-footer"},wc=["disabled"],kc=de({__name:"Sidebar",emits:["planExecutionRequested"],setup(n,{expose:e,emit:t}){const{t:o}=Te(),a=ns(),l=N(80),i=N(!1),u=N(0),f=N(0),d=N(null),h=N({toolName:"",toolDescription:"",planTemplateId:"",inputSchema:"[]",enableHttpService:!1,enableMcpService:!1,enableInternalToolcall:!1,serviceGroup:""}),$=N(null),M=N({enabled:!0,success:!0}),L=re(()=>M.value.enabled);ie(()=>H.currentPlanTemplateId,(b,I)=>{console.log("[Sidebar] currentPlanTemplateId changed from",I,"to",b)}),ie(()=>H.jsonContent,(b,I)=>{console.log("[Sidebar] jsonContent changed from",I,"to",b)});const y=async()=>{try{const b=await xe.getCoordinatorToolConfig();M.value=b}catch(b){console.error("Failed to load CoordinatorTool configuration:",b),M.value={enabled:!0,success:!1,message:b instanceof Error?b.message:"Unknown error"}}},S=t,_=async()=>{try{const b=await H.saveTemplate();b!=null&&b.duplicate?a.success(o("sidebar.saveCompleted",{message:b.message,versionCount:b.versionCount})):b!=null&&b.saved?(a.success(o("sidebar.saveSuccess",{message:b.message,versionCount:b.versionCount})),m()):b!=null&&b.message&&a.success(o("sidebar.saveStatus",{message:b.message}))}catch(b){console.error("Failed to save plan modifications:",b),a.error(b.message||o("sidebar.saveFailed"))}},m=async()=>{await new Promise(b=>setTimeout(b,1e3)),console.log("[Sidebar] 🔄 Refreshing parameter requirements for templateId:",H.currentPlanTemplateId),await ye(),d.value?(console.log("[Sidebar] 📞 Calling ExecutionController.loadParameterRequirements()"),d.value.loadParameterRequirements(),setTimeout(()=>{d.value&&(console.log("[Sidebar] 🔄 Retry: Calling ExecutionController.loadParameterRequirements() again"),d.value.loadParameterRequirements())},2e3)):console.warn("[Sidebar] ⚠️ ExecutionController ref not available"),$.value?(console.log("[Sidebar] 📞 Calling PublishMcpServiceModal.loadParameterRequirements()"),$.value.loadParameterRequirements()):console.warn("[Sidebar] ⚠️ PublishMcpServiceModal ref not available")},C=()=>{try{typeof H.rollbackVersion=="function"?H.rollbackVersion():console.warn("rollbackVersion method is not available")}catch(b){console.error("Error during rollback operation:",b),a.error(o("sidebar.rollbackFailed")||"Rollback failed")}},w=()=>{try{typeof H.restoreVersion=="function"?H.restoreVersion():console.warn("restoreVersion method is not available")}catch(b){console.error("Error during restore operation:",b),a.error(o("sidebar.restoreFailed")||"Restore failed")}},D=async b=>{var I;console.log("[Sidebar] 🎯 handleExecutePlan called with payload:",JSON.stringify(b,null,2)),console.log("[Sidebar] 📊 Current sidebarStore state:",{currentPlanTemplateId:H.currentPlanTemplateId,selectedTemplate:(I=H.selectedTemplate)==null?void 0:I.id,jsonContent:H.jsonContent.substring(0,100)+"..."});try{const W=H.preparePlanExecution();if(console.log("[Sidebar] 📋 Prepared plan data:",JSON.stringify(W,null,2)),!W){console.log("[Sidebar] ❌ No plan data available, returning");return}const Q={...W,uploadedFiles:b.uploadedFiles,uploadKey:b.uploadKey};b.replacementParams&&Object.keys(b.replacementParams).length>0&&(console.log("[Sidebar] 🔄 Processing replacement parameters:",b.replacementParams),Q.replacementParams=b.replacementParams),console.log("[Sidebar] ✅ Final plan data:",JSON.stringify(Q,null,2));const me={...b,title:Q.title,planData:Q.planData,params:Q.params,uploadedFiles:Q.uploadedFiles,uploadKey:Q.uploadKey};console.log("[Sidebar] 📤 Emitting planExecutionRequested with final payload:",JSON.stringify(me,null,2)),S("planExecutionRequested",me),console.log("[Sidebar] ✅ Event emitted successfully")}catch(W){console.error("[Sidebar] ❌ Error executing plan:",W),a.error(o("sidebar.executeFailed")+": "+W.message)}finally{console.log("[Sidebar] 🧹 Cleaning up after execution"),H.finishPlanExecution(),H.clearExecutionParams(),d.value&&(console.log("[Sidebar] 🧹 Calling ExecutionController.clearExecutionParams"),d.value.clearExecutionParams()),console.log("[Sidebar] ✅ Cleanup completed")}},v=N(!1),E=N(!1),A=N(""),G=N(!1),R=()=>{if(console.log("[Sidebar] Publish MCP service button clicked"),console.log("[Sidebar] currentPlanTemplateId:",H.currentPlanTemplateId),!H.currentPlanTemplateId){console.log("[Sidebar] No plan template selected, showing warning"),a.error(o("mcpService.selectPlanTemplateFirst"));return}console.log("[Sidebar] Opening publish MCP service modal"),v.value=!0},U=async b=>{b===null?(console.log("MCP service deleted successfully"),a.success(o("mcpService.deleteSuccess")),h.value={toolName:"",toolDescription:"",planTemplateId:"",inputSchema:"[]",enableHttpService:!1,enableMcpService:!1,enableInternalToolcall:!1,serviceGroup:""}):(console.log("MCP service published successfully:",b),a.success(o("mcpService.publishSuccess")),h.value={...b,toolName:b.toolName,serviceGroup:b.serviceGroup??""}),console.log("[Sidebar] 🔄 Reloading available tools after service publish/delete"),await H.loadAvailableTools()},F=()=>{H.clearExecutionParams()},B=b=>{H.executionParams=b},V=()=>{if(console.log("[Sidebar] Copy plan clicked"),!H.selectedTemplate){console.log("[Sidebar] No template selected, cannot copy"),a.error(o("sidebar.selectPlanFirst"));return}A.value=(H.selectedTemplate.title??o("sidebar.unnamedPlan"))+" (copy)",console.log("[Sidebar] Opening copy plan modal"),E.value=!0},z=()=>{E.value=!1,A.value="",G.value=!1},Y=async()=>{if(!A.value.trim()){a.error(o("sidebar.titleRequired"));return}if(!H.selectedTemplate||!H.jsonContent){a.error(o("sidebar.noPlanToCopy"));return}G.value=!0;try{const I={...JSON.parse(H.jsonContent),title:A.value.trim(),planTemplateId:""},{PlanActApiService:W}=await Ye(async()=>{const{PlanActApiService:me}=await import("./sidebar-DD9JCzEa.js").then(Ce=>Ce.p);return{PlanActApiService:me}},__vite__mapDeps([0,1,2,3])),Q=await W.savePlanTemplate("",JSON.stringify(I));Q.saved?(a.success(o("sidebar.copyPlanSuccess",{title:A.value.trim()})),await H.loadPlanTemplateList(),z()):a.error(o("sidebar.copyPlanFailed",{message:Q.message||"Unknown error"}))}catch(b){console.error("[Sidebar] Error copying plan:",b),a.error(o("sidebar.copyPlanFailed",{message:b.message||"Unknown error"}))}finally{G.value=!1}},T=async b=>{if(!b){h.value={toolName:"",toolDescription:"",planTemplateId:"",inputSchema:"[]",enableHttpService:!1,enableMcpService:!1,enableInternalToolcall:!1,serviceGroup:""};return}try{const I=await xe.getCoordinatorToolsByTemplate(b);I?h.value={...I,toolName:I.toolName,serviceGroup:I.serviceGroup??""}:h.value={toolName:"",toolDescription:"",planTemplateId:b,inputSchema:"[]",enableHttpService:!1,enableMcpService:!1,enableInternalToolcall:!1,serviceGroup:""}}catch(I){console.error("Failed to load tool information:",I),h.value={toolName:"",toolDescription:"",planTemplateId:b,inputSchema:"[]",enableHttpService:!1,enableMcpService:!1,enableInternalToolcall:!1,serviceGroup:""}}},j=b=>{if(isNaN(b.getTime()))return console.warn("Invalid date received:",b),o("time.unknown");const W=new Date().getTime()-b.getTime(),Q=Math.floor(W/6e4),me=Math.floor(W/36e5),Ce=Math.floor(W/864e5);return Q<1?o("time.now"):Q<60?o("time.minuteAgo",{count:Q}):me<24?o("time.hourAgo",{count:me}):Ce<30?o("time.dayAgo",{count:Ce}):b.toLocaleDateString("zh-CN")},J=(b,I)=>!b||b.length<=I?b:b.substring(0,I)+"...",X=b=>{i.value=!0,u.value=b.clientX,f.value=l.value,document.addEventListener("mousemove",q),document.addEventListener("mouseup",K),document.body.style.cursor="col-resize",document.body.style.userSelect="none",b.preventDefault()},q=b=>{if(!i.value)return;const I=window.innerWidth,Q=(b.clientX-u.value)/I*100;let me=f.value+Q;me=Math.max(15,Math.min(100,me)),l.value=me},K=()=>{i.value=!1,document.removeEventListener("mousemove",q),document.removeEventListener("mouseup",K),document.body.style.cursor="",document.body.style.userSelect="",localStorage.setItem("sidebarWidth",l.value.toString())},ee=()=>{l.value=80,localStorage.setItem("sidebarWidth","80")};return ie(()=>H.currentPlanTemplateId,b=>{T(b)},{immediate:!0}),we(()=>{H.loadPlanTemplateList(),y(),H.loadAvailableTools();const b=localStorage.getItem("sidebarWidth");b&&(l.value=parseFloat(b))}),Se(()=>{document.removeEventListener("mousemove",q),document.removeEventListener("mouseup",K)}),e({loadPlanTemplateList:H.loadPlanTemplateList,toggleSidebar:H.toggleSidebar,currentPlanTemplateId:H.currentPlanTemplateId}),(b,I)=>{var W;return p(),g(ne,null,[s("div",{class:oe(["sidebar-wrapper",{"sidebar-wrapper-collapsed":r(H).isCollapsed}]),style:Ve({width:l.value+"%"})},[s("div",Gi,[s("div",Wi,[s("div",zi,c(b.$t("sidebar.title")),1)]),s("div",Ki,[s("button",{class:oe(["tab-button",{active:r(H).currentTab==="list"}]),onClick:I[0]||(I[0]=Q=>r(H).switchToTab("list"))},[k(r(P),{icon:"carbon:list",width:"16"}),Z(" "+c(b.$t("sidebar.templateList")),1)],2),s("button",{class:oe(["tab-button",{active:r(H).currentTab==="config"}]),onClick:I[1]||(I[1]=Q=>r(H).switchToTab("config")),disabled:!r(H).selectedTemplate},[k(r(P),{icon:"carbon:settings",width:"16"}),Z(" "+c(b.$t("sidebar.configuration")),1)],10,Xi)]),r(H).currentTab==="list"?(p(),g("div",Qi,[s("div",Yi,[s("button",{class:"new-task-btn",onClick:I[2]||(I[2]=()=>r(H).createNewTemplate(r(H).planType))},[k(r(P),{icon:"carbon:add",width:"16"}),Z(" "+c(b.$t("sidebar.newPlan"))+" ",1),I[10]||(I[10]=s("span",{class:"shortcut"},"⌘ K",-1))])]),s("div",Zi,[r(H).isLoading?(p(),g("div",ec,[k(r(P),{icon:"carbon:circle-dash",width:"20",class:"spinning"}),s("span",null,c(b.$t("sidebar.loading")),1)])):r(H).errorMessage?(p(),g("div",tc,[k(r(P),{icon:"carbon:warning",width:"20"}),s("span",null,c(r(H).errorMessage),1),s("button",{onClick:I[3]||(I[3]=(...Q)=>r(H).loadPlanTemplateList&&r(H).loadPlanTemplateList(...Q)),class:"retry-btn"},c(b.$t("sidebar.retry")),1)])):r(H).planTemplateList.length===0?(p(),g("div",sc,[k(r(P),{icon:"carbon:document",width:"32"}),s("span",null,c(b.$t("sidebar.noTemplates")),1)])):(p(!0),g(ne,{key:3},le(r(H).sortedTemplates,Q=>(p(),g("div",{key:Q.id,class:oe(["sidebar-content-list-item",{"sidebar-content-list-item-active":Q.id===r(H).currentPlanTemplateId}]),onClick:me=>r(H).selectTemplate(Q)},[s("div",nc,[k(r(P),{icon:"carbon:document",width:"20"})]),s("div",ac,[s("div",lc,c(Q.title||b.$t("sidebar.unnamedPlan")),1),s("div",rc,c(J(Q.description||b.$t("sidebar.noDescription"),40)),1)]),s("div",ic,c(j(r(H).parseDateTime(Q.updateTime||Q.createTime))),1),s("div",cc,[s("button",{class:"delete-task-btn",title:b.$t("sidebar.deleteTemplate"),onClick:pe(me=>r(H).deleteTemplate(Q),["stop"])},[k(r(P),{icon:"carbon:close",width:"16"})],8,dc)])],10,oc))),128))])])):r(H).currentTab==="config"?(p(),g("div",uc,[r(H).selectedTemplate?(p(),g("div",pc,[s("div",mc,[s("div",hc,[s("h3",null,c(r(H).selectedTemplate.title||b.$t("sidebar.unnamedPlan")),1),s("span",fc,"ID: "+c(r(H).selectedTemplate.id),1)]),s("button",{class:"back-to-list-btn",onClick:I[4]||(I[4]=Q=>r(H).switchToTab("list"))},[k(r(P),{icon:"carbon:arrow-left",width:"16"})])]),r(H).planType==="dynamic_agent"?(p(),ae(Hi,{key:r(H).currentPlanTemplateId||"default","json-content":r(H).jsonContent,"can-rollback":r(H).canRollback,"can-restore":r(H).canRestore,"is-generating":r(H).isGenerating,"is-executing":r(H).isExecuting,"current-plan-template-id":r(H).currentPlanTemplateId||"",onRollback:C,onRestore:w,onSave:_,onCopyPlan:V,"onUpdate:jsonContent":I[5]||(I[5]=Q=>r(H).jsonContent=Q)},null,8,["json-content","can-rollback","can-restore","is-generating","is-executing","current-plan-template-id"])):(p(),ae(wa,{key:"simple-"+(r(H).currentPlanTemplateId||"default"),"json-content":r(H).jsonContent,"can-rollback":r(H).canRollback,"can-restore":r(H).canRestore,"is-generating":r(H).isGenerating,"is-executing":r(H).isExecuting,"current-plan-template-id":r(H).currentPlanTemplateId||"",onRollback:C,onRestore:w,onSave:_,"onUpdate:jsonContent":I[6]||(I[6]=Q=>r(H).jsonContent=Q)},null,8,["json-content","can-rollback","can-restore","is-generating","is-executing","current-plan-template-id"])),k(xn,{ref_key:"executionControllerRef",ref:d,"current-plan-template-id":r(H).currentPlanTemplateId||"","is-executing":r(H).isExecuting,"is-generating":r(H).isGenerating,"show-publish-button":L.value,"tool-info":h.value,onExecutePlan:D,onPublishMcpService:R,onClearParams:F,onUpdateExecutionParams:B},null,8,["current-plan-template-id","is-executing","is-generating","show-publish-button","tool-info"])])):O("",!0)])):O("",!0)]),s("div",{class:"sidebar-resizer",onMousedown:X,onDblclick:ee,title:b.$t("sidebar.resizeHint")},I[11]||(I[11]=[s("div",{class:"resizer-line"},null,-1)]),40,vc)],6),k(wo,{ref_key:"publishMcpModalRef",ref:$,modelValue:v.value,"onUpdate:modelValue":I[7]||(I[7]=Q=>v.value=Q),"plan-template-id":r(H).currentPlanTemplateId||"","plan-description":((W=r(H).selectedTemplate)==null?void 0:W.description)||"",onPublished:U},null,8,["modelValue","plan-template-id","plan-description"]),E.value?(p(),g("div",{key:0,class:"modal-overlay",onClick:z},[s("div",{class:"modal-content",onClick:I[9]||(I[9]=pe(()=>{},["stop"]))},[s("div",gc,[s("h3",null,c(b.$t("sidebar.copyPlan")),1),s("button",{class:"close-btn",onClick:z},[k(r(P),{icon:"carbon:close",width:"16"})])]),s("div",bc,[s("div",yc,[s("label",_c,c(b.$t("sidebar.newPlanTitle")),1),se(s("input",{"onUpdate:modelValue":I[8]||(I[8]=Q=>A.value=Q),type:"text",class:"form-input",placeholder:b.$t("sidebar.enterNewPlanTitle"),onKeyup:Ns(Y,["enter"])},null,40,$c),[[ce,A.value]])])]),s("div",Sc,[s("button",{class:"btn btn-secondary",onClick:z},c(b.$t("common.cancel")),1),s("button",{class:"btn btn-primary",onClick:Y,disabled:!A.value.trim()||G.value},[G.value?(p(),ae(r(P),{key:0,icon:"carbon:loading",width:"16",class:"spinning"})):O("",!0),Z(" "+c(G.value?b.$t("sidebar.copying"):b.$t("sidebar.copyPlan")),1)],8,wc)])])])):O("",!0)],64)}}}),Tc=ue(kc,[["__scopeId","data-v-3686debf"]]);class dt{static async handleResponse(e){if(!e.ok)try{const t=await e.json();throw new Error(t.message||`API request failed: ${e.status}`)}catch{throw new Error(`API request failed: ${e.status} ${e.statusText}`)}return e}static async getMemories(){try{const e=await fetch(`${this.BASE_URL}`);return(await(await this.handleResponse(e)).json()).memories??[]}catch(e){throw console.error("Failed to get memory list:",e),e}}static async getMemory(e){try{const t=await fetch(`${this.BASE_URL}/single?conversationId=${e}`),a=await(await this.handleResponse(t)).json();if(!a.data)throw new Error("Memory not found");return a.data}catch(t){throw console.error("Failed to get memory:",t),t}}static async createMemory(e,t){try{const o=await fetch(`${this.BASE_URL}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({conversation_id:e,memory_name:t})}),l=await(await this.handleResponse(o)).json();if(!l.data)throw new Error("Failed to create memory");return l.data}catch(o){throw console.error("Failed to create memory:",o),o}}static async updateMemory(e,t){try{const o=await fetch(`${this.BASE_URL}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({conversation_id:e,memory_name:t})}),l=await(await this.handleResponse(o)).json();if(!l.data)throw new Error("Failed to update memory");return l.data}catch(o){throw console.error("Failed to update memory:",o),o}}static async deleteMemory(e){try{const t=await fetch(`${this.BASE_URL}/${e}`,{method:"DELETE"});await this.handleResponse(t)}catch(t){throw console.error("Failed to delete memory:",t),t}}static async generateConversationId(){try{const e=await fetch(`${this.BASE_URL}/generate-id`),o=await(await this.handleResponse(e)).json();if(!o.data)throw new Error("Failed to generate conversation ID");return o.data}catch(e){throw console.error("Failed to generate conversation ID:",e),e}}}fe(dt,"BASE_URL","/api/memories");class Pc{constructor(){fe(this,"isCollapsed",!1);fe(this,"selectMemoryId","");fe(this,"loadMessages",()=>{});fe(this,"intervalId")}toggleSidebar(){this.isCollapsed=!this.isCollapsed,this.isCollapsed?(this.loadMessages(),this.intervalId=window.setInterval(()=>{this.loadMessages()},3e3)):clearInterval(this.intervalId)}selectMemory(e){this.toggleSidebar(),this.selectMemoryId=e}setMemory(e){this.selectMemoryId=e}defaultMemoryId(){this.selectMemoryId=this.generateRandomId()}clearMemoryId(){this.selectMemoryId=""}generateRandomId(){return Math.random().toString(36).substring(2,10)}setLoadMessages(e){this.loadMessages=e}}const De=ot(new Pc),Cc={key:0,class:"app-container"},Ec={class:"app-content"},Rc={class:"header"},Ic={class:"relative"},Ac={class:"title-edit-group"},xc={id:"main-title",class:"main-title"},Dc={key:0,id:"title-edit-container",class:"title-edit-container"},Fc={class:"search-bar"},Mc={class:"search-container"},Uc=["placeholder"],Nc={class:"message-list",id:"message-list"},Lc={class:"message-header"},Oc={class:"message-content"},Bc={class:"sender-info"},qc=["onClick"],Vc={class:"sender-name"},jc=["onClick"],Jc={class:"action-buttons"},Hc=["onClick"],Gc={class:"action-buttons"},Wc=["onClick"],zc={class:"message-preview"},Kc={class:"preview-line"},Xc={key:0,class:"preview-line",style:{opacity:"0.8"}},Qc={class:"message-meta"},Yc={class:"message-id"},Zc={class:"meta-right"},ed={key:0,class:"unread-count"},td={class:"message-time"},sd=["id"],od={style:{display:"flex","flex-direction":"column",gap:"0.75rem"}},nd={class:"bubble-avatar"},ad={class:"bubble-content"},ld={class:"bubble-text"},rd={key:0,class:"empty-state"},id={class:"modal-content"},cd={class:"modal-header"},dd={class:"modal-title"},ud=["placeholder"],pd={id:"name-char-count",class:"char-count",style:{"text-align":"right",display:"block","margin-top":"0.25rem"}},md={class:"modal-footer"},hd={class:"modal-content"},fd={class:"modal-header"},vd={class:"modal-title"},gd={class:"state-text",id:"delete-message"},bd={class:"modal-footer"},yd=de({__name:"Memory",emits:["memory-selected"],setup(n,{emit:e}){const t=N(!1),o=N(""),a=N([]),l=N([]),i=N(!1),u=N(null),f=N(""),d=N(!1),h=N(null),$=new Map,M=e,L=R=>{R.key==="Escape"&&(d.value?A():i.value&&w())};we(()=>{De.setLoadMessages(y),document.addEventListener("keydown",L)}),Se(()=>{document.removeEventListener("keydown",L)});const y=async()=>{try{const R=await dt.getMemories();a.value=R.map(U=>({...U,expanded:$.has(U.conversation_id)?$.get(U.conversation_id):!1})),l.value=[...a.value],m()}catch(R){console.error("error:",R),a.value=[],l.value=[]}},S=R=>{De.selectMemory(R),M("memory-selected")},_=R=>{const U=typeof R=="string"?parseInt(R,10):R;return isNaN(U)||U<=0?"unknow time":new Date(U.toString().length===13?U:U*1e3).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1}).replace(","," ")},m=()=>{const R=o.value.toLowerCase().trim();if(!R){l.value=[...a.value];return}l.value=a.value.filter(U=>{var z;const F=U.memory_name.toLowerCase().includes(R),B=U.conversation_id.toLowerCase().includes(R),V=((z=U.messages)==null?void 0:z.some(Y=>Y.text.toLowerCase().includes(R)))??!1;return F||B||V})},C=(R,U)=>{u.value=R,f.value=U,i.value=!0},w=()=>{i.value=!1,u.value=null},D=async()=>{if(!u.value)return;const R=f.value.trim()||"unknow name",U=a.value.findIndex(F=>F.conversation_id===u.value);if(U!==-1){const F=a.value[U];try{const B=await dt.updateMemory(F.conversation_id,R);B.messages||(B.messages=[]),a.value[U]={...B,expanded:F.expanded},m(),i.value=!1}catch(B){console.error("error:",B)}}},v=R=>{const U=a.value.find(F=>F.conversation_id===R);if(U){U.expanded=!U.expanded,$.set(R,U.expanded);const F=l.value.findIndex(B=>B.conversation_id===R);F!==-1&&(l.value[F]={...U})}},E=R=>{h.value=R,d.value=!0},A=()=>{d.value=!1,h.value=null},G=async()=>{if(h.value)try{await dt.deleteMemory(h.value),a.value=a.value.filter(R=>R.conversation_id!==h.value),m(),a.value.length===0&&De.clearMemoryId(),d.value=!1,h.value=null}catch(R){console.error("error:",R)}};return(R,U)=>(p(),ae(Ze,{to:"body"},[k(Ne,{name:"modal"},{default:Ie(()=>[r(De).isCollapsed?(p(),g("div",Cc,[s("div",Ec,[s("div",Rc,[s("div",Ic,[s("div",Ac,[s("h1",xc,[s("span",null,c(R.$t("memory.title")),1)])]),t.value?(p(),g("div",Dc)):O("",!0)]),s("button",{class:"close-btn",onClick:U[0]||(U[0]=F=>r(De).toggleSidebar())},[k(r(P),{icon:"carbon:close"})])]),s("div",Fc,[s("div",Mc,[k(r(P),{class:"search-container-icon",icon:"carbon:search"}),se(s("input",{type:"text",placeholder:R.$t("memory.searchPlaceholder"),class:"search-input","onUpdate:modelValue":U[1]||(U[1]=F=>o.value=F),onInput:m},null,40,Uc),[[ce,o.value]])])]),s("div",Nc,[s("div",null,[(p(!0),g(ne,null,le(l.value,F=>(p(),g("div",{class:oe(["message-item",{expanded:F.expanded}]),key:F.conversation_id},[s("div",Lc,[s("div",Oc,[s("div",Bc,[s("div",{class:"sender-div",onClick:pe(B=>S(F.conversation_id),["stop"])},[s("h3",Vc,c(F.memory_name),1)],8,qc),s("div",{class:"toggle-container",onClick:pe(B=>C(F.conversation_id,F.memory_name),["stop"])},[k(r(P),{icon:"carbon:edit",class:"edit-btn"})],8,jc),s("div",Jc,[s("button",{class:"delete-btn",onClick:pe(B=>v(F.conversation_id),["stop"])},[k(r(P),{id:"toggle-"+F.conversation_id,icon:"carbon:chevron-down",class:"down-btn"},null,8,["id"])],8,Hc)]),s("div",Gc,[s("button",{class:"delete-btn",onClick:pe(B=>E(F.conversation_id),["stop"])},[k(r(P),{icon:"carbon:delete"})],8,Wc)])]),s("div",zc,[s("p",Kc,c(F.messages&&F.messages.length>0?F.messages[0].text:"none message"),1),F.messages&&F.messages.length>1?(p(),g("p",Xc,c(F.messages[1].text),1)):O("",!0)]),s("div",Qc,[s("span",Yc,"ID: "+c(F.conversation_id),1),s("div",Zc,[F.messages&&F.messages.length>0?(p(),g("span",ed,c(F.messages.length)+" "+c(R.$t("memory.size")),1)):O("",!0),s("span",td,c(_(F.create_time)),1)])])])]),F.expanded?(p(),g("div",{key:0,id:"content-"+F.conversation_id,class:"expanded-content"},[s("div",od,[(p(!0),g(ne,null,le(F.messages,(B,V)=>(p(),g("div",{class:"message-bubble",key:V},[s("div",nd,c(B.messageType),1),s("div",ad,[s("p",ld,c(B.text),1)])]))),128))])],8,sd)):O("",!0)],2))),128))]),l.value.length===0&&o.value?(p(),g("div",rd,U[3]||(U[3]=[s("p",{class:"state-text"},"none message",-1)]))):O("",!0)]),i.value?(p(),g("div",{key:0,id:"name-edit-modal",class:"modal-overlay",onClick:pe(w,["self"])},[s("div",id,[s("div",cd,[s("h3",dd,c(R.$t("memory.changeName")),1),se(s("input",{type:"text","onUpdate:modelValue":U[2]||(U[2]=F=>f.value=F),class:"edit-input",placeholder:R.$t("memory.newNamePlaceholder")},null,8,ud),[[ce,f.value]]),s("span",pd,c(f.value.length),1)]),s("div",md,[s("button",{id:"cancel-name",class:"modal-btn cancel-btn",onClick:w},c(R.$t("memory.cancel")),1),s("button",{id:"save-name",class:"modal-btn confirm-btn",onClick:D},c(R.$t("memory.save")),1)])])])):O("",!0),d.value?(p(),g("div",{key:1,id:"delete-modal",class:"modal-overlay",onClick:pe(A,["self"])},[s("div",hd,[s("div",fd,[s("h3",vd,c(R.$t("memory.deleteHint")),1),s("p",gd,c(R.$t("memory.deleteHintPrefix"))+" "+c(h.value)+" "+c(R.$t("memory.deleteHintSuffix")),1)]),s("div",bd,[s("button",{id:"cancel-delete",class:"modal-btn cancel-btn",onClick:A},c(R.$t("memory.cancel")),1),s("button",{id:"confirm-delete",class:"modal-btn delete-btn-confirm",onClick:G},c(R.$t("memory.delete")),1)])])])):O("",!0)])])):O("",!0)]),_:1})]))}}),_d=ue(yd,[["__scopeId","data-v-4dca2d9f"]]),$d="/api/executor";async function xs(n){try{const e=await fetch(`${$d}/agent-execution/${n}`);if(!e.ok){if(e.status===404)return console.warn(`Agent execution detail not found for stepId: ${n}`),null;throw new Error(`HTTP error! status: ${e.status}`)}return await e.json()}catch(e){return console.error(`Error fetching agent execution detail for stepId: ${n}:`,e),null}}async function Sd(n){return console.log(`Refreshing agent execution detail for stepId: ${n}`),xs(n)}class Fe{static async handleResponse(e){if(!e.ok)try{const t=await e.json();throw new Error(t.message??`API request failed: ${e.status}`)}catch{throw new Error(`API request failed: ${e.status} ${e.statusText}`)}return e}static async getFileTree(e){try{const t=await fetch(`${this.BASE_URL}/tree/${e}`),a=await(await this.handleResponse(t)).json();if(!a.success)throw new Error(a.message??"Failed to get file tree");return a.data}catch(t){throw console.error("Failed to get file tree:",t),t}}static async getFileContent(e,t){try{const o=await fetch(`${this.BASE_URL}/content/${e}?path=${encodeURIComponent(t)}`),l=await(await this.handleResponse(o)).json();if(!l.success)throw new Error(l.message??"Failed to get file content");return l.data}catch(o){throw console.error("Failed to get file content:",o),o}}static async downloadFile(e,t,o){try{const a=await fetch(`${this.BASE_URL}/download/${e}?path=${encodeURIComponent(t)}`);await this.handleResponse(a);const l=await a.blob(),i=window.URL.createObjectURL(l),u=document.createElement("a");u.href=i,u.download=o??t.split("/").pop()??"download",document.body.appendChild(u),u.click(),window.URL.revokeObjectURL(i),document.body.removeChild(u)}catch(a){throw console.error("Failed to download file:",a),a}}static isTextFile(e,t){const o=["text/","application/json","application/xml","application/javascript","application/typescript"],a=[".txt",".md",".json",".xml",".html",".css",".js",".ts",".vue",".jsx",".tsx",".py",".java",".cpp",".c",".h",".sh",".bat",".yml",".yaml",".properties",".conf",".cfg"];if(o.some(i=>e.startsWith(i)))return!0;const l=t.toLowerCase();return a.some(i=>l.endsWith(i))}static getFileIcon(e){if(e.type==="directory")return"carbon:folder";const t=e.name.toLowerCase();return t.endsWith(".js")?"vscode-icons:file-type-js":t.endsWith(".ts")?"vscode-icons:file-type-typescript":t.endsWith(".vue")?"vscode-icons:file-type-vue":t.endsWith(".java")?"vscode-icons:file-type-java":t.endsWith(".py")?"vscode-icons:file-type-python":t.endsWith(".json")?"vscode-icons:file-type-json":t.endsWith(".xml")?"vscode-icons:file-type-xml":t.endsWith(".html")?"vscode-icons:file-type-html":t.endsWith(".css")?"vscode-icons:file-type-css":t.endsWith(".md")?"vscode-icons:file-type-markdown":t.endsWith(".yml")||t.endsWith(".yaml")?"vscode-icons:file-type-yaml":t.endsWith(".pdf")?"vscode-icons:file-type-pdf2":t.endsWith(".doc")||t.endsWith(".docx")?"vscode-icons:file-type-word":t.endsWith(".xls")||t.endsWith(".xlsx")?"vscode-icons:file-type-excel":t.endsWith(".ppt")||t.endsWith(".pptx")?"vscode-icons:file-type-powerpoint":t.match(/\.(jpg|jpeg|png|gif|bmp|svg)$/)?"carbon:image":t.match(/\.(zip|rar|7z|tar|gz)$/)?"carbon:archive":"carbon:document"}}fe(Fe,"BASE_URL","/api/file-browser");const wd={class:"file-tree-node"},kd={class:"node-icon"},Td={class:"node-name"},Pd={key:1,class:"file-size"},Cd={key:2,class:"node-actions"},Ed={key:0,class:"children"},Rd=de({__name:"FileTreeNode",props:{node:{},level:{}},emits:["file-selected","download-file"],setup(n,{emit:e}){const t=n,o=e,a=N(t.level===0),l=N(!1),i=N(!1),u=N({}),f=()=>{t.node.type==="directory"&&(a.value=!a.value)},d=()=>{t.node.type==="directory"?f():h()},h=()=>{t.node.type==="file"&&o("file-selected",t.node),L()},$=()=>{o("download-file",t.node),L()},M=m=>{m.preventDefault(),i.value=!0,u.value={position:"fixed",top:`${m.clientY}px`,left:`${m.clientX}px`,zIndex:1e3},setTimeout(()=>{document.addEventListener("click",L)},0)},L=()=>{i.value=!1,document.removeEventListener("click",L)},y=async()=>{try{await navigator.clipboard.writeText(t.node.path)}catch(m){console.error("Failed to copy path:",m)}L()},S=()=>t.node.type==="directory"?a.value?"carbon:folder-open":"carbon:folder":Fe.getFileIcon(t.node),_=m=>{if(m===0)return"0 B";const C=1024,w=["B","KB","MB","GB"],D=Math.floor(Math.log(m)/Math.log(C));return parseFloat((m/Math.pow(C,D)).toFixed(1))+" "+w[D]};return Se(()=>{document.removeEventListener("click",L)}),(m,C)=>{const w=es("FileTreeNode",!0);return p(),g("div",wd,[s("div",{class:oe(["node-content",{"is-directory":m.node.type==="directory","is-file":m.node.type==="file","is-expanded":a.value}]),style:Ve({paddingLeft:`${m.level*16+12}px`}),onClick:d,onContextmenu:pe(M,["prevent"])},[m.node.type==="directory"?(p(),g("div",{key:0,class:"expand-icon",onClick:pe(f,["stop"])},[k(r(P),{icon:a.value?"carbon:chevron-down":"carbon:chevron-right",class:"chevron-icon"},null,8,["icon"])])):O("",!0),s("div",kd,[k(r(P),{icon:S()},null,8,["icon"])]),s("span",Td,c(m.node.name),1),m.node.type==="file"?(p(),g("span",Pd,c(_(m.node.size)),1)):O("",!0),l.value?(p(),g("div",Cd,[m.node.type==="file"?(p(),g("button",{key:0,onClick:C[0]||(C[0]=pe(D=>m.$emit("download-file",m.node),["stop"])),class:"action-btn download-btn",title:"Download"},[k(r(P),{icon:"carbon:download"})])):O("",!0)])):O("",!0)],38),m.node.type==="directory"&&a.value&&m.node.children?(p(),g("div",Ed,[(p(!0),g(ne,null,le(m.node.children,D=>(p(),ae(w,{key:D.path,node:D,level:m.level+1,onFileSelected:C[1]||(C[1]=v=>m.$emit("file-selected",v)),onDownloadFile:C[2]||(C[2]=v=>m.$emit("download-file",v))},null,8,["node","level"]))),128))])):O("",!0),i.value?(p(),g("div",{key:1,class:"context-menu",style:Ve(u.value),onClick:C[3]||(C[3]=pe(()=>{},["stop"]))},[s("div",{class:"context-menu-item",onClick:h},[k(r(P),{icon:"carbon:view"}),C[4]||(C[4]=s("span",null,"Open",-1))]),m.node.type==="file"?(p(),g("div",{key:0,class:"context-menu-item",onClick:$},[k(r(P),{icon:"carbon:download"}),C[5]||(C[5]=s("span",null,"Download",-1))])):O("",!0),C[7]||(C[7]=s("div",{class:"context-menu-divider"},null,-1)),s("div",{class:"context-menu-item",onClick:y},[k(r(P),{icon:"carbon:copy"}),C[6]||(C[6]=s("span",null,"Copy Path",-1))])],4)):O("",!0)])}}}),Id=ue(Rd,[["__scopeId","data-v-e4a376d5"]]),Ad={class:"file-browser"},xd={class:"file-browser-header"},Dd={class:"header-actions"},Fd=["disabled","title"],Md={class:"file-browser-content"},Ud={class:"file-tree-panel"},Nd={key:0,class:"loading-state"},Ld={key:1,class:"error-state"},Od={key:0,class:"waiting-for-files"},Bd={class:"message-content"},qd={class:"tips"},Vd=["disabled"],jd={key:1,class:"actual-error"},Jd={key:2,class:"empty-state"},Hd={key:3,class:"file-tree"},Gd={key:0,class:"file-content-panel"},Wd={class:"file-content-header"},zd={class:"file-info"},Kd={class:"file-name"},Xd={class:"file-size"},Qd={class:"file-actions"},Yd=["title"],Zd=["title"],eu={class:"file-content-body"},tu={key:0,class:"loading-content"},su={key:1,class:"content-error"},ou={key:2,class:"file-content"},nu={key:0,class:"text-content"},au={key:1,class:"binary-content"},lu=de({__name:"index",props:{planId:{}},setup(n){const e=n,{t}=Te(),o=N(!1),a=N(null),l=N(null),i=N(null),u=N(null),f=N(!1),d=N(null),h=N(null),$=re(()=>!u.value||!i.value?!1:Fe.isTextFile(u.value.mimeType,i.value.name)),M=re(()=>a.value&&(a.value.includes("Plan directory not found")||a.value.includes("not found"))),L=()=>{h.value&&(clearTimeout(h.value),h.value=null)},y=()=>{L(),h.value=window.setTimeout(()=>{M.value&&S()},5e3)},S=async()=>{if(e.planId){o.value=!0,a.value=null,L();try{l.value=await Fe.getFileTree(e.planId)}catch(v){a.value=v instanceof Error?v.message:t("fileBrowser.loadError"),console.error("Failed to load file tree:",v);const E=v instanceof Error?v.message:"";(E.includes("Plan directory not found")||E.includes("not found"))&&y()}finally{o.value=!1}}},_=async v=>{if(v.type!=="directory"){i.value=v,u.value=null,f.value=!0,d.value=null;try{u.value=await Fe.getFileContent(e.planId,v.path)}catch(E){d.value=E instanceof Error?E.message:t("fileBrowser.contentLoadError"),console.error("Failed to load file content:",E)}finally{f.value=!1}}},m=async v=>{try{await Fe.downloadFile(e.planId,v.path,v.name)}catch(E){console.error("Failed to download file:",E)}},C=()=>{i.value=null,u.value=null,d.value=null},w=v=>Fe.getFileIcon(v),D=v=>{if(v===0)return"0 B";const E=1024,A=["B","KB","MB","GB"],G=Math.floor(Math.log(v)/Math.log(E));return parseFloat((v/Math.pow(E,G)).toFixed(1))+" "+A[G]};return ie(()=>e.planId,v=>{v&&(i.value=null,u.value=null,S())},{immediate:!0}),we(()=>{e.planId&&S()}),Se(()=>{L()}),(v,E)=>(p(),g("div",Ad,[s("div",xd,[s("h3",null,c(v.$t("fileBrowser.title")),1),s("div",Dd,[s("button",{class:"refresh-btn",onClick:S,disabled:o.value,title:v.$t("fileBrowser.refresh")},[k(r(P),{icon:"carbon:refresh",class:oe({rotating:o.value}),style:{color:"#ffffff",fontSize:"18px",width:"18px",height:"18px"}},null,8,["class"])],8,Fd)])]),s("div",Md,[s("div",Ud,[o.value?(p(),g("div",Nd,[k(r(P),{icon:"carbon:loading",class:"rotating"}),s("span",null,c(v.$t("fileBrowser.loading")),1)])):a.value?(p(),g("div",Ld,[M.value?(p(),g("div",Od,[k(r(P),{icon:"carbon:time",class:"rotating"}),s("div",Bd,[s("h3",null,c(v.$t("fileBrowser.waitingForGeneration")),1),s("p",null,c(v.$t("fileBrowser.planExecuting")),1),s("div",qd,[k(r(P),{icon:"carbon:information"}),s("span",null,c(v.$t("fileBrowser.filesTip")),1)])]),s("button",{onClick:S,class:"retry-btn",disabled:o.value},[k(r(P),{icon:"carbon:refresh",class:oe({rotating:o.value})},null,8,["class"]),Z(" "+c(o.value?v.$t("fileBrowser.checking"):v.$t("fileBrowser.checkNow")),1)],8,Vd)])):(p(),g("div",jd,[k(r(P),{icon:"carbon:warning"}),s("span",null,c(a.value),1),s("button",{onClick:S,class:"retry-btn"},c(v.$t("fileBrowser.retry")),1)]))])):l.value?(p(),g("div",Hd,[k(Id,{node:l.value,level:0,onFileSelected:_,onDownloadFile:m},null,8,["node"])])):(p(),g("div",Jd,[k(r(P),{icon:"carbon:folder-off"}),s("span",null,c(v.$t("fileBrowser.noFiles")),1)]))]),i.value?(p(),g("div",Gd,[s("div",Wd,[s("div",zd,[k(r(P),{icon:w(i.value)},null,8,["icon"]),s("span",Kd,c(i.value.name),1),s("span",Xd,"("+c(D(i.value.size))+")",1)]),s("div",Qd,[s("button",{onClick:E[0]||(E[0]=A=>m(i.value)),class:"download-btn",title:v.$t("fileBrowser.download")},[k(r(P),{icon:"carbon:download"})],8,Yd),s("button",{onClick:C,class:"close-btn",title:v.$t("common.close")},[k(r(P),{icon:"carbon:close"})],8,Zd)])]),s("div",eu,[f.value?(p(),g("div",tu,[k(r(P),{icon:"carbon:loading",class:"rotating"}),s("span",null,c(v.$t("fileBrowser.loadingContent")),1)])):d.value?(p(),g("div",su,[k(r(P),{icon:"carbon:warning"}),s("span",null,c(d.value),1)])):u.value?(p(),g("div",ou,[$.value?(p(),g("div",nu,[s("pre",null,[s("code",null,c(u.value.content),1)])])):(p(),g("div",au,[k(r(P),{icon:"carbon:document-unknown"}),s("p",null,c(v.$t("fileBrowser.binaryFile")),1),s("button",{onClick:E[1]||(E[1]=A=>m(i.value)),class:"download-btn-large"},[k(r(P),{icon:"carbon:download"}),Z(" "+c(v.$t("fileBrowser.downloadToView")),1)])]))])):O("",!0)])])):O("",!0)])]))}}),ru=ue(lu,[["__scopeId","data-v-e7c74fe4"]]),iu={class:"right-panel"},cu={class:"preview-header"},du={class:"preview-tabs"},uu={class:"preview-content"},pu={key:0,class:"step-details"},mu={key:0,class:"step-info"},hu={key:0,class:"agent-info"},fu={class:"info-item"},vu={class:"label"},gu={class:"value"},bu={class:"info-item"},yu={class:"label"},_u={class:"value"},$u={class:"info-item"},Su={class:"label"},wu={class:"execution-status"},ku={class:"status-item"},Tu={class:"status-text"},Pu={key:0},Cu={key:0,class:"think-act-steps"},Eu={class:"steps-container"},Ru={class:"step-header"},Iu={class:"step-number"},Au={class:"think-section"},xu={class:"think-content"},Du={class:"input"},Fu={class:"label"},Mu={class:"output"},Uu={class:"label"},Nu={key:0,class:"action-section"},Lu={class:"action-content"},Ou={class:"tool-info"},Bu={class:"label"},qu={class:"value"},Vu={class:"input"},ju={class:"label"},Ju={class:"output"},Hu={class:"label"},Gu={key:0,class:"sub-plan-section"},Wu={class:"sub-plan-content"},zu={class:"sub-plan-header"},Ku={class:"sub-plan-info"},Xu={class:"label"},Qu={class:"value"},Yu={key:0,class:"sub-plan-info"},Zu={class:"label"},ep={class:"value"},tp={class:"sub-plan-status"},sp={class:"status-text"},op={key:0,class:"no-steps-message"},np={key:1,class:"no-execution-message"},ap={class:"step-basic-info"},lp={class:"info-item"},rp={class:"label"},ip={class:"value"},cp={key:0,class:"info-item"},dp={class:"label"},up={class:"value"},pp={class:"info-item"},mp={class:"label"},hp={class:"no-execution-hint"},fp={key:2,class:"execution-indicator"},vp={class:"execution-text"},gp={key:1,class:"no-selection"},bp=["title"],yp={key:1,class:"file-browser-container"},_p={key:1,class:"no-plan-message"},$p={class:"message-content"},Sp={class:"tips"},wp=de({__name:"RightPanel",props:{currentRootPlanId:{},selectedStepId:{}},setup(n,{expose:e}){const t=n,{t:o}=Te(),a=N(),l=N(),i=N("details"),u=N(localStorage.getItem("jmanus-last-plan-id")),f=N(localStorage.getItem("jmanus-has-executed-plan")==="true"),d=N(!1),h=N(!0),$=N(!0),M=re(()=>l.value?l.value.completed?o("rightPanel.status.completed"):l.value.current?o("rightPanel.status.executing"):o("rightPanel.status.waiting"):""),L=re(()=>t.currentRootPlanId?t.currentRootPlanId:u.value),y=re(()=>!L.value&&!f.value),S=async R=>{var U,F,B;if(console.log("[RightPanel] Step selected:",{stepId:R}),!R){console.warn("[RightPanel] No stepId provided"),l.value=null;return}try{const V=await xs(R);if(!V){console.warn("[RightPanel] Agent execution detail not found for stepId:",R),l.value=null;return}const z={stepId:R,title:V.agentName??`Step ${R}`,description:V.agentDescription??"",agentExecution:V,completed:V.status==="FINISHED",current:V.status==="RUNNING"};l.value=z,console.log("[RightPanel] Step details updated:",z),console.log("[RightPanel] activeTab:",i.value),console.log("[RightPanel] selectedStep.value:",l.value),console.log("[RightPanel] agentExecution:",l.value.agentExecution),console.log("[RightPanel] thinkActSteps:",(U=l.value.agentExecution)==null?void 0:U.thinkActSteps),console.log("[RightPanel] thinkActSteps length:",(B=(F=l.value.agentExecution)==null?void 0:F.thinkActSteps)==null?void 0:B.length),await ye(),console.log("[RightPanel] After nextTick - selectedStep:",l.value),setTimeout(()=>{C()},100),D()}catch(V){console.error("[RightPanel] Error fetching step details:",V),l.value=null}},_=async()=>{var R;if(!((R=l.value)!=null&&R.stepId)){console.warn("[RightPanel] No step selected for refresh");return}console.log("[RightPanel] Refreshing current step:",l.value.stepId);try{const U=await Sd(l.value.stepId);U&&(l.value.agentExecution=U,l.value.completed=U.status==="FINISHED",l.value.current=U.status==="RUNNING",console.log("[RightPanel] Step refreshed successfully"),D())}catch(U){console.error("[RightPanel] Error refreshing step:",U)}};ie(()=>t.selectedStepId,async R=>{R?await S(R):l.value=null},{immediate:!0});const m=R=>{a.value=R??void 0},C=()=>{if(!a.value)return;const{scrollTop:R,scrollHeight:U,clientHeight:F}=a.value,B=U-R-F<50,V=U>F;h.value=B,d.value=V&&!B,B?$.value=!0:U-R-F>100&&($.value=!1),console.log("[RightPanel] Scroll state check:",{scrollTop:R,scrollHeight:U,clientHeight:F,isAtBottom:B,hasScrollableContent:V,showButton:d.value,shouldAutoScroll:$.value})},w=()=>{a.value&&(a.value.scrollTo({top:a.value.scrollHeight,behavior:"smooth"}),ye(()=>{$.value=!0,C()}))},D=()=>{!$.value||!a.value||ye(()=>{a.value&&(a.value.scrollTop=a.value.scrollHeight,console.log("[RightPanel] Auto scroll to bottom"))})},v=R=>{if(R===null||typeof R>"u"||R==="")return"N/A";try{const U=typeof R=="object"?R:JSON.parse(R);return JSON.stringify(U,null,2)}catch{return String(R)}},E=()=>{l.value=null,$.value=!0,a.value&&a.value.removeEventListener("scroll",C)},A=()=>{const R=()=>{const U=a.value;return U?(m(U),U.addEventListener("scroll",C),$.value=!0,C(),console.log("[RightPanel] Scroll listener initialized successfully"),!0):(console.log("[RightPanel] Scroll container not found, retrying..."),!1)};ye(()=>{R()||setTimeout(()=>{R()},100)})};return ie(()=>t.currentRootPlanId,(R,U)=>{R&&R!==U?(u.value=R,f.value=!0,localStorage.setItem("jmanus-last-plan-id",R),localStorage.setItem("jmanus-has-executed-plan","true"),console.log("[RightPanel] New plan started:",R)):!R&&U&&console.log("[RightPanel] Plan execution finished, keeping last plan:",u.value)},{immediate:!0}),we(()=>{console.log("[RightPanel] Component mounted"),ye(()=>{A()})}),Se(()=>{console.log("[RightPanel] Component unmounting, cleaning up..."),E()}),e({handleStepSelected:S,refreshCurrentStep:_,updateDisplayedPlanProgress:R=>{console.log("[RightPanel] updateDisplayedPlanProgress called with rootPlanId:",R),R&&(u.value=R,f.value=!0,localStorage.setItem("jmanus-last-plan-id",R),localStorage.setItem("jmanus-has-executed-plan","true"),console.log("[RightPanel] Plan progress updated:",R))}}),(R,U)=>{var F,B;return p(),g("div",iu,[s("div",cu,[s("div",du,[s("div",{class:oe(["tab-item",{active:i.value==="details"}]),onClick:U[0]||(U[0]=V=>i.value="details")},[k(r(P),{icon:"carbon:events"}),s("span",null,c(r(o)("rightPanel.stepExecutionDetails")),1)],2),s("div",{class:oe(["tab-item",{active:i.value==="files"}]),onClick:U[1]||(U[1]=V=>i.value="files")},[k(r(P),{icon:"carbon:folder"}),s("span",null,c(r(o)("fileBrowser.title")),1)],2)])]),s("div",uu,[i.value==="details"?(p(),g("div",pu,[l.value?(p(),g("div",mu,[s("h3",null,c(l.value.title||l.value.description||r(o)("rightPanel.defaultStepTitle",{number:1})),1),l.value.agentExecution?(p(),g("div",hu,[s("div",fu,[s("span",vu,c(r(o)("rightPanel.executingAgent"))+":",1),s("span",gu,c(l.value.agentExecution.agentName),1)]),s("div",bu,[s("span",yu,c(r(o)("rightPanel.callingModel"))+":",1),s("span",_u,c(l.value.agentExecution.modelName),1)]),s("div",$u,[s("span",Su,c(r(o)("rightPanel.executionResult"))+":",1),s("span",{class:oe(["value",{success:l.value.agentExecution.status==="FINISHED"}])},c(l.value.agentExecution.status||r(o)("rightPanel.executing")),3)])])):O("",!0),s("div",wu,[s("div",ku,[l.value.completed?(p(),ae(r(P),{key:0,icon:"carbon:checkmark-filled",class:"status-icon success"})):l.value.current?(p(),ae(r(P),{key:1,icon:"carbon:in-progress",class:"status-icon progress"})):(p(),ae(r(P),{key:2,icon:"carbon:time",class:"status-icon pending"})),s("span",Tu,c(M.value),1)])])])):O("",!0),s("div",{ref_key:"scrollContainer",ref:a,class:"step-details-scroll-container",onScroll:C},[l.value?(p(),g("div",Pu,[(F=l.value.agentExecution)!=null&&F.thinkActSteps&&l.value.agentExecution.thinkActSteps.length>0?(p(),g("div",Cu,[s("h4",null,c(r(o)("rightPanel.thinkAndActionSteps")),1),s("div",Eu,[(p(!0),g(ne,null,le(l.value.agentExecution.thinkActSteps,(V,z)=>(p(),g("div",{key:z,class:"think-act-step"},[s("div",Ru,[s("span",Iu,"#"+c(z+1),1),s("span",{class:oe(["step-status",V.status])},c(V.status||r(o)("rightPanel.executing")),3)]),s("div",Au,[s("h5",null,[k(r(P),{icon:"carbon:thinking"}),Z(" "+c(r(o)("rightPanel.thinking")),1)]),s("div",xu,[s("div",Du,[s("span",Fu,c(r(o)("rightPanel.input"))+":",1),s("pre",null,c(v(V.thinkInput)),1)]),s("div",Mu,[s("span",Uu,c(r(o)("rightPanel.output"))+":",1),s("pre",null,c(v(V.thinkOutput)),1)])])]),V.actionNeeded?(p(),g("div",Nu,[s("h5",null,[k(r(P),{icon:"carbon:play"}),Z(" "+c(r(o)("rightPanel.action")),1)]),s("div",Lu,[(p(!0),g(ne,null,le(V.actToolInfoList,(Y,T)=>(p(),g("div",{key:T},[s("div",Ou,[s("span",Bu,c(r(o)("rightPanel.tool"))+":",1),s("span",qu,c(Y.name||""),1)]),s("div",Vu,[s("span",ju,c(r(o)("rightPanel.toolParameters"))+":",1),s("pre",null,c(v(Y.parameters)),1)]),s("div",Ju,[s("span",Hu,c(r(o)("rightPanel.executionResult"))+":",1),s("pre",null,c(v(Y.result)),1)])]))),128))]),V.subPlanExecutionRecord?(p(),g("div",Gu,[s("h5",null,[k(r(P),{icon:"carbon:tree-view"}),Z(" "+c(r(o)("rightPanel.subPlan")),1)]),s("div",Wu,[s("div",zu,[s("div",Ku,[s("span",Xu,c(R.$t("rightPanel.subPlanId"))+":",1),s("span",Qu,c(V.subPlanExecutionRecord.currentPlanId),1)]),V.subPlanExecutionRecord.title?(p(),g("div",Yu,[s("span",Zu,c(R.$t("rightPanel.title"))+":",1),s("span",ep,c(V.subPlanExecutionRecord.title),1)])):O("",!0),s("div",tp,[V.subPlanExecutionRecord.completed?(p(),ae(r(P),{key:0,icon:"carbon:checkmark-filled",class:"status-icon success"})):(p(),ae(r(P),{key:1,icon:"carbon:in-progress",class:"status-icon progress"})),s("span",sp,c(V.subPlanExecutionRecord.completed?R.$t("rightPanel.status.completed"):R.$t("rightPanel.status.executing")),1)])])])])):O("",!0)])):O("",!0)]))),128))]),l.value.agentExecution&&!((B=l.value.agentExecution.thinkActSteps)!=null&&B.length)?(p(),g("div",op,[s("p",null,c(r(o)("rightPanel.noStepDetails")),1)])):l.value.agentExecution?O("",!0):(p(),g("div",np,[k(r(P),{icon:"carbon:information",class:"info-icon"}),s("h4",null,c(r(o)("rightPanel.stepInfo")),1),s("div",ap,[s("div",lp,[s("span",rp,c(r(o)("rightPanel.stepName"))+":",1),s("span",ip,c(l.value.title||l.value.description||l.value.stepId),1)]),l.value.description?(p(),g("div",cp,[s("span",dp,c(R.$t("rightPanel.description"))+":",1),s("span",up,c(l.value.description),1)])):O("",!0),s("div",pp,[s("span",mp,c(R.$t("rightPanel.status.label"))+":",1),s("span",{class:oe(["value",{"status-completed":l.value.completed,"status-current":l.value.current,"status-pending":!l.value.completed&&!l.value.current}])},c(l.value.completed?R.$t("rightPanel.status.completed"):l.value.current?R.$t("rightPanel.status.executing"):R.$t("rightPanel.status.pending")),3)])]),s("p",hp,c(r(o)("rightPanel.noExecutionInfo")),1)])),l.value.current&&!l.value.completed?(p(),g("div",fp,[U[2]||(U[2]=s("div",{class:"execution-waves"},[s("div",{class:"wave wave-1"}),s("div",{class:"wave wave-2"}),s("div",{class:"wave wave-3"})],-1)),s("p",vp,[k(r(P),{icon:"carbon:in-progress",class:"rotating-icon"}),Z(" "+c(r(o)("rightPanel.stepExecuting")),1)])])):O("",!0)])):(p(),g("div",gp,[k(r(P),{icon:"carbon:events",class:"empty-icon"}),s("h3",null,c(r(o)("rightPanel.noStepSelected")),1),s("p",null,c(r(o)("rightPanel.selectStepHint")),1)]))])):O("",!0),k(Ne,{name:"scroll-button"},{default:Ie(()=>[d.value?(p(),g("button",{key:0,onClick:w,class:"scroll-to-bottom-btn",title:r(o)("rightPanel.scrollToBottom")},[k(r(P),{icon:"carbon:chevron-down"})],8,bp)):O("",!0)]),_:1})],544)])):O("",!0),i.value==="files"?(p(),g("div",yp,[L.value?(p(),ae(ru,{key:0,"plan-id":L.value},null,8,["plan-id"])):y.value?(p(),g("div",_p,[k(r(P),{icon:"carbon:folder-off"}),s("div",$p,[s("h3",null,c(r(o)("fileBrowser.noFilesYet")),1),s("p",null,c(r(o)("fileBrowser.noPlanExecuting")),1),s("div",Sp,[k(r(P),{icon:"carbon:information"}),s("span",null,c(r(o)("fileBrowser.startTaskTip")),1)])])])):O("",!0)])):O("",!0)])])}}}),kp=ue(wp,[["__scopeId","data-v-3ea813c1"]]);function Lt(){return{formatResponseText:f=>f?f.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/\*(.*?)\*/g,"<em>$1</em>").replace(/`([^`]+)`/g,"<code>$1</code>").replace(/\n/g,"<br>").replace(/```([\s\S]*?)```/g,"<pre><code>$1</code></pre>"):"",formatTimestamp:f=>{const h=new Date().getTime()-f.getTime();return h<6e4?"Just now":h<36e5?`${Math.floor(h/6e4)} minutes ago`:h<864e5?`${Math.floor(h/36e5)} hours ago`:f.toLocaleDateString("zh-CN",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})},getMessageClasses:f=>re(()=>({user:f.type==="user",assistant:f.type==="assistant",streaming:f.isStreaming,"has-error":!!f.error,"has-thinking":!!f.thinking,"has-execution":!!f.planExecution})),formatFileSize:f=>{if(f===0)return"0 B";const d=1024,h=["B","KB","MB","GB"],$=Math.floor(Math.log(f)/Math.log(d));return parseFloat((f/Math.pow(d,$)).toFixed(2))+" "+h[$]},truncateText:(f,d=100)=>!f||f.length<=d?f:f.substring(0,d)+"...",stripHtml:f=>f.replace(/<[^>]*>/g,""),hasDisplayableContent:f=>!!(f.content||(f.thinking??!1)||(f.planExecution??!1)||f.error),getMessageStatus:f=>f.error?"Send failed":f.isStreaming?"Typing...":f.type==="assistant"&&!f.content&&!f.thinking?"Waiting for response":""}}const Tp=["data-message-id"],Pp={class:"user-content"},Cp={class:"message-text"},Ep={key:0,class:"attachments"},Rp={class:"attachment-name"},Ip={class:"attachment-size"},Ap={class:"message-timestamp"},xp={key:0,class:"message-status error"},Dp={class:"status-text"},Fp=de({__name:"UserMessage",props:{message:{}},setup(n){const{formatTimestamp:e,formatFileSize:t}=Lt();return(o,a)=>{var l;return p(),g("div",{class:"user-message","data-message-id":o.message.id},[s("div",Pp,[s("div",Cp,c(o.message.content),1),(l=o.message.attachments)!=null&&l.length?(p(),g("div",Ep,[(p(!0),g(ne,null,le(o.message.attachments,(i,u)=>(p(),g("div",{key:u,class:"attachment-item"},[k(r(P),{icon:"carbon:document",class:"attachment-icon"}),s("span",Rp,c(i.name),1),s("span",Ip,c(r(t)(i.size)),1)]))),128))])):O("",!0),s("div",Ap,c(r(e)(o.message.timestamp)),1)]),o.message.error?(p(),g("div",xp,[k(r(P),{icon:"carbon:warning",class:"status-icon"}),s("span",Dp,c(o.message.error),1)])):O("",!0)],8,Tp)}}}),Mp=ue(Fp,[["__scopeId","data-v-94372507"]]),Up={class:"sub-plan-info"},Np={class:"sub-plan-details"},Lp={class:"sub-plan-title"},Op={key:0,class:"nesting-level"},Bp={class:"sub-plan-id"},qp={class:"sub-plan-meta"},Vp={key:0,class:"trigger-tool"},jp={class:"trigger-text"},Jp={key:0,class:"sub-plan-progress"},Hp={class:"progress-info"},Gp={class:"progress-text"},Wp={class:"progress-bar"},zp={key:1,class:"sub-plan-agents-steps"},Kp={class:"agents-steps-header"},Xp={class:"agents-label"},Qp={class:"agents-steps-list"},Yp=["onClick"],Zp={class:"agent-step-header"},em={class:"agent-name"},tm={class:"sub-agent-execution-info"},sm={key:0,class:"agent-result"},om={class:"result-header"},nm={class:"result-label"},am={class:"result-content"},lm={key:1,class:"agent-error"},rm={class:"error-header"},im={class:"error-label"},cm={class:"error-content"},dm={key:2,class:"think-act-preview"},um={class:"think-act-header"},pm={class:"think-act-label"},mm={class:"think-act-steps-preview"},hm=["onClick"],fm={class:"step-number"},vm={class:"step-description"},gm={key:0,class:"more-steps"},bm={class:"more-steps-text"},ym={key:3,class:"nested-sub-plans"},_m={class:"nested-sub-plans-header"},$m={class:"nested-label"},Sm={class:"nested-sub-plans-list"},wm={key:4,class:"direct-sub-plans"},km={class:"direct-sub-plans-header"},Tm={class:"direct-label"},Pm={class:"direct-sub-plans-list"},Cm=de({__name:"RecursiveSubPlan",props:{subPlan:{},subPlanIndex:{},nestingLevel:{default:0},maxNestingDepth:{default:3},maxVisibleSteps:{default:2}},emits:["sub-plan-selected","step-selected"],setup(n,{emit:e}){const t=n,o=e,{t:a}=Te(),l=()=>`nesting-level-${t.nestingLevel}`,i=()=>{var A,G;return t.subPlan.completed?"completed":((A=t.subPlan.agentExecutionSequence)==null?void 0:A.some(R=>R.status==="RUNNING"))?"running":((G=t.subPlan.agentExecutionSequence)==null?void 0:G.some(R=>R.status==="FINISHED"))?"in-progress":"pending"},u=()=>{switch(i()){case"completed":return a("chat.status.completed");case"running":return a("chat.status.executing");case"in-progress":return a("chat.status.inProgress");case"pending":return a("chat.status.pending");default:return a("chat.status.unknown")}},f=()=>{switch(i()){case"completed":return"carbon:checkmark";case"running":return"carbon:play";case"in-progress":return"carbon:in-progress";case"pending":default:return"carbon:dot-mark"}},d=()=>{var E;if(!((E=t.subPlan.agentExecutionSequence)!=null&&E.length))return 0;if(t.subPlan.completed)return 100;const v=h();return Math.min(100,v/t.subPlan.agentExecutionSequence.length*100)},h=()=>{var v;return(v=t.subPlan.agentExecutionSequence)!=null&&v.length?t.subPlan.agentExecutionSequence.filter(E=>E.status==="FINISHED").length:0},$=v=>{switch(v){case"FINISHED":return"completed";case"RUNNING":return"running";case"IDLE":default:return"pending"}},M=v=>{switch(v){case"FINISHED":return"carbon:checkmark";case"RUNNING":return"carbon:play";case"IDLE":default:return"carbon:dot-mark"}},L=v=>{switch(v){case"RUNNING":return a("chat.status.executing");case"FINISHED":return a("chat.status.completed");case"IDLE":default:return a("chat.status.pending")}},y=v=>{var E;return((E=v.thinkActSteps)==null?void 0:E.some(A=>A.subPlanExecutionRecord))??!1},S=v=>{var E;return((E=v.thinkActSteps)==null?void 0:E.filter(A=>A.subPlanExecutionRecord))??[]},_=()=>{o("sub-plan-selected",-1,t.subPlanIndex,t.subPlan)},m=(v,E)=>{const A=E.stepId??`subplan-${t.subPlanIndex}-agent-${v}`;o("step-selected",A)},C=(v,E,A)=>{const G=A.stepId??`subplan-${t.subPlanIndex}-agent-${v}`;o("step-selected",G)},w=(v,E,A)=>{o("sub-plan-selected",v,E,A)},D=v=>{o("step-selected",v)};return(v,E)=>{var G,R;const A=es("RecursiveSubPlan",!0);return p(),g("div",{class:oe(["recursive-sub-plan",l()])},[s("div",{class:"sub-plan-header",onClick:_},[s("div",Up,[k(r(P),{icon:f(),class:"sub-plan-status-icon"},null,8,["icon"]),s("div",Np,[s("div",Lp,[Z(c(v.subPlan.title||v.$t("chat.subPlan"))+" #"+c(v.subPlanIndex+1)+" ",1),(v.nestingLevel??0)>0?(p(),g("span",Op,"(L"+c((v.nestingLevel??0)+1)+")",1)):O("",!0)]),s("div",Bp,c(v.subPlan.currentPlanId),1)])]),s("div",qp,[s("div",{class:oe(["sub-plan-status-badge",i()])},c(u()),3),v.subPlan.parentActToolCall?(p(),g("div",Vp,[k(r(P),{icon:"carbon:function",class:"trigger-icon"}),s("span",jp,c(v.subPlan.parentActToolCall.name),1)])):O("",!0)])]),(G=v.subPlan.agentExecutionSequence)!=null&&G.length?(p(),g("div",Jp,[s("div",Hp,[s("span",Gp,c(v.$t("chat.progress"))+": "+c(h())+" / "+c(v.subPlan.agentExecutionSequence.length),1),s("div",Wp,[s("div",{class:"progress-fill",style:Ve({width:d()+"%"})},null,4)])])])):O("",!0),(R=v.subPlan.agentExecutionSequence)!=null&&R.length?(p(),g("div",zp,[s("div",Kp,[s("span",Xp,c(v.$t("chat.agentExecutions"))+":",1)]),s("div",Qp,[(p(!0),g(ne,null,le(v.subPlan.agentExecutionSequence,(U,F)=>{var B,V;return p(),g("div",{key:U.id||F,class:oe(["agent-step-item",$(U.status)]),onClick:z=>m(F,U)},[s("div",Zp,[k(r(P),{icon:M(U.status),class:"agent-icon"},null,8,["icon"]),s("span",em,c(U.agentName||v.$t("chat.unknownAgent")),1),s("div",{class:oe(["agent-status-badge",$(U.status)])},c(L(U.status)),3)]),s("div",tm,[U.result?(p(),g("div",sm,[s("div",om,[k(r(P),{icon:"carbon:checkmark",class:"result-icon"}),s("span",nm,c(v.$t("chat.agentResult"))+":",1)]),s("pre",am,c(U.result),1)])):O("",!0),U.errorMessage?(p(),g("div",lm,[s("div",rm,[k(r(P),{icon:"carbon:warning",class:"error-icon"}),s("span",im,c(v.$t("chat.errorMessage"))+":",1)]),s("pre",cm,c(U.errorMessage),1)])):O("",!0),(B=U.thinkActSteps)!=null&&B.length?(p(),g("div",dm,[s("div",um,[k(r(P),{icon:"carbon:thinking",class:"think-act-icon"}),s("span",pm,c(v.$t("chat.thinkActSteps"))+" ("+c(U.thinkActSteps.length)+")",1)]),s("div",mm,[(p(!0),g(ne,null,le(U.thinkActSteps.slice(0,v.maxVisibleSteps??2),(z,Y)=>(p(),g("div",{key:z.id||Y,class:"think-act-step-preview",onClick:pe(T=>C(F,Y,U),["stop"])},[s("span",fm,"#"+c(Y+1),1),s("span",vm,c(z.actionDescription||v.$t("chat.thinking")),1),k(r(P),{icon:"carbon:arrow-right",class:"step-arrow"})],8,hm))),128)),U.thinkActSteps.length>(v.maxVisibleSteps??2)?(p(),g("div",gm,[s("span",bm,c(v.$t("chat.andMoreSteps",{count:U.thinkActSteps.length-(v.maxVisibleSteps??2)})),1)])):O("",!0)])])):O("",!0),y(U)?(p(),g("div",ym,[s("div",_m,[k(r(P),{icon:"carbon:tree-view-alt",class:"nested-icon"}),s("span",$m,c(v.$t("chat.nestedSubPlans")),1)]),s("div",Sm,[(p(!0),g(ne,null,le(S(U),(z,Y)=>(p(),ae(A,{key:z.id||Y,"sub-plan":z.subPlanExecutionRecord,"sub-plan-index":Y,"nesting-level":(v.nestingLevel??0)+1,"max-nesting-depth":v.maxNestingDepth??3,"max-visible-steps":v.maxVisibleSteps??2,onSubPlanSelected:w,onStepSelected:D},null,8,["sub-plan","sub-plan-index","nesting-level","max-nesting-depth","max-visible-steps"]))),128))])])):O("",!0),(V=U.subPlanExecutionRecords)!=null&&V.length?(p(),g("div",wm,[s("div",km,[k(r(P),{icon:"carbon:tree-view",class:"direct-icon"}),s("span",Tm,c(v.$t("chat.directSubPlans")),1)]),s("div",Pm,[(p(!0),g(ne,null,le(U.subPlanExecutionRecords,(z,Y)=>(p(),ae(A,{key:z.currentPlanId||Y,"sub-plan":z,"sub-plan-index":Y,"nesting-level":(v.nestingLevel??0)+1,"max-nesting-depth":v.maxNestingDepth??3,"max-visible-steps":v.maxVisibleSteps??2,onSubPlanSelected:w,onStepSelected:D},null,8,["sub-plan","sub-plan-index","nesting-level","max-nesting-depth","max-visible-steps"]))),128))])])):O("",!0)])],10,Yp)}),128))])])):O("",!0)],2)}}}),Em=ue(Cm,[["__scopeId","data-v-5dcf159c"]]),Rm={class:"execution-details"},Im={key:0,class:"plan-overview"},Am={class:"plan-header"},xm={class:"plan-title"},Dm={key:0,class:"parent-tool-call"},Fm={class:"parent-tool-header"},Mm={class:"tool-label"},Um={class:"tool-name"},Nm={key:0,class:"tool-parameters"},Lm={class:"param-label"},Om={class:"param-content"},Bm={key:1,class:"agent-execution-container"},qm={class:"section-title"},Vm=["onClick"],jm={class:"agent-info"},Jm={class:"agent-details"},Hm={class:"agent-name"},Gm={class:"request-content"},Wm={class:"agent-controls"},zm={class:"agent-execution-info"},Km={key:0,class:"agent-result"},Xm={class:"result-header"},Qm={class:"result-label"},Ym={class:"result-content"},Zm={key:1,class:"agent-error"},eh={class:"error-header"},th={class:"error-label"},sh={class:"error-content"},oh={key:0,class:"sub-plans-container"},nh={class:"sub-plans-header"},ah={class:"sub-plans-title"},lh={class:"sub-plans-list"},rh=de({__name:"ExecutionDetails",props:{planExecution:{}},emits:["sub-plan-selected","step-selected"],setup(n,{emit:e}){const t=n,o=e,{t:a}=Te(),l=re(()=>t.planExecution.agentExecutionSequence??[]),i=S=>{S.stepId?o("step-selected",S.stepId):console.warn("[ExecutionDetails] Agent execution has no stepId:",S)},u=()=>t.planExecution.completed?"completed":l.value.some(m=>m.status==="RUNNING")?"running":l.value.some(m=>m.status==="FINISHED")?"in-progress":"pending",f=()=>{switch(u()){case"completed":return a("chat.status.completed");case"running":return a("chat.status.executing");case"in-progress":return a("chat.status.inProgress");case"pending":return a("chat.status.pending");default:return a("chat.status.unknown")}},d=S=>{switch(S){case"RUNNING":return"running";case"FINISHED":return"completed";case"IDLE":default:return"pending"}},h=S=>{switch(S){case"RUNNING":return a("chat.status.executing");case"FINISHED":return a("chat.status.completed");case"IDLE":default:return a("chat.status.pending")}},$=S=>{switch(S){case"RUNNING":return"carbon:play";case"FINISHED":return"carbon:checkmark";case"IDLE":default:return"carbon:dot-mark"}},M=(S,_,m)=>{o("sub-plan-selected",S,_,m)},L=S=>{o("step-selected",S)},y=S=>{if(!S)return"";try{const _=JSON.parse(S);return JSON.stringify(_,null,2)}catch{return S}};return(S,_)=>{var m,C,w;return p(),g("div",Rm,[S.planExecution?(p(),g("div",Im,[s("div",Am,[s("h3",xm,c(S.planExecution.title||S.$t("chat.planExecution")),1),s("div",{class:oe(["plan-status-badge",u()])},c(f()),3)]),S.planExecution.parentActToolCall?(p(),g("div",Dm,[s("div",Fm,[k(r(P),{icon:"carbon:flow",class:"tool-icon"}),s("span",Mm,c(S.$t("chat.triggeredByTool"))+":",1),s("span",Um,c(S.planExecution.parentActToolCall.name),1)]),S.planExecution.parentActToolCall.parameters?(p(),g("div",Nm,[s("span",Lm,c(S.$t("common.parameters"))+":",1),s("pre",Om,c(y(S.planExecution.parentActToolCall.parameters)),1)])):O("",!0)])):O("",!0)])):O("",!0),(((C=(m=S.planExecution)==null?void 0:m.agentExecutionSequence)==null?void 0:C.length)??0)>0?(p(),g("div",Bm,[s("h4",qm,c(S.$t("chat.agentExecutionSequence")),1),(p(!0),g(ne,null,le((w=S.planExecution)==null?void 0:w.agentExecutionSequence,(D,v)=>{var E;return p(),g("div",{key:D.id||v,class:oe(["agent-execution-item",d(D.status)])},[s("div",{class:"agent-header",onClick:A=>i(D)},[s("div",jm,[k(r(P),{icon:$(D.status),class:"agent-status-icon"},null,8,["icon"]),s("div",Jm,[s("div",Hm,c(D.agentName||S.$t("chat.unknownAgent")),1),s("pre",Gm,c(D.agentRequest),1)])]),s("div",Wm,[s("div",{class:oe(["agent-status-badge",d(D.status)])},c(h(D.status)),3),k(r(P),{icon:"carbon:arrow-right",class:"step-select-icon"})])],8,Vm),s("div",zm,[D.result?(p(),g("div",Km,[s("div",Xm,[k(r(P),{icon:"carbon:checkmark",class:"result-icon"}),s("span",Qm,c(S.$t("chat.agentResult"))+":",1)]),s("pre",Ym,c(D.result),1)])):O("",!0),D.errorMessage?(p(),g("div",Zm,[s("div",eh,[k(r(P),{icon:"carbon:warning",class:"error-icon"}),s("span",th,c(S.$t("chat.errorMessage"))+":",1)]),s("pre",sh,c(D.errorMessage),1)])):O("",!0)]),(E=D.subPlanExecutionRecords)!=null&&E.length?(p(),g("div",oh,[s("div",nh,[k(r(P),{icon:"carbon:tree-view",class:"sub-plans-icon"}),s("span",ah,c(S.$t("chat.subPlanExecutions"))+" ("+c(D.subPlanExecutionRecords.length)+") ",1)]),s("div",lh,[(p(!0),g(ne,null,le(D.subPlanExecutionRecords,(A,G)=>(p(),ae(Em,{key:A.currentPlanId||G,"sub-plan":A,"sub-plan-index":G,"nesting-level":0,"max-nesting-depth":3,"max-visible-steps":2,onSubPlanSelected:M,onStepSelected:L},null,8,["sub-plan","sub-plan-index"]))),128))])])):O("",!0)],2)}),128))])):O("",!0)])}}}),Ds=ue(rh,[["__scopeId","data-v-3fdaaeed"]]),ih={key:0,class:"thinking-section"},ch={class:"thinking-header"},dh={class:"thinking-avatar"},uh={class:"thinking-label"},ph={class:"thinking-content"},mh={key:0,class:"thinking"},hh={key:2,class:"default-processing"},fh={class:"processing-indicator"},vh=de({__name:"ThinkingSection",props:{thinking:{},thinkingDetails:{},planExecution:{},stepActions:{},genericInput:{},hasContent:{type:Boolean}},emits:["agent-selected","sub-plan-selected","user-input-submitted","step-selected"],setup(n,{emit:e}){const t=n,o=e,a=re(()=>{var d,h,$,M;return(t.thinking??!1)||(((h=(d=t.thinkingDetails)==null?void 0:d.agentExecutionSequence)==null?void 0:h.length)??0)>0||(((M=($=t.planExecution)==null?void 0:$.agentExecutionSequence)==null?void 0:M.length)??0)>0}),l=(d,h)=>{o("agent-selected",d,h)},i=(d,h,$)=>{o("sub-plan-selected",d,h,$)},u=d=>{o("user-input-submitted",d)},f=d=>{o("step-selected",d)};return(d,h)=>a.value?(p(),g("div",ih,[s("div",ch,[s("div",dh,[k(r(P),{icon:"carbon:thinking",class:"thinking-icon"})]),s("div",uh,c(d.$t("chat.thinkingLabel")),1)]),s("div",ph,[d.thinking?(p(),g("div",mh,[k(r(P),{icon:"carbon:thinking",class:"thinking-icon"}),s("span",null,c(d.thinking),1)])):O("",!0),d.thinkingDetails||d.planExecution?(p(),ae(Ds,{key:1,"plan-execution":d.thinkingDetails||d.planExecution,"step-actions":d.stepActions||[],"generic-input":d.genericInput||"",onAgentSelected:l,onSubPlanSelected:i,onUserInputSubmitted:u,onStepSelected:f},null,8,["plan-execution","step-actions","generic-input"])):!d.hasContent&&d.thinking?(p(),g("div",hh,[s("div",fh,[h[0]||(h[0]=s("div",{class:"thinking-dots"},[s("span"),s("span"),s("span")],-1)),s("span",null,c(d.thinking||d.$t("chat.thinkingProcessing")),1)])])):O("",!0)])])):O("",!0)}}),gh=ue(vh,[["__scopeId","data-v-1cb833fc"]]);class _t{static async getDetails(e){try{const t=await fetch(`${this.BASE_URL}/details/${e}`);if(t.status===404)return null;if(!t.ok){const l=await t.text();throw new Error(`Failed to get detailed information: ${t.status} - ${l}`)}const o=await t.text(),a=JSON.parse(o);return a&&typeof a=="object"&&!a.currentPlanId&&(a.currentPlanId=e),a}catch(t){return console.error("[CommonApiService] Failed to get plan details:",t),null}}static async submitFormInput(e,t){const o=await fetch(`${this.BASE_URL}/submit-input/${e}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!o.ok){let l;try{l=await o.json()}catch{l={message:`Failed to submit form input: ${o.status}`}}throw new Error(l.message||`Failed to submit form input: ${o.status}`)}const a=o.headers.get("content-type");return a&&a.indexOf("application/json")!==-1?await o.json():{success:!0}}static async getAllPrompts(){try{const e=await fetch(this.BASE_URL);return await(await this.handleResponse(e)).json()}catch(e){throw console.error("Failed to get Prompt list:",e),e}}static async handleResponse(e){if(!e.ok)try{const t=await e.json();throw new Error(t.message||`API request failed: ${e.status}`)}catch{throw new Error(`API request failed: ${e.status} ${e.statusText}`)}return e}}fe(_t,"BASE_URL","/api/executor");const bh={class:"user-input-form-container"},yh={class:"user-input-header"},_h={class:"user-input-title"},$h={class:"user-input-message"},Sh={key:0,class:"form-description"},wh={key:0,class:"form-grid"},kh=["for"],Th=["id","name","placeholder","required","onUpdate:modelValue"],Ph=["id","name","placeholder","required","onUpdate:modelValue"],Ch=["id","name","placeholder","required","onUpdate:modelValue"],Eh=["id","name","placeholder","required","onUpdate:modelValue"],Rh=["id","name","placeholder","required","onUpdate:modelValue"],Ih=["id","name","required","onUpdate:modelValue"],Ah={value:""},xh=["value"],Dh={key:6,class:"checkbox-group"},Fh=["id","name","value","onUpdate:modelValue"],Mh={class:"checkbox-label"},Uh={key:7,class:"radio-group"},Nh=["id","name","value","onUpdate:modelValue"],Lh={class:"radio-label"},Oh=["id","name","placeholder","required","onUpdate:modelValue"],Bh={key:1,class:"form-group"},qh={for:"form-input-genericInput"},Vh={type:"submit",class:"submit-user-input-btn"},jh=de({__name:"UserInputForm",props:{userInputWaitState:{},planId:{},genericInput:{}},emits:["user-input-submitted"],setup(n,{emit:e}){const t=n,o=e;Te();const a=ot({}),l=N(t.genericInput??""),i=N(!1),u=N(null),f=()=>{var L;const M=(L=t.userInputWaitState)==null?void 0:L.formInputs;M&&M.length>0&&(!i.value||Object.keys(a).length!==M.length)&&(M.forEach((S,_)=>{(!(_ in a)||S.type==="checkbox"&&!Array.isArray(a[_])||S.type!=="checkbox"&&a[_]==="")&&(S.type==="checkbox"?a[_]=[]:a[_]="")}),i.value=!0)};we(()=>{f()}),ie(()=>{var M;return(M=t.userInputWaitState)==null?void 0:M.formInputs},()=>{u.value&&clearTimeout(u.value),u.value=setTimeout(()=>{i.value=!1,f()},100)},{deep:!0});const d=async()=>{var M;try{const L={},y=(M=t.userInputWaitState)==null?void 0:M.formInputs;y&&y.length>0?Object.entries(a).forEach(([S,_])=>{const m=parseInt(S,10),w=y[m].label||`input_${S}`;Array.isArray(_)?L[w]=_.join(", "):L[w]=_}):L.genericInput=l.value,console.log("[UserInputForm] Submitting user input:",L,"for planId:",t.planId),t.planId?(await _t.submitFormInput(t.planId,L),console.log("[UserInputForm] User input submitted successfully")):console.error("[UserInputForm] No planId available for user input submission"),o("user-input-submitted",L)}catch(L){console.error("[UserInputForm] User input submission failed:",L)}},h=M=>M?Array.isArray(M)?M:typeof M=="string"?M.split(",").map(L=>L.trim()).filter(L=>L.length>0):[]:[],$=M=>typeof M=="boolean"?M:typeof M=="string"?M==="true":!1;return Se(()=>{u.value&&clearTimeout(u.value)}),(M,L)=>{var y,S,_,m,C;return p(),g("div",bh,[s("div",yh,[k(r(P),{icon:"carbon:user",class:"user-icon"}),s("h4",_h,c(M.$t("chat.userInputRequired")),1)]),s("p",$h,c(((y=M.userInputWaitState)==null?void 0:y.title)??M.$t("chat.userInput.message")),1),(S=M.userInputWaitState)!=null&&S.formDescription?(p(),g("p",Sh,c((_=M.userInputWaitState)==null?void 0:_.formDescription),1)):O("",!0),s("form",{onSubmit:pe(d,["prevent"]),class:"user-input-form"},[(m=M.userInputWaitState)!=null&&m.formInputs&&M.userInputWaitState.formInputs.length>0?(p(),g("div",wh,[(p(!0),g(ne,null,le((C=M.userInputWaitState)==null?void 0:C.formInputs,(w,D)=>(p(),g("div",{key:D,class:"form-group"},[s("label",{for:`form-input-${w.label.replace(/\W+/g,"_")}`},c(w.label)+c($(w.required)?" *":"")+": ",9,kh),!w.type||w.type==="text"?se((p(),g("input",{key:0,type:"text",id:`form-input-${w.label.replace(/\W+/g,"_")}`,name:w.label,placeholder:w.placeholder||"",required:$(w.required),"onUpdate:modelValue":v=>a[D]=v,class:"form-input"},null,8,Th)),[[ce,a[D]]]):w.type==="email"?se((p(),g("input",{key:1,type:"email",id:`form-input-${w.label.replace(/\W+/g,"_")}`,name:w.label,placeholder:w.placeholder||"",required:$(w.required),"onUpdate:modelValue":v=>a[D]=v,class:"form-input"},null,8,Ph)),[[ce,a[D]]]):w.type==="number"?se((p(),g("input",{key:2,type:"number",id:`form-input-${w.label.replace(/\W+/g,"_")}`,name:w.label,placeholder:w.placeholder||"",required:$(w.required),"onUpdate:modelValue":v=>a[D]=v,class:"form-input"},null,8,Ch)),[[ce,a[D]]]):w.type==="password"?se((p(),g("input",{key:3,type:"password",id:`form-input-${w.label.replace(/\W+/g,"_")}`,name:w.label,placeholder:w.placeholder||"",required:$(w.required),"onUpdate:modelValue":v=>a[D]=v,class:"form-input"},null,8,Eh)),[[ce,a[D]]]):w.type==="textarea"?se((p(),g("textarea",{key:4,id:`form-input-${w.label.replace(/\W+/g,"_")}`,name:w.label,placeholder:w.placeholder||"",required:$(w.required),"onUpdate:modelValue":v=>a[D]=v,class:"form-input form-textarea",rows:"4"},null,8,Rh)),[[ce,a[D]]]):w.type==="select"&&w.options?se((p(),g("select",{key:5,id:`form-input-${w.label.replace(/\W+/g,"_")}`,name:w.label,required:$(w.required),"onUpdate:modelValue":v=>a[D]=v,class:"form-input form-select"},[s("option",Ah,c(M.$t("selectCommon.pleaseSelect")),1),(p(!0),g(ne,null,le(h(w.options),v=>(p(),g("option",{key:v,value:v},c(v),9,xh))),128))],8,Ih)),[[nt,a[D]]]):w.type==="checkbox"&&w.options?(p(),g("div",Dh,[(p(!0),g(ne,null,le(h(w.options),v=>(p(),g("label",{key:v,class:"checkbox-item"},[se(s("input",{type:"checkbox",id:`form-input-${w.label.replace(/\W+/g,"_")}-${v.replace(/\W+/g,"_")}`,name:w.label,value:v,"onUpdate:modelValue":E=>a[D]=E,class:"form-checkbox"},null,8,Fh),[[kt,a[D]]]),s("span",Mh,c(v),1)]))),128))])):w.type==="radio"&&w.options?(p(),g("div",Uh,[(p(!0),g(ne,null,le(h(w.options),v=>(p(),g("label",{key:v,class:"radio-item"},[se(s("input",{type:"radio",id:`form-input-${w.label.replace(/\W+/g,"_")}-${v.replace(/\W+/g,"_")}`,name:w.label,value:v,"onUpdate:modelValue":E=>a[D]=E,class:"form-radio"},null,8,Nh),[[Ls,a[D]]]),s("span",Lh,c(v),1)]))),128))])):se((p(),g("input",{key:8,type:"text",id:`form-input-${w.label.replace(/\W+/g,"_")}`,name:w.label,placeholder:w.placeholder||"",required:$(w.required),"onUpdate:modelValue":v=>a[D]=v,class:"form-input"},null,8,Oh)),[[ce,a[D]]])]))),128))])):(p(),g("div",Bh,[s("label",qh,c(M.$t("common.input"))+":",1),se(s("input",{type:"text",id:"form-input-genericInput",name:"genericInput","onUpdate:modelValue":L[0]||(L[0]=w=>l.value=w),class:"form-input"},null,512),[[ce,l.value]])])),s("button",Vh,c(M.$t("chat.userInput.submit")),1)],32)])}}}),Jh=ue(jh,[["__scopeId","data-v-fc42d4b8"]]),Hh={class:"response-section"},Gh={class:"response-header"},Wh={class:"response-avatar"},zh={class:"response-name"},Kh={key:0,class:"response-timestamp"},Xh={class:"response-content"},Qh={key:1,class:"final-response"},Yh=["innerHTML"],Zh={class:"response-actions"},ef=["title"],tf=["title"],sf={key:2,class:"response-placeholder"},of={class:"typing-indicator"},nf={class:"typing-text"},af={key:3,class:"response-error"},lf={class:"error-text"},rf={key:4,class:"response-empty"},cf={class:"empty-text"},df=de({__name:"ResponseSection",props:{content:{},isStreaming:{type:Boolean},error:{},timestamp:{},userInputWaitState:{},planId:{},genericInput:{}},emits:["copy","regenerate","retry","user-input-submitted"],setup(n,{emit:e}){const t=n,o=e,{formatResponseText:a,formatTimestamp:l}=Lt(),i=async()=>{if(t.content)try{const h=t.content.replace(/<[^>]*>/g,"");await navigator.clipboard.writeText(h),o("copy")}catch(h){console.error("Failed to copy to clipboard:",h)}},u=()=>{o("regenerate")},f=()=>{o("retry")},d=h=>{console.log("[ResponseSection] User input submitted:",h),o("user-input-submitted",h)};return(h,$)=>{var M;return p(),g("div",Hh,[s("div",Gh,[s("div",Wh,[k(r(P),{icon:"carbon:bot",class:"bot-icon"})]),s("div",zh,c(h.$t("chat.botName")),1),h.timestamp?(p(),g("div",Kh,c(r(l)(h.timestamp)),1)):O("",!0)]),s("div",Xh,[(M=h.userInputWaitState)!=null&&M.waiting?(p(),ae(Jh,ts({key:0,"user-input-wait-state":h.userInputWaitState},h.planId?{"plan-id":h.planId}:{},{"generic-input":h.genericInput??"",onUserInputSubmitted:d}),null,16,["user-input-wait-state","generic-input"])):O("",!0),h.content?(p(),g("div",Qh,[s("div",{class:"response-text",innerHTML:r(a)(h.content)},null,8,Yh),s("div",Zh,[s("button",{class:"action-btn copy-btn",onClick:i,title:h.$t("chat.copyResponse")},[k(r(P),{icon:"carbon:copy"})],8,ef),s("button",{class:"action-btn regenerate-btn",onClick:u,title:h.$t("chat.regenerateResponse")},[k(r(P),{icon:"carbon:renew"})],8,tf)])])):h.isStreaming?(p(),g("div",sf,[s("div",of,[$[0]||($[0]=s("div",{class:"typing-dots"},[s("span"),s("span"),s("span")],-1)),s("span",nf,c(h.$t("chat.thinkingResponse")),1)])])):h.error?(p(),g("div",af,[k(r(P),{icon:"carbon:warning",class:"error-icon"}),s("span",lf,c(h.error),1),s("button",{class:"retry-btn",onClick:f},c(h.$t("chat.retry")),1)])):(p(),g("div",rf,[s("span",cf,c(h.$t("chat.waitingForResponse")),1)]))])])}}}),uf=ue(df,[["__scopeId","data-v-6581a34f"]]),pf={class:"assistant-message"},mf=de({__name:"AssistantMessage",props:{message:{},isStreaming:{type:Boolean}},emits:["copy","regenerate","retry","step-selected"],setup(n,{emit:e}){const t=n,o=e,a=()=>{o("copy",t.message.id)},l=()=>{o("regenerate",t.message.id)},i=()=>{o("retry",t.message.id)},u=(d,h)=>{console.log("[AssistantMessage] User input submitted:",h,"for message:",d.id)},f=d=>{console.log("[AssistantMessage] Step selected:",d),o("step-selected",d)};return(d,h)=>{var $,M,L,y;return p(),g("div",pf,[d.message.thinkingDetails?(p(),ae(gh,{key:0,"thinking-details":d.message.thinkingDetails,onStepSelected:f},null,8,["thinking-details"])):O("",!0),d.message.planExecution?(p(),ae(Ds,{key:1,"plan-execution":d.message.planExecution,"step-actions":d.message.stepActions||[],"generic-input":d.message.genericInput||"",onStepSelected:f},null,8,["plan-execution","step-actions","generic-input"])):O("",!0),d.message.content||d.message.error||d.isStreaming||(M=($=d.message.planExecution)==null?void 0:$.userInputWaitState)!=null&&M.waiting?(p(),ae(uf,ts({key:2,content:d.message.content||"","is-streaming":d.isStreaming||!1},{...d.message.error?{error:d.message.error}:{},...(L=d.message.planExecution)!=null&&L.userInputWaitState?{userInputWaitState:d.message.planExecution.userInputWaitState}:{},...(y=d.message.planExecution)!=null&&y.currentPlanId?{planId:d.message.planExecution.currentPlanId}:{}},{timestamp:d.message.timestamp,"generic-input":d.message.genericInput||"",onCopy:a,onRegenerate:l,onRetry:i,onUserInputSubmitted:h[0]||(h[0]=S=>u(d.message,S))}),null,16,["content","is-streaming","timestamp","generic-input"])):O("",!0)])}}}),hf=ue(mf,[["__scopeId","data-v-3810c279"]]),ff=de({__name:"ChatMessage",props:{message:{},isStreaming:{type:Boolean}},emits:["copy","regenerate","retry","step-selected"],setup(n,{emit:e}){const t=n,o=e,{getMessageClasses:a}=Lt(),l=re(()=>a(t.message)),i=h=>{o("copy",h)},u=h=>{o("regenerate",h)},f=h=>{o("retry",h)},d=h=>{o("step-selected",h)};return(h,$)=>(p(),g("div",{class:oe(["chat-message",l.value])},[h.message.type==="user"?(p(),ae(Mp,{key:0,message:h.message},null,8,["message"])):h.message.type==="assistant"?(p(),ae(hf,{key:1,message:h.message,"is-streaming":h.isStreaming||!1,onCopy:i,onRegenerate:u,onRetry:f,onStepSelected:d},null,8,["message","is-streaming"])):O("",!0)],2))}}),vf=ue(ff,[["__scopeId","data-v-218b3735"]]);function At(n){const e={...n};return"agentExecutionSequence"in n&&Array.isArray(n.agentExecutionSequence)&&(e.agentExecutionSequence=n.agentExecutionSequence.map(t=>gf(t))),e}function gf(n){const e={...n};return"subPlanExecutionRecords"in n&&Array.isArray(n.subPlanExecutionRecords)&&(e.subPlanExecutionRecords=n.subPlanExecutionRecords.map(t=>At(t))),e}function bf(n){const e={...n};return"thinkingDetails"in n&&n.thinkingDetails&&(e.thinkingDetails=At(n.thinkingDetails)),"planExecution"in n&&n.planExecution&&(e.planExecution=At(n.planExecution)),"attachments"in n&&Array.isArray(n.attachments)&&(e.attachments=[...n.attachments]),e}function yf(){const n=N([]),e=N(!1),t=N(null),o=N(null),a=re(()=>n.value.length>0?n.value[n.value.length-1]:null),l=re(()=>t.value!==null),i=re(()=>n.value.length>0),u=(D,v,E)=>{const A={id:`msg_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,type:D,content:v,timestamp:new Date,isStreaming:!1,...E};return n.value.push(A),A},f=(D,v)=>{const E=n.value.findIndex(A=>A.id===D);E!==-1&&(n.value[E]={...n.value[E],...v})},d=D=>{const v=n.value.findIndex(E=>E.id===D);v!==-1&&n.value.splice(v,1)},h=()=>{n.value=[],t.value=null,o.value=null},$=D=>{t.value=D,f(D,{isStreaming:!0})},M=D=>{D&&f(D,{isStreaming:!1}),t.value===D&&(t.value=null)},L=D=>{o.value=D},y=(D,v,E="content")=>{const A=n.value.find(G=>G.id===D);A&&typeof A[E]=="string"&&f(D,{[E]:A[E]+v})},S=(D,v)=>{f(D,{thinkingDetails:v})},_=(D,v)=>{f(D,{thinking:v})},m=(D,v)=>{f(D,{planExecution:v})},C=D=>n.value.find(v=>v.id===D),w=D=>n.value.findIndex(v=>v.id===D);return{messages:et(n),isLoading:e,streamingMessageId:et(t),activeMessageId:et(o),lastMessage:a,isStreaming:l,hasMessages:i,addMessage:u,updateMessage:f,removeMessage:d,clearMessages:h,startStreaming:$,stopStreaming:M,setActiveMessage:L,appendToMessage:y,updateMessageThinking:_,updateMessageThinkingDetails:S,updateMessagePlanExecution:m,findMessage:C,getMessageIndex:w}}function _f(n){const e=N(!1),t=N(!0),o=150,a=async(_=!0)=>{n.value&&(await ye(),n.value.scrollTo({top:n.value.scrollHeight,behavior:_?"smooth":"auto"}))},l=()=>{if(!n.value)return!1;const{scrollTop:_,scrollHeight:m,clientHeight:C}=n.value;return m-_-C<o},i=()=>{if(!n.value)return;const _=l();e.value=!_&&n.value.scrollHeight>n.value.clientHeight,_&&(t.value=!0)},u=()=>{i(),l()||(t.value=!1)},f=async()=>{t.value&&await a()},d=async()=>{t.value=!0,await a()},h=(_,m=!0)=>{if(!n.value)return;const C=n.value.querySelector(`[data-message-id="${_}"]`);C&&C.scrollIntoView({behavior:m?"smooth":"auto",block:"center"})},$=()=>{if(!n.value)return{scrollTop:0,scrollHeight:0,clientHeight:0,isAtTop:!0,isAtBottom:!0,scrollPercentage:0};const{scrollTop:_,scrollHeight:m,clientHeight:C}=n.value,w=_===0,D=_+C>=m-5,v=m>C?_/(m-C)*100:100;return{scrollTop:_,scrollHeight:m,clientHeight:C,isAtTop:w,isAtBottom:D,scrollPercentage:v}},M=()=>{n.value&&n.value.addEventListener("scroll",u,{passive:!0})},L=()=>{n.value&&n.value.removeEventListener("scroll",u)},y=()=>{M(),i()},S=()=>{L()};return we(()=>{ye(()=>{y()})}),Se(()=>{S()}),{showScrollToBottom:et(e),isAutoScrollEnabled:et(t),scrollToBottom:a,autoScrollToBottom:f,forceScrollToBottom:d,scrollToMessage:h,isNearBottom:l,checkScrollPosition:i,getScrollInfo:$,addScrollListener:M,removeScrollListener:L,initializeScrollBehavior:y,cleanupScrollBehavior:S}}const Me=class Me{constructor(){fe(this,"POLL_INTERVAL",5e3);fe(this,"state",ot({activePlanId:null,lastSequenceSize:0,isPolling:!1,pollTimer:null}));fe(this,"callbacks",{});fe(this,"planExecutionCache",new Map);fe(this,"uiStateCache",new Map);console.log("[PlanExecutionManager] Initialized with callback-based event system")}getCachedPlanRecord(e){return this.planExecutionCache.get(e)}getCachedUIState(e){return this.uiStateCache.get(e)}setCachedUIState(e,t){this.uiStateCache.set(e,t),console.log(`[PlanExecutionManager] Cached UI state for rootPlanId: ${e}`)}getAllCachedRecords(){return new Map(this.planExecutionCache)}hasCachedPlanRecord(e){return this.planExecutionCache.has(e)}setCachedPlanRecord(e,t){this.planExecutionCache.set(e,t),console.log(`[PlanExecutionManager] Cached plan execution record for rootPlanId: ${e}`)}clearCachedPlanRecord(e){const t=this.planExecutionCache.delete(e);return t&&console.log(`[PlanExecutionManager] Cleared cached plan execution record for rootPlanId: ${e}`),t}clearAllCachedRecords(){const e=this.planExecutionCache.size,t=this.uiStateCache.size;this.planExecutionCache.clear(),this.uiStateCache.clear(),console.log(`[PlanExecutionManager] Cleared all caches - Plans: ${e}, UI States: ${t}`)}static getInstance(){return Me.instance||(Me.instance=new Me),Me.instance}getActivePlanId(){return this.state.activePlanId}getState(){return this.state}setEventCallbacks(e){this.callbacks={...this.callbacks,...e},console.log("[PlanExecutionManager] Event callbacks set:",Object.keys(e))}async handleUserMessageSendRequested(e){if(this.validateAndPrepareUIForNewRequest(e))try{if(await this.sendUserMessageAndSetPlanId(e),this.state.activePlanId)this.initiatePlanExecutionSequence(e,this.state.activePlanId);else throw new Error("Failed to get valid plan ID")}catch(t){console.error("[PlanExecutionManager] Failed to send user message:",t);const o=this.state.activePlanId??"error";this.setCachedUIState(o,{enabled:!0}),this.emitChatInputUpdateState(o),this.state.activePlanId=null}}handlePlanExecutionRequested(e,t){console.log("[PlanExecutionManager] Received plan execution request:",{planId:e,query:t}),e?(this.state.activePlanId=e,this.initiatePlanExecutionSequence(t??"Execute Plan",e)):console.error("[PlanExecutionManager] Invalid plan execution request: missing planId")}handleCachedPlanExecution(e,t){const o=this.getCachedPlanRecord(e);return o!=null&&o.currentPlanId?(console.log(`[PlanExecutionManager] Found cached plan execution record for rootPlanId: ${e}`),this.handlePlanExecutionRequested(o.currentPlanId,t),!0):(console.log(`[PlanExecutionManager] No cached plan execution record found for rootPlanId: ${e}`),!1)}validateAndPrepareUIForNewRequest(e){if(!e)return console.warn("[PlanExecutionManager] Query is empty"),!1;if(this.state.activePlanId)return!1;this.emitChatInputClear();const t=this.state.activePlanId??"ui-state";return this.setCachedUIState(t,{enabled:!1,placeholder:"Processing..."}),this.emitChatInputUpdateState(t),!0}async sendUserMessageAndSetPlanId(e){try{const t=await qs.sendMessage({input:e});if(t!=null&&t.planId)return this.state.activePlanId=t.planId,t;if(t!=null&&t.planTemplateId)return this.state.activePlanId=t.planTemplateId,{...t,planId:t.planTemplateId};throw console.error("[PlanExecutionManager] Failed to get planId from response:",t),new Error("Failed to get valid planId from API response")}catch(t){throw console.error("[PlanExecutionManager] API call failed:",t),t}}initiatePlanExecutionSequence(e,t){console.log(`[PlanExecutionManager] Starting plan execution sequence for query: "${e}", planId: ${t}`);const o=t;Ye(async()=>{const{useTaskStore:a}=await import("./sidebar-DD9JCzEa.js").then(l=>l.t);return{useTaskStore:a}},__vite__mapDeps([0,1,2,3])).then(({useTaskStore:a})=>{a().setTaskRunning(t),console.log("[PlanExecutionManager] Task marked as running with planId:",t)}),this.emitDialogRoundStart(o),this.startPolling()}handlePlanCompletion(e){this.emitPlanCompleted(e.rootPlanId??""),this.state.lastSequenceSize=0,this.stopPolling(),Ye(async()=>{const{useTaskStore:t}=await import("./sidebar-DD9JCzEa.js").then(o=>o.t);return{useTaskStore:t}},__vite__mapDeps([0,1,2,3])).then(({useTaskStore:t})=>{const o=t();o.currentTask&&o.currentTask.isRunning&&(o.currentTask.isRunning=!1,console.log("[PlanExecutionManager] Task marked as completed"))});try{setTimeout(async()=>{if(this.state.activePlanId)try{await tt.deletePlanTemplate(this.state.activePlanId),console.log(`[PlanExecutionManager] Plan template ${this.state.activePlanId} deleted successfully`)}catch(t){console.log(`Delete plan execution record failed: ${t.message}`)}},5e3)}catch(t){console.log(`Delete plan execution record failed: ${t.message}`)}e.completed&&(this.state.activePlanId=null,this.emitChatInputUpdateState(e.rootPlanId??""))}handlePlanError(e){this.emitPlanError(e.message??""),this.state.lastSequenceSize=0,this.stopPolling(),Ye(async()=>{const{useTaskStore:t}=await import("./sidebar-DD9JCzEa.js").then(o=>o.t);return{useTaskStore:t}},__vite__mapDeps([0,1,2,3])).then(({useTaskStore:t})=>{const o=t();o.currentTask&&o.currentTask.isRunning&&(o.currentTask.isRunning=!1,console.log("[PlanExecutionManager] Task marked as stopped due to error"))});try{setTimeout(async()=>{if(this.state.activePlanId)try{await tt.deletePlanTemplate(this.state.activePlanId),console.log(`[PlanExecutionManager] Plan template ${this.state.activePlanId} deleted successfully`)}catch(t){console.log(`Delete plan execution record failed: ${t.message}`)}},5e3)}catch(t){console.log(`Delete plan execution record failed: ${t.message}`)}}async pollPlanStatus(){if(this.state.activePlanId){if(this.state.isPolling){console.log("[PlanExecutionManager] Previous polling still in progress, skipping");return}try{this.state.isPolling=!0;const e=await this.getPlanDetails(this.state.activePlanId);if(!e){console.warn("[PlanExecutionManager] No details received from API - this might be a temporary network issue");return}if(e.status&&e.status==="failed"&&e.message&&!e.message.includes("Failed to get detailed information")){this.handlePlanError(e);return}e.rootPlanId&&this.setCachedPlanRecord(e.rootPlanId,e),this.emitPlanUpdate(e.rootPlanId??""),e.completed&&this.handlePlanCompletion(e)}catch(e){console.error("[PlanExecutionManager] Failed to poll plan status:",e)}finally{this.state.isPolling=!1}}}async getPlanDetails(e){try{const t=await _t.getDetails(e);return t!=null&&t.rootPlanId&&(this.planExecutionCache.set(t.rootPlanId,t),console.log(`[PlanExecutionManager] Cached plan execution record for rootPlanId: ${t.rootPlanId}`)),t}catch(t){return console.error("[PlanExecutionManager] Failed to get plan details:",t),{currentPlanId:e,status:"failed",message:t instanceof Error?t.message:"Failed to get plan"}}}startPolling(){this.state.pollTimer&&clearInterval(this.state.pollTimer),this.state.pollTimer=window.setInterval(()=>{this.pollPlanStatus()},this.POLL_INTERVAL),console.log("[PlanExecutionManager] Started polling")}async pollPlanStatusImmediately(){console.log("[PlanExecutionManager] Polling plan status immediately"),await this.pollPlanStatus()}stopPolling(){this.state.pollTimer&&(clearInterval(this.state.pollTimer),this.state.pollTimer=null),console.log("[PlanExecutionManager] Stopped polling")}cleanup(){this.stopPolling(),this.state.activePlanId=null,this.state.lastSequenceSize=0,this.state.isPolling=!1,this.clearAllCachedRecords()}emitChatInputClear(){this.callbacks.onChatInputClear&&this.callbacks.onChatInputClear()}emitChatInputUpdateState(e){this.callbacks.onChatInputUpdateState&&this.callbacks.onChatInputUpdateState(e)}emitDialogRoundStart(e){this.callbacks.onDialogRoundStart&&this.callbacks.onDialogRoundStart(e)}emitPlanUpdate(e){this.callbacks.onPlanUpdate&&this.callbacks.onPlanUpdate(e)}emitPlanCompleted(e){this.callbacks.onPlanCompleted&&this.callbacks.onPlanCompleted(e)}emitPlanError(e){this.callbacks.onPlanError&&this.callbacks.onPlanError(e)}};fe(Me,"instance",null);let xt=Me;const Ae=xt.getInstance(),$f={class:"chat-container"},Sf={key:0,class:"loading-message"},wf={class:"loading-content"},kf=["title"],Tf=de({__name:"ChatContainer",emits:["step-selected"],setup(n,{expose:e,emit:t}){const o=t,{t:a}=Te(),{messages:l,isLoading:i,streamingMessageId:u,addMessage:f,updateMessage:d,startStreaming:h,stopStreaming:$,findMessage:M}=yf(),L=N(null),{scrollToBottom:y,autoScrollToBottom:S,showScrollToBottom:_}=_f(L),m=N(),C=z=>u.value===z,w=re(()=>l.value.map(bf)),D=()=>{},v=z=>{const Y=z.target;if(Y.classList.contains("md-copy-btn")){const T=Y.getAttribute("data-raw");if(T){const j=decodeURIComponent(T);navigator.clipboard.writeText(j).then(()=>{Y.textContent=a("chat.copied"),setTimeout(()=>{Y.textContent=a("chat.copy")},1e3)})}}},E=async z=>{const Y=M(z);if(Y)try{const T=Y.content.replace(/<[^>]*>/g,"");await navigator.clipboard.writeText(T)}catch(T){console.error("Failed to copy message:",T)}},A=z=>{const Y=M(z);Y&&Y.type==="assistant"&&(d(z,{content:""}),h(z))},G=z=>{M(z)&&(d(z,{content:""}),h(z))},R=z=>{console.log("[ChatContainer] Step selected:",z),o("step-selected",z)},U=z=>{console.log("[ChatContainer] Plan update received:",z);const Y=Ae.getCachedPlanRecord(z);if(!Y){console.warn("[ChatContainer] No cached plan data found for rootPlanId:",z);return}console.log("[ChatContainer] Retrieved plan details from cache:",Y);const T=l.value.findIndex(j=>{var J;return((J=j.planExecution)==null?void 0:J.currentPlanId)===Y.currentPlanId&&j.type==="assistant"});if(T!==-1){const j=l.value[T],J={planExecution:JSON.parse(JSON.stringify(Y))};if(!Y.agentExecutionSequence||Y.agentExecutionSequence.length===0){if(console.log("[ChatContainer] Handling simple response without agent execution sequence"),Y.completed){J.thinking="";const X=Y.summary??Y.result??Y.message??"Execution completed";J.content=X,console.log("[ChatContainer] Set simple response content:",X)}}else console.log("[ChatContainer] Handling detailed plan with agent execution sequence");d(j.id,J)}},F=z=>{if(console.log("[ChatContainer] Plan completed:",z),z.rootPlanId){const Y=l.value.findIndex(T=>{var j;return((j=T.planExecution)==null?void 0:j.currentPlanId)===z.rootPlanId});if(Y!==-1){const T=l.value[Y],j=z.summary??z.result??"Execution completed";d(T.id,{thinking:"",content:j}),console.log("[ChatContainer] Updated completed message:",j)}}},B=z=>{console.log("[ChatContainer] Dialog round start:",z)},V=z=>{console.log("[ChatContainer] Plan error:",z),f("assistant",`Error: ${z}`),console.error("[ChatContainer] Plan execution error:",z)};return we(()=>{ie(l,()=>{ye(()=>{S()})},{deep:!0}),Ae.setEventCallbacks({onPlanUpdate:U,onPlanCompleted:F,onDialogRoundStart:B,onPlanError:V})}),Se(()=>{m.value&&clearInterval(m.value)}),e({scrollToBottom:y,handlePlanUpdate:U,handlePlanCompleted:F,handleDialogRoundStart:B,handlePlanError:V,addMessage:f,updateMessage:d,startStreaming:h,stopStreaming:$}),(z,Y)=>(p(),g("div",$f,[s("div",{class:"messages",ref_key:"messagesRef",ref:L,onScroll:D,onClick:v},[(p(!0),g(ne,null,le(w.value,T=>(p(),ae(vf,{key:T.id,message:T,"is-streaming":C(T.id),onCopy:E,onRegenerate:A,onRetry:G,onStepSelected:R},null,8,["message","is-streaming"]))),128)),r(i)?(p(),g("div",Sf,[s("div",wf,[k(r(P),{icon:"carbon:circle-dash",class:"loading-icon"}),s("span",null,c(z.$t("chat.processing")),1)])])):O("",!0)],544),k(Ne,{name:"scroll-button"},{default:Ie(()=>[r(_)?(p(),g("button",{key:0,class:"scroll-to-bottom",onClick:Y[0]||(Y[0]=()=>r(y)()),title:z.$t("chat.scrollToBottom")},[k(r(P),{icon:"carbon:chevron-down"})],8,kf)):O("",!0)]),_:1})]))}}),Pf=ue(Tf,[["__scopeId","data-v-3aa5b9a4"]]),Cf={class:"input-area"},Ef={class:"input-container"},Rf=["placeholder","disabled"],If=["title"],Af=["disabled","title"],xf=["title"],Df=de({__name:"InputArea",props:{placeholder:{default:""},disabled:{type:Boolean,default:!1},initialValue:{default:""}},emits:["send","clear","update-state","plan-mode-clicked"],setup(n,{expose:e,emit:t}){const{t:o}=Te(),a=Dt(),l=re(()=>a.hasRunningTask()),i=n,u=t,f=N(),d=N(),h=N(""),$=re(()=>i.placeholder||o("input.placeholder")),M=N($.value),L=N([]),y=N(null),S=()=>{var T;console.log("[FileUpload] Resetting session and clearing uploadKey"),(T=d.value)==null||T.resetSession()};Se(()=>{S()});const _=(T,j)=>{L.value=T.map(J=>J.originalName),y.value=j,console.log("[InputArea] Files uploaded:",T.length,"uploadKey:",j),L.value.length>0&&(M.value=o("input.filesAttached",{count:L.value.length}))},m=T=>{L.value=T.map(j=>j.originalName),console.log("[InputArea] Files removed, remaining:",T.length),L.value.length===0?M.value=$.value:M.value=o("input.filesAttached",{count:L.value.length})},C=T=>{y.value=T,console.log("[InputArea] Upload key changed:",T)},w=()=>{console.log("[InputArea] Upload started")},D=()=>{console.log("[InputArea] Upload completed")},v=T=>{console.error("[InputArea] Upload error:",T)},E=re(()=>!!i.disabled),A=()=>{ye(()=>{f.value&&(f.value.style.height="auto",f.value.style.height=Math.min(f.value.scrollHeight,120)+"px")})},G=T=>{T.key==="Enter"&&!T.shiftKey&&(T.preventDefault(),R())},R=()=>{if(!h.value.trim()||E.value)return;const j={input:h.value.trim(),memoryId:De.selectMemoryId,uploadedFiles:L.value};y.value?(j.uploadKey=y.value,console.log("[InputArea] Including uploadKey in message:",y.value)):console.log("[InputArea] No uploadKey available for message"),u("send",j),B()},U=()=>{u("plan-mode-clicked")},F=async()=>{console.log("[InputArea] Stop button clicked"),await a.stopCurrentTask()?console.log("[InputArea] Task stopped successfully"):console.error("[InputArea] Failed to stop task")},B=()=>{h.value="",A(),u("clear")},V=(T,j)=>{j&&(M.value=T?j:o("input.waiting")),u("update-state",T,j)},z=T=>{h.value=T,A()},Y=()=>h.value.trim();return ie(()=>i.initialValue,T=>{T.trim()&&(h.value=T,A())},{immediate:!0}),e({clearInput:B,updateState:V,setInputValue:z,getQuery:Y,resetSession:S,focus:()=>{var T;return(T=f.value)==null?void 0:T.focus()},get uploadedFiles(){var T,j;return((j=(T=d.value)==null?void 0:T.uploadedFiles)==null?void 0:j.map(J=>J.originalName))||[]},get uploadKey(){var T;return((T=d.value)==null?void 0:T.uploadKey)||null}}),we(()=>{}),Se(()=>{}),(T,j)=>(p(),g("div",Cf,[k(as,{ref_key:"fileUploadRef",ref:d,disabled:E.value,onFilesUploaded:_,onFilesRemoved:m,onUploadKeyChanged:C,onUploadStarted:w,onUploadCompleted:D,onUploadError:v},null,8,["disabled"]),s("div",Ef,[se(s("textarea",{"onUpdate:modelValue":j[0]||(j[0]=J=>h.value=J),ref_key:"inputRef",ref:f,class:"chat-input",placeholder:M.value,disabled:E.value,onKeydown:G,onInput:A},null,40,Rf),[[ce,h.value]]),s("button",{class:"plan-mode-btn",title:T.$t("input.planMode"),onClick:U},[k(r(P),{icon:"carbon:document"}),Z(" "+c(T.$t("input.planMode")),1)],8,If),l.value?(p(),g("button",{key:1,class:"send-button stop-button",onClick:F,title:T.$t("input.stop")},[k(r(P),{icon:"carbon:stop-filled"}),Z(" "+c(T.$t("input.stop")),1)],8,xf)):(p(),g("button",{key:0,class:"send-button",disabled:!h.value.trim()||E.value,onClick:R,title:T.$t("input.send")},[k(r(P),{icon:"carbon:send-alt"}),Z(" "+c(T.$t("input.send")),1)],8,Af))])]))}}),Ff=ue(Df,[["__scopeId","data-v-f3b9d060"]]);class Be{static async getAllCronTasks(){try{const e=await fetch(this.BASE_URL);return await(await this.handleResponse(e)).json()}catch(e){throw console.error("Failed to get cron tasks:",e),e}}static async getCronTaskById(e){try{const t=await fetch(`${this.BASE_URL}/${e}`);return await(await this.handleResponse(t)).json()}catch(t){throw console.error("Failed to get cron task by id:",t),t}}static async createCronTask(e){try{const t=await fetch(this.BASE_URL,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});return await(await this.handleResponse(t)).json()}catch(t){throw console.error("Failed to create cron task:",t),t}}static async updateCronTask(e,t){try{const o=await fetch(`${this.BASE_URL}/${e}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});return await(await this.handleResponse(o)).json()}catch(o){throw console.error("Failed to update cron task:",o),o}}static async updateTaskStatus(e,t){try{const o=await fetch(`${this.BASE_URL}/${e}/status?status=${t}`,{method:"PUT"});await this.handleResponse(o)}catch(o){throw console.error("Failed to update task status:",o),o}}static async deleteCronTask(e){try{const t=await fetch(`${this.BASE_URL}/${e}`,{method:"DELETE"});await this.handleResponse(t)}catch(t){throw console.error("Failed to delete cron task:",t),t}}static async handleResponse(e){if(!e.ok)try{const t=await e.json();throw new Error(t.message||`API request failed: ${e.status}`)}catch{throw new Error(`API request failed: ${e.status} ${e.statusText}`)}return e}}fe(Be,"BASE_URL","/api/cron-tasks");const qe={validateCronExpression(n){const e=n.trim().split(/\s+/);return e.length>=5&&e.length<=6},formatTime(n){return new Date(n).toLocaleString()},async saveTask(n){try{let e;return n.id?e=await Be.updateCronTask(Number(n.id),n):e=await Be.createCronTask(n),e}catch(e){throw console.error("Failed to save cron task:",e),e}},async deleteTask(n){try{await Be.deleteCronTask(String(n))}catch(e){throw console.error("Failed to delete cron task:",e),e}},async toggleTaskStatus(n){if(!n.id)throw new Error("Task ID is required");const e=n.status===0?1:0;return await Be.updateCronTask(Number(n.id),{...n,status:e})},prepareTaskExecution(n){return n.planTemplateId?{useTemplate:!0,planData:{title:n.cronName||"Scheduled Task Execution",planData:{id:n.planTemplateId,planTemplateId:n.planTemplateId,planId:n.planTemplateId},params:n.executionParams||void 0}}:{useTemplate:!1,taskContent:n.planDesc||n.cronName||""}}},Mf={class:"modal-header"},Uf={class:"header-actions"},Nf={class:"status-switch"},Lf={class:"status-label"},Of={class:"toggle-switch"},Bf=["checked"],qf={class:"modal-content"},Vf={class:"form-group"},jf={class:"form-label"},Jf=["placeholder"],Hf={class:"form-group"},Gf={class:"form-label"},Wf=["placeholder"],zf={class:"form-help"},Kf={class:"form-group"},Xf={class:"form-label"},Qf=["placeholder"],Yf={class:"form-group"},Zf={class:"form-label"},ev={class:"template-toggle"},tv={key:0,class:"template-selector"},sv={value:""},ov=["value"],nv={class:"form-help"},av={key:0,class:"form-group"},lv={class:"time-info"},rv={class:"time-label"},iv={class:"time-value"},cv={key:1,class:"form-group"},dv={class:"time-info"},uv={class:"time-label"},pv={class:"time-value"},mv={class:"modal-footer"},hv=["disabled"],fv=de({__name:"TaskDetailModal",props:{modelValue:{type:Boolean},task:{}},emits:["update:modelValue","save"],setup(n,{emit:e}){const t=n,o=e,a=N(!1),l=N([]),i=N({cronName:"",cronTime:"",planDesc:"",status:1,linkTemplate:!1,templateId:"",planTemplateId:""}),u=async()=>{try{const y=await tt.getAllPlanTemplates();y!=null&&y.templates&&(l.value=y.templates.map(S=>({id:S.id,name:S.title??"Unnamed Template"})))}catch(y){console.error("Failed to get template list:",y)}},f=y=>{y.key==="Escape"&&t.modelValue&&o("update:modelValue",!1)};we(()=>{u(),document.addEventListener("keydown",f)}),Se(()=>{document.removeEventListener("keydown",f)});const d=y=>{y.target===y.currentTarget&&o("update:modelValue",!1)},h=()=>{i.value.linkTemplate=!1,i.value.templateId="",i.value.planTemplateId=""},$=()=>i.value.cronName.trim()?i.value.cronTime.trim()?qe.validateCronExpression(i.value.cronTime)?i.value.planDesc.trim()?i.value.linkTemplate&&!i.value.templateId?(alert("Please select a plan template"),!1):!0:(alert("Task description cannot be empty"),!1):(alert("Invalid Cron expression format, should be 5-6 parts separated by spaces"),!1):(alert("Cron expression cannot be empty"),!1):(alert("Task name cannot be empty"),!1),M=y=>qe.formatTime(y),L=async()=>{var y;if($()){a.value=!0;try{const S={...i.value,...((y=t.task)==null?void 0:y.id)!==void 0&&{id:t.task.id},cronName:i.value.cronName.trim(),cronTime:i.value.cronTime.trim(),planDesc:i.value.planDesc.trim(),status:i.value.status,planTemplateId:i.value.linkTemplate?i.value.templateId??"":""};o("save",S)}finally{a.value=!1}}};return ie(()=>t.task,y=>{if(y){const S=y.templateId??y.planTemplateId??"";i.value={cronName:y.cronName||"",cronTime:y.cronTime||"",planDesc:y.planDesc||"",status:y.status,linkTemplate:!!S,templateId:S,planTemplateId:S}}else i.value={cronName:"",cronTime:"",planDesc:"",status:1,linkTemplate:!1,templateId:"",planTemplateId:""}},{immediate:!0}),ie(()=>t.modelValue,y=>{y||(i.value={cronName:"",cronTime:"",planDesc:"",status:1,linkTemplate:!1,templateId:"",planTemplateId:""})}),(y,S)=>(p(),ae(Ze,{to:"body"},[k(Ne,{name:"modal"},{default:Ie(()=>{var _,m,C;return[y.modelValue?(p(),g("div",{key:0,class:"modal-overlay",onClick:d},[s("div",{class:"modal-container",onClick:S[8]||(S[8]=pe(()=>{},["stop"]))},[s("div",Mf,[s("h3",null,c(y.$t("cronTask.taskDetail")),1),s("div",Uf,[s("div",Nf,[s("span",Lf,c(y.$t("cronTask.taskStatus")),1),s("label",Of,[s("input",{type:"checkbox",checked:i.value.status===0,onChange:S[0]||(S[0]=w=>i.value.status=i.value.status===0?1:0)},null,40,Bf),S[9]||(S[9]=s("span",{class:"toggle-slider"},null,-1))])]),s("button",{class:"close-btn",onClick:S[1]||(S[1]=w=>y.$emit("update:modelValue",!1))},[k(r(P),{icon:"carbon:close"})])])]),s("div",qf,[s("form",{onSubmit:pe(L,["prevent"]),class:"task-form"},[s("div",Vf,[s("label",jf,c(y.$t("cronTask.taskName")),1),se(s("input",{"onUpdate:modelValue":S[2]||(S[2]=w=>i.value.cronName=w),type:"text",class:"form-input",placeholder:y.$t("cronTask.taskNamePlaceholder"),required:""},null,8,Jf),[[ce,i.value.cronName]])]),s("div",Hf,[s("label",Gf,c(y.$t("cronTask.cronExpression")),1),se(s("input",{"onUpdate:modelValue":S[3]||(S[3]=w=>i.value.cronTime=w),type:"text",class:"form-input",placeholder:y.$t("cronTask.cronExpressionPlaceholder"),required:""},null,8,Wf),[[ce,i.value.cronTime]]),s("div",zf,c(y.$t("cronTask.cronExpressionHelp")),1)]),s("div",Kf,[s("label",Xf,c(y.$t("cronTask.taskDescription")),1),se(s("textarea",{"onUpdate:modelValue":S[4]||(S[4]=w=>i.value.planDesc=w),class:"form-textarea",placeholder:y.$t("cronTask.taskDescriptionPlaceholder"),rows:"4",required:""},null,8,Qf),[[ce,i.value.planDesc]])]),s("div",Yf,[s("label",Zf,c(y.$t("cronTask.planTemplate")),1),s("div",ev,[s("button",{type:"button",class:oe(["template-btn",i.value.linkTemplate?"active":""]),onClick:S[5]||(S[5]=w=>i.value.linkTemplate=!0)},[k(r(P),{icon:"carbon:checkmark"}),Z(" "+c(y.$t("cronTask.linkTemplate")),1)],2),s("button",{type:"button",class:oe(["template-btn",i.value.linkTemplate?"":"active"]),onClick:h},[k(r(P),{icon:"carbon:close"}),Z(" "+c(y.$t("cronTask.noTemplate")),1)],2)]),i.value.linkTemplate?(p(),g("div",tv,[se(s("select",{"onUpdate:modelValue":S[6]||(S[6]=w=>i.value.templateId=w),class:"form-select"},[s("option",sv,c(y.$t("cronTask.selectTemplate")),1),(p(!0),g(ne,null,le(l.value,w=>(p(),g("option",{key:w.id,value:w.id},c(w.name),9,ov))),128))],512),[[nt,i.value.templateId]]),s("div",nv,c(y.$t("cronTask.templateHelpText")),1)])):O("",!0)]),(_=y.task)!=null&&_.createTime?(p(),g("div",av,[s("div",lv,[s("span",rv,c(y.$t("cronTask.createTime"))+":",1),s("span",iv,c(M(y.task.createTime)),1)])])):O("",!0),(m=y.task)!=null&&m.updateTime?(p(),g("div",cv,[s("div",dv,[s("span",uv,c(y.$t("cronTask.updateTime"))+":",1),s("span",pv,c(M(y.task.updateTime)),1)])])):O("",!0)],32)]),s("div",mv,[s("button",{type:"button",class:"cancel-btn",onClick:S[7]||(S[7]=w=>y.$emit("update:modelValue",!1))},c(y.$t("common.cancel")),1),s("button",{type:"button",class:"save-btn",onClick:L,disabled:a.value},[a.value?(p(),ae(r(P),{key:0,icon:"carbon:loading",class:"loading-icon"})):O("",!0),Z(" "+c((C=t.task)!=null&&C.id?y.$t("common.save"):y.$t("common.create")),1)],8,hv)])])])):O("",!0)]}),_:1})]))}}),vv=ue(fv,[["__scopeId","data-v-7de1858d"]]),gv={class:"modal-header"},bv={class:"header-actions"},yv={class:"modal-content"},_v={key:0,class:"loading-container"},$v={key:1,class:"empty-container"},Sv={key:2,class:"task-list"},wv=["onClick"],kv={class:"task-main"},Tv={class:"task-info"},Pv={class:"task-header"},Cv={class:"task-name"},Ev={class:"task-description"},Rv={class:"task-time"},Iv=["onClick"],Av=["onClick","disabled","title"],xv=["onClick","title"],Dv={class:"dropdown-menu"},Fv=["onClick"],Mv=["onClick","disabled"],Uv=["onClick","disabled"],Nv={class:"confirm-header"},Lv={class:"confirm-content"},Ov={class:"confirm-actions"},Bv=["disabled"],qv={class:"confirm-header"},Vv={class:"confirm-content"},jv={class:"create-options"},Jv={class:"option-content"},Hv={class:"option-title"},Gv={class:"option-desc"},Wv={class:"option-content"},zv={class:"option-title"},Kv={class:"option-desc"},Xv={class:"confirm-actions"},Qv=de({__name:"CronTaskModal",props:{modelValue:{type:Boolean,required:!0}},emits:["update:modelValue"],setup(n,{emit:e}){const t=ss(),o=Dt(),a=ns(),{t:l}=Te(),i=n,u=e,f=N([]),d=N(!1),h=N(null),$=N(null),M=N(null),L=N(null),y=N(!1),S=N(null),_=N(!1),m=N(null),C=N(!1),w=q=>{q.target===q.currentTarget&&u("update:modelValue",!1)},D=async()=>{d.value=!0;try{f.value=await Be.getAllCronTasks()}catch(q){console.error("Failed to load cron tasks:",q),a.error(`Failed to load tasks: ${q instanceof Error?q.message:String(q)}`)}finally{d.value=!1}},v=async q=>{h.value=q;try{const K=f.value.find(I=>I.id===q);if(!K){console.error("Task not found:",q);return}u("update:modelValue",!1);const ee=Date.now().toString();await t.push({name:"direct",params:{id:ee}}),await new Promise(I=>setTimeout(I,100));const b=qe.prepareTaskExecution(K);b.useTemplate&&b.planData?o.emitPlanExecutionRequested(b.planData):b.taskContent&&o.setTask(b.taskContent)}catch(K){console.error("Failed to execute task:",K),a.error(`Execution failed: ${K instanceof Error?K.message:String(K)}`)}finally{h.value=null}},E=q=>{S.value={...q},y.value=!0,L.value=null},A=async q=>{try{await qe.saveTask(q),await D(),y.value=!1,a.success("Task saved successfully")}catch(K){console.error("Failed to save task:",K),a.error(`Save failed: ${K instanceof Error?K.message:String(K)}`)}},G=q=>{m.value=q,_.value=!0},R=async()=>{var q;if((q=m.value)!=null&&q.id){$.value=m.value.id;try{await qe.deleteTask(m.value.id),await D(),_.value=!1,m.value=null,a.success("Task deleted successfully")}catch(K){console.error("Failed to delete task:",K),a.error(`Delete failed: ${K instanceof Error?K.message:String(K)}`)}finally{$.value=null}}},U=()=>{_.value=!1,m.value=null},F=q=>{L.value=L.value===q?null:q},B=async q=>{if(q.id){M.value=q.id;try{await qe.toggleTaskStatus(q),await D(),L.value=null,a.success(`Task ${q.status===0?"disabled":"enabled"} successfully`)}catch(K){console.error("Failed to toggle task status:",K),a.error(`Status toggle failed: ${K instanceof Error?K.message:String(K)}`)}finally{M.value=null}}},V=async q=>{try{await navigator.clipboard.writeText(q),a.success("Cron expression copied successfully")}catch(K){a.error(`Copy failed: ${K instanceof Error?K.message:String(K)}`)}},z=()=>{C.value=!0},Y=()=>{C.value=!1;try{u("update:modelValue",!1);const q=l("cronTask.template");o.setTaskToInput(q);const K=Date.now().toString();t.push({name:"direct",params:{id:K}})}catch(q){console.error("Error in createWithJmanus:",q),a.error(`Creation failed: ${q instanceof Error?q.message:String(q)}`)}},T=()=>{C.value=!1,S.value={cronName:"",cronTime:"",planDesc:"",status:0,planTemplateId:""},y.value=!0},j=()=>{C.value=!1},J=q=>{const K=q.target;!K.closest(".action-dropdown")&&!K.closest(".dropdown-menu")&&(L.value=null)},X=q=>{q.key==="Escape"&&(_.value?U():C.value?j():i.modelValue&&u("update:modelValue",!1))};return we(()=>{document.addEventListener("click",J,!0),document.addEventListener("keydown",X)}),Se(()=>{document.removeEventListener("click",J,!0),document.removeEventListener("keydown",X)}),ie(()=>i.modelValue,q=>{q&&D()}),(q,K)=>(p(),g(ne,null,[(p(),ae(Ze,{to:"body"},[k(Ne,{name:"modal"},{default:Ie(()=>[n.modelValue?(p(),g("div",{key:0,class:"modal-overlay",onClick:w},[s("div",{class:"modal-container",onClick:K[3]||(K[3]=pe(()=>{},["stop"]))},[s("div",gv,[s("h3",null,c(q.$t("cronTask.title")),1),s("div",bv,[s("button",{class:"add-task-btn",onClick:[z,K[0]||(K[0]=pe(()=>{},["stop"]))]},[k(r(P),{icon:"carbon:add"}),Z(" "+c(q.$t("cronTask.addTask")),1)]),s("button",{class:"close-btn",onClick:K[1]||(K[1]=ee=>q.$emit("update:modelValue",!1))},[k(r(P),{icon:"carbon:close"})])])]),s("div",yv,[d.value?(p(),g("div",_v,[k(r(P),{icon:"carbon:loading",class:"loading-icon"}),s("span",null,c(q.$t("common.loading")),1)])):f.value.length===0?(p(),g("div",$v,[k(r(P),{icon:"carbon:time",class:"empty-icon"}),s("span",null,c(q.$t("cronTask.noTasks")),1)])):(p(),g("div",Sv,[(p(!0),g(ne,null,le(f.value,ee=>(p(),g("div",{key:ee.id||"",class:"task-item",onClick:b=>E(ee)},[s("div",kv,[s("div",Tv,[s("div",Pv,[s("div",Cv,c(ee.cronName),1),s("div",{class:oe(["task-status-badge",ee.status===0?"active":"inactive"])},[k(r(P),{icon:ee.status===0?"carbon:checkmark-filled":"carbon:pause-filled"},null,8,["icon"]),s("span",null,c(ee.status===0?q.$t("cronTask.active"):q.$t("cronTask.inactive")),1)],2)]),s("div",Ev,c(ee.planDesc),1),s("div",Rv,[k(r(P),{icon:"carbon:time"}),s("span",{class:"cron-readable",style:{cursor:"pointer"},onClick:pe(b=>V(ee.cronTime),["stop"])},c(ee.cronTime),9,Iv)])])]),s("div",{class:"task-actions",onClick:K[2]||(K[2]=pe(()=>{},["stop"]))},[s("button",{class:"action-btn execute-btn",onClick:b=>v(ee.id),disabled:h.value===ee.id,title:q.$t("cronTask.executeOnce")},[k(r(P),{icon:h.value===ee.id?"carbon:loading":"carbon:play-filled"},null,8,["icon"]),Z(" "+c(q.$t("cronTask.executeOnce")),1)],8,Av),s("div",{class:oe(["action-dropdown",{active:L.value===ee.id}])},[s("button",{class:"action-btn dropdown-btn",onClick:b=>F(ee.id),title:q.$t("cronTask.operations")},[k(r(P),{icon:"carbon:overflow-menu-horizontal"}),Z(" "+c(q.$t("cronTask.operations")),1)],8,xv),se(s("div",Dv,[s("button",{class:"dropdown-item edit-btn",onClick:b=>E(ee)},[k(r(P),{icon:"carbon:edit"}),Z(" "+c(q.$t("cronTask.edit")),1)],8,Fv),s("button",{class:"dropdown-item toggle-btn",onClick:b=>B(ee),disabled:M.value===ee.id},[k(r(P),{icon:M.value===ee.id?"carbon:loading":ee.status===0?"carbon:pause-filled":"carbon:play-filled"},null,8,["icon"]),Z(" "+c(ee.status===0?q.$t("cronTask.disable"):q.$t("cronTask.enable")),1)],8,Mv),s("button",{class:"dropdown-item delete-btn",onClick:b=>G(ee),disabled:$.value===ee.id},[k(r(P),{icon:$.value===ee.id?"carbon:loading":"carbon:trash-can"},null,8,["icon"]),Z(" "+c(q.$t("cronTask.delete")),1)],8,Uv)],512),[[Zt,L.value===ee.id]])],2)])],8,wv))),128))]))])])])):O("",!0)]),_:1})])),k(vv,{modelValue:y.value,"onUpdate:modelValue":K[4]||(K[4]=ee=>y.value=ee),task:S.value,onSave:A},null,8,["modelValue","task"]),(p(),ae(Ze,{to:"body"},[k(Ne,{name:"modal"},{default:Ie(()=>{var ee,b,I,W;return[_.value?(p(),g("div",{key:0,class:"modal-overlay",onClick:U},[s("div",{class:"confirm-modal",onClick:K[5]||(K[5]=pe(()=>{},["stop"]))},[s("div",Nv,[k(r(P),{icon:"carbon:warning",class:"warning-icon"}),s("h3",null,c(q.$t("cronTask.deleteConfirm")),1)]),s("div",Lv,[s("p",null,c(q.$t("cronTask.deleteConfirmMessage",{taskName:((ee=m.value)==null?void 0:ee.cronName)||((b=m.value)==null?void 0:b.planDesc)||""})),1)]),s("div",Ov,[s("button",{class:"confirm-btn cancel-btn",onClick:U},c(q.$t("common.cancel")),1),s("button",{class:"confirm-btn delete-btn",onClick:R,disabled:$.value===((I=m.value)==null?void 0:I.id)},[k(r(P),{icon:$.value===((W=m.value)==null?void 0:W.id)?"carbon:loading":"carbon:trash-can"},null,8,["icon"]),Z(" "+c(q.$t("cronTask.delete")),1)],8,Bv)])])])):O("",!0)]}),_:1})])),(p(),ae(Ze,{to:"body"},[k(Ne,{name:"modal"},{default:Ie(()=>[C.value?(p(),g("div",{key:0,class:"modal-overlay",onClick:j},[s("div",{class:"confirm-modal create-options-modal",onClick:K[6]||(K[6]=pe(()=>{},["stop"]))},[s("div",qv,[k(r(P),{icon:"carbon:time",class:"create-icon"}),s("h3",null,c(q.$t("cronTask.createTask")),1)]),s("div",Vv,[s("p",null,c(q.$t("cronTask.selectCreateMethod")),1),s("div",jv,[s("button",{class:"create-option-btn jmanus-btn",onClick:Y},[k(r(P),{icon:"carbon:ai-status"}),s("div",Jv,[s("span",Hv,c(q.$t("cronTask.createWithJmanus")),1),s("span",Gv,c(q.$t("cronTask.createWithJmanusDesc")),1)])]),s("button",{class:"create-option-btn manual-btn",onClick:T},[k(r(P),{icon:"carbon:edit"}),s("div",Wv,[s("span",zv,c(q.$t("cronTask.createManually")),1),s("span",Kv,c(q.$t("cronTask.createManuallyDesc")),1)])])])]),s("div",Xv,[s("button",{class:"confirm-btn cancel-btn",onClick:j},c(q.$t("common.cancel")),1)])])])):O("",!0)]),_:1})]))],64))}}),Yv=ue(Qv,[["__scopeId","data-v-a90a3961"]]),Zv={class:"direct-page"},eg={class:"direct-chat"},tg={class:"chat-header"},sg={class:"header-actions"},og=["title"],ng=["title"],ag=["title"],lg=["title"],rg={class:"chat-content"},ig=["title"],cg={class:"message-content"},dg=de({__name:"index",setup(n){const e=Os(),t=ss(),o=Dt(),{t:a}=Te(),{message:l}=Bs(),i=N(""),u=N(""),f=N(),d=N(),h=N(),$=N(),M=N(!1),L=N(!1),y=N(null),S=N(!1),_=N(50),m=N(!1),C=N(0),w=N(0),D=re(()=>{if(H.isCollapsed)return _.value;let b=26;$.value&&$.value.sidebarWidth!==void 0&&(b=$.value.sidebarWidth);const I=100-b;return Math.max(20,Math.min(I,_.value))});we(()=>{if(console.log("[Direct] onMounted called"),console.log("[Direct] taskStore.currentTask:",o.currentTask),console.log("[Direct] taskStore.hasUnprocessedTask():",o.hasUnprocessedTask()),Ae.setEventCallbacks({onPlanUpdate:I=>{console.log("[Direct] Plan update event received for rootPlanId:",I),R(I)&&(console.log("[Direct] Processing plan update for current rootPlanId:",I),d.value&&typeof d.value.handlePlanUpdate=="function"?(console.log("[Direct] Calling chatRef.handlePlanUpdate with rootPlanId:",I),d.value.handlePlanUpdate(I)):console.warn("[Direct] chatRef.handlePlanUpdate method not available"),f.value&&typeof f.value.updateDisplayedPlanProgress=="function"?(console.log("[Direct] Calling rightPanelRef.updateDisplayedPlanProgress with rootPlanId:",I),f.value.updateDisplayedPlanProgress(I)):console.warn("[Direct] rightPanelRef.updateDisplayedPlanProgress method not available"))},onPlanCompleted:I=>{if(console.log("[Direct] Plan completed event received for rootPlanId:",I),!!R(I)){if(console.log("[Direct] Processing plan completion for current rootPlanId:",I),d.value&&typeof d.value.handlePlanCompleted=="function"){const W=Ae.getCachedPlanRecord(I);W&&W.completed?W.summary&&W.summary.trim().length>0?(console.log("[Direct]  Plan details are valid and complete from polling cache, updating UI"),d.value.handlePlanCompleted(W)):(console.warn("[Direct]  Plan completed but summary is empty, still proceeding with available data"),d.value.handlePlanCompleted(W)):(console.warn("[Direct]  Plan details incomplete in cache, attempting API fallback"),_t.getDetails(I).then(Q=>{console.log("[Direct]  Got fresh details from API:",Q),Q&&Q.completed?(console.log("[Direct] Fresh details from API are valid, updating UI"),Ae.setCachedPlanRecord(I,Q),d.value.handlePlanCompleted(Q)):(console.warn("[Direct]  API details also incomplete, using best available data"),d.value.handlePlanCompleted(W??{planId:I}))}).catch(Q=>{console.error("[Direct] API call failed (likely record deleted), using cached data:",Q),d.value.handlePlanCompleted(W??{planId:I})}))}else console.warn("[Direct] chatRef.handlePlanCompleted method not available");y.value=null,console.log("[Direct] 🧹 Cleared currentRootPlanId after plan completion"),h.value&&typeof h.value.resetSession=="function"&&(console.log("[Direct] 🧹 Calling inputRef.resetSession to clear sessionPlanId"),h.value.resetSession())}},onDialogRoundStart:I=>{console.log("[Direct] Dialog round start event received for rootPlanId:",I),y.value=I,console.log("[Direct] Set currentRootPlanId to:",I),d.value&&typeof d.value.handleDialogRoundStart=="function"?(console.log("[Direct] Calling chatRef.handleDialogRoundStart with planId:",I),d.value.handleDialogRoundStart(I)):console.warn("[Direct] chatRef.handleDialogRoundStart method not available")},onChatInputClear:()=>{console.log("[Direct] Chat input clear event received"),B()},onChatInputUpdateState:I=>{if(console.log("[Direct] Chat input update state event received for rootPlanId:",I),!R(I,!0))return;const W=Ae.getCachedUIState(I);W&&z(W.enabled,W.placeholder)},onPlanError:I=>{d.value.handlePlanError(I)}}),console.log("[Direct] Event callbacks registered to planExecutionManager"),H.loadPlanTemplateList(),o.hasUnprocessedTask()&&o.currentTask){const I=o.currentTask.prompt;console.log("[Direct] Found unprocessed task from store:",I),o.markTaskAsProcessed(),ye(async()=>{try{console.log("[Direct] Calling handleChatSendMessage with taskContent:",I),await U({input:I})}catch(W){console.warn("[Direct] handleChatSendMessage failed, falling back to prompt:",W),i.value=I}})}else{const I=o.getAndClearTaskToInput();I?(u.value=I,console.log("[Direct] Setting inputOnlyContent for input only:",u.value)):(i.value=e.query.prompt||"",console.log("[Direct] Received task from URL:",i.value),console.log("[Direct] No unprocessed task in store"))}const b=localStorage.getItem("directPanelWidth");b&&(_.value=parseFloat(b)),console.log("[Direct] Final prompt value:",i.value),u.value&&ye(()=>{h.value&&typeof h.value.setInputValue=="function"&&(h.value.setInputValue(u.value),console.log("[Direct] Set input value:",u.value),u.value="")}),window.addEventListener("plan-execution-requested",I=>{console.log("[DirectView] Received plan-execution-requested event:",I.detail),q(I.detail)})}),ie(()=>o.currentTask,b=>{if(console.log("[Direct] Watch taskStore.currentTask triggered, newTask:",b),b&&!b.processed&&b.prompt.trim()){const I=b.prompt;o.markTaskAsProcessed(),console.log("[Direct] Received new task from store:",I),ye(async()=>{try{console.log("[Direct] Directly executing new task via handleChatSendMessage:",I),await U({input:I})}catch(W){console.warn("[Direct] handleChatSendMessage failed for new task:",W)}})}else console.log("[Direct] Task is null, already processed, or has empty prompt - ignoring")},{immediate:!1}),ie(()=>i.value,(b,I)=>{console.log("[Direct] prompt value changed from:",I,"to:",b)},{immediate:!1}),ie(()=>o.taskToInput,b=>{console.log("[Direct] Watch taskStore.taskToInput triggered, newTaskToInput:",b),b.trim()&&(console.log("[Direct] Setting input value from taskToInput:",b),ye(()=>{h.value&&typeof h.value.setInputValue=="function"&&(h.value.setInputValue(b.trim()),console.log("[Direct] Input value set from taskToInput watch:",b.trim()),o.getAndClearTaskToInput())}))},{immediate:!1}),Se(()=>{console.log("[Direct] onUnmounted called, cleaning up resources"),y.value=null,Ae.cleanup(),document.removeEventListener("mousemove",E),document.removeEventListener("mouseup",A),window.removeEventListener("plan-execution-requested",b=>{q(b.detail)})});const v=b=>{m.value=!0,C.value=b.clientX,w.value=_.value,document.addEventListener("mousemove",E),document.addEventListener("mouseup",A),document.body.style.cursor="col-resize",document.body.style.userSelect="none",b.preventDefault()},E=b=>{if(!m.value)return;const I=window.innerWidth,Q=(b.clientX-C.value)/I*100;let me=w.value+Q;me=Math.max(20,Math.min(80,me)),_.value=me},A=()=>{m.value=!1,document.removeEventListener("mousemove",E),document.removeEventListener("mouseup",A),document.body.style.cursor="",document.body.style.userSelect="",localStorage.setItem("directPanelWidth",_.value.toString())},G=()=>{_.value=50,localStorage.setItem("directPanelWidth","50")},R=(b,I=!1)=>!y.value||b===y.value||I&&(b==="ui-state"||b==="error")?!0:(console.log("[Direct] Ignoring event for non-current rootPlanId:",b,"current:",y.value),!1),U=async b=>{var W,Q,me,Ce,He,Ge,We,ze,Ke;let I=null;try{console.log("[DirectView] Processing send-message event:",b);const Ee=(W=d.value)==null?void 0:W.addMessage("user",b.input);b.attachments&&Ee&&((Q=d.value)==null||Q.updateMessage(Ee.id,{attachments:b.attachments})),I=(me=d.value)==null?void 0:me.addMessage("assistant","",{thinking:a("chat.thinkingProcessing")}),I&&((Ce=d.value)==null||Ce.startStreaming(I.id));const{DirectApiService:be}=await Ye(async()=>{const{DirectApiService:Xe}=await import("./sidebar-DD9JCzEa.js").then(ke=>ke.d);return{DirectApiService:Xe}},__vite__mapDeps([0,1,2,3]));console.log("[DirectView] Calling DirectApiService.sendMessageWithDefaultPlan");const ve=await be.sendMessageWithDefaultPlan(b);console.log("[DirectView] API response received:",ve),ve.planId&&I?((He=d.value)==null||He.updateMessage(I.id,{thinking:a("chat.planningExecution"),planExecution:{currentPlanId:ve.planId,rootPlanId:ve.planId,status:"running"}}),y.value=ve.planId,console.log("[DirectView] Set currentRootPlanId to:",ve.planId),Ae.handlePlanExecutionRequested(ve.planId,b.input),console.log("[DirectView] Started polling for plan execution updates")):I&&((Ge=d.value)==null||Ge.updateMessage(I.id,{content:ve.message||ve.result||"No response received from backend"}),(We=d.value)==null||We.stopStreaming(I.id))}catch(Ee){console.error("[DirectView] Send message failed:",Ee),(ze=d.value)==null||ze.addMessage("assistant",`Error: ${(Ee==null?void 0:Ee.message)||"Failed to send message"}`),I&&((Ke=d.value)==null||Ke.stopStreaming(I.id))}},F=async b=>{console.log("[DirectView] Send message from input:",JSON.stringify(b)),await U(b)},B=()=>{console.log("[DirectView] Input cleared"),h.value&&typeof h.value.clear=="function"&&h.value.clear()},V=()=>{console.log("[DirectView] Input focused")},z=(b,I)=>{console.log("[DirectView] Input state updated:",b,I),L.value=!b},Y=b=>{console.log("[DirectView] Step selected:",b),f.value&&typeof f.value.handleStepSelected=="function"?(console.log("[DirectView] Forwarding step selection to right panel:",b),f.value.handleStepSelected(b)):console.warn("[DirectView] rightPanelRef.handleStepSelected method not available")},T=(b,I,W,Q)=>{console.log("[DirectView] Sub plan step selected:",{parentPlanId:b,subPlanId:I,stepIndex:W,subStepIndex:Q}),f.value&&typeof f.value.handleSubPlanStepSelected=="function"?(console.log("[DirectView] Forwarding sub plan step selection to right panel:",{parentPlanId:b,subPlanId:I,stepIndex:W,subStepIndex:Q}),f.value.handleSubPlanStepSelected(b,I,W,Q)):console.warn("[DirectView] rightPanelRef.handleSubPlanStepSelected method not available")},j=()=>{console.log("[DirectView] Plan mode button clicked"),H.toggleSidebar(),console.log("[DirectView] Sidebar toggled, isCollapsed:",H.isCollapsed)},J=()=>{t.push("/home")},X=()=>{t.push("/configs")},q=async b=>{var Q,me,Ce,He,Ge,We,ze,Ke,Ee;if(console.log("[DirectView] Plan execution requested:",b),M.value){console.log("[DirectView] Plan execution already in progress, ignoring request");return}M.value=!0;let I=!1,W=null;try{console.log("[DirectView] Adding messages for plan execution:",b.title),(Q=d.value)==null||Q.addMessage("user",b.title),I=!0,W=(me=d.value)==null?void 0:me.addMessage("assistant","",{thinking:a("chat.planningExecution")}),W&&((Ce=d.value)==null||Ce.startStreaming(W.id),console.log("[DirectView] Added assistant message for plan execution:",W.id))}catch(be){console.warn("[DirectView] Failed to add messages:",be)}try{const be=b.planData.planTemplateId;if(!be)throw new Error(a("direct.planTemplateIdNotFound"));console.log("[Direct] Executing plan with templateId:",be,"params:",b.params),console.log("[Direct] About to call PlanActApiService.executePlan");const ve=b.uploadedFiles??[],Xe=b.uploadKey??void 0;console.log("[Direct] 🔍 DEBUG - InputArea uploadedFiles:",ve),console.log("[Direct] 🔍 DEBUG - InputArea uploadKey:",Xe),console.log("[Direct] Executing with uploaded files:",ve.length),console.log("[Direct] Executing with replacement params:",b.replacementParams);let ke;if((He=b.params)!=null&&He.trim()?(console.log("[Direct] Calling executePlan with rawParam:",b.params.trim()),ke=await tt.executePlan(be,b.params.trim(),ve,b.replacementParams,Xe)):(console.log("[Direct] Calling executePlan without rawParam"),ke=await tt.executePlan(be,void 0,ve,b.replacementParams,Xe)),console.log("[Direct] Plan execution API response:",ke),ke.planId&&W)console.log("[Direct] Got planId from response:",ke.planId,"starting plan execution"),(Ge=d.value)==null||Ge.updateMessage(W.id,{thinking:a("chat.planningExecution"),planExecution:{currentPlanId:ke.planId,rootPlanId:ke.planId,status:"running"}}),y.value=ke.planId,console.log("[Direct] Set currentRootPlanId to:",ke.planId),console.log("[Direct] Delegating plan execution to planExecutionManager"),Ae.handlePlanExecutionRequested(ke.planId,b.title);else throw console.error("[Direct] No planId in response:",ke),new Error(a("direct.executionFailedNoPlanId"))}catch(be){console.error("[Direct] Plan execution failed:",be),console.error("[Direct] Error details:",{message:be.message,stack:be.stack}),y.value=null;try{console.log("[Direct] Adding error messages to chat"),I||(We=d.value)==null||We.addMessage("user",b.title),W?((ze=d.value)==null||ze.updateMessage(W.id,{content:`${a("direct.executionFailed")}: ${be.message||a("common.unknownError")}`,thinking:void 0}),(Ke=d.value)==null||Ke.stopStreaming(W.id)):(Ee=d.value)==null||Ee.addMessage("assistant",`${a("direct.executionFailed")}: ${be.message||a("common.unknownError")}`)}catch(ve){console.error("[Direct] Failed to add error messages:",ve),alert(`${a("direct.executionFailed")}: ${be.message||a("common.unknownError")}`)}}finally{console.log("[Direct] Plan execution finished, resetting isExecutingPlan flag"),M.value=!1}},K=()=>{d.value.showMemory()},ee=()=>{De.clearMemoryId(),d.value.newChat()};return(b,I)=>(p(),g("div",Zv,[s("div",eg,[k(Tc,{ref_key:"sidebarRef",ref:$,onPlanExecutionRequested:q},null,512),s("div",{class:"left-panel",style:Ve({width:D.value+"%"})},[s("div",tg,[s("button",{class:"back-button",onClick:J},[k(r(P),{icon:"carbon:arrow-left"})]),s("h2",null,c(b.$t("conversation")),1),s("div",sg,[k(Vs),s("button",{class:"config-button",onClick:ee,title:b.$t("memory.newChat")},[k(r(P),{icon:"carbon:add",width:"20"})],8,og),s("button",{class:"config-button",onClick:X,title:b.$t("direct.configuration")},[k(r(P),{icon:"carbon:settings-adjust",width:"20"})],8,ng),s("button",{class:"cron-task-btn",onClick:I[0]||(I[0]=W=>S.value=!0),title:b.$t("cronTask.title")},[k(r(P),{icon:"carbon:alarm",width:"20"})],8,ag),s("button",{class:"cron-task-btn",onClick:I[1]||(I[1]=W=>r(De).toggleSidebar()),title:b.$t("memory.selectMemory")},[k(r(P),{icon:"carbon:calendar",width:"20"})],8,lg)])]),s("div",rg,[k(Pf,{ref_key:"chatRef",ref:d,mode:"direct","initial-prompt":i.value||"",onStepSelected:Y,onSubPlanStepSelected:T},null,8,["initial-prompt"])]),(p(),ae(Ff,{key:b.$i18n.locale,ref_key:"inputRef",ref:h,disabled:L.value,placeholder:L.value?r(a)("input.waiting"):r(a)("input.placeholder"),"initial-value":i.value,onSend:F,onClear:B,onFocus:V,onUpdateState:z,onPlanModeClicked:j},null,8,["disabled","placeholder","initial-value"]))],4),s("div",{class:"panel-resizer",onMousedown:v,onDblclick:G,title:b.$t("direct.panelResizeHint")},I[3]||(I[3]=[s("div",{class:"resizer-line"},null,-1)]),40,ig),k(kp,{ref_key:"rightPanelRef",ref:f,style:Ve({width:100-_.value+"%"}),"current-root-plan-id":y.value},null,8,["style","current-root-plan-id"])]),k(Yv,{modelValue:S.value,"onUpdate:modelValue":I[2]||(I[2]=W=>S.value=W)},null,8,["modelValue"]),k(_d,{onMemorySelected:K}),r(l).show?(p(),g("div",{key:0,class:oe(["message-toast",r(l).type])},[s("div",cg,[s("span",null,c(r(l).text),1)])],2)):O("",!0)]))}}),Ug=ue(dg,[["__scopeId","data-v-a073b453"]]);export{Ug as default};
//# sourceMappingURL=index-BeArTTM_.js.map
