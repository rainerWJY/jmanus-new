var Ms=Object.defineProperty;var Us=(n,e,t)=>e in n?Ms(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t;var fe=(n,e,t)=>Us(n,typeof e!="symbol"?e+"":e,t);import{d as de,u as $e,c as ce,r as M,B as tt,C as pe,o as Se,a as g,b as h,F as ne,g as k,f as B,p as Ie,h as ee,i as r,t as c,e as o,w as te,m as le,n as se,q as ae,D as kt,l as oe,E as ut,G as Ns,H as _e,I as es,z as qe,j as me,A as ge,T as Ue,J as Ye,K as ts,v as Os,M as ss,N as Qe,y as os,O as Ls,_ as Bs}from"./index--H9DNrYA.js";import{I as P,_ as ue}from"./_plugin-vue_export-helper-DyMWlxWP.js";import{s as W,P as Ze,u as ns}from"./sidebar-CZk496_N.js";import{M as qs,A as js,T as Vs,u as as,a as Hs}from"./useMessage-IWM1Cp2w.js";import{L as Lt}from"./llm-check-BVkAKrj3.js";import{L as Ws}from"./LanguageSwitcher-BSNKP5DC.js";class Ae{static async getCoordinatorToolConfig(){try{const e=await fetch(`${this.BASE_URL}/config`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!e.ok)throw new Error(`Failed to get coordinator tool config: ${e.status}`);return await e.json()}catch(e){return console.error("Failed to get CoordinatorTool configuration:",e),{enabled:!0,success:!1,message:e.message}}}static async getAllEndpoints(){try{const e=await fetch(`${this.BASE_URL}/endpoints`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!e.ok)throw new Error(`Failed to get endpoints: ${e.status}`);return await e.json()}catch(e){throw console.error("Failed to get endpoints:",e),new Error("Failed to get endpoints: "+e.message)}}static async getCoordinatorToolsByTemplate(e){console.log("[CoordinatorToolApiService] Starting to get coordinator tool, planTemplateId:",e),console.log("[CoordinatorToolApiService] Request URL:",`${this.BASE_URL}/get-get-or-new-by-template/${e}`);try{const t=await fetch(`${this.BASE_URL}/get-or-new-by-template/${e}`,{method:"GET",headers:{"Content-Type":"application/json"}});if(console.log("[CoordinatorToolApiService] Response status:",t.status),console.log("[CoordinatorToolApiService] Response status text:",t.statusText),t.status===404)return console.log("[CoordinatorToolApiService] 404"),null;if(!t.ok){const a=await t.text();throw console.error("[CoordinatorToolApiService] Response error content:",a),new Error(`Failed to get coordinator tools: ${t.status} - ${a}`)}const s=await t.json();return console.log("[CoordinatorToolApiService] Successfully got coordinator tool, result:",s),s}catch(t){throw console.error("[CoordinatorToolApiService] Failed to get coordinator tool:",t),new Error("Failed to get coordinator tool: "+t.message)}}static async getOrNewCoordinatorToolsByTemplate(e){console.log("[CoordinatorToolApiService] Starting to get or create coordinator tool, planTemplateId:",e),console.log("[CoordinatorToolApiService] Request URL:",`${this.BASE_URL}/get-or-new-by-template/${e}`);try{const t=await fetch(`${this.BASE_URL}/get-or-new-by-template/${e}`,{method:"GET",headers:{"Content-Type":"application/json"}});if(console.log("[CoordinatorToolApiService] Response status:",t.status),console.log("[CoordinatorToolApiService] Response status text:",t.statusText),!t.ok){const a=await t.text();throw console.error("[CoordinatorToolApiService] Response error content:",a),new Error(`Failed to get coordinator tools: ${t.status} - ${a}`)}const s=await t.json();return console.log("[CoordinatorToolApiService] Successfully got coordinator tool, result:",s),s}catch(t){throw console.error("[CoordinatorToolApiService] Failed to get coordinator tool:",t),new Error("Failed to get coordinator tool: "+t.message)}}static async createCoordinatorTool(e){console.log("[CoordinatorToolApiService] Starting to create coordinator tool"),console.log("[CoordinatorToolApiService] Original data:",JSON.stringify(e,null,2)),console.log("[CoordinatorToolApiService] Request URL:",`${this.BASE_URL}`);const t={id:e.id,toolName:e.toolName,toolDescription:e.toolDescription,inputSchema:e.inputSchema,planTemplateId:e.planTemplateId,httpEndpoint:e.httpEndpoint,mcpEndpoint:e.mcpEndpoint,serviceGroup:e.serviceGroup,enableInternalToolcall:e.enableInternalToolcall,enableHttpService:e.enableHttpService,enableMcpService:e.enableMcpService};console.log("[CoordinatorToolApiService] Cleaned sending data:",JSON.stringify(t,null,2));try{const s=await fetch(`${this.BASE_URL}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(console.log("[CoordinatorToolApiService] Response status:",s.status),console.log("[CoordinatorToolApiService] Response status text:",s.statusText),!s.ok){let l="Unknown error";try{const i=await s.json();l=i.message||i.error||l}catch{l=await s.text()||l}throw console.error("[CoordinatorToolApiService] Response error content:",l),new Error(`Failed to create coordinator tool: ${s.status} - ${l}`)}const a=await s.json();return console.log("[CoordinatorToolApiService] Created successfully, result:",a),a}catch(s){throw console.error("[CoordinatorToolApiService] Failed to create coordinator tool:",s),new Error("Failed to create coordinator tool: "+s.message)}}static async updateCoordinatorTool(e,t){console.log("[CoordinatorToolApiService] Starting to update coordinator tool, ID:",e),console.log("[CoordinatorToolApiService] Sending data:",t),console.log("[CoordinatorToolApiService] Request URL:",`${this.BASE_URL}/${e}`);const s={id:t.id,toolName:t.toolName,toolDescription:t.toolDescription,inputSchema:t.inputSchema,planTemplateId:t.planTemplateId,httpEndpoint:t.httpEndpoint,mcpEndpoint:t.mcpEndpoint,serviceGroup:t.serviceGroup,enableInternalToolcall:t.enableInternalToolcall,enableHttpService:t.enableHttpService,enableMcpService:t.enableMcpService};console.log("[CoordinatorToolApiService] Cleaned sending data:",s);try{const a=await fetch(`${this.BASE_URL}/${e}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(console.log("[CoordinatorToolApiService] Response status:",a.status),console.log("[CoordinatorToolApiService] Response status text:",a.statusText),!a.ok){let i="Unknown error";try{const p=await a.json();i=p.message||p.error||i}catch{i=await a.text()||i}throw console.error("[CoordinatorToolApiService] Response error content:",i),new Error(`Failed to update coordinator tool: ${a.status} - ${i}`)}const l=await a.json();return console.log("[CoordinatorToolApiService] Updated successfully, result:",l),l}catch(a){throw console.error("[CoordinatorToolApiService] Failed to update coordinator tool:",a),new Error("Failed to update coordinator tool: "+a.message)}}static async deleteCoordinatorTool(e){console.log("[CoordinatorToolApiService] Starting to delete coordinator tool, ID:",e),console.log("[CoordinatorToolApiService] Request URL:",`${this.BASE_URL}/${e}`);try{const t=await fetch(`${this.BASE_URL}/${e}`,{method:"DELETE",headers:{"Content-Type":"application/json"}});if(console.log("[CoordinatorToolApiService] Response status:",t.status),console.log("[CoordinatorToolApiService] Response status text:",t.statusText),!t.ok){const a=await t.text();throw console.error("[CoordinatorToolApiService] Response error content:",a),new Error(`Failed to delete coordinator tool: ${t.status} - ${a}`)}const s=await t.json();return console.log("[CoordinatorToolApiService] Deleted successfully, result:",s),s}catch(t){throw console.error("[CoordinatorToolApiService] Failed to delete coordinator tool:",t),new Error("Failed to delete coordinator tool: "+t.message)}}}fe(Ae,"BASE_URL","/api/coordinator-tools");class Dt{static async getParameterRequirements(e){try{const t=await fetch(`${this.BASE_URL}/${e}/parameters`,{method:"GET",headers:{"Content-Type":"application/json"}});if(!t.ok)throw new Error(`Failed to get parameter requirements: ${t.statusText}`);return await t.json()}catch(t){throw console.error("Error getting parameter requirements:",t),t}}}fe(Dt,"BASE_URL","/api/plan-template");const zs={class:"modal-form wide-modal"},Js={class:"form-section"},Gs={class:"form-item"},Ks=["placeholder"],Xs={class:"field-description"},Ys={class:"form-section"},Qs={class:"form-item"},Zs=["placeholder"],eo={class:"field-description"},to={class:"form-section"},so={class:"form-item"},oo=["placeholder"],no={class:"field-description"},ao={class:"form-section"},lo={class:"section-title"},ro={key:0,class:"params-help-text"},io={class:"parameter-table"},co=["onUpdate:modelValue","placeholder","readonly"],uo=["onUpdate:modelValue","placeholder"],po={class:"form-section"},mo={class:"service-publish-options"},ho={class:"internal-toolcall-publish-option"},fo={class:"checkbox-label"},vo={class:"checkbox-text"},go={class:"checkbox-description"},bo={class:"http-publish-option"},yo={class:"checkbox-label"},_o={class:"checkbox-text"},So={class:"checkbox-description"},$o={class:"button-container"},wo=["disabled"],ko=["disabled"],To=de({__name:"PublishServiceModal",props:{modelValue:{type:Boolean,default:!1},planTemplateId:{default:""},planTitle:{default:""},planDescription:{default:""}},emits:["update:modelValue","published"],setup(n,{expose:e,emit:t}){const{t:s}=$e(),a=n,l=t,i=ce({get:()=>a.modelValue,set:x=>l("update:modelValue",x)}),p=M(""),v=M(""),d=M(!1),m=M(!1),_=M(null),I=M(!1),U=M(!1),S=M(!0),$=M({parameters:[],hasParameters:!1,requirements:""}),y=M(!1),u=tt({serviceName:"",userRequest:"",endpoint:"",serviceGroup:"",parameters:[]}),T=ce(()=>{const x=_.value&&_.value.id;return s(x?"mcpService.updateService":"mcpService.createService")}),w=()=>{u.serviceName="",u.userRequest=a.planDescription||"",u.endpoint="",u.serviceGroup="",$.value.hasParameters||(u.parameters=[]),_.value=null,I.value=!1},E=async()=>{if(!a.planTemplateId){$.value={parameters:[],hasParameters:!1,requirements:""};return}y.value=!0;try{const x=await Dt.getParameterRequirements(a.planTemplateId);$.value=x,x.hasParameters&&(u.parameters=x.parameters.map(H=>({name:H,description:""})))}catch(x){console.error("[PublishModal] Failed to load parameter requirements:",x),x instanceof Error&&!x.message.includes("404")&&console.warn("[PublishModal] Parameter requirements not available yet, will retry later"),$.value={parameters:[],hasParameters:!1,requirements:""}}finally{y.value=!1}},f=(x,H)=>{H==="success"?(v.value=x,setTimeout(()=>{v.value=""},3e3)):H==="error"&&(p.value=x,setTimeout(()=>{p.value=""},5e3))},q=()=>{if(!u.serviceName||!u.serviceName.trim())return f(s("mcpService.toolNameRequiredError"),"error"),!1;if(!u.userRequest||!u.userRequest.trim())return f(s("mcpService.toolDescriptionRequiredError"),"error"),!1;if(!u.serviceGroup||!u.serviceGroup.trim())return f(s("mcpService.serviceGroupRequiredError"),"error"),!1;if(!S.value&&!U.value)return f("Please select at least one service type","error"),!1;for(let x=0;x<u.parameters.length;x++){const H=u.parameters[x];if(H.name&&!H.description.trim())return f(`Parameter "${H.name}" description cannot be empty`,"error"),!1;if(H.description&&!H.name.trim())return f(`Parameter description "${H.description}" corresponding name cannot be empty`,"error"),!1}return!0},z=async()=>{if(console.log("[PublishModal] Starting to handle publish request"),console.log("[PublishModal] Form data:",u),console.log("[PublishModal] Current tool:",_.value),console.log("[PublishModal] Publish as HTTP service:",U.value),!q()){console.log("[PublishModal] Form validation failed");return}d.value=!0;try{_.value||(console.log("[PublishModal] No current tool data, getting or creating first"),_.value=await Ae.getOrNewCoordinatorToolsByTemplate(a.planTemplateId)),console.log("[PublishModal] Updating tool information"),_.value.toolName=u.serviceName.trim(),_.value.toolDescription=u.userRequest.trim(),_.value.serviceGroup=u.serviceGroup.trim(),_.value.planTemplateId=a.planTemplateId,_.value.enableInternalToolcall=S.value,_.value.enableHttpService=U.value,_.value.enableMcpService=!1,_.value.mcpEndpoint=void 0;const x=u.parameters.filter(b=>b.name.trim()&&b.description.trim()).map(b=>({name:b.name.trim(),description:b.description.trim(),type:"string"}));if(_.value.inputSchema=JSON.stringify(x),console.log("[PublishModal] Updated tool information:",_.value),_.value.id)console.log("[PublishModal] Updating existing tool, ID:",_.value.id),await Ae.updateCoordinatorTool(_.value.id,_.value);else{console.log("[PublishModal] Creating new tool");const b=await Ae.createCoordinatorTool(_.value);_.value=b}const H=[];if(S.value&&H.push("Internal Method Call"),U.value&&H.push("HTTP Service"),H.length>0){console.log("[PublishModal] Step 5: Publishing service, ID:",_.value.id,"Enabled services:",H.join(", "));const b=[];S.value&&b.push(`Internal Call: ${u.serviceName}`),console.log("[PublishModal] Service published successfully"),f(s("mcpService.publishSuccess"),"success"),l("published",_.value)}else console.log("[PublishModal] Only saving tool, not publishing as any service"),f(s("mcpService.saveSuccess"),"success"),l("published",_.value)}catch(x){console.error("[PublishModal] Failed to publish service:",x),f(s("mcpService.publishFailed")+": "+x.message,"error")}finally{d.value=!1}},Z=async()=>{if(!m.value&&confirm(s("mcpService.deleteConfirmMessage"))){if(!_.value||!_.value.id){f(s("mcpService.deleteFailed")+": "+s("mcpService.selectPlanTemplateFirst"),"error");return}m.value=!0;try{console.log("[PublishModal] Starting to delete MCP service, ID:",_.value.id);const x=await Ae.deleteCoordinatorTool(_.value.id);if(x.success)console.log("[PublishModal] Deleted successfully"),f(s("mcpService.deleteSuccess"),"success"),i.value=!1,l("published",null);else throw new Error(x.message)}catch(x){console.error("[PublishModal] Failed to delete MCP service:",x),f(s("mcpService.deleteFailed")+": "+x.message,"error")}finally{m.value=!1}}},A=async()=>{i.value&&(console.log("[PublishModal] Modal opened, starting to initialize data"),w(),await N())},N=async()=>{if(!a.planTemplateId){console.log("[PublishModal] "+s("mcpService.noPlanTemplateId"));return}try{console.log("[PublishModal] Starting to load coordinator tool data, planTemplateId:",a.planTemplateId);const x=await Ae.getOrNewCoordinatorToolsByTemplate(a.planTemplateId);console.log("[PublishModal] Get coordinator tool data result:",x),_.value=x,I.value=!!x.id;const H=[];if(x.enableMcpService&&x.mcpEndpoint){const b=window.location.origin;H.push(`MCP: ${b}/mcp${x.mcpEndpoint}`)}x.enableInternalToolcall&&H.push(`Internal Call: ${x.toolName}`),console.log("[PublishModal] Load tool data completed"),u.serviceName=x.toolName||"",u.userRequest=x.toolDescription||a.planDescription||"",u.serviceGroup=x.serviceGroup||"",U.value=x.enableHttpService||!1,S.value=x.enableInternalToolcall||!1;try{if(x.inputSchema){const b=JSON.parse(x.inputSchema);Array.isArray(b)&&b.length>0?(u.parameters=b.map(R=>({name:R.name||"",description:R.description||""})),console.log("[PublishModal] Load parameters from inputSchema:",u.parameters)):console.log("[PublishModal] inputSchema is empty, keeping existing parameters:",u.parameters)}}catch(b){console.warn("[PublishModal] "+s("mcpService.parseInputSchemaFailed")+":",b),console.log("[PublishModal] Parsing failed, keeping existing parameters:",u.parameters)}console.log("[PublishModal] Form data filled:",u)}catch(x){console.error("[PublishModal] "+s("mcpService.loadToolDataFailed")+":",x),f(s("mcpService.loadToolDataFailed")+": "+x.message,"error")}};return pe(()=>a.modelValue,A),pe(()=>a.planTemplateId,(x,H)=>{x&&x!==H&&(H&&x.startsWith("planTemplate-")?setTimeout(()=>{E()},1e3):E())}),Se(async()=>{i.value&&(console.log("[PublishModal] Initialize when component mounted"),w(),await N(),await E())}),e({loadParameterRequirements:E}),(x,H)=>(h(),g(ne,null,[k(qs,{modelValue:i.value,"onUpdate:modelValue":H[5]||(H[5]=b=>i.value=b),title:T.value,onConfirm:z},{footer:Ie(()=>{var b;return[o("div",$o,[I.value&&((b=_.value)!=null&&b.id)?(h(),g("button",{key:0,class:"action-btn danger",onClick:Z,disabled:m.value},[m.value?(h(),oe(r(P),{key:0,icon:"carbon:loading",class:"loading-icon"})):(h(),oe(r(P),{key:1,icon:"carbon:trash-can"})),ee(" "+c(m.value?r(s)("mcpService.deleting"):r(s)("mcpService.delete")),1)],8,wo)):B("",!0),o("button",{class:"action-btn primary",onClick:z,disabled:d.value},[d.value?(h(),oe(r(P),{key:0,icon:"carbon:loading",class:"loading-icon"})):(h(),oe(r(P),{key:1,icon:"carbon:cloud-upload"})),ee(" "+c(d.value?r(s)("mcpService.publishing"):r(s)("mcpService.publishAsService")),1)],8,ko)])]}),default:Ie(()=>[o("div",zs,[o("div",Js,[o("div",Gs,[o("label",null,c(r(s)("mcpService.toolNameRequired")),1),te(o("input",{type:"text","onUpdate:modelValue":H[0]||(H[0]=b=>u.serviceName=b),placeholder:r(s)("mcpService.toolNamePlaceholder"),class:se({error:!u.serviceName||!u.serviceName.trim()}),required:""},null,10,Ks),[[le,u.serviceName]]),o("div",Xs,c(r(s)("mcpService.toolNameDescription")),1)])]),o("div",Ys,[o("div",Qs,[o("label",null,c(r(s)("mcpService.toolDescriptionRequired")),1),te(o("textarea",{"onUpdate:modelValue":H[1]||(H[1]=b=>u.userRequest=b),placeholder:r(s)("mcpService.toolDescriptionPlaceholder"),class:se([{error:!u.userRequest||!u.userRequest.trim()},"description-field"]),rows:"4",required:""},null,10,Zs),[[le,u.userRequest]]),o("div",eo,c(r(s)("mcpService.toolDescriptionDescription")),1)])]),o("div",to,[o("div",so,[o("label",null,c(r(s)("mcpService.serviceGroup")),1),te(o("input",{type:"text","onUpdate:modelValue":H[2]||(H[2]=b=>u.serviceGroup=b),placeholder:r(s)("mcpService.serviceGroupPlaceholder"),class:se({error:!u.serviceGroup||!u.serviceGroup.trim()}),required:""},null,10,oo),[[le,u.serviceGroup]]),o("div",no,c(r(s)("mcpService.serviceGroupDescription")),1)])]),o("div",ao,[o("div",lo,c(r(s)("mcpService.parameterConfig")),1),$.value.hasParameters?(h(),g("div",ro,c(r(s)("sidebar.parameterRequirementsHelp")),1)):B("",!0),o("div",io,[o("table",null,[o("thead",null,[o("tr",null,[o("th",null,c(r(s)("mcpService.parameterName")),1),o("th",null,c(r(s)("mcpService.parameterDescription")),1)])]),o("tbody",null,[(h(!0),g(ne,null,ae(u.parameters,(b,R)=>(h(),g("tr",{key:R},[o("td",null,[te(o("input",{type:"text","onUpdate:modelValue":J=>b.name=J,placeholder:r(s)("mcpService.parameterName"),class:se(["parameter-input",{"readonly-input":$.value.hasParameters}]),readonly:$.value.hasParameters,required:""},null,10,co),[[le,b.name]])]),o("td",null,[te(o("input",{type:"text","onUpdate:modelValue":J=>b.description=J,placeholder:r(s)("mcpService.parameterDescription"),class:"parameter-input",required:""},null,8,uo),[[le,b.description]])])]))),128))])])])]),o("div",po,[o("div",mo,[o("div",ho,[o("label",fo,[te(o("input",{type:"checkbox","onUpdate:modelValue":H[3]||(H[3]=b=>S.value=b),class:"checkbox-input"},null,512),[[kt,S.value]]),o("span",vo,c(r(s)("mcpService.publishAsInternalToolcall")),1)]),o("div",go,c(r(s)("mcpService.publishAsInternalToolcallDescription")),1)]),o("div",bo,[o("label",yo,[te(o("input",{type:"checkbox","onUpdate:modelValue":H[4]||(H[4]=b=>U.value=b),class:"checkbox-input"},null,512),[[kt,U.value]]),o("span",_o,c(r(s)("mcpService.publishAsHttpService")),1)]),o("div",So,c(r(s)("mcpService.publishAsHttpServiceDescription")),1)])])])])]),_:1},8,["modelValue","title"]),p.value?(h(),g("div",{key:0,class:"error-toast",onClick:H[6]||(H[6]=b=>p.value="")},[k(r(P),{icon:"carbon:error"}),ee(" "+c(p.value),1)])):B("",!0),v.value?(h(),g("div",{key:1,class:"success-toast",onClick:H[7]||(H[7]=b=>v.value="")},[k(r(P),{icon:"carbon:checkmark"}),ee(" "+c(v.value),1)])):B("",!0)],64))}}),Po=ue(To,[["__scopeId","data-v-98b92f03"]]);function ls(n,e){const t=M(!1),s=tt({title:"",steps:[],directResponse:!1,planTemplateId:n.currentPlanTemplateId||"",planType:"dynamic_agent"}),a=y=>{try{if(!y){Object.assign(s,{title:"",steps:[],directResponse:!1,planTemplateId:n.currentPlanTemplateId||"",planType:"dynamic_agent"});return}const u=JSON.parse(y);s.title=u.title||"",s.directResponse=!1,s.planTemplateId=u.planTemplateId||n.currentPlanTemplateId||"",s.planType=u.planType||"dynamic_agent",s.steps=(u.steps||[]).map(T=>({stepRequirement:T.stepRequirement||"",agentName:T.agentName||"",modelName:T.modelName||null,selectedToolKeys:T.selectedToolKeys||[],terminateColumns:T.terminateColumns||""}))}catch(u){console.warn("Failed to parse JSON content:",u)}},l=()=>{try{const y={title:s.title,steps:s.steps.map(u=>({stepRequirement:u.stepRequirement,agentName:u.agentName,modelName:u.modelName||"",selectedToolKeys:u.selectedToolKeys,terminateColumns:u.terminateColumns})),directResponse:s.directResponse,planTemplateId:s.planTemplateId,planType:s.planType};return JSON.stringify(y,null,2)}catch(y){return console.error("Failed to convert visual data to JSON:",y),"{}"}},i=ce(()=>l());return pe(()=>n.jsonContent,y=>{a(y)},{immediate:!0}),pe(s,()=>{const y=l();e("update:jsonContent",y)},{deep:!0}),pe(()=>n.currentPlanTemplateId,y=>{y&&(s.planTemplateId=y)}),{showJsonPreview:t,displayData:s,formattedJsonOutput:i,addStep:()=>{const y={stepRequirement:"",agentName:"ConfigurableDynaAgent",modelName:null,selectedToolKeys:[],terminateColumns:"",agentType:"",stepContent:""};s.steps.push(y)},removeStep:y=>{y>=0&&y<s.steps.length&&s.steps.splice(y,1)},moveStepUp:y=>{if(y>0){const u=s.steps.splice(y,1)[0];s.steps.splice(y-1,0,u)}},moveStepDown:y=>{if(y<s.steps.length-1){const u=s.steps.splice(y,1)[0];s.steps.splice(y+1,0,u)}},toggleJsonPreview:()=>{t.value=!t.value},closeJsonPreview:()=>{t.value=!1},handleRollback:()=>{e("rollback")},handleRestore:()=>{e("restore")},handleSave:()=>{e("save")}}}const Eo={class:"config-section"},Co={class:"section-header"},Ro={class:"visual-editor"},Io={class:"plan-basic-info"},Ao={class:"form-row"},xo={class:"form-label"},Do=["placeholder"],Fo={class:"steps-section"},Mo={class:"steps-header"},Uo={class:"form-label"},No={class:"steps-container"},Oo={class:"step-header"},Lo={class:"step-number"},Bo={class:"step-actions"},qo=["onClick","disabled","title"],jo=["onClick","disabled","title"],Vo=["onClick","title"],Ho={class:"step-content"},Wo={class:"form-row"},zo={class:"form-label"},Jo={class:"agent-selector"},Go=["onUpdate:modelValue"],Ko={value:""},Xo=["title"],Yo={class:"form-row"},Qo={class:"form-label"},Zo=["onUpdate:modelValue","placeholder"],en={class:"form-row"},tn={class:"form-label"},sn=["onUpdate:modelValue","placeholder"],on={key:0,class:"empty-steps"},nn={class:"plan-id-section"},an={class:"form-row"},ln={class:"form-label"},rn={key:0,class:"json-preview"},cn={class:"preview-header"},dn={class:"form-label"},un={class:"json-code"},pn={class:"editor-footer"},mn={class:"section-actions"},hn=["disabled","title"],fn=["disabled","title"],vn=["disabled"],gn=de({__name:"JsonEditor",props:{jsonContent:{},canRollback:{type:Boolean},canRestore:{type:Boolean},isGenerating:{type:Boolean},isExecuting:{type:Boolean},hiddenFields:{default:()=>["currentPlanId","userRequest","rootPlanId"]},currentPlanTemplateId:{}},emits:["rollback","restore","save","update:jsonContent"],setup(n,{emit:e}){const t=n,s=e,{showJsonPreview:a,displayData:l,formattedJsonOutput:i,addStep:p,removeStep:v,moveStepUp:d,moveStepDown:m,handleRollback:_,handleRestore:I,handleSave:U,toggleJsonPreview:S,closeJsonPreview:$}=ls(t,s),y=u=>{const T=u.target;if(!T)return;T.style.height="auto";const w=20,E=Math.ceil(T.scrollHeight/w),f=4,q=12,z=Math.max(f,Math.min(q,E)),Z=z*w;T.style.height=`${Z}px`,T.rows=z,E>q?T.style.overflowY="auto":T.style.overflowY="hidden"};return(u,T)=>(h(),g("div",Eo,[o("div",Co,[k(r(P),{icon:"carbon:code",width:"16"}),o("span",null,c(u.$t("sidebar.jsonTemplate")),1)]),o("div",Ro,[o("div",Io,[o("div",Ao,[o("label",xo,c(u.$t("sidebar.title")),1),te(o("input",{"onUpdate:modelValue":T[0]||(T[0]=w=>r(l).title=w),type:"text",class:"form-input",placeholder:u.$t("sidebar.titlePlaceholder")},null,8,Do),[[le,r(l).title]])])]),o("div",Fo,[o("div",Mo,[o("label",Uo,c(u.$t("sidebar.tasks")),1)]),o("div",No,[(h(!0),g(ne,null,ae(r(l).steps,(w,E)=>(h(),g("div",{key:E,class:"step-item"},[o("div",Oo,[o("span",Lo,c(u.$t("sidebar.subtask"))+" "+c(E+1),1),o("div",Bo,[o("button",{onClick:f=>r(d)(E),disabled:E===0,class:"btn btn-xs",title:u.$t("sidebar.moveUp")},[k(r(P),{icon:"carbon:chevron-up",width:"12"})],8,qo),o("button",{onClick:f=>r(m)(E),disabled:E===r(l).steps.length-1,class:"btn btn-xs",title:u.$t("sidebar.moveDown")},[k(r(P),{icon:"carbon:chevron-down",width:"12"})],8,jo),o("button",{onClick:f=>r(v)(E),class:"btn btn-xs btn-danger",title:u.$t("sidebar.removeStep")},[k(r(P),{icon:"carbon:trash-can",width:"12"})],8,Vo)])]),o("div",Ho,[o("div",Wo,[o("label",zo,c(u.$t("sidebar.agent")),1),o("div",Jo,[te(o("select",{"onUpdate:modelValue":f=>w.agentName=f,class:"form-select agent-select"},[o("option",Ko,c(u.$t("sidebar.selectAgent")),1),T[10]||(T[10]=Ns('<option value="DEFAULT_AGENT" data-v-228d1ada>DEFAULT_AGENT</option><option value="BROWSER_AGENT" data-v-228d1ada>BROWSER_AGENT</option><option value="TEXT_FILE_AGENT" data-v-228d1ada>TEXT_FILE_AGENT</option><option value="JSX_GENERATOR_AGENT" data-v-228d1ada>JSX_GENERATOR_AGENT</option><option value="FILE_MANAGER_AGENT" data-v-228d1ada>FILE_MANAGER_AGENT</option>',5))],8,Go),[[ut,w.agentName]]),o("button",{onClick:T[1]||(T[1]=(...f)=>r(p)&&r(p)(...f)),class:"btn btn-sm btn-add-step",title:u.$t("sidebar.addStep")},[k(r(P),{icon:"carbon:add",width:"14"})],8,Xo)])]),o("div",Yo,[o("label",Qo,c(u.$t("sidebar.stepRequirement")),1),te(o("textarea",{"onUpdate:modelValue":f=>w.stepContent=f,class:"form-textarea auto-resize",placeholder:u.$t("sidebar.stepRequirementPlaceholder"),rows:"4",onInput:T[2]||(T[2]=f=>y(f))},null,40,Zo),[[le,w.stepContent]])]),o("div",en,[o("label",tn,c(u.$t("sidebar.terminateColumns")),1),te(o("input",{"onUpdate:modelValue":f=>w.terminateColumns=f,type:"text",class:"form-input",placeholder:u.$t("sidebar.terminateColumnsPlaceholder")},null,8,sn),[[le,w.terminateColumns]])])])]))),128)),r(l).steps.length===0?(h(),g("div",on,[k(r(P),{icon:"carbon:add-alt",width:"32",class:"empty-icon"}),o("p",null,c(u.$t("sidebar.noSteps")),1),o("button",{onClick:T[3]||(T[3]=(...w)=>r(p)&&r(p)(...w)),class:"btn btn-primary"},[k(r(P),{icon:"carbon:add",width:"14"}),ee(" "+c(u.$t("sidebar.addFirstStep")),1)])])):B("",!0)])]),o("div",nn,[o("div",an,[o("label",ln,c(u.$t("sidebar.planId")),1),te(o("input",{"onUpdate:modelValue":T[4]||(T[4]=w=>r(l).planTemplateId=w),type:"text",class:"form-input",placeholder:"planTemplate-1756109892045"},null,512),[[le,r(l).planTemplateId]])])]),r(a)?(h(),g("div",rn,[o("div",cn,[o("label",dn,c(u.$t("sidebar.jsonPreview")),1),o("button",{onClick:T[5]||(T[5]=(...w)=>r($)&&r($)(...w)),class:"btn btn-xs"},[k(r(P),{icon:"carbon:close",width:"12"})])]),o("pre",un,c(r(i)),1)])):B("",!0),o("div",pn,[o("button",{onClick:T[6]||(T[6]=(...w)=>r(S)&&r(S)(...w)),class:"btn btn-sm btn-secondary"},[k(r(P),{icon:"carbon:code",width:"14"}),ee(" "+c(r(a)?u.$t("sidebar.hideJson"):u.$t("sidebar.showJson")),1)]),o("div",mn,[o("button",{class:"btn btn-sm",onClick:T[7]||(T[7]=(...w)=>r(_)&&r(_)(...w)),disabled:!(u.canRollback??!1),title:u.$t("sidebar.rollback")},[k(r(P),{icon:"carbon:undo",width:"14"})],8,hn),o("button",{class:"btn btn-sm",onClick:T[8]||(T[8]=(...w)=>r(I)&&r(I)(...w)),disabled:!(u.canRestore??!1),title:u.$t("sidebar.restore")},[k(r(P),{icon:"carbon:redo",width:"14"})],8,fn),o("button",{class:"btn btn-primary",onClick:T[9]||(T[9]=(...w)=>r(U)&&r(U)(...w)),disabled:u.isGenerating||u.isExecuting},[k(r(P),{icon:"carbon:save",width:"14"}),T[11]||(T[11]=ee(" Save "))],8,vn)])])])]))}}),bn=ue(gn,[["__scopeId","data-v-228d1ada"]]);function rs(n,e){return function(){return n.apply(e,arguments)}}const{toString:yn}=Object.prototype,{getPrototypeOf:Ft}=Object,{iterator:pt,toStringTag:is}=Symbol,mt=(n=>e=>{const t=yn.call(e);return n[t]||(n[t]=t.slice(8,-1).toLowerCase())})(Object.create(null)),ke=n=>(n=n.toLowerCase(),e=>mt(e)===n),ht=n=>e=>typeof e===n,{isArray:je}=Array,et=ht("undefined");function _n(n){return n!==null&&!et(n)&&n.constructor!==null&&!et(n.constructor)&&be(n.constructor.isBuffer)&&n.constructor.isBuffer(n)}const cs=ke("ArrayBuffer");function Sn(n){let e;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?e=ArrayBuffer.isView(n):e=n&&n.buffer&&cs(n.buffer),e}const $n=ht("string"),be=ht("function"),ds=ht("number"),ft=n=>n!==null&&typeof n=="object",wn=n=>n===!0||n===!1,at=n=>{if(mt(n)!=="object")return!1;const e=Ft(n);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(is in n)&&!(pt in n)},kn=ke("Date"),Tn=ke("File"),Pn=ke("Blob"),En=ke("FileList"),Cn=n=>ft(n)&&be(n.pipe),Rn=n=>{let e;return n&&(typeof FormData=="function"&&n instanceof FormData||be(n.append)&&((e=mt(n))==="formdata"||e==="object"&&be(n.toString)&&n.toString()==="[object FormData]"))},In=ke("URLSearchParams"),[An,xn,Dn,Fn]=["ReadableStream","Request","Response","Headers"].map(ke),Mn=n=>n.trim?n.trim():n.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function st(n,e,{allOwnKeys:t=!1}={}){if(n===null||typeof n>"u")return;let s,a;if(typeof n!="object"&&(n=[n]),je(n))for(s=0,a=n.length;s<a;s++)e.call(null,n[s],s,n);else{const l=t?Object.getOwnPropertyNames(n):Object.keys(n),i=l.length;let p;for(s=0;s<i;s++)p=l[s],e.call(null,n[p],p,n)}}function us(n,e){e=e.toLowerCase();const t=Object.keys(n);let s=t.length,a;for(;s-- >0;)if(a=t[s],e===a.toLowerCase())return a;return null}const Me=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,ps=n=>!et(n)&&n!==Me;function Tt(){const{caseless:n}=ps(this)&&this||{},e={},t=(s,a)=>{const l=n&&us(e,a)||a;at(e[l])&&at(s)?e[l]=Tt(e[l],s):at(s)?e[l]=Tt({},s):je(s)?e[l]=s.slice():e[l]=s};for(let s=0,a=arguments.length;s<a;s++)arguments[s]&&st(arguments[s],t);return e}const Un=(n,e,t,{allOwnKeys:s}={})=>(st(e,(a,l)=>{t&&be(a)?n[l]=rs(a,t):n[l]=a},{allOwnKeys:s}),n),Nn=n=>(n.charCodeAt(0)===65279&&(n=n.slice(1)),n),On=(n,e,t,s)=>{n.prototype=Object.create(e.prototype,s),n.prototype.constructor=n,Object.defineProperty(n,"super",{value:e.prototype}),t&&Object.assign(n.prototype,t)},Ln=(n,e,t,s)=>{let a,l,i;const p={};if(e=e||{},n==null)return e;do{for(a=Object.getOwnPropertyNames(n),l=a.length;l-- >0;)i=a[l],(!s||s(i,n,e))&&!p[i]&&(e[i]=n[i],p[i]=!0);n=t!==!1&&Ft(n)}while(n&&(!t||t(n,e))&&n!==Object.prototype);return e},Bn=(n,e,t)=>{n=String(n),(t===void 0||t>n.length)&&(t=n.length),t-=e.length;const s=n.indexOf(e,t);return s!==-1&&s===t},qn=n=>{if(!n)return null;if(je(n))return n;let e=n.length;if(!ds(e))return null;const t=new Array(e);for(;e-- >0;)t[e]=n[e];return t},jn=(n=>e=>n&&e instanceof n)(typeof Uint8Array<"u"&&Ft(Uint8Array)),Vn=(n,e)=>{const s=(n&&n[pt]).call(n);let a;for(;(a=s.next())&&!a.done;){const l=a.value;e.call(n,l[0],l[1])}},Hn=(n,e)=>{let t;const s=[];for(;(t=n.exec(e))!==null;)s.push(t);return s},Wn=ke("HTMLFormElement"),zn=n=>n.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(t,s,a){return s.toUpperCase()+a}),Bt=(({hasOwnProperty:n})=>(e,t)=>n.call(e,t))(Object.prototype),Jn=ke("RegExp"),ms=(n,e)=>{const t=Object.getOwnPropertyDescriptors(n),s={};st(t,(a,l)=>{let i;(i=e(a,l,n))!==!1&&(s[l]=i||a)}),Object.defineProperties(n,s)},Gn=n=>{ms(n,(e,t)=>{if(be(n)&&["arguments","caller","callee"].indexOf(t)!==-1)return!1;const s=n[t];if(be(s)){if(e.enumerable=!1,"writable"in e){e.writable=!1;return}e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+t+"'")})}})},Kn=(n,e)=>{const t={},s=a=>{a.forEach(l=>{t[l]=!0})};return je(n)?s(n):s(String(n).split(e)),t},Xn=()=>{},Yn=(n,e)=>n!=null&&Number.isFinite(n=+n)?n:e;function Qn(n){return!!(n&&be(n.append)&&n[is]==="FormData"&&n[pt])}const Zn=n=>{const e=new Array(10),t=(s,a)=>{if(ft(s)){if(e.indexOf(s)>=0)return;if(!("toJSON"in s)){e[a]=s;const l=je(s)?[]:{};return st(s,(i,p)=>{const v=t(i,a+1);!et(v)&&(l[p]=v)}),e[a]=void 0,l}}return s};return t(n,0)},ea=ke("AsyncFunction"),ta=n=>n&&(ft(n)||be(n))&&be(n.then)&&be(n.catch),hs=((n,e)=>n?setImmediate:e?((t,s)=>(Me.addEventListener("message",({source:a,data:l})=>{a===Me&&l===t&&s.length&&s.shift()()},!1),a=>{s.push(a),Me.postMessage(t,"*")}))(`axios@${Math.random()}`,[]):t=>setTimeout(t))(typeof setImmediate=="function",be(Me.postMessage)),sa=typeof queueMicrotask<"u"?queueMicrotask.bind(Me):typeof process<"u"&&process.nextTick||hs,oa=n=>n!=null&&be(n[pt]),C={isArray:je,isArrayBuffer:cs,isBuffer:_n,isFormData:Rn,isArrayBufferView:Sn,isString:$n,isNumber:ds,isBoolean:wn,isObject:ft,isPlainObject:at,isReadableStream:An,isRequest:xn,isResponse:Dn,isHeaders:Fn,isUndefined:et,isDate:kn,isFile:Tn,isBlob:Pn,isRegExp:Jn,isFunction:be,isStream:Cn,isURLSearchParams:In,isTypedArray:jn,isFileList:En,forEach:st,merge:Tt,extend:Un,trim:Mn,stripBOM:Nn,inherits:On,toFlatObject:Ln,kindOf:mt,kindOfTest:ke,endsWith:Bn,toArray:qn,forEachEntry:Vn,matchAll:Hn,isHTMLForm:Wn,hasOwnProperty:Bt,hasOwnProp:Bt,reduceDescriptors:ms,freezeMethods:Gn,toObjectSet:Kn,toCamelCase:zn,noop:Xn,toFiniteNumber:Yn,findKey:us,global:Me,isContextDefined:ps,isSpecCompliantForm:Qn,toJSONObject:Zn,isAsyncFn:ea,isThenable:ta,setImmediate:hs,asap:sa,isIterable:oa};function Q(n,e,t,s,a){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=n,this.name="AxiosError",e&&(this.code=e),t&&(this.config=t),s&&(this.request=s),a&&(this.response=a,this.status=a.status?a.status:null)}C.inherits(Q,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:C.toJSONObject(this.config),code:this.code,status:this.status}}});const fs=Q.prototype,vs={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(n=>{vs[n]={value:n}});Object.defineProperties(Q,vs);Object.defineProperty(fs,"isAxiosError",{value:!0});Q.from=(n,e,t,s,a,l)=>{const i=Object.create(fs);return C.toFlatObject(n,i,function(v){return v!==Error.prototype},p=>p!=="isAxiosError"),Q.call(i,n.message,e,t,s,a),i.cause=n,i.name=n.name,l&&Object.assign(i,l),i};const na=null;function Pt(n){return C.isPlainObject(n)||C.isArray(n)}function gs(n){return C.endsWith(n,"[]")?n.slice(0,-2):n}function qt(n,e,t){return n?n.concat(e).map(function(a,l){return a=gs(a),!t&&l?"["+a+"]":a}).join(t?".":""):e}function aa(n){return C.isArray(n)&&!n.some(Pt)}const la=C.toFlatObject(C,{},null,function(e){return/^is[A-Z]/.test(e)});function vt(n,e,t){if(!C.isObject(n))throw new TypeError("target must be an object");e=e||new FormData,t=C.toFlatObject(t,{metaTokens:!0,dots:!1,indexes:!1},!1,function($,y){return!C.isUndefined(y[$])});const s=t.metaTokens,a=t.visitor||m,l=t.dots,i=t.indexes,v=(t.Blob||typeof Blob<"u"&&Blob)&&C.isSpecCompliantForm(e);if(!C.isFunction(a))throw new TypeError("visitor must be a function");function d(S){if(S===null)return"";if(C.isDate(S))return S.toISOString();if(!v&&C.isBlob(S))throw new Q("Blob is not supported. Use a Buffer instead.");return C.isArrayBuffer(S)||C.isTypedArray(S)?v&&typeof Blob=="function"?new Blob([S]):Buffer.from(S):S}function m(S,$,y){let u=S;if(S&&!y&&typeof S=="object"){if(C.endsWith($,"{}"))$=s?$:$.slice(0,-2),S=JSON.stringify(S);else if(C.isArray(S)&&aa(S)||(C.isFileList(S)||C.endsWith($,"[]"))&&(u=C.toArray(S)))return $=gs($),u.forEach(function(w,E){!(C.isUndefined(w)||w===null)&&e.append(i===!0?qt([$],E,l):i===null?$:$+"[]",d(w))}),!1}return Pt(S)?!0:(e.append(qt(y,$,l),d(S)),!1)}const _=[],I=Object.assign(la,{defaultVisitor:m,convertValue:d,isVisitable:Pt});function U(S,$){if(!C.isUndefined(S)){if(_.indexOf(S)!==-1)throw Error("Circular reference detected in "+$.join("."));_.push(S),C.forEach(S,function(u,T){(!(C.isUndefined(u)||u===null)&&a.call(e,u,C.isString(T)?T.trim():T,$,I))===!0&&U(u,$?$.concat(T):[T])}),_.pop()}}if(!C.isObject(n))throw new TypeError("data must be an object");return U(n),e}function jt(n){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(n).replace(/[!'()~]|%20|%00/g,function(s){return e[s]})}function Mt(n,e){this._pairs=[],n&&vt(n,this,e)}const bs=Mt.prototype;bs.append=function(e,t){this._pairs.push([e,t])};bs.toString=function(e){const t=e?function(s){return e.call(this,s,jt)}:jt;return this._pairs.map(function(a){return t(a[0])+"="+t(a[1])},"").join("&")};function ra(n){return encodeURIComponent(n).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function ys(n,e,t){if(!e)return n;const s=t&&t.encode||ra;C.isFunction(t)&&(t={serialize:t});const a=t&&t.serialize;let l;if(a?l=a(e,t):l=C.isURLSearchParams(e)?e.toString():new Mt(e,t).toString(s),l){const i=n.indexOf("#");i!==-1&&(n=n.slice(0,i)),n+=(n.indexOf("?")===-1?"?":"&")+l}return n}class Vt{constructor(){this.handlers=[]}use(e,t,s){return this.handlers.push({fulfilled:e,rejected:t,synchronous:s?s.synchronous:!1,runWhen:s?s.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){C.forEach(this.handlers,function(s){s!==null&&e(s)})}}const _s={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},ia=typeof URLSearchParams<"u"?URLSearchParams:Mt,ca=typeof FormData<"u"?FormData:null,da=typeof Blob<"u"?Blob:null,ua={isBrowser:!0,classes:{URLSearchParams:ia,FormData:ca,Blob:da},protocols:["http","https","file","blob","url","data"]},Ut=typeof window<"u"&&typeof document<"u",Et=typeof navigator=="object"&&navigator||void 0,pa=Ut&&(!Et||["ReactNative","NativeScript","NS"].indexOf(Et.product)<0),ma=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",ha=Ut&&window.location.href||"http://localhost",fa=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:Ut,hasStandardBrowserEnv:pa,hasStandardBrowserWebWorkerEnv:ma,navigator:Et,origin:ha},Symbol.toStringTag,{value:"Module"})),ve={...fa,...ua};function va(n,e){return vt(n,new ve.classes.URLSearchParams,Object.assign({visitor:function(t,s,a,l){return ve.isNode&&C.isBuffer(t)?(this.append(s,t.toString("base64")),!1):l.defaultVisitor.apply(this,arguments)}},e))}function ga(n){return C.matchAll(/\w+|\[(\w*)]/g,n).map(e=>e[0]==="[]"?"":e[1]||e[0])}function ba(n){const e={},t=Object.keys(n);let s;const a=t.length;let l;for(s=0;s<a;s++)l=t[s],e[l]=n[l];return e}function Ss(n){function e(t,s,a,l){let i=t[l++];if(i==="__proto__")return!0;const p=Number.isFinite(+i),v=l>=t.length;return i=!i&&C.isArray(a)?a.length:i,v?(C.hasOwnProp(a,i)?a[i]=[a[i],s]:a[i]=s,!p):((!a[i]||!C.isObject(a[i]))&&(a[i]=[]),e(t,s,a[i],l)&&C.isArray(a[i])&&(a[i]=ba(a[i])),!p)}if(C.isFormData(n)&&C.isFunction(n.entries)){const t={};return C.forEachEntry(n,(s,a)=>{e(ga(s),a,t,0)}),t}return null}function ya(n,e,t){if(C.isString(n))try{return(e||JSON.parse)(n),C.trim(n)}catch(s){if(s.name!=="SyntaxError")throw s}return(t||JSON.stringify)(n)}const ot={transitional:_s,adapter:["xhr","http","fetch"],transformRequest:[function(e,t){const s=t.getContentType()||"",a=s.indexOf("application/json")>-1,l=C.isObject(e);if(l&&C.isHTMLForm(e)&&(e=new FormData(e)),C.isFormData(e))return a?JSON.stringify(Ss(e)):e;if(C.isArrayBuffer(e)||C.isBuffer(e)||C.isStream(e)||C.isFile(e)||C.isBlob(e)||C.isReadableStream(e))return e;if(C.isArrayBufferView(e))return e.buffer;if(C.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let p;if(l){if(s.indexOf("application/x-www-form-urlencoded")>-1)return va(e,this.formSerializer).toString();if((p=C.isFileList(e))||s.indexOf("multipart/form-data")>-1){const v=this.env&&this.env.FormData;return vt(p?{"files[]":e}:e,v&&new v,this.formSerializer)}}return l||a?(t.setContentType("application/json",!1),ya(e)):e}],transformResponse:[function(e){const t=this.transitional||ot.transitional,s=t&&t.forcedJSONParsing,a=this.responseType==="json";if(C.isResponse(e)||C.isReadableStream(e))return e;if(e&&C.isString(e)&&(s&&!this.responseType||a)){const i=!(t&&t.silentJSONParsing)&&a;try{return JSON.parse(e)}catch(p){if(i)throw p.name==="SyntaxError"?Q.from(p,Q.ERR_BAD_RESPONSE,this,null,this.response):p}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:ve.classes.FormData,Blob:ve.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};C.forEach(["delete","get","head","post","put","patch"],n=>{ot.headers[n]={}});const _a=C.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),Sa=n=>{const e={};let t,s,a;return n&&n.split(`
`).forEach(function(i){a=i.indexOf(":"),t=i.substring(0,a).trim().toLowerCase(),s=i.substring(a+1).trim(),!(!t||e[t]&&_a[t])&&(t==="set-cookie"?e[t]?e[t].push(s):e[t]=[s]:e[t]=e[t]?e[t]+", "+s:s)}),e},Ht=Symbol("internals");function Xe(n){return n&&String(n).trim().toLowerCase()}function lt(n){return n===!1||n==null?n:C.isArray(n)?n.map(lt):String(n)}function $a(n){const e=Object.create(null),t=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let s;for(;s=t.exec(n);)e[s[1]]=s[2];return e}const wa=n=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(n.trim());function St(n,e,t,s,a){if(C.isFunction(s))return s.call(this,e,t);if(a&&(e=t),!!C.isString(e)){if(C.isString(s))return e.indexOf(s)!==-1;if(C.isRegExp(s))return s.test(e)}}function ka(n){return n.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,t,s)=>t.toUpperCase()+s)}function Ta(n,e){const t=C.toCamelCase(" "+e);["get","set","has"].forEach(s=>{Object.defineProperty(n,s+t,{value:function(a,l,i){return this[s].call(this,e,a,l,i)},configurable:!0})})}let ye=class{constructor(e){e&&this.set(e)}set(e,t,s){const a=this;function l(p,v,d){const m=Xe(v);if(!m)throw new Error("header name must be a non-empty string");const _=C.findKey(a,m);(!_||a[_]===void 0||d===!0||d===void 0&&a[_]!==!1)&&(a[_||v]=lt(p))}const i=(p,v)=>C.forEach(p,(d,m)=>l(d,m,v));if(C.isPlainObject(e)||e instanceof this.constructor)i(e,t);else if(C.isString(e)&&(e=e.trim())&&!wa(e))i(Sa(e),t);else if(C.isObject(e)&&C.isIterable(e)){let p={},v,d;for(const m of e){if(!C.isArray(m))throw TypeError("Object iterator must return a key-value pair");p[d=m[0]]=(v=p[d])?C.isArray(v)?[...v,m[1]]:[v,m[1]]:m[1]}i(p,t)}else e!=null&&l(t,e,s);return this}get(e,t){if(e=Xe(e),e){const s=C.findKey(this,e);if(s){const a=this[s];if(!t)return a;if(t===!0)return $a(a);if(C.isFunction(t))return t.call(this,a,s);if(C.isRegExp(t))return t.exec(a);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,t){if(e=Xe(e),e){const s=C.findKey(this,e);return!!(s&&this[s]!==void 0&&(!t||St(this,this[s],s,t)))}return!1}delete(e,t){const s=this;let a=!1;function l(i){if(i=Xe(i),i){const p=C.findKey(s,i);p&&(!t||St(s,s[p],p,t))&&(delete s[p],a=!0)}}return C.isArray(e)?e.forEach(l):l(e),a}clear(e){const t=Object.keys(this);let s=t.length,a=!1;for(;s--;){const l=t[s];(!e||St(this,this[l],l,e,!0))&&(delete this[l],a=!0)}return a}normalize(e){const t=this,s={};return C.forEach(this,(a,l)=>{const i=C.findKey(s,l);if(i){t[i]=lt(a),delete t[l];return}const p=e?ka(l):String(l).trim();p!==l&&delete t[l],t[p]=lt(a),s[p]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const t=Object.create(null);return C.forEach(this,(s,a)=>{s!=null&&s!==!1&&(t[a]=e&&C.isArray(s)?s.join(", "):s)}),t}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,t])=>e+": "+t).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...t){const s=new this(e);return t.forEach(a=>s.set(a)),s}static accessor(e){const s=(this[Ht]=this[Ht]={accessors:{}}).accessors,a=this.prototype;function l(i){const p=Xe(i);s[p]||(Ta(a,i),s[p]=!0)}return C.isArray(e)?e.forEach(l):l(e),this}};ye.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);C.reduceDescriptors(ye.prototype,({value:n},e)=>{let t=e[0].toUpperCase()+e.slice(1);return{get:()=>n,set(s){this[t]=s}}});C.freezeMethods(ye);function $t(n,e){const t=this||ot,s=e||t,a=ye.from(s.headers);let l=s.data;return C.forEach(n,function(p){l=p.call(t,l,a.normalize(),e?e.status:void 0)}),a.normalize(),l}function $s(n){return!!(n&&n.__CANCEL__)}function Ve(n,e,t){Q.call(this,n??"canceled",Q.ERR_CANCELED,e,t),this.name="CanceledError"}C.inherits(Ve,Q,{__CANCEL__:!0});function ws(n,e,t){const s=t.config.validateStatus;!t.status||!s||s(t.status)?n(t):e(new Q("Request failed with status code "+t.status,[Q.ERR_BAD_REQUEST,Q.ERR_BAD_RESPONSE][Math.floor(t.status/100)-4],t.config,t.request,t))}function Pa(n){const e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(n);return e&&e[1]||""}function Ea(n,e){n=n||10;const t=new Array(n),s=new Array(n);let a=0,l=0,i;return e=e!==void 0?e:1e3,function(v){const d=Date.now(),m=s[l];i||(i=d),t[a]=v,s[a]=d;let _=l,I=0;for(;_!==a;)I+=t[_++],_=_%n;if(a=(a+1)%n,a===l&&(l=(l+1)%n),d-i<e)return;const U=m&&d-m;return U?Math.round(I*1e3/U):void 0}}function Ca(n,e){let t=0,s=1e3/e,a,l;const i=(d,m=Date.now())=>{t=m,a=null,l&&(clearTimeout(l),l=null),n.apply(null,d)};return[(...d)=>{const m=Date.now(),_=m-t;_>=s?i(d,m):(a=d,l||(l=setTimeout(()=>{l=null,i(a)},s-_)))},()=>a&&i(a)]}const ct=(n,e,t=3)=>{let s=0;const a=Ea(50,250);return Ca(l=>{const i=l.loaded,p=l.lengthComputable?l.total:void 0,v=i-s,d=a(v),m=i<=p;s=i;const _={loaded:i,total:p,progress:p?i/p:void 0,bytes:v,rate:d||void 0,estimated:d&&p&&m?(p-i)/d:void 0,event:l,lengthComputable:p!=null,[e?"download":"upload"]:!0};n(_)},t)},Wt=(n,e)=>{const t=n!=null;return[s=>e[0]({lengthComputable:t,total:n,loaded:s}),e[1]]},zt=n=>(...e)=>C.asap(()=>n(...e)),Ra=ve.hasStandardBrowserEnv?((n,e)=>t=>(t=new URL(t,ve.origin),n.protocol===t.protocol&&n.host===t.host&&(e||n.port===t.port)))(new URL(ve.origin),ve.navigator&&/(msie|trident)/i.test(ve.navigator.userAgent)):()=>!0,Ia=ve.hasStandardBrowserEnv?{write(n,e,t,s,a,l){const i=[n+"="+encodeURIComponent(e)];C.isNumber(t)&&i.push("expires="+new Date(t).toGMTString()),C.isString(s)&&i.push("path="+s),C.isString(a)&&i.push("domain="+a),l===!0&&i.push("secure"),document.cookie=i.join("; ")},read(n){const e=document.cookie.match(new RegExp("(^|;\\s*)("+n+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove(n){this.write(n,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function Aa(n){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(n)}function xa(n,e){return e?n.replace(/\/?\/$/,"")+"/"+e.replace(/^\/+/,""):n}function ks(n,e,t){let s=!Aa(e);return n&&(s||t==!1)?xa(n,e):e}const Jt=n=>n instanceof ye?{...n}:n;function Oe(n,e){e=e||{};const t={};function s(d,m,_,I){return C.isPlainObject(d)&&C.isPlainObject(m)?C.merge.call({caseless:I},d,m):C.isPlainObject(m)?C.merge({},m):C.isArray(m)?m.slice():m}function a(d,m,_,I){if(C.isUndefined(m)){if(!C.isUndefined(d))return s(void 0,d,_,I)}else return s(d,m,_,I)}function l(d,m){if(!C.isUndefined(m))return s(void 0,m)}function i(d,m){if(C.isUndefined(m)){if(!C.isUndefined(d))return s(void 0,d)}else return s(void 0,m)}function p(d,m,_){if(_ in e)return s(d,m);if(_ in n)return s(void 0,d)}const v={url:l,method:l,data:l,baseURL:i,transformRequest:i,transformResponse:i,paramsSerializer:i,timeout:i,timeoutMessage:i,withCredentials:i,withXSRFToken:i,adapter:i,responseType:i,xsrfCookieName:i,xsrfHeaderName:i,onUploadProgress:i,onDownloadProgress:i,decompress:i,maxContentLength:i,maxBodyLength:i,beforeRedirect:i,transport:i,httpAgent:i,httpsAgent:i,cancelToken:i,socketPath:i,responseEncoding:i,validateStatus:p,headers:(d,m,_)=>a(Jt(d),Jt(m),_,!0)};return C.forEach(Object.keys(Object.assign({},n,e)),function(m){const _=v[m]||a,I=_(n[m],e[m],m);C.isUndefined(I)&&_!==p||(t[m]=I)}),t}const Ts=n=>{const e=Oe({},n);let{data:t,withXSRFToken:s,xsrfHeaderName:a,xsrfCookieName:l,headers:i,auth:p}=e;e.headers=i=ye.from(i),e.url=ys(ks(e.baseURL,e.url,e.allowAbsoluteUrls),n.params,n.paramsSerializer),p&&i.set("Authorization","Basic "+btoa((p.username||"")+":"+(p.password?unescape(encodeURIComponent(p.password)):"")));let v;if(C.isFormData(t)){if(ve.hasStandardBrowserEnv||ve.hasStandardBrowserWebWorkerEnv)i.setContentType(void 0);else if((v=i.getContentType())!==!1){const[d,...m]=v?v.split(";").map(_=>_.trim()).filter(Boolean):[];i.setContentType([d||"multipart/form-data",...m].join("; "))}}if(ve.hasStandardBrowserEnv&&(s&&C.isFunction(s)&&(s=s(e)),s||s!==!1&&Ra(e.url))){const d=a&&l&&Ia.read(l);d&&i.set(a,d)}return e},Da=typeof XMLHttpRequest<"u",Fa=Da&&function(n){return new Promise(function(t,s){const a=Ts(n);let l=a.data;const i=ye.from(a.headers).normalize();let{responseType:p,onUploadProgress:v,onDownloadProgress:d}=a,m,_,I,U,S;function $(){U&&U(),S&&S(),a.cancelToken&&a.cancelToken.unsubscribe(m),a.signal&&a.signal.removeEventListener("abort",m)}let y=new XMLHttpRequest;y.open(a.method.toUpperCase(),a.url,!0),y.timeout=a.timeout;function u(){if(!y)return;const w=ye.from("getAllResponseHeaders"in y&&y.getAllResponseHeaders()),f={data:!p||p==="text"||p==="json"?y.responseText:y.response,status:y.status,statusText:y.statusText,headers:w,config:n,request:y};ws(function(z){t(z),$()},function(z){s(z),$()},f),y=null}"onloadend"in y?y.onloadend=u:y.onreadystatechange=function(){!y||y.readyState!==4||y.status===0&&!(y.responseURL&&y.responseURL.indexOf("file:")===0)||setTimeout(u)},y.onabort=function(){y&&(s(new Q("Request aborted",Q.ECONNABORTED,n,y)),y=null)},y.onerror=function(){s(new Q("Network Error",Q.ERR_NETWORK,n,y)),y=null},y.ontimeout=function(){let E=a.timeout?"timeout of "+a.timeout+"ms exceeded":"timeout exceeded";const f=a.transitional||_s;a.timeoutErrorMessage&&(E=a.timeoutErrorMessage),s(new Q(E,f.clarifyTimeoutError?Q.ETIMEDOUT:Q.ECONNABORTED,n,y)),y=null},l===void 0&&i.setContentType(null),"setRequestHeader"in y&&C.forEach(i.toJSON(),function(E,f){y.setRequestHeader(f,E)}),C.isUndefined(a.withCredentials)||(y.withCredentials=!!a.withCredentials),p&&p!=="json"&&(y.responseType=a.responseType),d&&([I,S]=ct(d,!0),y.addEventListener("progress",I)),v&&y.upload&&([_,U]=ct(v),y.upload.addEventListener("progress",_),y.upload.addEventListener("loadend",U)),(a.cancelToken||a.signal)&&(m=w=>{y&&(s(!w||w.type?new Ve(null,n,y):w),y.abort(),y=null)},a.cancelToken&&a.cancelToken.subscribe(m),a.signal&&(a.signal.aborted?m():a.signal.addEventListener("abort",m)));const T=Pa(a.url);if(T&&ve.protocols.indexOf(T)===-1){s(new Q("Unsupported protocol "+T+":",Q.ERR_BAD_REQUEST,n));return}y.send(l||null)})},Ma=(n,e)=>{const{length:t}=n=n?n.filter(Boolean):[];if(e||t){let s=new AbortController,a;const l=function(d){if(!a){a=!0,p();const m=d instanceof Error?d:this.reason;s.abort(m instanceof Q?m:new Ve(m instanceof Error?m.message:m))}};let i=e&&setTimeout(()=>{i=null,l(new Q(`timeout ${e} of ms exceeded`,Q.ETIMEDOUT))},e);const p=()=>{n&&(i&&clearTimeout(i),i=null,n.forEach(d=>{d.unsubscribe?d.unsubscribe(l):d.removeEventListener("abort",l)}),n=null)};n.forEach(d=>d.addEventListener("abort",l));const{signal:v}=s;return v.unsubscribe=()=>C.asap(p),v}},Ua=function*(n,e){let t=n.byteLength;if(t<e){yield n;return}let s=0,a;for(;s<t;)a=s+e,yield n.slice(s,a),s=a},Na=async function*(n,e){for await(const t of Oa(n))yield*Ua(t,e)},Oa=async function*(n){if(n[Symbol.asyncIterator]){yield*n;return}const e=n.getReader();try{for(;;){const{done:t,value:s}=await e.read();if(t)break;yield s}}finally{await e.cancel()}},Gt=(n,e,t,s)=>{const a=Na(n,e);let l=0,i,p=v=>{i||(i=!0,s&&s(v))};return new ReadableStream({async pull(v){try{const{done:d,value:m}=await a.next();if(d){p(),v.close();return}let _=m.byteLength;if(t){let I=l+=_;t(I)}v.enqueue(new Uint8Array(m))}catch(d){throw p(d),d}},cancel(v){return p(v),a.return()}},{highWaterMark:2})},gt=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",Ps=gt&&typeof ReadableStream=="function",La=gt&&(typeof TextEncoder=="function"?(n=>e=>n.encode(e))(new TextEncoder):async n=>new Uint8Array(await new Response(n).arrayBuffer())),Es=(n,...e)=>{try{return!!n(...e)}catch{return!1}},Ba=Ps&&Es(()=>{let n=!1;const e=new Request(ve.origin,{body:new ReadableStream,method:"POST",get duplex(){return n=!0,"half"}}).headers.has("Content-Type");return n&&!e}),Kt=64*1024,Ct=Ps&&Es(()=>C.isReadableStream(new Response("").body)),dt={stream:Ct&&(n=>n.body)};gt&&(n=>{["text","arrayBuffer","blob","formData","stream"].forEach(e=>{!dt[e]&&(dt[e]=C.isFunction(n[e])?t=>t[e]():(t,s)=>{throw new Q(`Response type '${e}' is not supported`,Q.ERR_NOT_SUPPORT,s)})})})(new Response);const qa=async n=>{if(n==null)return 0;if(C.isBlob(n))return n.size;if(C.isSpecCompliantForm(n))return(await new Request(ve.origin,{method:"POST",body:n}).arrayBuffer()).byteLength;if(C.isArrayBufferView(n)||C.isArrayBuffer(n))return n.byteLength;if(C.isURLSearchParams(n)&&(n=n+""),C.isString(n))return(await La(n)).byteLength},ja=async(n,e)=>{const t=C.toFiniteNumber(n.getContentLength());return t??qa(e)},Va=gt&&(async n=>{let{url:e,method:t,data:s,signal:a,cancelToken:l,timeout:i,onDownloadProgress:p,onUploadProgress:v,responseType:d,headers:m,withCredentials:_="same-origin",fetchOptions:I}=Ts(n);d=d?(d+"").toLowerCase():"text";let U=Ma([a,l&&l.toAbortSignal()],i),S;const $=U&&U.unsubscribe&&(()=>{U.unsubscribe()});let y;try{if(v&&Ba&&t!=="get"&&t!=="head"&&(y=await ja(m,s))!==0){let f=new Request(e,{method:"POST",body:s,duplex:"half"}),q;if(C.isFormData(s)&&(q=f.headers.get("content-type"))&&m.setContentType(q),f.body){const[z,Z]=Wt(y,ct(zt(v)));s=Gt(f.body,Kt,z,Z)}}C.isString(_)||(_=_?"include":"omit");const u="credentials"in Request.prototype;S=new Request(e,{...I,signal:U,method:t.toUpperCase(),headers:m.normalize().toJSON(),body:s,duplex:"half",credentials:u?_:void 0});let T=await fetch(S);const w=Ct&&(d==="stream"||d==="response");if(Ct&&(p||w&&$)){const f={};["status","statusText","headers"].forEach(A=>{f[A]=T[A]});const q=C.toFiniteNumber(T.headers.get("content-length")),[z,Z]=p&&Wt(q,ct(zt(p),!0))||[];T=new Response(Gt(T.body,Kt,z,()=>{Z&&Z(),$&&$()}),f)}d=d||"text";let E=await dt[C.findKey(dt,d)||"text"](T,n);return!w&&$&&$(),await new Promise((f,q)=>{ws(f,q,{data:E,headers:ye.from(T.headers),status:T.status,statusText:T.statusText,config:n,request:S})})}catch(u){throw $&&$(),u&&u.name==="TypeError"&&/Load failed|fetch/i.test(u.message)?Object.assign(new Q("Network Error",Q.ERR_NETWORK,n,S),{cause:u.cause||u}):Q.from(u,u&&u.code,n,S)}}),Rt={http:na,xhr:Fa,fetch:Va};C.forEach(Rt,(n,e)=>{if(n){try{Object.defineProperty(n,"name",{value:e})}catch{}Object.defineProperty(n,"adapterName",{value:e})}});const Xt=n=>`- ${n}`,Ha=n=>C.isFunction(n)||n===null||n===!1,Cs={getAdapter:n=>{n=C.isArray(n)?n:[n];const{length:e}=n;let t,s;const a={};for(let l=0;l<e;l++){t=n[l];let i;if(s=t,!Ha(t)&&(s=Rt[(i=String(t)).toLowerCase()],s===void 0))throw new Q(`Unknown adapter '${i}'`);if(s)break;a[i||"#"+l]=s}if(!s){const l=Object.entries(a).map(([p,v])=>`adapter ${p} `+(v===!1?"is not supported by the environment":"is not available in the build"));let i=e?l.length>1?`since :
`+l.map(Xt).join(`
`):" "+Xt(l[0]):"as no adapter specified";throw new Q("There is no suitable adapter to dispatch the request "+i,"ERR_NOT_SUPPORT")}return s},adapters:Rt};function wt(n){if(n.cancelToken&&n.cancelToken.throwIfRequested(),n.signal&&n.signal.aborted)throw new Ve(null,n)}function Yt(n){return wt(n),n.headers=ye.from(n.headers),n.data=$t.call(n,n.transformRequest),["post","put","patch"].indexOf(n.method)!==-1&&n.headers.setContentType("application/x-www-form-urlencoded",!1),Cs.getAdapter(n.adapter||ot.adapter)(n).then(function(s){return wt(n),s.data=$t.call(n,n.transformResponse,s),s.headers=ye.from(s.headers),s},function(s){return $s(s)||(wt(n),s&&s.response&&(s.response.data=$t.call(n,n.transformResponse,s.response),s.response.headers=ye.from(s.response.headers))),Promise.reject(s)})}const Rs="1.9.0",bt={};["object","boolean","number","function","string","symbol"].forEach((n,e)=>{bt[n]=function(s){return typeof s===n||"a"+(e<1?"n ":" ")+n}});const Qt={};bt.transitional=function(e,t,s){function a(l,i){return"[Axios v"+Rs+"] Transitional option '"+l+"'"+i+(s?". "+s:"")}return(l,i,p)=>{if(e===!1)throw new Q(a(i," has been removed"+(t?" in "+t:"")),Q.ERR_DEPRECATED);return t&&!Qt[i]&&(Qt[i]=!0,console.warn(a(i," has been deprecated since v"+t+" and will be removed in the near future"))),e?e(l,i,p):!0}};bt.spelling=function(e){return(t,s)=>(console.warn(`${s} is likely a misspelling of ${e}`),!0)};function Wa(n,e,t){if(typeof n!="object")throw new Q("options must be an object",Q.ERR_BAD_OPTION_VALUE);const s=Object.keys(n);let a=s.length;for(;a-- >0;){const l=s[a],i=e[l];if(i){const p=n[l],v=p===void 0||i(p,l,n);if(v!==!0)throw new Q("option "+l+" must be "+v,Q.ERR_BAD_OPTION_VALUE);continue}if(t!==!0)throw new Q("Unknown option "+l,Q.ERR_BAD_OPTION)}}const rt={assertOptions:Wa,validators:bt},Ee=rt.validators;let Ne=class{constructor(e){this.defaults=e||{},this.interceptors={request:new Vt,response:new Vt}}async request(e,t){try{return await this._request(e,t)}catch(s){if(s instanceof Error){let a={};Error.captureStackTrace?Error.captureStackTrace(a):a=new Error;const l=a.stack?a.stack.replace(/^.+\n/,""):"";try{s.stack?l&&!String(s.stack).endsWith(l.replace(/^.+\n.+\n/,""))&&(s.stack+=`
`+l):s.stack=l}catch{}}throw s}}_request(e,t){typeof e=="string"?(t=t||{},t.url=e):t=e||{},t=Oe(this.defaults,t);const{transitional:s,paramsSerializer:a,headers:l}=t;s!==void 0&&rt.assertOptions(s,{silentJSONParsing:Ee.transitional(Ee.boolean),forcedJSONParsing:Ee.transitional(Ee.boolean),clarifyTimeoutError:Ee.transitional(Ee.boolean)},!1),a!=null&&(C.isFunction(a)?t.paramsSerializer={serialize:a}:rt.assertOptions(a,{encode:Ee.function,serialize:Ee.function},!0)),t.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?t.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:t.allowAbsoluteUrls=!0),rt.assertOptions(t,{baseUrl:Ee.spelling("baseURL"),withXsrfToken:Ee.spelling("withXSRFToken")},!0),t.method=(t.method||this.defaults.method||"get").toLowerCase();let i=l&&C.merge(l.common,l[t.method]);l&&C.forEach(["delete","get","head","post","put","patch","common"],S=>{delete l[S]}),t.headers=ye.concat(i,l);const p=[];let v=!0;this.interceptors.request.forEach(function($){typeof $.runWhen=="function"&&$.runWhen(t)===!1||(v=v&&$.synchronous,p.unshift($.fulfilled,$.rejected))});const d=[];this.interceptors.response.forEach(function($){d.push($.fulfilled,$.rejected)});let m,_=0,I;if(!v){const S=[Yt.bind(this),void 0];for(S.unshift.apply(S,p),S.push.apply(S,d),I=S.length,m=Promise.resolve(t);_<I;)m=m.then(S[_++],S[_++]);return m}I=p.length;let U=t;for(_=0;_<I;){const S=p[_++],$=p[_++];try{U=S(U)}catch(y){$.call(this,y);break}}try{m=Yt.call(this,U)}catch(S){return Promise.reject(S)}for(_=0,I=d.length;_<I;)m=m.then(d[_++],d[_++]);return m}getUri(e){e=Oe(this.defaults,e);const t=ks(e.baseURL,e.url,e.allowAbsoluteUrls);return ys(t,e.params,e.paramsSerializer)}};C.forEach(["delete","get","head","options"],function(e){Ne.prototype[e]=function(t,s){return this.request(Oe(s||{},{method:e,url:t,data:(s||{}).data}))}});C.forEach(["post","put","patch"],function(e){function t(s){return function(l,i,p){return this.request(Oe(p||{},{method:e,headers:s?{"Content-Type":"multipart/form-data"}:{},url:l,data:i}))}}Ne.prototype[e]=t(),Ne.prototype[e+"Form"]=t(!0)});let za=class Is{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let t;this.promise=new Promise(function(l){t=l});const s=this;this.promise.then(a=>{if(!s._listeners)return;let l=s._listeners.length;for(;l-- >0;)s._listeners[l](a);s._listeners=null}),this.promise.then=a=>{let l;const i=new Promise(p=>{s.subscribe(p),l=p}).then(a);return i.cancel=function(){s.unsubscribe(l)},i},e(function(l,i,p){s.reason||(s.reason=new Ve(l,i,p),t(s.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const t=this._listeners.indexOf(e);t!==-1&&this._listeners.splice(t,1)}toAbortSignal(){const e=new AbortController,t=s=>{e.abort(s)};return this.subscribe(t),e.signal.unsubscribe=()=>this.unsubscribe(t),e.signal}static source(){let e;return{token:new Is(function(a){e=a}),cancel:e}}};function Ja(n){return function(t){return n.apply(null,t)}}function Ga(n){return C.isObject(n)&&n.isAxiosError===!0}const It={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(It).forEach(([n,e])=>{It[e]=n});function As(n){const e=new Ne(n),t=rs(Ne.prototype.request,e);return C.extend(t,Ne.prototype,e,{allOwnKeys:!0}),C.extend(t,e,null,{allOwnKeys:!0}),t.create=function(a){return As(Oe(n,a))},t}const he=As(ot);he.Axios=Ne;he.CanceledError=Ve;he.CancelToken=za;he.isCancel=$s;he.VERSION=Rs;he.toFormData=vt;he.AxiosError=Q;he.Cancel=he.CanceledError;he.all=function(e){return Promise.all(e)};he.spread=Ja;he.isAxiosError=Ga;he.mergeConfig=Oe;he.AxiosHeaders=ye;he.formToJSON=n=>Ss(C.isHTMLForm(n)?new FormData(n):n);he.getAdapter=Cs.getAdapter;he.HttpStatusCode=It;he.default=he;const{Axios:Iv,AxiosError:Av,CanceledError:xv,isCancel:Dv,CancelToken:Fv,VERSION:Mv,all:Uv,Cancel:Nv,isAxiosError:Ov,spread:Lv,toFormData:Bv,AxiosHeaders:qv,HttpStatusCode:jv,formToJSON:Vv,getAdapter:Hv,mergeConfig:Wv}=he;class Ka{static async getAvailableModels(){try{return(await he({url:"/api/models/available-models",method:"GET",baseURL:""})).data}catch(e){return console.error("Failed to fetch available models:",e),{options:[],total:0}}}}const Xa={class:"config-section"},Ya={class:"section-header"},Qa={key:0,class:"error-section"},Za={class:"error-message"},el={class:"error-content"},tl={class:"error-title"},sl={class:"error-description"},ol={key:1,class:"visual-editor"},nl={class:"plan-basic-info"},al={class:"form-row"},ll={class:"form-label"},rl=["placeholder"],il={key:0,class:"field-error-message"},cl={class:"form-row"},dl={class:"form-label"},ul=["value","placeholder"],pl={class:"steps-section"},ml={class:"steps-header"},hl={class:"form-label"},fl={class:"steps-actions"},vl=["title"],gl={class:"steps-container"},bl={class:"step-header"},yl={class:"step-number"},_l={class:"step-actions"},Sl=["onClick","disabled","title"],$l=["onClick","disabled","title"],wl=["onClick","title"],kl={class:"step-content"},Tl={class:"form-row"},Pl={class:"form-label"},El=["onUpdate:modelValue","placeholder"],Cl={class:"form-row"},Rl={class:"form-label"},Il=["onUpdate:modelValue","placeholder"],Al={class:"form-row"},xl={class:"form-label"},Dl={class:"model-selector"},Fl=["onUpdate:modelValue","disabled"],Ml={key:0,disabled:"",value:""},Ul={key:1,disabled:"",value:""},Nl={value:"",disabled:""},Ol={value:""},Ll=["value","title"],Bl=["title"],ql={key:0,class:"error-message"},jl={class:"form-row"},Vl={key:0,class:"empty-steps"},Hl={key:0,class:"json-preview"},Wl={class:"preview-header"},zl={class:"form-label"},Jl={class:"json-code"},Gl={class:"editor-footer"},Kl={class:"section-actions"},Xl=["disabled","title"],Yl=["disabled","title"],Ql=["disabled"],Zl=de({__name:"JsonEditorV2",props:{jsonContent:{},canRollback:{type:Boolean},canRestore:{type:Boolean},isGenerating:{type:Boolean},isExecuting:{type:Boolean},hiddenFields:{default:()=>[]},currentPlanTemplateId:{default:""}},emits:["rollback","restore","save","update:jsonContent"],setup(n,{emit:e}){const t=n,s=e,{showJsonPreview:a,displayData:l,formattedJsonOutput:i,addStep:p,removeStep:v,moveStepUp:d,moveStepDown:m,handleRollback:_,handleRestore:I,handleSave:U,toggleJsonPreview:S,closeJsonPreview:$}=ls(t,s),y=M(null),u=M(""),T=M([]),w=M(!1),E=M(""),f=M(!1),q=M(-1),z=async()=>{if(!w.value){w.value=!0,E.value="";try{const b=await Ka.getAvailableModels();b&&b.options?T.value=b.options:T.value=[]}catch(b){console.error("Failed to load models:",b),E.value=b instanceof Error?b.message:"Failed to load models",T.value=[]}finally{w.value=!1}}},Z=b=>{q.value=b,f.value=!0,console.log("[JsonEditorV2] Available tools from store:",W.availableTools)},A=b=>{q.value>=0&&q.value<l.steps.length&&(l.steps[q.value].selectedToolKeys=[...b]),f.value=!1,q.value=-1},N=(b,R)=>{b>=0&&b<l.steps.length&&(l.steps[b].selectedToolKeys=[...R])},x=()=>{try{y.value=null,l.title||(l.title=""),l.steps||(l.steps=[]),l.directResponse=!1}catch(b){const R=`Failed to initialize JsonEditorV2: ${b instanceof Error?b.message:"Unknown error"}`;y.value=R,console.error(R,b)}};pe(()=>l,b=>{try{!b.title||!b.title.trim()?u.value="Title is required field":u.value="",y.value=null}catch(R){y.value=`Invalid data structure: ${R instanceof Error?R.message:"Unknown error"}`,u.value=""}},{immediate:!0,deep:!0}),Se(()=>{x(),z()});const H=b=>{const R=b.target;if(!R)return;R.style.height="auto";const J=20,K=Math.ceil(R.scrollHeight/J),F=4,D=12,X=Math.max(F,Math.min(D,K)),O=X*J;R.style.height=`${O}px`,R.rows=X,K>D?R.style.overflowY="auto":R.style.overflowY="hidden"};return(b,R)=>{var J;return h(),g("div",Xa,[o("div",Ya,[k(r(P),{icon:"carbon:code",width:"16"}),o("span",null,c(b.$t("sidebar.dynamicAgentPlan")),1)]),y.value?(h(),g("div",Qa,[o("div",Za,[k(r(P),{icon:"carbon:warning",width:"16"}),o("div",el,[o("div",tl,c(b.$t("sidebar.planTypeError")),1),o("div",sl,c(y.value),1)])])])):(h(),g("div",ol,[o("div",nl,[o("div",al,[o("label",ll,c(b.$t("sidebar.title")),1),te(o("input",{"onUpdate:modelValue":R[0]||(R[0]=K=>r(l).title=K),type:"text",class:se(["form-input",{error:u.value}]),placeholder:b.$t("sidebar.titlePlaceholder")},null,10,rl),[[le,r(l).title]]),u.value?(h(),g("div",il,[k(r(P),{icon:"carbon:warning",width:"12"}),ee(" "+c(u.value),1)])):B("",!0)]),o("div",cl,[o("label",dl,c(b.$t("sidebar.planTemplateId")),1),o("input",{value:b.currentPlanTemplateId,type:"text",class:"form-input readonly-input",readonly:"",placeholder:b.$t("sidebar.planTemplateIdPlaceholder")},null,8,ul)])]),o("div",pl,[o("div",ml,[o("label",hl,c(b.$t("sidebar.tasks")),1),o("div",fl,[o("button",{onClick:R[1]||(R[1]=(...K)=>r(p)&&r(p)(...K)),class:"btn btn-xs",title:b.$t("sidebar.addStep")},[k(r(P),{icon:"carbon:add",width:"12"})],8,vl)])]),o("div",gl,[(h(!0),g(ne,null,ae(r(l).steps,(K,F)=>(h(),g("div",{key:F,class:"step-item"},[o("div",bl,[o("span",yl,c(b.$t("sidebar.subtask"))+" "+c(F+1),1),o("div",_l,[o("button",{onClick:D=>r(d)(F),disabled:F===0,class:"btn btn-xs",title:b.$t("sidebar.moveUp")},[k(r(P),{icon:"carbon:chevron-up",width:"12"})],8,Sl),o("button",{onClick:D=>r(m)(F),disabled:F===r(l).steps.length-1,class:"btn btn-xs",title:b.$t("sidebar.moveDown")},[k(r(P),{icon:"carbon:chevron-down",width:"12"})],8,$l),o("button",{onClick:D=>r(v)(F),class:"btn btn-xs btn-danger",title:b.$t("sidebar.removeStep")},[k(r(P),{icon:"carbon:trash-can",width:"12"})],8,wl)])]),o("div",kl,[o("div",Tl,[o("label",Pl,c(b.$t("sidebar.stepRequirement")),1),te(o("textarea",{"onUpdate:modelValue":D=>K.stepRequirement=D,class:"form-textarea auto-resize",placeholder:b.$t("sidebar.stepRequirementPlaceholder"),rows:"4",onInput:R[2]||(R[2]=D=>H(D))},null,40,El),[[le,K.stepRequirement]])]),o("div",Cl,[o("label",Rl,c(b.$t("sidebar.terminateColumns")),1),te(o("textarea",{"onUpdate:modelValue":D=>K.terminateColumns=D,class:"form-textarea auto-resize",placeholder:b.$t("sidebar.terminateColumnsPlaceholder"),rows:"4",onInput:R[3]||(R[3]=D=>H(D))},null,40,Il),[[le,K.terminateColumns]])]),o("div",Al,[o("label",xl,c(b.$t("sidebar.modelName")),1),o("div",Dl,[te(o("select",{"onUpdate:modelValue":D=>K.modelName=D,class:"form-select model-select",disabled:w.value},[w.value?(h(),g("option",Ml,c(b.$t("sidebar.loading")),1)):E.value?(h(),g("option",Ul,c(b.$t("sidebar.modelLoadError")),1)):B("",!0),o("option",Nl,c(b.$t("sidebar.modelNameDescription")),1),o("option",Ol,c(b.$t("sidebar.noModelSelected")),1),(h(!0),g(ne,null,ae(T.value,D=>(h(),g("option",{key:D.value,value:D.value,title:D.label},c(D.label),9,Ll))),128))],8,Fl),[[ut,K.modelName]]),E.value?(h(),g("button",{key:0,onClick:z,class:"btn btn-sm btn-danger",title:b.$t("sidebar.retryLoadModels")},[k(r(P),{icon:"carbon:warning",width:"14"}),ee(" "+c(b.$t("sidebar.retry")),1)],8,Bl)):B("",!0)]),E.value?(h(),g("div",ql,[k(r(P),{icon:"carbon:warning",width:"12"}),ee(" "+c(E.value),1)])):B("",!0)]),o("div",jl,[k(js,{title:b.$t("sidebar.selectedTools"),"selected-tool-ids":K.selectedToolKeys,"available-tools":r(W).availableTools,"add-button-text":b.$t("sidebar.addRemoveTools"),"empty-text":b.$t("sidebar.noTools"),"use-grid-layout":!0,onAddTools:D=>Z(F),onToolsFiltered:D=>N(F,D)},null,8,["title","selected-tool-ids","available-tools","add-button-text","empty-text","onAddTools","onToolsFiltered"])])])]))),128)),r(l).steps.length===0?(h(),g("div",Vl,[k(r(P),{icon:"carbon:add-alt",width:"32",class:"empty-icon"}),o("p",null,c(b.$t("sidebar.noSteps")),1),o("button",{onClick:R[4]||(R[4]=(...K)=>r(p)&&r(p)(...K)),class:"btn btn-primary"},[k(r(P),{icon:"carbon:add",width:"14"}),ee(" "+c(b.$t("sidebar.addFirstStep")),1)])])):B("",!0)])]),r(a)?(h(),g("div",Hl,[o("div",Wl,[o("label",zl,c(b.$t("sidebar.jsonPreview")),1),o("button",{onClick:R[5]||(R[5]=(...K)=>r($)&&r($)(...K)),class:"btn btn-xs"},[k(r(P),{icon:"carbon:close",width:"12"})])]),o("pre",Jl,c(r(i)),1)])):B("",!0),o("div",Gl,[o("button",{onClick:R[6]||(R[6]=(...K)=>r(S)&&r(S)(...K)),class:"btn btn-sm btn-secondary"},[k(r(P),{icon:"carbon:code",width:"14"}),ee(" "+c(r(a)?b.$t("sidebar.hideJson"):b.$t("sidebar.showJson")),1)]),o("div",Kl,[o("button",{class:"btn btn-sm",onClick:R[7]||(R[7]=(...K)=>r(_)&&r(_)(...K)),disabled:!(b.canRollback??!1),title:b.$t("sidebar.rollback")},[k(r(P),{icon:"carbon:undo",width:"14"})],8,Xl),o("button",{class:"btn btn-sm",onClick:R[8]||(R[8]=(...K)=>r(I)&&r(I)(...K)),disabled:!(b.canRestore??!1),title:b.$t("sidebar.restore")},[k(r(P),{icon:"carbon:redo",width:"14"})],8,Yl),o("button",{class:"btn btn-primary",onClick:R[9]||(R[9]=(...K)=>r(U)&&r(U)(...K)),disabled:b.isGenerating||b.isExecuting},[k(r(P),{icon:"carbon:save",width:"14"}),R[11]||(R[11]=ee(" Save "))],8,Ql)])])])),k(Vs,{modelValue:f.value,"onUpdate:modelValue":R[10]||(R[10]=K=>f.value=K),tools:r(W).availableTools,"selected-tool-ids":q.value>=0?((J=r(l).steps[q.value])==null?void 0:J.selectedToolKeys)||[]:[],onConfirm:A},null,8,["modelValue","tools","selected-tool-ids"])])}}}),er=ue(Zl,[["__scopeId","data-v-575f3fe3"]]);class Zt{static async uploadFiles(e){try{console.log("[FileUploadApiService] Uploading files:",e.length);const t=new FormData;e.forEach(l=>{t.append("files",l)});const s=await fetch("/api/file-upload/upload",{method:"POST",body:t});if(!s.ok)throw new Error(`HTTP error! status: ${s.status}`);const a=await s.json();return console.log("[FileUploadApiService] Files uploaded successfully:",a.successfulFiles,"uploadKey:",a.uploadKey),a}catch(t){throw console.error("[FileUploadApiService] Error uploading files:",t),t}}static async getUploadedFiles(e){try{console.log("[FileUploadApiService] Getting uploaded files for uploadKey:",e);const t=await fetch(`/api/file-upload/files/${encodeURIComponent(e)}`);if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const s=await t.json();return console.log("[FileUploadApiService] Got uploaded files:",s.totalCount,"for uploadKey:",e),s}catch(t){throw console.error("[FileUploadApiService] Error getting uploaded files:",t),t}}static async deleteFile(e,t){try{console.log("[FileUploadApiService] Deleting file:",t,"from uploadKey:",e);const s=await fetch(`/api/file-upload/files/${encodeURIComponent(e)}/${encodeURIComponent(t)}`,{method:"DELETE",headers:{"Content-Type":"application/json"}});if(!s.ok)throw new Error(`HTTP error! status: ${s.status}`);const a=await s.json();return console.log("[FileUploadApiService] File deleted successfully:",a.success),a}catch(s){throw console.error("[FileUploadApiService] Error deleting file:",s),s}}static async getUploadConfig(){try{console.log("[FileUploadApiService] Getting upload configuration");const e=await fetch("/api/file-upload/config");if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);const t=await e.json();return console.log("[FileUploadApiService] Got upload configuration:",t),t}catch(e){throw console.error("[FileUploadApiService] Error getting upload configuration:",e),e}}}const tr={class:"file-upload-component"},sr=["accept"],or={key:0},nr={key:1},ar={key:0,class:"files-list"},lr={class:"file-name"},rr={class:"file-size"},ir=["onClick","title"],cr={key:0,class:"upload-progress"},dr=de({__name:"FileUploadComponent",props:{acceptedFileTypes:{default:".pdf,.txt,.md,.doc,.docx,.csv,.xlsx,.xls,.json,.xml,.html,.htm,.log,.java,.py,.js,.ts,.sql,.sh,.bat,.yaml,.yml,.properties,.conf,.ini,.jpg,.jpeg,.png,.gif"},disabled:{type:Boolean,default:!1}},emits:["files-uploaded","files-removed","upload-key-changed","upload-started","upload-completed","upload-error"],setup(n,{expose:e,emit:t}){const{t:s}=$e(),a=n,l=t,i=M(),p=M([]),v=M(!1),d=M(null),m=()=>{console.log("[FileUpload] Resetting session and clearing uploadKey"),p.value=[],d.value=null,l("upload-key-changed",null)};_e(()=>{m()}),pe(()=>p.value,y=>{l("files-removed",y)},{deep:!0});const _=()=>{a.disabled||i.value&&i.value.click()},I=async y=>{const u=y.target,T=u.files;if(!T||T.length===0)return;const w=Array.from(T);console.log("[FileUpload] Selected files for upload:",w.map(E=>E.name)),await U(w),u&&(u.value="")},U=async y=>{if(y.length!==0){v.value=!0,l("upload-started");try{const u=await Zt.uploadFiles(y);u.success&&u.uploadedFiles&&(!d.value&&u.uploadKey?(d.value=u.uploadKey,console.log("[FileUpload] Set uploadKey:",d.value),p.value=u.uploadedFiles):d.value?(console.log("[FileUpload] Using existing uploadKey:",d.value),p.value=[...p.value,...u.uploadedFiles]):(console.warn("[FileUpload] No uploadKey returned from upload"),p.value=u.uploadedFiles),u.uploadKey&&(d.value=u.uploadKey,console.log("[Input] Saved uploadKey locally:",u.uploadKey),l("upload-key-changed",d.value)),console.log("[Input] Updated global uploadedFiles state:",p.value),l("files-uploaded",p.value,d.value)),console.log("Files uploaded successfully:",u),l("upload-completed")}catch(u){console.error("File upload error:",u),l("upload-error",u)}finally{v.value=!1}}},S=async y=>{try{if(console.log("🗑️ Removing file:",y.originalName,"from uploadKey:",d),d.value){const u=await Zt.deleteFile(d.value,y.originalName);u.success?console.log("✅ File deleted from server successfully"):console.error("❌ Failed to delete file from server:",u.error)}p.value=p.value.filter(u=>u.originalName!==y.originalName),p.value.length===0&&(console.log("[FileUpload] 🧹 Clearing uploadKey to force new plan for new files"),d.value=null,l("upload-key-changed",null)),console.log("🎉 File removal completed, remaining files:",p.value.length)}catch(u){console.error("❌ Error removing file:",u),l("upload-error",u)}},$=y=>{if(y===0)return"0 Bytes";const u=1024,T=["Bytes","KB","MB","GB"],w=Math.floor(Math.log(y)/Math.log(u));return parseFloat((y/Math.pow(u,w)).toFixed(2))+" "+T[w]};return e({uploadedFiles:p,uploadKey:d,resetSession:m,uploadFiles:U,removeFile:S,isUploading:v}),(y,u)=>(h(),g("div",tr,[o("input",{ref_key:"fileInputRef",ref:i,type:"file",multiple:"",style:{display:"none"},onChange:I,accept:y.acceptedFileTypes||""},null,40,sr),o("div",{class:se(["uploaded-files",{"has-files":p.value.length>0}])},[o("div",{class:"files-header",onClick:_},[k(r(P),{icon:"carbon:attachment"}),p.value.length===0?(h(),g("span",or,c(r(s)("input.attachFile")),1)):(h(),g("span",nr,c(r(s)("input.attachedFiles"))+" ("+c(p.value.length)+")",1))]),p.value.length>0?(h(),g("div",ar,[(h(!0),g(ne,null,ae(p.value,T=>(h(),g("div",{key:T.originalName,class:"file-item"},[k(r(P),{icon:"carbon:document",class:"file-icon"}),o("span",lr,c(T.originalName),1),o("span",rr,"("+c($(T.size))+")",1),o("button",{onClick:w=>S(T),class:"remove-btn",title:r(s)("input.removeFile")},[k(r(P),{icon:"carbon:close"})],8,ir)]))),128))])):B("",!0)],2),v.value?(h(),g("div",cr,[k(r(P),{icon:"carbon:rotate--clockwise",class:"loading-icon"}),o("span",null,c(r(s)("input.uploading")),1)])):B("",!0)]))}}),xs=ue(dr,[["__scopeId","data-v-608b06f9"]]),ur={class:"config-section"},pr={class:"section-header"},mr={class:"execution-content"},hr={class:"params-requirements-group"},fr={class:"params-help-text"},vr={key:0,class:"parameter-fields"},gr={class:"parameter-label"},br=["onUpdate:modelValue","placeholder","onInput"],yr={key:0,class:"parameter-error"},_r={key:1,class:"validation-message"},Sr=["disabled"],$r=["disabled"],wr={key:1,class:"call-example-wrapper"},kr={class:"call-example-header"},Tr={class:"call-example-title"},Pr={class:"call-example-description"},Er={class:"internal-call-wrapper"},Cr={class:"call-info"},Rr={class:"call-method"},Ir={class:"call-endpoint"},Ar={key:0,class:"call-endpoint"},xr={class:"call-description"},Dr={class:"call-example"},Fr={class:"example-code"},Mr={key:2,class:"call-example-wrapper"},Ur={class:"call-example-header"},Nr={class:"call-example-title"},Or={class:"call-example-description"},Lr={class:"http-api-urls-wrapper"},Br={class:"tab-container"},qr={class:"tab-header"},jr=["onClick"],Vr={class:"tab-content"},Hr={class:"http-api-url-display"},Wr={class:"api-method"},zr={class:"api-endpoint"},Jr={class:"api-description"},Gr={key:0,class:"api-example"},Kr={class:"example-code"},Xr={key:3,class:"call-example-wrapper"},Yr={class:"call-example-header"},Qr={class:"call-example-title"},Zr={class:"call-example-description"},ei={class:"mcp-call-wrapper"},ti={class:"call-info"},si={class:"call-method"},oi={class:"call-endpoint"},ni={class:"call-description"},ai={class:"call-example"},li={class:"example-code"},ri=de({__name:"ExecutionController",props:{currentPlanTemplateId:{default:""},isExecuting:{type:Boolean,default:!1},isGenerating:{type:Boolean,default:!1},showPublishButton:{type:Boolean,default:!0},toolInfo:{default:()=>({toolName:"",toolDescription:"",planTemplateId:"",inputSchema:"[]",enableHttpService:!1,enableMcpService:!1,enableInternalToolcall:!1,serviceGroup:""})}},emits:["executePlan","publishMcpService","clearParams","updateExecutionParams"],setup(n,{expose:e,emit:t}){const{t:s}=$e(),a=n,l=t,i=M(""),p=M({parameters:[],hasParameters:!1,requirements:""}),v=M({}),d=M(!1),m=M("get-sync"),_=M({}),I=M(!1),U=M(!1),S=M(),$=M([]),y=M(null),u=M([{id:"get-sync",label:"GET + Sync",method:"GET",endpoint:"/api/executor/executeByToolNameSync/{toolName}",description:"Synchronous GET request - returns execution result immediately",example:`GET /api/executor/executeByToolNameSync/my-tool?allParams={"rawParam":"test"}
Response: {
  "status": "completed",
  "result": "Execution result here"
}`},{id:"post-sync",label:"POST + Sync",method:"POST",endpoint:"/api/executor/executeByToolNameSync",description:"Synchronous POST request - returns execution result immediately",example:`POST /api/executor/executeByToolNameSync
Content-Type: application/json

{
  "toolName": "my-tool",
  "replacementParams": {
    "rawParam": "test"
  },
  "uploadedFiles": []
}

Response: {
  "status": "completed",
  "result": "Execution result here"
}`},{id:"post-async",label:"POST + Async",method:"POST",endpoint:"/api/executor/executeByToolNameAsync",description:"Asynchronous POST request - returns task ID, check status separately",example:`POST /api/executor/executeByToolNameAsync
Content-Type: application/json

{
  "toolName": "my-tool",
  "replacementParams": {
    "rawParam": "test"
  },
  "uploadedFiles": []
}

Response: {
  "planId": "plan-123",
  "status": "processing",
  "message": "Task submitted, processing",
  "memoryId": "ABC12345",
  "toolName": "my-tool",
  "planTemplateId": "template-456"
}

# Check execution status and get detailed results:
GET /api/executor/details/{planId}
Response: {
  "currentPlanId": "plan-123",
  "title": "Plan Title",
  "status": "completed",
  "summary": "Execution completed successfully",
  "agentExecutionSequence": [...],
  "userInputWaitState": null
}`}]),T=ce(()=>{var D,X,O;return((D=a.toolInfo)==null?void 0:D.enableInternalToolcall)||((X=a.toolInfo)==null?void 0:X.enableHttpService)||((O=a.toolInfo)==null?void 0:O.enableMcpService)}),w=ce(()=>T.value?s("sidebar.updateServiceStatus"):s("sidebar.publishMcpService")),E=ce(()=>a.isExecuting||a.isGenerating?!1:p.value.hasParameters?p.value.parameters.every(D=>{var X;return(X=v.value[D])==null?void 0:X.trim()}):!0),f=(D,X)=>{$.value=D.map(O=>O.originalName),y.value=X,console.log("[ExecutionController] Files uploaded:",D.length,"uploadKey:",X)},q=D=>{$.value=D.map(X=>X.originalName),console.log("[ExecutionController] Files removed, remaining:",D.length)},z=D=>{y.value=D,console.log("[ExecutionController] Upload key changed:",D)},Z=()=>{console.log("[ExecutionController] Upload started")},A=()=>{console.log("[ExecutionController] Upload completed")},N=D=>{console.error("[ExecutionController] Upload error:",D)},x=()=>{if(console.log("[ExecutionController] 🚀 Execute button clicked"),U.value=!0,console.log("[ExecutionController] 🔒 Set isExecutingPlan to true"),!K()){console.log("[ExecutionController] ❌ Parameter validation failed:",_.value),U.value=!1;return}const D=p.value.hasParameters&&Object.keys(v.value).length>0?v.value:void 0;console.log("[ExecutionController] 🔄 Replacement params:",D);const X={title:"",planData:{title:"",steps:[],directResponse:!1},params:void 0,replacementParams:D,uploadedFiles:$.value,uploadKey:y.value};console.log("[ExecutionController] 📤 Emitting executePlan with payload:",JSON.stringify(X,null,2)),l("executePlan",X)},H=()=>{l("publishMcpService")},b=()=>{console.log("[ExecutionController] 🧹 clearExecutionParams called"),i.value="",v.value={},U.value=!1,console.log("[ExecutionController] 🔓 Reset isExecutingPlan to false"),console.log("[ExecutionController] ✅ After clear - parameterValues cleared"),l("clearParams")},R=async()=>{if(console.log("[ExecutionController] 🔄 loadParameterRequirements called for templateId:",a.currentPlanTemplateId),console.log("[ExecutionController] 📊 Current parameterRequirements before load:",JSON.stringify(p.value,null,2)),!a.currentPlanTemplateId){console.log("[ExecutionController] ❌ No template ID, resetting parameters"),p.value={parameters:[],hasParameters:!1,requirements:""},v.value={};return}d.value=!0;try{console.log("[ExecutionController] 🌐 Fetching parameter requirements from API...");const D=await Dt.getParameterRequirements(a.currentPlanTemplateId);console.log("[ExecutionController] 📥 Received requirements from API:",JSON.stringify(D,null,2)),p.value=D;const X={};D.parameters.forEach(O=>{X[O]=v.value[O]||""}),v.value=X,console.log("[ExecutionController] ✅ Updated parameterRequirements:",JSON.stringify(p.value,null,2)),console.log("[ExecutionController] ✅ Updated parameterValues:",JSON.stringify(v.value,null,2)),F()}catch(D){console.error("[ExecutionController] ❌ Failed to load parameter requirements:",D),D instanceof Error&&!D.message.includes("404")&&console.warn("[ExecutionController] ⚠️ Parameter requirements not available yet, will retry later"),p.value={parameters:[],hasParameters:!1,requirements:""},console.log("[ExecutionController] 🔄 Reset parameterRequirements due to error:",JSON.stringify(p.value,null,2))}finally{d.value=!1,console.log("[ExecutionController] ✅ loadParameterRequirements completed")}},J=(D,X)=>{v.value[D]=X,_.value[D]&&delete _.value[D],F()},K=()=>{if(_.value={},I.value=!1,!p.value.hasParameters)return!0;let D=!1;return p.value.parameters.forEach(X=>{var V;((V=v.value[X])==null?void 0:V.trim())||(_.value[X]=`${X} is required`,D=!0)}),I.value=D,!D},F=()=>{p.value.hasParameters?i.value=JSON.stringify(v.value,null,2):i.value="",l("updateExecutionParams",i.value)};return pe(()=>a.currentPlanTemplateId,(D,X)=>{if(D&&D!==X){if(U.value){console.log("[ExecutionController] ⏸️ Skipping parameter reload - plan is executing");return}console.log("[ExecutionController] 🔄 Template ID changed, will reload parameters"),X&&D.startsWith("planTemplate-")?(console.log("[ExecutionController] ⏰ New template detected, retrying with delay..."),setTimeout(()=>{console.log("[ExecutionController] ⏰ Delay timeout, calling loadParameterRequirements"),R()},1e3)):(console.log("[ExecutionController] 🚀 Immediate reload of parameters"),R())}}),pe(()=>i.value,D=>{l("updateExecutionParams",D)}),Se(()=>{R()}),e({executionParams:i,clearExecutionParams:b,loadParameterRequirements:R,fileUploadRef:S,uploadedFiles:$,uploadKey:y}),(D,X)=>{var O,V,Y,L,j;return h(),g("div",ur,[o("div",pr,[k(r(P),{icon:"carbon:play",width:"16"}),o("span",null,c(r(s)("sidebar.executionController")),1)]),o("div",mr,[o("div",hr,[o("label",null,c(r(s)("sidebar.parameterRequirements")),1),o("div",fr,c(r(s)("sidebar.parameterRequirementsHelp")),1),p.value.hasParameters?(h(),g("div",vr,[(h(!0),g(ne,null,ae(p.value.parameters,G=>(h(),g("div",{key:G,class:"parameter-field"},[o("label",gr,[ee(c(G)+" ",1),X[0]||(X[0]=o("span",{class:"required"},"*",-1))]),te(o("input",{"onUpdate:modelValue":re=>v.value[G]=re,class:se(["parameter-input",{error:_.value[G]}]),placeholder:r(s)("sidebar.enterValueFor",{param:G}),onInput:re=>J(G,re.target.value),required:""},null,42,br),[[le,v.value[G]]]),_.value[G]?(h(),g("div",yr,c(_.value[G]),1)):B("",!0)]))),128))])):B("",!0),p.value.hasParameters&&!E.value&&!a.isExecuting&&!a.isGenerating?(h(),g("div",_r,[k(r(P),{icon:"carbon:warning",width:"14"}),ee(" "+c(r(s)("sidebar.fillAllRequiredParameters")),1)])):B("",!0)]),k(xs,{ref_key:"fileUploadRef",ref:S,disabled:a.isExecuting||a.isGenerating,onFilesUploaded:f,onFilesRemoved:q,onUploadKeyChanged:z,onUploadStarted:Z,onUploadCompleted:A,onUploadError:N},null,8,["disabled"]),o("button",{class:"btn btn-primary execute-btn",onClick:x,disabled:!E.value},[k(r(P),{icon:a.isExecuting?"carbon:circle-dash":"carbon:play",width:"16",class:se({spinning:a.isExecuting})},null,8,["icon","class"]),ee(" "+c(a.isExecuting?r(s)("sidebar.executing"):r(s)("sidebar.executePlan")),1)],8,Sr),D.showPublishButton?(h(),g("button",{key:0,class:"btn publish-mcp-btn",onClick:H,disabled:!D.currentPlanTemplateId},[k(r(P),{icon:"carbon:application",width:"16"}),ee(" "+c(w.value),1)],8,$r)):B("",!0),(O=D.toolInfo)!=null&&O.enableInternalToolcall?(h(),g("div",wr,[o("div",kr,[o("h4",Tr,c(r(s)("sidebar.internalCall")),1),o("p",Pr,c(r(s)("sidebar.internalCallDescription")),1)]),o("div",Er,[o("div",Cr,[o("div",Rr,c(r(s)("sidebar.internalMethodCall")),1),o("div",Ir,c(r(s)("sidebar.toolName"))+": "+c(((V=D.toolInfo)==null?void 0:V.toolName)||D.currentPlanTemplateId),1),(Y=D.toolInfo)!=null&&Y.serviceGroup?(h(),g("div",Ar,c(r(s)("sidebar.serviceGroup"))+": "+c(D.toolInfo.serviceGroup),1)):B("",!0),o("div",xr,c(r(s)("sidebar.internalCallUsage")),1),o("div",Dr,[o("strong",null,c(r(s)("sidebar.usage"))+":",1),o("pre",Fr,c(r(s)("sidebar.internalCallExample")),1)])])])])):B("",!0),(L=D.toolInfo)!=null&&L.enableHttpService?(h(),g("div",Mr,[o("div",Ur,[o("h4",Nr,c(r(s)("sidebar.httpCallExample")),1),o("p",Or,c(r(s)("sidebar.httpCallDescription")),1)]),o("div",Lr,[o("div",Br,[o("div",qr,[(h(!0),g(ne,null,ae(u.value,G=>(h(),g("button",{key:G.id,class:se(["tab-button",{active:m.value===G.id}]),onClick:re=>m.value=G.id},c(G.label),11,jr))),128))]),o("div",Vr,[(h(!0),g(ne,null,ae(u.value,G=>te((h(),g("div",{key:G.id,class:"tab-panel"},[o("div",Hr,[o("div",Wr,c(G.method),1),o("div",zr,c(G.endpoint),1),o("div",Jr,c(G.description),1),G.example?(h(),g("div",Gr,[o("strong",null,c(r(s)("sidebar.example"))+":",1),o("pre",Kr,c(G.example),1)])):B("",!0)])])),[[es,m.value===G.id]])),128))])])])])):B("",!0),(j=D.toolInfo)!=null&&j.enableMcpService?(h(),g("div",Xr,[o("div",Yr,[o("h4",Qr,c(r(s)("sidebar.mcpCall")),1),o("p",Zr,c(r(s)("sidebar.mcpCallDescription")),1)]),o("div",ei,[o("div",ti,[o("div",si,c(r(s)("sidebar.mcpServiceCall")),1),o("div",oi,c(r(s)("sidebar.mcpEndpoint"))+": /mcp/execute",1),o("div",ni,c(r(s)("sidebar.mcpCallUsage")),1),o("div",ai,[o("strong",null,c(r(s)("sidebar.usage"))+":",1),o("pre",li,c(r(s)("sidebar.mcpCallExample")),1)])])])])):B("",!0)])])}}}),ii=ue(ri,[["__scopeId","data-v-29b1330b"]]),ci={class:"sidebar-content"},di={class:"sidebar-content-header"},ui={class:"sidebar-content-title"},pi={class:"tab-switcher"},mi=["disabled"],hi={key:0,class:"tab-content"},fi={class:"new-task-section"},vi={class:"sidebar-content-list"},gi={key:0,class:"loading-state"},bi={key:1,class:"error-state"},yi={key:2,class:"empty-state"},_i=["onClick"],Si={class:"task-icon"},$i={class:"task-details"},wi={class:"task-title"},ki={class:"task-preview"},Ti={class:"task-time"},Pi={class:"task-actions"},Ei=["title","onClick"],Ci={key:1,class:"tab-content config-tab"},Ri={key:0,class:"config-container"},Ii={class:"template-info-header"},Ai={class:"template-info"},xi={class:"template-id"},Di=["title"],Fi=de({__name:"Sidebar",emits:["planExecutionRequested"],setup(n,{expose:e,emit:t}){const{t:s}=$e(),a=as(),l=M(80),i=M(!1),p=M(0),v=M(0),d=M(null),m=M({toolName:"",toolDescription:"",planTemplateId:"",inputSchema:"[]",enableHttpService:!1,enableMcpService:!1,enableInternalToolcall:!1,serviceGroup:""}),_=M(null),I=M({enabled:!0,success:!0}),U=ce(()=>I.value.enabled),S=async()=>{try{const F=await Ae.getCoordinatorToolConfig();I.value=F}catch(F){console.error("Failed to load CoordinatorTool configuration:",F),I.value={enabled:!0,success:!1,message:F instanceof Error?F.message:"Unknown error"}}},$=t,y=async()=>{try{const F=await W.saveTemplate();F!=null&&F.duplicate?a.success(s("sidebar.saveCompleted",{message:F.message,versionCount:F.versionCount})):F!=null&&F.saved?(a.success(s("sidebar.saveSuccess",{message:F.message,versionCount:F.versionCount})),u()):F!=null&&F.message&&a.success(s("sidebar.saveStatus",{message:F.message}))}catch(F){console.error("Failed to save plan modifications:",F),a.error(F.message||s("sidebar.saveFailed"))}},u=async()=>{await new Promise(F=>setTimeout(F,1e3)),console.log("[Sidebar] 🔄 Refreshing parameter requirements for templateId:",W.currentPlanTemplateId),await ge(),d.value?(console.log("[Sidebar] 📞 Calling ExecutionController.loadParameterRequirements()"),d.value.loadParameterRequirements(),setTimeout(()=>{d.value&&(console.log("[Sidebar] 🔄 Retry: Calling ExecutionController.loadParameterRequirements() again"),d.value.loadParameterRequirements())},2e3)):console.warn("[Sidebar] ⚠️ ExecutionController ref not available"),_.value?(console.log("[Sidebar] 📞 Calling PublishMcpServiceModal.loadParameterRequirements()"),_.value.loadParameterRequirements()):console.warn("[Sidebar] ⚠️ PublishMcpServiceModal ref not available")},T=()=>{try{W&&typeof W.rollbackVersion=="function"?W.rollbackVersion():console.warn("sidebarStore or rollbackVersion method is not available")}catch(F){console.error("Error during rollback operation:",F),a.error(s("sidebar.rollbackFailed")||"Rollback failed")}},w=()=>{try{W&&typeof W.restoreVersion=="function"?W.restoreVersion():console.warn("sidebarStore or restoreVersion method is not available")}catch(F){console.error("Error during restore operation:",F),a.error(s("sidebar.restoreFailed")||"Restore failed")}},E=async F=>{var D,X;console.log("[Sidebar] 🎯 handleExecutePlan called with payload:",JSON.stringify(F,null,2)),console.log("[Sidebar] 📊 Current sidebarStore state:",{currentPlanTemplateId:W.currentPlanTemplateId,selectedTemplate:(D=W.selectedTemplate)==null?void 0:D.id,jsonContent:((X=W.jsonContent)==null?void 0:X.substring(0,100))+"..."});try{const O=W.preparePlanExecution();if(console.log("[Sidebar] 📋 Prepared plan data:",JSON.stringify(O,null,2)),!O){console.log("[Sidebar] ❌ No plan data available, returning");return}const V={...O,uploadedFiles:F.uploadedFiles,uploadKey:F.uploadKey};F.replacementParams&&Object.keys(F.replacementParams).length>0&&(console.log("[Sidebar] 🔄 Processing replacement parameters:",F.replacementParams),V.replacementParams=F.replacementParams),console.log("[Sidebar] ✅ Final plan data:",JSON.stringify(V,null,2));const Y={...F,title:V.title,planData:V.planData,params:V.params,uploadedFiles:V.uploadedFiles,uploadKey:V.uploadKey};console.log("[Sidebar] 📤 Emitting planExecutionRequested with final payload:",JSON.stringify(Y,null,2)),$("planExecutionRequested",Y),console.log("[Sidebar] ✅ Event emitted successfully")}catch(O){console.error("[Sidebar] ❌ Error executing plan:",O),a.error(s("sidebar.executeFailed")+": "+O.message)}finally{console.log("[Sidebar] 🧹 Cleaning up after execution"),W.finishPlanExecution(),W.clearExecutionParams(),d.value&&(console.log("[Sidebar] 🧹 Calling ExecutionController.clearExecutionParams"),d.value.clearExecutionParams()),console.log("[Sidebar] ✅ Cleanup completed")}},f=M(!1),q=()=>{if(console.log("[Sidebar] Publish MCP service button clicked"),console.log("[Sidebar] currentPlanTemplateId:",W.currentPlanTemplateId),!W.currentPlanTemplateId){console.log("[Sidebar] No plan template selected, showing warning"),a.error(s("mcpService.selectPlanTemplateFirst"));return}console.log("[Sidebar] Opening publish MCP service modal"),f.value=!0},z=async F=>{F===null?(console.log("MCP service deleted successfully"),a.success(s("mcpService.deleteSuccess")),m.value={toolName:"",toolDescription:"",planTemplateId:"",inputSchema:"[]",enableHttpService:!1,enableMcpService:!1,enableInternalToolcall:!1,serviceGroup:""}):(console.log("MCP service published successfully:",F),a.success(s("mcpService.publishSuccess")),m.value={...F,toolName:F.toolName||"",serviceGroup:F.serviceGroup||""}),console.log("[Sidebar] 🔄 Reloading available tools after service publish/delete"),await W.loadAvailableTools()},Z=()=>{W.clearExecutionParams()},A=F=>{W.executionParams=F},N=async F=>{if(!F){m.value={toolName:"",toolDescription:"",planTemplateId:"",inputSchema:"[]",enableHttpService:!1,enableMcpService:!1,enableInternalToolcall:!1,serviceGroup:""};return}try{const D=await Ae.getCoordinatorToolsByTemplate(F);D?m.value={...D,toolName:D.toolName||"",serviceGroup:D.serviceGroup||""}:m.value={toolName:"",toolDescription:"",planTemplateId:F,inputSchema:"[]",enableHttpService:!1,enableMcpService:!1,enableInternalToolcall:!1,serviceGroup:""}}catch(D){console.error("Failed to load tool information:",D),m.value={toolName:"",toolDescription:"",planTemplateId:F,inputSchema:"[]",enableHttpService:!1,enableMcpService:!1,enableInternalToolcall:!1,serviceGroup:""}}},x=F=>{if(isNaN(F.getTime()))return console.warn("Invalid date received:",F),s("time.unknown");const X=new Date().getTime()-F.getTime(),O=Math.floor(X/6e4),V=Math.floor(X/36e5),Y=Math.floor(X/864e5);return O<1?s("time.now"):O<60?s("time.minuteAgo",{count:O}):V<24?s("time.hourAgo",{count:V}):Y<30?s("time.dayAgo",{count:Y}):F.toLocaleDateString("zh-CN")},H=(F,D)=>!F||F.length<=D?F:F.substring(0,D)+"...",b=F=>{i.value=!0,p.value=F.clientX,v.value=l.value,document.addEventListener("mousemove",R),document.addEventListener("mouseup",J),document.body.style.cursor="col-resize",document.body.style.userSelect="none",F.preventDefault()},R=F=>{if(!i.value)return;const D=window.innerWidth,O=(F.clientX-p.value)/D*100;let V=v.value+O;V=Math.max(15,Math.min(100,V)),l.value=V},J=()=>{i.value=!1,document.removeEventListener("mousemove",R),document.removeEventListener("mouseup",J),document.body.style.cursor="",document.body.style.userSelect="",localStorage.setItem("sidebarWidth",l.value.toString())},K=()=>{l.value=80,localStorage.setItem("sidebarWidth","80")};return pe(()=>W.currentPlanTemplateId,F=>{N(F)},{immediate:!0}),Se(()=>{W.loadPlanTemplateList(),S(),W.loadAvailableTools();const F=localStorage.getItem("sidebarWidth");F&&(l.value=parseFloat(F))}),_e(()=>{document.removeEventListener("mousemove",R),document.removeEventListener("mouseup",J)}),e({loadPlanTemplateList:W.loadPlanTemplateList,toggleSidebar:W.toggleSidebar,currentPlanTemplateId:W.currentPlanTemplateId}),(F,D)=>{var X,O;return h(),g(ne,null,[o("div",{class:se(["sidebar-wrapper",{"sidebar-wrapper-collapsed":r(W).isCollapsed}]),style:qe({width:l.value+"%"})},[o("div",ci,[o("div",di,[o("div",ui,c(F.$t("sidebar.title")),1)]),o("div",pi,[o("button",{class:se(["tab-button",{active:r(W).currentTab==="list"}]),onClick:D[0]||(D[0]=V=>r(W).switchToTab("list"))},[k(r(P),{icon:"carbon:list",width:"16"}),ee(" "+c(F.$t("sidebar.templateList")),1)],2),o("button",{class:se(["tab-button",{active:r(W).currentTab==="config"}]),onClick:D[1]||(D[1]=V=>r(W).switchToTab("config")),disabled:!r(W).selectedTemplate},[k(r(P),{icon:"carbon:settings",width:"16"}),ee(" "+c(F.$t("sidebar.configuration")),1)],10,mi)]),r(W).currentTab==="list"?(h(),g("div",hi,[o("div",fi,[o("button",{class:"new-task-btn",onClick:D[2]||(D[2]=()=>r(W).createNewTemplate(r(W).planType))},[k(r(P),{icon:"carbon:add",width:"16"}),ee(" "+c(F.$t("sidebar.newPlan"))+" ",1),D[8]||(D[8]=o("span",{class:"shortcut"},"⌘ K",-1))])]),o("div",vi,[r(W).isLoading?(h(),g("div",gi,[k(r(P),{icon:"carbon:circle-dash",width:"20",class:"spinning"}),o("span",null,c(F.$t("sidebar.loading")),1)])):r(W).errorMessage?(h(),g("div",bi,[k(r(P),{icon:"carbon:warning",width:"20"}),o("span",null,c(r(W).errorMessage),1),o("button",{onClick:D[3]||(D[3]=(...V)=>r(W).loadPlanTemplateList&&r(W).loadPlanTemplateList(...V)),class:"retry-btn"},c(F.$t("sidebar.retry")),1)])):r(W).planTemplateList.length===0?(h(),g("div",yi,[k(r(P),{icon:"carbon:document",width:"32"}),o("span",null,c(F.$t("sidebar.noTemplates")),1)])):(h(!0),g(ne,{key:3},ae(r(W).sortedTemplates,V=>(h(),g("div",{key:V.id,class:se(["sidebar-content-list-item",{"sidebar-content-list-item-active":V.id===r(W).currentPlanTemplateId}]),onClick:Y=>r(W).selectTemplate(V)},[o("div",Si,[k(r(P),{icon:"carbon:document",width:"20"})]),o("div",$i,[o("div",wi,c(V.title||F.$t("sidebar.unnamedPlan")),1),o("div",ki,c(H(V.description||F.$t("sidebar.noDescription"),40)),1)]),o("div",Ti,c(x(r(W).parseDateTime(V.updateTime||V.createTime))),1),o("div",Pi,[o("button",{class:"delete-task-btn",title:F.$t("sidebar.deleteTemplate"),onClick:me(Y=>r(W).deleteTemplate(V),["stop"])},[k(r(P),{icon:"carbon:close",width:"16"})],8,Ei)])],10,_i))),128))])])):r(W).currentTab==="config"?(h(),g("div",Ci,[r(W).selectedTemplate?(h(),g("div",Ri,[o("div",Ii,[o("div",Ai,[o("h3",null,c(r(W).selectedTemplate.title||F.$t("sidebar.unnamedPlan")),1),o("span",xi,"ID: "+c(r(W).selectedTemplate.id),1)]),o("button",{class:"back-to-list-btn",onClick:D[4]||(D[4]=V=>r(W).switchToTab("list"))},[k(r(P),{icon:"carbon:arrow-left",width:"16"})])]),r(W).planType==="dynamic_agent"?(h(),oe(er,{key:0,"json-content":r(W).jsonContent,"can-rollback":r(W).canRollback,"can-restore":r(W).canRestore,"is-generating":r(W).isGenerating,"is-executing":r(W).isExecuting,"current-plan-template-id":r(W).currentPlanTemplateId||"",onRollback:T,onRestore:w,onSave:y,"onUpdate:jsonContent":D[5]||(D[5]=V=>r(W).jsonContent=V)},null,8,["json-content","can-rollback","can-restore","is-generating","is-executing","current-plan-template-id"])):(h(),oe(bn,{key:1,"json-content":r(W).jsonContent,"can-rollback":r(W).canRollback,"can-restore":r(W).canRestore,"is-generating":r(W).isGenerating,"is-executing":r(W).isExecuting,"current-plan-template-id":r(W).currentPlanTemplateId||"",onRollback:T,onRestore:w,onSave:y,"onUpdate:jsonContent":D[6]||(D[6]=V=>r(W).jsonContent=V)},null,8,["json-content","can-rollback","can-restore","is-generating","is-executing","current-plan-template-id"])),k(ii,{ref_key:"executionControllerRef",ref:d,"current-plan-template-id":r(W).currentPlanTemplateId||"","is-executing":r(W).isExecuting,"is-generating":r(W).isGenerating,"show-publish-button":U.value,"tool-info":m.value,onExecutePlan:E,onPublishMcpService:q,onClearParams:Z,onUpdateExecutionParams:A},null,8,["current-plan-template-id","is-executing","is-generating","show-publish-button","tool-info"])])):B("",!0)])):B("",!0)]),o("div",{class:"sidebar-resizer",onMousedown:b,onDblclick:K,title:F.$t("sidebar.resizeHint")},D[9]||(D[9]=[o("div",{class:"resizer-line"},null,-1)]),40,Di)],6),k(Po,{ref_key:"publishMcpModalRef",ref:_,modelValue:f.value,"onUpdate:modelValue":D[7]||(D[7]=V=>f.value=V),"plan-template-id":r(W).currentPlanTemplateId||"","plan-title":((X=r(W).selectedTemplate)==null?void 0:X.title)||"","plan-description":((O=r(W).selectedTemplate)==null?void 0:O.description)||"",onPublished:z},null,8,["modelValue","plan-template-id","plan-title","plan-description"])],64)}}}),Mi=ue(Fi,[["__scopeId","data-v-36d3da05"]]);class it{static async handleResponse(e){if(!e.ok)try{const t=await e.json();throw new Error(t.message||`API request failed: ${e.status}`)}catch{throw new Error(`API request failed: ${e.status} ${e.statusText}`)}return e}static async getMemories(){try{const e=await fetch(`${this.BASE_URL}`);return(await(await this.handleResponse(e)).json()).memories||[]}catch(e){throw console.error("Failed to get memory list:",e),e}}static async getMemory(e){try{const t=await fetch(`${this.BASE_URL}/single?conversationId=${e}`),a=await(await this.handleResponse(t)).json();if(!a.data)throw new Error("Memory not found");return a.data}catch(t){throw console.error("Failed to get memory:",t),t}}static async createMemory(e,t){try{const s=await fetch(`${this.BASE_URL}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({conversation_id:e,memory_name:t})}),l=await(await this.handleResponse(s)).json();if(!l.data)throw new Error("Failed to create memory");return l.data}catch(s){throw console.error("Failed to create memory:",s),s}}static async updateMemory(e,t){try{const s=await fetch(`${this.BASE_URL}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({conversation_id:e,memory_name:t})}),l=await(await this.handleResponse(s)).json();if(!l.data)throw new Error("Failed to update memory");return l.data}catch(s){throw console.error("Failed to update memory:",s),s}}static async deleteMemory(e){try{const t=await fetch(`${this.BASE_URL}/${e}`,{method:"DELETE"});await this.handleResponse(t)}catch(t){throw console.error("Failed to delete memory:",t),t}}static async generateConversationId(){try{const e=await fetch(`${this.BASE_URL}/generate-id`),s=await(await this.handleResponse(e)).json();if(!s.data)throw new Error("Failed to generate conversation ID");return s.data}catch(e){throw console.error("Failed to generate conversation ID:",e),e}}}fe(it,"BASE_URL","/api/memories");class Ui{constructor(){fe(this,"isCollapsed",!1);fe(this,"selectMemoryId","");fe(this,"loadMessages",()=>{});fe(this,"intervalId")}toggleSidebar(){this.isCollapsed=!this.isCollapsed,this.isCollapsed?(this.loadMessages(),this.intervalId=window.setInterval(()=>{this.loadMessages()},3e3)):clearInterval(this.intervalId)}selectMemory(e){this.toggleSidebar(),this.selectMemoryId=e}setMemory(e){this.selectMemoryId=e}defaultMemoryId(){this.selectMemoryId=this.generateRandomId()}clearMemoryId(){this.selectMemoryId=""}generateRandomId(){return Math.random().toString(36).substring(2,10)}setLoadMessages(e){this.loadMessages=e}}const xe=tt(new Ui),Ni={key:0,class:"app-container"},Oi={class:"app-content"},Li={class:"header"},Bi={class:"relative"},qi={class:"title-edit-group"},ji={id:"main-title",class:"main-title"},Vi={key:0,id:"title-edit-container",class:"title-edit-container"},Hi={class:"search-bar"},Wi={class:"search-container"},zi=["placeholder"],Ji={class:"message-list",id:"message-list"},Gi={class:"message-header"},Ki={class:"message-content"},Xi={class:"sender-info"},Yi=["onClick"],Qi={class:"sender-name"},Zi=["onClick"],ec={class:"action-buttons"},tc=["onClick"],sc={class:"action-buttons"},oc=["onClick"],nc={class:"message-preview"},ac={class:"preview-line"},lc={key:0,class:"preview-line",style:{opacity:"0.8"}},rc={class:"message-meta"},ic={class:"message-id"},cc={class:"meta-right"},dc={key:0,class:"unread-count"},uc={class:"message-time"},pc=["id"],mc={style:{display:"flex","flex-direction":"column",gap:"0.75rem"}},hc={class:"bubble-avatar"},fc={class:"bubble-content"},vc={class:"bubble-text"},gc={key:0,class:"empty-state"},bc={class:"modal-content"},yc={class:"modal-header"},_c={class:"modal-title"},Sc=["placeholder"],$c={id:"name-char-count",class:"char-count",style:{"text-align":"right",display:"block","margin-top":"0.25rem"}},wc={class:"modal-footer"},kc={class:"modal-content"},Tc={class:"modal-header"},Pc={class:"modal-title"},Ec={class:"state-text",id:"delete-message"},Cc={class:"modal-footer"},Rc=de({__name:"Memory",emits:["memory-selected"],setup(n,{emit:e}){const t=M(!1),s=M(""),a=M([]),l=M([]),i=M(!1),p=M(null),v=M(""),d=M(!1),m=M(null),_=new Map,I=e,U=A=>{A.key==="Escape"&&(d.value?z():i.value&&w())};Se(()=>{xe.setLoadMessages(S),document.addEventListener("keydown",U)}),_e(()=>{document.removeEventListener("keydown",U)});const S=async()=>{try{const A=await it.getMemories();a.value?a.value=A.map(N=>({...N,expanded:_.has(N.conversation_id)?_.get(N.conversation_id):!1})):a.value=A.map(N=>({...N,expanded:!1})),l.value=[...a.value],u()}catch(A){console.error("error:",A),a.value=[],l.value=[]}},$=A=>{xe.selectMemory(A),I("memory-selected")},y=A=>{const N=typeof A=="string"?parseInt(A,10):A;return isNaN(N)||N<=0?"unknow time":new Date(N.toString().length===13?N:N*1e3).toLocaleString("zh-CN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1}).replace(","," ")},u=()=>{const A=s.value.toLowerCase().trim();if(!A){l.value=[...a.value];return}l.value=a.value.filter(N=>{var R;const x=N.memory_name.toLowerCase().includes(A),H=N.conversation_id.toLowerCase().includes(A),b=((R=N.messages)==null?void 0:R.some(J=>J.text.toLowerCase().includes(A)))||!1;return x||H||b})},T=(A,N)=>{p.value=A,v.value=N,i.value=!0},w=()=>{i.value=!1,p.value=null},E=async()=>{if(!p.value)return;const A=v.value.trim()||"unknow name",N=a.value.findIndex(x=>x.conversation_id===p.value);if(N!==-1){const x=a.value[N];try{const H=await it.updateMemory(x.conversation_id,A);H.messages||(H.messages=[]),a.value[N]={...H,expanded:x.expanded},u(),i.value=!1}catch(H){console.error("error:",H)}}},f=A=>{const N=a.value.find(x=>x.conversation_id===A);if(N){N.expanded=!N.expanded,_.set(A,N.expanded);const x=l.value.findIndex(H=>H.conversation_id===A);x!==-1&&(l.value[x]={...N})}},q=A=>{m.value=A,d.value=!0},z=()=>{d.value=!1,m.value=null},Z=async()=>{if(m.value)try{await it.deleteMemory(m.value),a.value=a.value.filter(A=>A.conversation_id!==m.value),u(),a.value.length===0&&xe.clearMemoryId(),d.value=!1,m.value=null}catch(A){console.error("error:",A)}};return(A,N)=>(h(),oe(Ye,{to:"body"},[k(Ue,{name:"modal"},{default:Ie(()=>[r(xe).isCollapsed?(h(),g("div",Ni,[o("div",Oi,[o("div",Li,[o("div",Bi,[o("div",qi,[o("h1",ji,[o("span",null,c(A.$t("memory.title")),1)])]),t.value?(h(),g("div",Vi)):B("",!0)]),o("button",{class:"close-btn",onClick:N[0]||(N[0]=x=>r(xe).toggleSidebar())},[k(r(P),{icon:"carbon:close"})])]),o("div",Hi,[o("div",Wi,[k(r(P),{class:"search-container-icon",icon:"carbon:search"}),te(o("input",{type:"text",placeholder:A.$t("memory.searchPlaceholder"),class:"search-input","onUpdate:modelValue":N[1]||(N[1]=x=>s.value=x),onInput:u},null,40,zi),[[le,s.value]])])]),o("div",Ji,[o("div",null,[(h(!0),g(ne,null,ae(l.value,x=>(h(),g("div",{class:se(["message-item",{expanded:x.expanded}]),key:x.conversation_id},[o("div",Gi,[o("div",Ki,[o("div",Xi,[o("div",{class:"sender-div",onClick:me(H=>$(x.conversation_id),["stop"])},[o("h3",Qi,c(x.memory_name),1)],8,Yi),o("div",{class:"toggle-container",onClick:me(H=>T(x.conversation_id,x.memory_name),["stop"])},[k(r(P),{icon:"carbon:edit",class:"edit-btn"})],8,Zi),o("div",ec,[o("button",{class:"delete-btn",onClick:me(H=>f(x.conversation_id),["stop"])},[k(r(P),{id:"toggle-"+x.conversation_id,icon:"carbon:chevron-down",class:"down-btn"},null,8,["id"])],8,tc)]),o("div",sc,[o("button",{class:"delete-btn",onClick:me(H=>q(x.conversation_id),["stop"])},[k(r(P),{icon:"carbon:delete"})],8,oc)])]),o("div",nc,[o("p",ac,c(x.messages&&x.messages.length>0?x.messages[0].text:"none message"),1),x.messages&&x.messages.length>1?(h(),g("p",lc,c(x.messages[1].text),1)):B("",!0)]),o("div",rc,[o("span",ic,"ID: "+c(x.conversation_id),1),o("div",cc,[x.messages&&x.messages.length>0?(h(),g("span",dc,c(x.messages.length)+" "+c(A.$t("memory.size")),1)):B("",!0),o("span",uc,c(y(x.create_time)),1)])])])]),x.expanded?(h(),g("div",{key:0,id:"content-"+x.conversation_id,class:"expanded-content"},[o("div",mc,[(h(!0),g(ne,null,ae(x.messages,(H,b)=>(h(),g("div",{class:"message-bubble",key:b},[o("div",hc,c(H.messageType),1),o("div",fc,[o("p",vc,c(H.text),1)])]))),128))])],8,pc)):B("",!0)],2))),128))]),l.value.length===0&&s.value?(h(),g("div",gc,N[3]||(N[3]=[o("p",{class:"state-text"},"none message",-1)]))):B("",!0)]),i.value?(h(),g("div",{key:0,id:"name-edit-modal",class:"modal-overlay",onClick:me(w,["self"])},[o("div",bc,[o("div",yc,[o("h3",_c,c(A.$t("memory.changeName")),1),te(o("input",{type:"text","onUpdate:modelValue":N[2]||(N[2]=x=>v.value=x),class:"edit-input",placeholder:A.$t("memory.newNamePlaceholder")},null,8,Sc),[[le,v.value]]),o("span",$c,c(v.value.length),1)]),o("div",wc,[o("button",{id:"cancel-name",class:"modal-btn cancel-btn",onClick:w},c(A.$t("memory.cancel")),1),o("button",{id:"save-name",class:"modal-btn confirm-btn",onClick:E},c(A.$t("memory.save")),1)])])])):B("",!0),d.value?(h(),g("div",{key:1,id:"delete-modal",class:"modal-overlay",onClick:me(z,["self"])},[o("div",kc,[o("div",Tc,[o("h3",Pc,c(A.$t("memory.deleteHint")),1),o("p",Ec,c(A.$t("memory.deleteHintPrefix"))+" "+c(m.value)+" "+c(A.$t("memory.deleteHintSuffix")),1)]),o("div",Cc,[o("button",{id:"cancel-delete",class:"modal-btn cancel-btn",onClick:z},c(A.$t("memory.cancel")),1),o("button",{id:"confirm-delete",class:"modal-btn delete-btn-confirm",onClick:Z},c(A.$t("memory.delete")),1)])])])):B("",!0)])])):B("",!0)]),_:1})]))}}),Ic=ue(Rc,[["__scopeId","data-v-ca286acb"]]),Ac="/api/executor";async function Ds(n){try{const e=await fetch(`${Ac}/agent-execution/${n}`);if(!e.ok){if(e.status===404)return console.warn(`Agent execution detail not found for stepId: ${n}`),null;throw new Error(`HTTP error! status: ${e.status}`)}return await e.json()}catch(e){return console.error(`Error fetching agent execution detail for stepId: ${n}:`,e),null}}async function xc(n){return console.log(`Refreshing agent execution detail for stepId: ${n}`),Ds(n)}class De{static async handleResponse(e){if(!e.ok)try{const t=await e.json();throw new Error(t.message||`API request failed: ${e.status}`)}catch{throw new Error(`API request failed: ${e.status} ${e.statusText}`)}return e}static async getFileTree(e){try{const t=await fetch(`${this.BASE_URL}/tree/${e}`),a=await(await this.handleResponse(t)).json();if(!a.success)throw new Error(a.message||"Failed to get file tree");return a.data}catch(t){throw console.error("Failed to get file tree:",t),t}}static async getFileContent(e,t){try{const s=await fetch(`${this.BASE_URL}/content/${e}?path=${encodeURIComponent(t)}`),l=await(await this.handleResponse(s)).json();if(!l.success)throw new Error(l.message||"Failed to get file content");return l.data}catch(s){throw console.error("Failed to get file content:",s),s}}static async downloadFile(e,t,s){try{const a=await fetch(`${this.BASE_URL}/download/${e}?path=${encodeURIComponent(t)}`);await this.handleResponse(a);const l=await a.blob(),i=window.URL.createObjectURL(l),p=document.createElement("a");p.href=i,p.download=s||t.split("/").pop()||"download",document.body.appendChild(p),p.click(),window.URL.revokeObjectURL(i),document.body.removeChild(p)}catch(a){throw console.error("Failed to download file:",a),a}}static isTextFile(e,t){const s=["text/","application/json","application/xml","application/javascript","application/typescript"],a=[".txt",".md",".json",".xml",".html",".css",".js",".ts",".vue",".jsx",".tsx",".py",".java",".cpp",".c",".h",".sh",".bat",".yml",".yaml",".properties",".conf",".cfg"];if(s.some(i=>e.startsWith(i)))return!0;const l=t.toLowerCase();return a.some(i=>l.endsWith(i))}static getFileIcon(e){if(e.type==="directory")return"carbon:folder";const t=e.name.toLowerCase();return t.endsWith(".js")?"vscode-icons:file-type-js":t.endsWith(".ts")?"vscode-icons:file-type-typescript":t.endsWith(".vue")?"vscode-icons:file-type-vue":t.endsWith(".java")?"vscode-icons:file-type-java":t.endsWith(".py")?"vscode-icons:file-type-python":t.endsWith(".json")?"vscode-icons:file-type-json":t.endsWith(".xml")?"vscode-icons:file-type-xml":t.endsWith(".html")?"vscode-icons:file-type-html":t.endsWith(".css")?"vscode-icons:file-type-css":t.endsWith(".md")?"vscode-icons:file-type-markdown":t.endsWith(".yml")||t.endsWith(".yaml")?"vscode-icons:file-type-yaml":t.endsWith(".pdf")?"vscode-icons:file-type-pdf2":t.endsWith(".doc")||t.endsWith(".docx")?"vscode-icons:file-type-word":t.endsWith(".xls")||t.endsWith(".xlsx")?"vscode-icons:file-type-excel":t.endsWith(".ppt")||t.endsWith(".pptx")?"vscode-icons:file-type-powerpoint":t.match(/\.(jpg|jpeg|png|gif|bmp|svg)$/)?"carbon:image":t.match(/\.(zip|rar|7z|tar|gz)$/)?"carbon:archive":"carbon:document"}}fe(De,"BASE_URL","/api/file-browser");const Dc={class:"file-tree-node"},Fc={class:"node-icon"},Mc={class:"node-name"},Uc={key:1,class:"file-size"},Nc={key:2,class:"node-actions"},Oc={key:0,class:"children"},Lc=de({__name:"FileTreeNode",props:{node:{},level:{}},emits:["file-selected","download-file"],setup(n,{emit:e}){const t=n,s=e,a=M(t.level===0),l=M(!1),i=M(!1),p=M({}),v=()=>{t.node.type==="directory"&&(a.value=!a.value)},d=()=>{t.node.type==="directory"?v():m()},m=()=>{t.node.type==="file"&&s("file-selected",t.node),U()},_=()=>{s("download-file",t.node),U()},I=u=>{u.preventDefault(),i.value=!0,p.value={position:"fixed",top:`${u.clientY}px`,left:`${u.clientX}px`,zIndex:1e3},setTimeout(()=>{document.addEventListener("click",U)},0)},U=()=>{i.value=!1,document.removeEventListener("click",U)},S=async()=>{try{await navigator.clipboard.writeText(t.node.path)}catch(u){console.error("Failed to copy path:",u)}U()},$=()=>t.node.type==="directory"?a.value?"carbon:folder-open":"carbon:folder":De.getFileIcon(t.node),y=u=>{if(u===0)return"0 B";const T=1024,w=["B","KB","MB","GB"],E=Math.floor(Math.log(u)/Math.log(T));return parseFloat((u/Math.pow(T,E)).toFixed(1))+" "+w[E]};return _e(()=>{document.removeEventListener("click",U)}),(u,T)=>{const w=ts("FileTreeNode",!0);return h(),g("div",Dc,[o("div",{class:se(["node-content",{"is-directory":u.node.type==="directory","is-file":u.node.type==="file","is-expanded":a.value}]),style:qe({paddingLeft:`${u.level*16+12}px`}),onClick:d,onContextmenu:me(I,["prevent"])},[u.node.type==="directory"?(h(),g("div",{key:0,class:"expand-icon",onClick:me(v,["stop"])},[k(r(P),{icon:a.value?"carbon:chevron-down":"carbon:chevron-right",class:"chevron-icon"},null,8,["icon"])])):B("",!0),o("div",Fc,[k(r(P),{icon:$()},null,8,["icon"])]),o("span",Mc,c(u.node.name),1),u.node.type==="file"?(h(),g("span",Uc,c(y(u.node.size)),1)):B("",!0),l.value?(h(),g("div",Nc,[u.node.type==="file"?(h(),g("button",{key:0,onClick:T[0]||(T[0]=me(E=>u.$emit("download-file",u.node),["stop"])),class:"action-btn download-btn",title:"Download"},[k(r(P),{icon:"carbon:download"})])):B("",!0)])):B("",!0)],38),u.node.type==="directory"&&a.value&&u.node.children?(h(),g("div",Oc,[(h(!0),g(ne,null,ae(u.node.children,E=>(h(),oe(w,{key:E.path,node:E,level:u.level+1,onFileSelected:T[1]||(T[1]=f=>u.$emit("file-selected",f)),onDownloadFile:T[2]||(T[2]=f=>u.$emit("download-file",f))},null,8,["node","level"]))),128))])):B("",!0),i.value?(h(),g("div",{key:1,class:"context-menu",style:qe(p.value),onClick:T[3]||(T[3]=me(()=>{},["stop"]))},[o("div",{class:"context-menu-item",onClick:m},[k(r(P),{icon:"carbon:view"}),T[4]||(T[4]=o("span",null,"Open",-1))]),u.node.type==="file"?(h(),g("div",{key:0,class:"context-menu-item",onClick:_},[k(r(P),{icon:"carbon:download"}),T[5]||(T[5]=o("span",null,"Download",-1))])):B("",!0),T[7]||(T[7]=o("div",{class:"context-menu-divider"},null,-1)),o("div",{class:"context-menu-item",onClick:S},[k(r(P),{icon:"carbon:copy"}),T[6]||(T[6]=o("span",null,"Copy Path",-1))])],4)):B("",!0)])}}}),Bc=ue(Lc,[["__scopeId","data-v-e4a376d5"]]),qc={class:"file-browser"},jc={class:"file-browser-header"},Vc={class:"header-actions"},Hc=["disabled","title"],Wc={class:"file-browser-content"},zc={class:"file-tree-panel"},Jc={key:0,class:"loading-state"},Gc={key:1,class:"error-state"},Kc={key:0,class:"waiting-for-files"},Xc={class:"message-content"},Yc={class:"tips"},Qc=["disabled"],Zc={key:1,class:"actual-error"},ed={key:2,class:"empty-state"},td={key:3,class:"file-tree"},sd={key:0,class:"file-content-panel"},od={class:"file-content-header"},nd={class:"file-info"},ad={class:"file-name"},ld={class:"file-size"},rd={class:"file-actions"},id=["title"],cd=["title"],dd={class:"file-content-body"},ud={key:0,class:"loading-content"},pd={key:1,class:"content-error"},md={key:2,class:"file-content"},hd={key:0,class:"text-content"},fd={key:1,class:"binary-content"},vd=de({__name:"index",props:{planId:{}},setup(n){const e=n,{t}=$e(),s=M(!1),a=M(null),l=M(null),i=M(null),p=M(null),v=M(!1),d=M(null),m=M(null),_=ce(()=>!p.value||!i.value?!1:De.isTextFile(p.value.mimeType,i.value.name)),I=ce(()=>a.value&&(a.value.includes("Plan directory not found")||a.value.includes("not found"))),U=()=>{m.value&&(clearTimeout(m.value),m.value=null)},S=()=>{U(),m.value=window.setTimeout(()=>{I.value&&$()},5e3)},$=async()=>{if(e.planId){s.value=!0,a.value=null,U();try{l.value=await De.getFileTree(e.planId)}catch(f){a.value=f instanceof Error?f.message:t("fileBrowser.loadError"),console.error("Failed to load file tree:",f);const q=f instanceof Error?f.message:"";(q.includes("Plan directory not found")||q.includes("not found"))&&S()}finally{s.value=!1}}},y=async f=>{if(f.type!=="directory"){i.value=f,p.value=null,v.value=!0,d.value=null;try{p.value=await De.getFileContent(e.planId,f.path)}catch(q){d.value=q instanceof Error?q.message:t("fileBrowser.contentLoadError"),console.error("Failed to load file content:",q)}finally{v.value=!1}}},u=async f=>{try{await De.downloadFile(e.planId,f.path,f.name)}catch(q){console.error("Failed to download file:",q)}},T=()=>{i.value=null,p.value=null,d.value=null},w=f=>De.getFileIcon(f),E=f=>{if(f===0)return"0 B";const q=1024,z=["B","KB","MB","GB"],Z=Math.floor(Math.log(f)/Math.log(q));return parseFloat((f/Math.pow(q,Z)).toFixed(1))+" "+z[Z]};return pe(()=>e.planId,f=>{f&&(i.value=null,p.value=null,$())},{immediate:!0}),Se(()=>{e.planId&&$()}),_e(()=>{U()}),(f,q)=>(h(),g("div",qc,[o("div",jc,[o("h3",null,c(f.$t("fileBrowser.title")),1),o("div",Vc,[o("button",{class:"refresh-btn",onClick:$,disabled:s.value,title:f.$t("fileBrowser.refresh")},[k(r(P),{icon:"carbon:refresh",class:se({rotating:s.value}),style:{color:"#ffffff",fontSize:"18px",width:"18px",height:"18px"}},null,8,["class"])],8,Hc)])]),o("div",Wc,[o("div",zc,[s.value?(h(),g("div",Jc,[k(r(P),{icon:"carbon:loading",class:"rotating"}),o("span",null,c(f.$t("fileBrowser.loading")),1)])):a.value?(h(),g("div",Gc,[I.value?(h(),g("div",Kc,[k(r(P),{icon:"carbon:time",class:"rotating"}),o("div",Xc,[o("h3",null,c(f.$t("fileBrowser.waitingForGeneration")),1),o("p",null,c(f.$t("fileBrowser.planExecuting")),1),o("div",Yc,[k(r(P),{icon:"carbon:information"}),o("span",null,c(f.$t("fileBrowser.filesTip")),1)])]),o("button",{onClick:$,class:"retry-btn",disabled:s.value},[k(r(P),{icon:"carbon:refresh",class:se({rotating:s.value})},null,8,["class"]),ee(" "+c(s.value?f.$t("fileBrowser.checking"):f.$t("fileBrowser.checkNow")),1)],8,Qc)])):(h(),g("div",Zc,[k(r(P),{icon:"carbon:warning"}),o("span",null,c(a.value),1),o("button",{onClick:$,class:"retry-btn"},c(f.$t("fileBrowser.retry")),1)]))])):l.value?(h(),g("div",td,[k(Bc,{node:l.value,level:0,onFileSelected:y,onDownloadFile:u},null,8,["node"])])):(h(),g("div",ed,[k(r(P),{icon:"carbon:folder-off"}),o("span",null,c(f.$t("fileBrowser.noFiles")),1)]))]),i.value?(h(),g("div",sd,[o("div",od,[o("div",nd,[k(r(P),{icon:w(i.value)},null,8,["icon"]),o("span",ad,c(i.value.name),1),o("span",ld,"("+c(E(i.value.size))+")",1)]),o("div",rd,[o("button",{onClick:q[0]||(q[0]=z=>u(i.value)),class:"download-btn",title:f.$t("fileBrowser.download")},[k(r(P),{icon:"carbon:download"})],8,id),o("button",{onClick:T,class:"close-btn",title:f.$t("common.close")},[k(r(P),{icon:"carbon:close"})],8,cd)])]),o("div",dd,[v.value?(h(),g("div",ud,[k(r(P),{icon:"carbon:loading",class:"rotating"}),o("span",null,c(f.$t("fileBrowser.loadingContent")),1)])):d.value?(h(),g("div",pd,[k(r(P),{icon:"carbon:warning"}),o("span",null,c(d.value),1)])):p.value?(h(),g("div",md,[_.value?(h(),g("div",hd,[o("pre",null,[o("code",null,c(p.value.content),1)])])):(h(),g("div",fd,[k(r(P),{icon:"carbon:document-unknown"}),o("p",null,c(f.$t("fileBrowser.binaryFile")),1),o("button",{onClick:q[1]||(q[1]=z=>u(i.value)),class:"download-btn-large"},[k(r(P),{icon:"carbon:download"}),ee(" "+c(f.$t("fileBrowser.downloadToView")),1)])]))])):B("",!0)])])):B("",!0)])]))}}),gd=ue(vd,[["__scopeId","data-v-e7c74fe4"]]),bd={class:"right-panel"},yd={class:"preview-header"},_d={class:"preview-tabs"},Sd={class:"preview-content"},$d={key:0,class:"step-details"},wd={key:0,class:"step-info"},kd={key:0,class:"agent-info"},Td={class:"info-item"},Pd={class:"label"},Ed={class:"value"},Cd={class:"info-item"},Rd={class:"label"},Id={class:"value"},Ad={class:"info-item"},xd={class:"label"},Dd={class:"execution-status"},Fd={class:"status-item"},Md={class:"status-text"},Ud={key:0},Nd={key:0,class:"think-act-steps"},Od={class:"steps-container"},Ld={class:"step-header"},Bd={class:"step-number"},qd={class:"think-section"},jd={class:"think-content"},Vd={class:"input"},Hd={class:"label"},Wd={class:"output"},zd={class:"label"},Jd={key:0,class:"action-section"},Gd={class:"action-content"},Kd={class:"tool-info"},Xd={class:"label"},Yd={class:"value"},Qd={class:"input"},Zd={class:"label"},eu={class:"output"},tu={class:"label"},su={key:0,class:"sub-plan-section"},ou={class:"sub-plan-content"},nu={class:"sub-plan-header"},au={class:"sub-plan-info"},lu={class:"label"},ru={class:"value"},iu={key:0,class:"sub-plan-info"},cu={class:"label"},du={class:"value"},uu={class:"sub-plan-status"},pu={class:"status-text"},mu={key:0,class:"no-steps-message"},hu={key:1,class:"no-execution-message"},fu={class:"step-basic-info"},vu={class:"info-item"},gu={class:"label"},bu={class:"value"},yu={key:0,class:"info-item"},_u={class:"label"},Su={class:"value"},$u={class:"info-item"},wu={class:"label"},ku={class:"no-execution-hint"},Tu={key:2,class:"execution-indicator"},Pu={class:"execution-text"},Eu={key:1,class:"no-selection"},Cu=["title"],Ru={key:1,class:"file-browser-container"},Iu={key:1,class:"no-plan-message"},Au={class:"message-content"},xu={class:"tips"},Du=de({__name:"RightPanel",props:{currentRootPlanId:{},selectedStepId:{}},setup(n,{expose:e}){const t=n,{t:s}=$e(),a=M(),l=M(),i=M("details"),p=M(localStorage.getItem("jmanus-last-plan-id")),v=M(localStorage.getItem("jmanus-has-executed-plan")==="true"),d=M(!1),m=M(!0),_=M(!0),I=ce(()=>l.value?l.value.completed?s("rightPanel.status.completed"):l.value.current?s("rightPanel.status.executing"):s("rightPanel.status.waiting"):""),U=ce(()=>t.currentRootPlanId?t.currentRootPlanId:p.value),S=ce(()=>!U.value&&!v.value),$=async A=>{var N,x,H;if(console.log("[RightPanel] Step selected:",{stepId:A}),!A){console.warn("[RightPanel] No stepId provided"),l.value=null;return}try{const b=await Ds(A);if(!b){console.warn("[RightPanel] Agent execution detail not found for stepId:",A),l.value=null;return}const R={stepId:A,title:b.agentName||`Step ${A}`,description:b.agentDescription||"",agentExecution:b,completed:b.status==="FINISHED",current:b.status==="RUNNING"};l.value=R,console.log("[RightPanel] Step details updated:",R),console.log("[RightPanel] activeTab:",i.value),console.log("[RightPanel] selectedStep.value:",l.value),console.log("[RightPanel] agentExecution:",l.value.agentExecution),console.log("[RightPanel] thinkActSteps:",(N=l.value.agentExecution)==null?void 0:N.thinkActSteps),console.log("[RightPanel] thinkActSteps length:",(H=(x=l.value.agentExecution)==null?void 0:x.thinkActSteps)==null?void 0:H.length),await ge(),console.log("[RightPanel] After nextTick - selectedStep:",l.value),setTimeout(()=>{T()},100),E()}catch(b){console.error("[RightPanel] Error fetching step details:",b),l.value=null}},y=async()=>{var A;if(!((A=l.value)!=null&&A.stepId)){console.warn("[RightPanel] No step selected for refresh");return}console.log("[RightPanel] Refreshing current step:",l.value.stepId);try{const N=await xc(l.value.stepId);N&&l.value&&(l.value.agentExecution=N,l.value.completed=N.status==="FINISHED",l.value.current=N.status==="RUNNING",console.log("[RightPanel] Step refreshed successfully"),E())}catch(N){console.error("[RightPanel] Error refreshing step:",N)}};pe(()=>t.selectedStepId,async A=>{A?await $(A):l.value=null},{immediate:!0});const u=A=>{a.value=A??void 0},T=()=>{if(!a.value)return;const{scrollTop:A,scrollHeight:N,clientHeight:x}=a.value,H=N-A-x<50,b=N>x;m.value=H,d.value=b&&!H,H?_.value=!0:N-A-x>100&&(_.value=!1),console.log("[RightPanel] Scroll state check:",{scrollTop:A,scrollHeight:N,clientHeight:x,isAtBottom:H,hasScrollableContent:b,showButton:d.value,shouldAutoScroll:_.value})},w=()=>{a.value&&(a.value.scrollTo({top:a.value.scrollHeight,behavior:"smooth"}),ge(()=>{_.value=!0,T()}))},E=()=>{!_.value||!a.value||ge(()=>{a.value&&(a.value.scrollTop=a.value.scrollHeight,console.log("[RightPanel] Auto scroll to bottom"))})},f=A=>{if(A===null||typeof A>"u"||A==="")return"N/A";try{const N=typeof A=="object"?A:JSON.parse(A);return JSON.stringify(N,null,2)}catch{return String(A)}},q=()=>{l.value=null,_.value=!0,a.value&&a.value.removeEventListener("scroll",T)},z=()=>{const A=()=>{const N=a.value;return N?(u(N),N.addEventListener("scroll",T),_.value=!0,T(),console.log("[RightPanel] Scroll listener initialized successfully"),!0):(console.log("[RightPanel] Scroll container not found, retrying..."),!1)};ge(()=>{A()||setTimeout(()=>{A()},100)})};return pe(()=>t.currentRootPlanId,(A,N)=>{A&&A!==N?(p.value=A,v.value=!0,localStorage.setItem("jmanus-last-plan-id",A),localStorage.setItem("jmanus-has-executed-plan","true"),console.log("[RightPanel] New plan started:",A)):!A&&N&&console.log("[RightPanel] Plan execution finished, keeping last plan:",p.value)},{immediate:!0}),Se(()=>{console.log("[RightPanel] Component mounted"),ge(()=>{z()})}),_e(()=>{console.log("[RightPanel] Component unmounting, cleaning up..."),q()}),e({handleStepSelected:$,refreshCurrentStep:y,updateDisplayedPlanProgress:A=>{console.log("[RightPanel] updateDisplayedPlanProgress called with rootPlanId:",A),A&&(p.value=A,v.value=!0,localStorage.setItem("jmanus-last-plan-id",A),localStorage.setItem("jmanus-has-executed-plan","true"),console.log("[RightPanel] Plan progress updated:",A))}}),(A,N)=>{var x,H;return h(),g("div",bd,[o("div",yd,[o("div",_d,[o("div",{class:se(["tab-item",{active:i.value==="details"}]),onClick:N[0]||(N[0]=b=>i.value="details")},[k(r(P),{icon:"carbon:events"}),o("span",null,c(r(s)("rightPanel.stepExecutionDetails")),1)],2),o("div",{class:se(["tab-item",{active:i.value==="files"}]),onClick:N[1]||(N[1]=b=>i.value="files")},[k(r(P),{icon:"carbon:folder"}),o("span",null,c(r(s)("fileBrowser.title")),1)],2)])]),o("div",Sd,[i.value==="details"?(h(),g("div",$d,[l.value?(h(),g("div",wd,[o("h3",null,c(l.value.title||l.value.description||r(s)("rightPanel.defaultStepTitle",{number:1})),1),l.value.agentExecution?(h(),g("div",kd,[o("div",Td,[o("span",Pd,c(r(s)("rightPanel.executingAgent"))+":",1),o("span",Ed,c(l.value.agentExecution.agentName),1)]),o("div",Cd,[o("span",Rd,c(r(s)("rightPanel.callingModel"))+":",1),o("span",Id,c(l.value.agentExecution.modelName),1)]),o("div",Ad,[o("span",xd,c(r(s)("rightPanel.executionResult"))+":",1),o("span",{class:se(["value",{success:l.value.agentExecution.status==="FINISHED"}])},c(l.value.agentExecution.status||r(s)("rightPanel.executing")),3)])])):B("",!0),o("div",Dd,[o("div",Fd,[l.value.completed?(h(),oe(r(P),{key:0,icon:"carbon:checkmark-filled",class:"status-icon success"})):l.value.current?(h(),oe(r(P),{key:1,icon:"carbon:in-progress",class:"status-icon progress"})):(h(),oe(r(P),{key:2,icon:"carbon:time",class:"status-icon pending"})),o("span",Md,c(I.value),1)])])])):B("",!0),o("div",{ref_key:"scrollContainer",ref:a,class:"step-details-scroll-container",onScroll:T},[l.value?(h(),g("div",Ud,[(x=l.value.agentExecution)!=null&&x.thinkActSteps&&l.value.agentExecution.thinkActSteps.length>0?(h(),g("div",Nd,[o("h4",null,c(r(s)("rightPanel.thinkAndActionSteps")),1),o("div",Od,[(h(!0),g(ne,null,ae(l.value.agentExecution.thinkActSteps,(b,R)=>(h(),g("div",{key:R,class:"think-act-step"},[o("div",Ld,[o("span",Bd,"#"+c(R+1),1),o("span",{class:se(["step-status",b.status])},c(b.status||r(s)("rightPanel.executing")),3)]),o("div",qd,[o("h5",null,[k(r(P),{icon:"carbon:thinking"}),ee(" "+c(r(s)("rightPanel.thinking")),1)]),o("div",jd,[o("div",Vd,[o("span",Hd,c(r(s)("rightPanel.input"))+":",1),o("pre",null,c(f(b.thinkInput)),1)]),o("div",Wd,[o("span",zd,c(r(s)("rightPanel.output"))+":",1),o("pre",null,c(f(b.thinkOutput)),1)])])]),b.actionNeeded?(h(),g("div",Jd,[o("h5",null,[k(r(P),{icon:"carbon:play"}),ee(" "+c(r(s)("rightPanel.action")),1)]),o("div",Gd,[(h(!0),g(ne,null,ae(b.actToolInfoList,(J,K)=>(h(),g("div",{key:K},[o("div",Kd,[o("span",Xd,c(r(s)("rightPanel.tool"))+":",1),o("span",Yd,c(J.name||""),1)]),o("div",Qd,[o("span",Zd,c(r(s)("rightPanel.toolParameters"))+":",1),o("pre",null,c(f(J.parameters)),1)]),o("div",eu,[o("span",tu,c(r(s)("rightPanel.executionResult"))+":",1),o("pre",null,c(f(J.result)),1)])]))),128))]),b.subPlanExecutionRecord?(h(),g("div",su,[o("h5",null,[k(r(P),{icon:"carbon:tree-view"}),ee(" "+c(r(s)("rightPanel.subPlan")),1)]),o("div",ou,[o("div",nu,[o("div",au,[o("span",lu,c(A.$t("rightPanel.subPlanId"))+":",1),o("span",ru,c(b.subPlanExecutionRecord.currentPlanId),1)]),b.subPlanExecutionRecord.title?(h(),g("div",iu,[o("span",cu,c(A.$t("rightPanel.title"))+":",1),o("span",du,c(b.subPlanExecutionRecord.title),1)])):B("",!0),o("div",uu,[b.subPlanExecutionRecord.completed?(h(),oe(r(P),{key:0,icon:"carbon:checkmark-filled",class:"status-icon success"})):(h(),oe(r(P),{key:1,icon:"carbon:in-progress",class:"status-icon progress"})),o("span",pu,c(b.subPlanExecutionRecord.completed?A.$t("rightPanel.status.completed"):A.$t("rightPanel.status.executing")),1)])])])])):B("",!0)])):B("",!0)]))),128))]),l.value.agentExecution&&!((H=l.value.agentExecution.thinkActSteps)!=null&&H.length)?(h(),g("div",mu,[o("p",null,c(r(s)("rightPanel.noStepDetails")),1)])):l.value.agentExecution?B("",!0):(h(),g("div",hu,[k(r(P),{icon:"carbon:information",class:"info-icon"}),o("h4",null,c(r(s)("rightPanel.stepInfo")),1),o("div",fu,[o("div",vu,[o("span",gu,c(r(s)("rightPanel.stepName"))+":",1),o("span",bu,c(l.value.title||l.value.description||l.value.stepId),1)]),l.value.description?(h(),g("div",yu,[o("span",_u,c(A.$t("rightPanel.description"))+":",1),o("span",Su,c(l.value.description),1)])):B("",!0),o("div",$u,[o("span",wu,c(A.$t("rightPanel.status.label"))+":",1),o("span",{class:se(["value",{"status-completed":l.value.completed,"status-current":l.value.current,"status-pending":!l.value.completed&&!l.value.current}])},c(l.value.completed?A.$t("rightPanel.status.completed"):l.value.current?A.$t("rightPanel.status.executing"):A.$t("rightPanel.status.pending")),3)])]),o("p",ku,c(r(s)("rightPanel.noExecutionInfo")),1)])),l.value.current&&!l.value.completed?(h(),g("div",Tu,[N[2]||(N[2]=o("div",{class:"execution-waves"},[o("div",{class:"wave wave-1"}),o("div",{class:"wave wave-2"}),o("div",{class:"wave wave-3"})],-1)),o("p",Pu,[k(r(P),{icon:"carbon:in-progress",class:"rotating-icon"}),ee(" "+c(r(s)("rightPanel.stepExecuting")),1)])])):B("",!0)])):(h(),g("div",Eu,[k(r(P),{icon:"carbon:events",class:"empty-icon"}),o("h3",null,c(r(s)("rightPanel.noStepSelected")),1),o("p",null,c(r(s)("rightPanel.selectStepHint")),1)]))])):B("",!0),k(Ue,{name:"scroll-button"},{default:Ie(()=>[d.value?(h(),g("button",{key:0,onClick:w,class:"scroll-to-bottom-btn",title:r(s)("rightPanel.scrollToBottom")},[k(r(P),{icon:"carbon:chevron-down"})],8,Cu)):B("",!0)]),_:1})],544)])):B("",!0),i.value==="files"?(h(),g("div",Ru,[U.value?(h(),oe(gd,{key:0,"plan-id":U.value},null,8,["plan-id"])):S.value?(h(),g("div",Iu,[k(r(P),{icon:"carbon:folder-off"}),o("div",Au,[o("h3",null,c(r(s)("fileBrowser.noFilesYet")),1),o("p",null,c(r(s)("fileBrowser.noPlanExecuting")),1),o("div",xu,[k(r(P),{icon:"carbon:information"}),o("span",null,c(r(s)("fileBrowser.startTaskTip")),1)])])])):B("",!0)])):B("",!0)])])}}}),Fu=ue(Du,[["__scopeId","data-v-ea214380"]]);function Nt(){return{formatResponseText:v=>v?v.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/\*(.*?)\*/g,"<em>$1</em>").replace(/`([^`]+)`/g,"<code>$1</code>").replace(/\n/g,"<br>").replace(/```([\s\S]*?)```/g,"<pre><code>$1</code></pre>"):"",formatTimestamp:v=>{const m=new Date().getTime()-v.getTime();return m<6e4?"Just now":m<36e5?`${Math.floor(m/6e4)} minutes ago`:m<864e5?`${Math.floor(m/36e5)} hours ago`:v.toLocaleDateString("zh-CN",{month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})},getMessageClasses:v=>ce(()=>({user:v.type==="user",assistant:v.type==="assistant",streaming:v.isStreaming,"has-error":!!v.error,"has-thinking":!!v.thinking,"has-execution":!!v.planExecution})),formatFileSize:v=>{if(v===0)return"0 B";const d=1024,m=["B","KB","MB","GB"],_=Math.floor(Math.log(v)/Math.log(d));return parseFloat((v/Math.pow(d,_)).toFixed(2))+" "+m[_]},truncateText:(v,d=100)=>!v||v.length<=d?v:v.substring(0,d)+"...",stripHtml:v=>v.replace(/<[^>]*>/g,""),hasDisplayableContent:v=>!!(v.content||v.thinking||v.planExecution||v.error),getMessageStatus:v=>v.error?"Send failed":v.isStreaming?"Typing...":v.type==="assistant"&&!v.content&&!v.thinking?"Waiting for response":""}}const Mu=["data-message-id"],Uu={class:"user-content"},Nu={class:"message-text"},Ou={key:0,class:"attachments"},Lu={class:"attachment-name"},Bu={class:"attachment-size"},qu={class:"message-timestamp"},ju={key:0,class:"message-status error"},Vu={class:"status-text"},Hu=de({__name:"UserMessage",props:{message:{}},setup(n){const{formatTimestamp:e,formatFileSize:t}=Nt();return(s,a)=>{var l;return h(),g("div",{class:"user-message","data-message-id":s.message.id},[o("div",Uu,[o("div",Nu,c(s.message.content),1),(l=s.message.attachments)!=null&&l.length?(h(),g("div",Ou,[(h(!0),g(ne,null,ae(s.message.attachments,(i,p)=>(h(),g("div",{key:p,class:"attachment-item"},[k(r(P),{icon:"carbon:document",class:"attachment-icon"}),o("span",Lu,c(i.name),1),o("span",Bu,c(r(t)(i.size)),1)]))),128))])):B("",!0),o("div",qu,c(r(e)(s.message.timestamp)),1)]),s.message.error?(h(),g("div",ju,[k(r(P),{icon:"carbon:warning",class:"status-icon"}),o("span",Vu,c(s.message.error),1)])):B("",!0)],8,Mu)}}}),Wu=ue(Hu,[["__scopeId","data-v-94372507"]]),zu={class:"sub-plan-info"},Ju={class:"sub-plan-details"},Gu={class:"sub-plan-title"},Ku={key:0,class:"nesting-level"},Xu={class:"sub-plan-id"},Yu={class:"sub-plan-meta"},Qu={key:0,class:"trigger-tool"},Zu={class:"trigger-text"},ep={key:0,class:"sub-plan-progress"},tp={class:"progress-info"},sp={class:"progress-text"},op={class:"progress-bar"},np={key:1,class:"sub-plan-agents-steps"},ap={class:"agents-steps-header"},lp={class:"agents-label"},rp={class:"agents-steps-list"},ip=["onClick"],cp={class:"agent-step-header"},dp={class:"agent-name"},up={class:"sub-agent-execution-info"},pp={key:0,class:"agent-result"},mp={class:"result-header"},hp={class:"result-label"},fp={class:"result-content"},vp={key:1,class:"agent-error"},gp={class:"error-header"},bp={class:"error-label"},yp={class:"error-content"},_p={key:2,class:"think-act-preview"},Sp={class:"think-act-header"},$p={class:"think-act-label"},wp={class:"think-act-steps-preview"},kp=["onClick"],Tp={class:"step-number"},Pp={class:"step-description"},Ep={key:0,class:"more-steps"},Cp={class:"more-steps-text"},Rp={key:3,class:"nested-sub-plans"},Ip={class:"nested-sub-plans-header"},Ap={class:"nested-label"},xp={class:"nested-sub-plans-list"},Dp={key:4,class:"direct-sub-plans"},Fp={class:"direct-sub-plans-header"},Mp={class:"direct-label"},Up={class:"direct-sub-plans-list"},Np=de({__name:"RecursiveSubPlan",props:{subPlan:{},subPlanIndex:{},nestingLevel:{default:0},maxNestingDepth:{default:3},maxVisibleSteps:{default:2}},emits:["sub-plan-selected","step-selected"],setup(n,{emit:e}){const t=n,s=e,{t:a}=$e(),l=()=>`nesting-level-${t.nestingLevel}`,i=()=>{var z,Z;return t.subPlan.completed?"completed":((z=t.subPlan.agentExecutionSequence)==null?void 0:z.some(A=>A.status==="RUNNING"))?"running":((Z=t.subPlan.agentExecutionSequence)==null?void 0:Z.some(A=>A.status==="FINISHED"))?"in-progress":"pending"},p=()=>{switch(i()){case"completed":return a("chat.status.completed");case"running":return a("chat.status.executing");case"in-progress":return a("chat.status.inProgress");case"pending":return a("chat.status.pending");default:return a("chat.status.unknown")}},v=()=>{switch(i()){case"completed":return"carbon:checkmark";case"running":return"carbon:play";case"in-progress":return"carbon:in-progress";case"pending":default:return"carbon:dot-mark"}},d=()=>{var q;if(!((q=t.subPlan.agentExecutionSequence)!=null&&q.length))return 0;if(t.subPlan.completed)return 100;const f=m();return Math.min(100,f/t.subPlan.agentExecutionSequence.length*100)},m=()=>{var f;return(f=t.subPlan.agentExecutionSequence)!=null&&f.length?t.subPlan.agentExecutionSequence.filter(q=>q.status==="FINISHED").length:0},_=f=>{switch(f){case"FINISHED":return"completed";case"RUNNING":return"running";case"IDLE":default:return"pending"}},I=f=>{switch(f){case"FINISHED":return"carbon:checkmark";case"RUNNING":return"carbon:play";case"IDLE":default:return"carbon:dot-mark"}},U=f=>{switch(f){case"RUNNING":return a("chat.status.executing");case"FINISHED":return a("chat.status.completed");case"IDLE":default:return a("chat.status.pending")}},S=f=>{var q;return((q=f.thinkActSteps)==null?void 0:q.some(z=>z.subPlanExecutionRecord))??!1},$=f=>{var q;return((q=f.thinkActSteps)==null?void 0:q.filter(z=>z.subPlanExecutionRecord))??[]},y=()=>{s("sub-plan-selected",-1,t.subPlanIndex,t.subPlan)},u=(f,q)=>{const z=q.stepId||`subplan-${t.subPlanIndex}-agent-${f}`;s("step-selected",z)},T=(f,q,z)=>{const Z=z.stepId||`subplan-${t.subPlanIndex}-agent-${f}`;s("step-selected",Z)},w=(f,q,z)=>{s("sub-plan-selected",f,q,z)},E=f=>{s("step-selected",f)};return(f,q)=>{var Z,A;const z=ts("RecursiveSubPlan",!0);return h(),g("div",{class:se(["recursive-sub-plan",l()])},[o("div",{class:"sub-plan-header",onClick:y},[o("div",zu,[k(r(P),{icon:v(),class:"sub-plan-status-icon"},null,8,["icon"]),o("div",Ju,[o("div",Gu,[ee(c(f.subPlan.title||f.$t("chat.subPlan"))+" #"+c(f.subPlanIndex+1)+" ",1),(f.nestingLevel??0)>0?(h(),g("span",Ku,"(L"+c((f.nestingLevel??0)+1)+")",1)):B("",!0)]),o("div",Xu,c(f.subPlan.currentPlanId),1)])]),o("div",Yu,[o("div",{class:se(["sub-plan-status-badge",i()])},c(p()),3),f.subPlan.parentActToolCall?(h(),g("div",Qu,[k(r(P),{icon:"carbon:function",class:"trigger-icon"}),o("span",Zu,c(f.subPlan.parentActToolCall.name),1)])):B("",!0)])]),(Z=f.subPlan.agentExecutionSequence)!=null&&Z.length?(h(),g("div",ep,[o("div",tp,[o("span",sp,c(f.$t("chat.progress"))+": "+c(m())+" / "+c(f.subPlan.agentExecutionSequence.length),1),o("div",op,[o("div",{class:"progress-fill",style:qe({width:d()+"%"})},null,4)])])])):B("",!0),(A=f.subPlan.agentExecutionSequence)!=null&&A.length?(h(),g("div",np,[o("div",ap,[o("span",lp,c(f.$t("chat.agentExecutions"))+":",1)]),o("div",rp,[(h(!0),g(ne,null,ae(f.subPlan.agentExecutionSequence,(N,x)=>{var H,b;return h(),g("div",{key:N.id||x,class:se(["agent-step-item",_(N.status)]),onClick:R=>u(x,N)},[o("div",cp,[k(r(P),{icon:I(N.status),class:"agent-icon"},null,8,["icon"]),o("span",dp,c(N.agentName||f.$t("chat.unknownAgent")),1),o("div",{class:se(["agent-status-badge",_(N.status)])},c(U(N.status)),3)]),o("div",up,[N.result?(h(),g("div",pp,[o("div",mp,[k(r(P),{icon:"carbon:checkmark",class:"result-icon"}),o("span",hp,c(f.$t("chat.agentResult"))+":",1)]),o("pre",fp,c(N.result),1)])):B("",!0),N.errorMessage?(h(),g("div",vp,[o("div",gp,[k(r(P),{icon:"carbon:warning",class:"error-icon"}),o("span",bp,c(f.$t("chat.errorMessage"))+":",1)]),o("pre",yp,c(N.errorMessage),1)])):B("",!0),(H=N.thinkActSteps)!=null&&H.length?(h(),g("div",_p,[o("div",Sp,[k(r(P),{icon:"carbon:thinking",class:"think-act-icon"}),o("span",$p,c(f.$t("chat.thinkActSteps"))+" ("+c(N.thinkActSteps.length)+")",1)]),o("div",wp,[(h(!0),g(ne,null,ae(N.thinkActSteps.slice(0,f.maxVisibleSteps??2),(R,J)=>(h(),g("div",{key:R.id||J,class:"think-act-step-preview",onClick:me(K=>T(x,J,N),["stop"])},[o("span",Tp,"#"+c(J+1),1),o("span",Pp,c(R.actionDescription||f.$t("chat.thinking")),1),k(r(P),{icon:"carbon:arrow-right",class:"step-arrow"})],8,kp))),128)),N.thinkActSteps.length>(f.maxVisibleSteps??2)?(h(),g("div",Ep,[o("span",Cp,c(f.$t("chat.andMoreSteps",{count:N.thinkActSteps.length-(f.maxVisibleSteps??2)})),1)])):B("",!0)])])):B("",!0),S(N)?(h(),g("div",Rp,[o("div",Ip,[k(r(P),{icon:"carbon:tree-view-alt",class:"nested-icon"}),o("span",Ap,c(f.$t("chat.nestedSubPlans")),1)]),o("div",xp,[(h(!0),g(ne,null,ae($(N),(R,J)=>(h(),oe(z,{key:R.id||J,"sub-plan":R.subPlanExecutionRecord,"sub-plan-index":J,"nesting-level":(f.nestingLevel??0)+1,"max-nesting-depth":f.maxNestingDepth??3,"max-visible-steps":f.maxVisibleSteps??2,onSubPlanSelected:w,onStepSelected:E},null,8,["sub-plan","sub-plan-index","nesting-level","max-nesting-depth","max-visible-steps"]))),128))])])):B("",!0),(b=N.subPlanExecutionRecords)!=null&&b.length?(h(),g("div",Dp,[o("div",Fp,[k(r(P),{icon:"carbon:tree-view",class:"direct-icon"}),o("span",Mp,c(f.$t("chat.directSubPlans")),1)]),o("div",Up,[(h(!0),g(ne,null,ae(N.subPlanExecutionRecords,(R,J)=>(h(),oe(z,{key:R.currentPlanId||J,"sub-plan":R,"sub-plan-index":J,"nesting-level":(f.nestingLevel??0)+1,"max-nesting-depth":f.maxNestingDepth??3,"max-visible-steps":f.maxVisibleSteps??2,onSubPlanSelected:w,onStepSelected:E},null,8,["sub-plan","sub-plan-index","nesting-level","max-nesting-depth","max-visible-steps"]))),128))])])):B("",!0)])],10,ip)}),128))])])):B("",!0)],2)}}}),Op=ue(Np,[["__scopeId","data-v-5ef3cbb7"]]),Lp={class:"execution-details"},Bp={key:0,class:"plan-overview"},qp={class:"plan-header"},jp={class:"plan-title"},Vp={key:0,class:"parent-tool-call"},Hp={class:"parent-tool-header"},Wp={class:"tool-label"},zp={class:"tool-name"},Jp={key:0,class:"tool-parameters"},Gp={class:"param-label"},Kp={class:"param-content"},Xp={key:1,class:"agent-execution-container"},Yp={class:"section-title"},Qp=["onClick"],Zp={class:"agent-info"},em={class:"agent-details"},tm={class:"agent-name"},sm={class:"request-content"},om={class:"agent-controls"},nm={class:"agent-execution-info"},am={key:0,class:"agent-result"},lm={class:"result-header"},rm={class:"result-label"},im={class:"result-content"},cm={key:1,class:"agent-error"},dm={class:"error-header"},um={class:"error-label"},pm={class:"error-content"},mm={key:0,class:"sub-plans-container"},hm={class:"sub-plans-header"},fm={class:"sub-plans-title"},vm={class:"sub-plans-list"},gm=de({__name:"ExecutionDetails",props:{planExecution:{},genericInput:{}},emits:["agent-selected","sub-plan-selected","user-input-submitted","step-selected"],setup(n,{emit:e}){const t=n,s=e,{t:a}=$e(),l=ce(()=>{var $;return(($=t.planExecution)==null?void 0:$.agentExecutionSequence)??[]}),i=$=>{$.stepId?s("step-selected",$.stepId):console.warn("[ExecutionDetails] Agent execution has no stepId:",$)},p=()=>t.planExecution?t.planExecution.completed?"completed":l.value.some(u=>u.status==="RUNNING")?"running":l.value.some(u=>u.status==="FINISHED")?"in-progress":"pending":"unknown",v=()=>{switch(p()){case"completed":return a("chat.status.completed");case"running":return a("chat.status.executing");case"in-progress":return a("chat.status.inProgress");case"pending":return a("chat.status.pending");default:return a("chat.status.unknown")}},d=$=>{switch($){case"RUNNING":return"running";case"FINISHED":return"completed";case"IDLE":default:return"pending"}},m=$=>{switch($){case"RUNNING":return a("chat.status.executing");case"FINISHED":return a("chat.status.completed");case"IDLE":default:return a("chat.status.pending")}},_=$=>{switch($){case"RUNNING":return"carbon:play";case"FINISHED":return"carbon:checkmark";case"IDLE":default:return"carbon:dot-mark"}},I=($,y,u)=>{s("sub-plan-selected",$,y,u)},U=$=>{s("step-selected",$)},S=$=>{if(!$)return"";try{const y=JSON.parse($);return JSON.stringify(y,null,2)}catch{return $}};return($,y)=>{var u,T,w;return h(),g("div",Lp,[$.planExecution?(h(),g("div",Bp,[o("div",qp,[o("h3",jp,c($.planExecution.title||$.$t("chat.planExecution")),1),o("div",{class:se(["plan-status-badge",p()])},c(v()),3)]),$.planExecution.parentActToolCall?(h(),g("div",Vp,[o("div",Hp,[k(r(P),{icon:"carbon:flow",class:"tool-icon"}),o("span",Wp,c($.$t("chat.triggeredByTool"))+":",1),o("span",zp,c($.planExecution.parentActToolCall.name),1)]),$.planExecution.parentActToolCall.parameters?(h(),g("div",Jp,[o("span",Gp,c($.$t("common.parameters"))+":",1),o("pre",Kp,c(S($.planExecution.parentActToolCall.parameters)),1)])):B("",!0)])):B("",!0)])):B("",!0),(((T=(u=$.planExecution)==null?void 0:u.agentExecutionSequence)==null?void 0:T.length)??0)>0?(h(),g("div",Xp,[o("h4",Yp,c($.$t("chat.agentExecutionSequence")),1),(h(!0),g(ne,null,ae((w=$.planExecution)==null?void 0:w.agentExecutionSequence,(E,f)=>{var q;return h(),g("div",{key:E.id||f,class:se(["agent-execution-item",d(E.status)])},[o("div",{class:"agent-header",onClick:z=>i(E)},[o("div",Zp,[k(r(P),{icon:_(E.status),class:"agent-status-icon"},null,8,["icon"]),o("div",em,[o("div",tm,c(E.agentName||$.$t("chat.unknownAgent")),1),o("pre",sm,c(E.agentRequest),1)])]),o("div",om,[o("div",{class:se(["agent-status-badge",d(E.status)])},c(m(E.status)),3),k(r(P),{icon:"carbon:arrow-right",class:"step-select-icon"})])],8,Qp),o("div",nm,[E.result?(h(),g("div",am,[o("div",lm,[k(r(P),{icon:"carbon:checkmark",class:"result-icon"}),o("span",rm,c($.$t("chat.agentResult"))+":",1)]),o("pre",im,c(E.result),1)])):B("",!0),E.errorMessage?(h(),g("div",cm,[o("div",dm,[k(r(P),{icon:"carbon:warning",class:"error-icon"}),o("span",um,c($.$t("chat.errorMessage"))+":",1)]),o("pre",pm,c(E.errorMessage),1)])):B("",!0)]),(q=E.subPlanExecutionRecords)!=null&&q.length?(h(),g("div",mm,[o("div",hm,[k(r(P),{icon:"carbon:tree-view",class:"sub-plans-icon"}),o("span",fm,c($.$t("chat.subPlanExecutions"))+" ("+c(E.subPlanExecutionRecords.length)+") ",1)]),o("div",vm,[(h(!0),g(ne,null,ae(E.subPlanExecutionRecords,(z,Z)=>(h(),oe(Op,{key:z.currentPlanId||Z,"sub-plan":z,"sub-plan-index":Z,"nesting-level":0,"max-nesting-depth":3,"max-visible-steps":2,onSubPlanSelected:I,onStepSelected:U},null,8,["sub-plan","sub-plan-index"]))),128))])])):B("",!0)],2)}),128))])):B("",!0)])}}}),Fs=ue(gm,[["__scopeId","data-v-2d936ebb"]]),bm={key:0,class:"thinking-section"},ym={class:"thinking-header"},_m={class:"thinking-avatar"},Sm={class:"thinking-label"},$m={class:"thinking-content"},wm={key:0,class:"thinking"},km={key:2,class:"default-processing"},Tm={class:"processing-indicator"},Pm=de({__name:"ThinkingSection",props:{thinking:{},thinkingDetails:{},planExecution:{},stepActions:{},genericInput:{},hasContent:{type:Boolean}},emits:["agent-selected","sub-plan-selected","user-input-submitted","step-selected"],setup(n,{emit:e}){const t=n,s=e,a=ce(()=>{var d,m,_,I;return t.thinking||(((m=(d=t.thinkingDetails)==null?void 0:d.agentExecutionSequence)==null?void 0:m.length)??0)>0||(((I=(_=t.planExecution)==null?void 0:_.agentExecutionSequence)==null?void 0:I.length)??0)>0}),l=(d,m)=>{s("agent-selected",d,m)},i=(d,m,_)=>{s("sub-plan-selected",d,m,_)},p=d=>{s("user-input-submitted",d)},v=d=>{s("step-selected",d)};return(d,m)=>a.value?(h(),g("div",bm,[o("div",ym,[o("div",_m,[k(r(P),{icon:"carbon:thinking",class:"thinking-icon"})]),o("div",Sm,c(d.$t("chat.thinkingLabel")),1)]),o("div",$m,[d.thinking?(h(),g("div",wm,[k(r(P),{icon:"carbon:thinking",class:"thinking-icon"}),o("span",null,c(d.thinking),1)])):B("",!0),d.thinkingDetails||d.planExecution?(h(),oe(Fs,{key:1,"plan-execution":d.thinkingDetails||d.planExecution,"step-actions":d.stepActions||[],"generic-input":d.genericInput||"",onAgentSelected:l,onSubPlanSelected:i,onUserInputSubmitted:p,onStepSelected:v},null,8,["plan-execution","step-actions","generic-input"])):!d.hasContent&&d.thinking?(h(),g("div",km,[o("div",Tm,[m[0]||(m[0]=o("div",{class:"thinking-dots"},[o("span"),o("span"),o("span")],-1)),o("span",null,c(d.thinking||d.$t("chat.thinkingProcessing")),1)])])):B("",!0)])])):B("",!0)}}),Em=ue(Pm,[["__scopeId","data-v-c341487f"]]);class yt{static async getDetails(e){try{const t=await fetch(`${this.BASE_URL}/details/${e}`);if(t.status===404)return null;if(!t.ok){const l=await t.text();throw new Error(`Failed to get detailed information: ${t.status} - ${l}`)}const s=await t.text(),a=JSON.parse(s);return a&&typeof a=="object"&&!a.currentPlanId&&(a.currentPlanId=e),a}catch(t){return console.error("[CommonApiService] Failed to get plan details:",t),null}}static async submitFormInput(e,t){const s=await fetch(`${this.BASE_URL}/submit-input/${e}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!s.ok){let l;try{l=await s.json()}catch{l={message:`Failed to submit form input: ${s.status}`}}throw new Error(l.message||`Failed to submit form input: ${s.status}`)}const a=s.headers.get("content-type");return a&&a.indexOf("application/json")!==-1?await s.json():{success:!0}}static async getAllPrompts(){try{const e=await fetch(this.BASE_URL);return await(await this.handleResponse(e)).json()}catch(e){throw console.error("Failed to get Prompt list:",e),e}}static async handleResponse(e){if(!e.ok)try{const t=await e.json();throw new Error(t.message||`API request failed: ${e.status}`)}catch{throw new Error(`API request failed: ${e.status} ${e.statusText}`)}return e}}fe(yt,"BASE_URL","/api/executor");const Cm={class:"user-input-form-container"},Rm={class:"user-input-header"},Im={class:"user-input-title"},Am={class:"user-input-message"},xm={key:0,class:"form-description"},Dm={key:0,class:"form-grid"},Fm=["for"],Mm=["id","name","placeholder","required","onUpdate:modelValue"],Um=["id","name","placeholder","required","onUpdate:modelValue"],Nm=["id","name","placeholder","required","onUpdate:modelValue"],Om=["id","name","placeholder","required","onUpdate:modelValue"],Lm=["id","name","placeholder","required","onUpdate:modelValue"],Bm=["id","name","required","onUpdate:modelValue"],qm={value:""},jm=["value"],Vm={key:6,class:"checkbox-group"},Hm=["id","name","value","onUpdate:modelValue"],Wm={class:"checkbox-label"},zm={key:7,class:"radio-group"},Jm=["id","name","value","onUpdate:modelValue"],Gm={class:"radio-label"},Km=["id","name","placeholder","required","onUpdate:modelValue"],Xm={key:1,class:"form-group"},Ym={for:"form-input-genericInput"},Qm={type:"submit",class:"submit-user-input-btn"},Zm=de({__name:"UserInputForm",props:{userInputWaitState:{},planId:{},genericInput:{}},emits:["user-input-submitted"],setup(n,{emit:e}){const t=n,s=e;$e();const a=tt({}),l=M(t.genericInput||""),i=M(!1),p=M(null),v=()=>{var U;const I=(U=t.userInputWaitState)==null?void 0:U.formInputs;I&&I.length>0&&(!i.value||Object.keys(a).length!==I.length)&&(I.forEach(($,y)=>{(!(y in a)||$.type==="checkbox"&&!Array.isArray(a[y])||$.type!=="checkbox"&&a[y]==="")&&($.type==="checkbox"?a[y]=[]:a[y]="")}),i.value=!0)};Se(()=>{v()}),pe(()=>{var I;return(I=t.userInputWaitState)==null?void 0:I.formInputs},()=>{p.value&&clearTimeout(p.value),p.value=setTimeout(()=>{i.value=!1,v()},100)},{deep:!0});const d=async()=>{var I;try{const U={},S=(I=t.userInputWaitState)==null?void 0:I.formInputs;S&&S.length>0?Object.entries(a).forEach(([$,y])=>{const u=parseInt($,10),T=S[u];if(T){const w=T.label||`input_${$}`;Array.isArray(y)?U[w]=y.join(", "):U[w]=y}}):U.genericInput=l.value,console.log("[UserInputForm] Submitting user input:",U,"for planId:",t.planId),t.planId?(await yt.submitFormInput(t.planId,U),console.log("[UserInputForm] User input submitted successfully")):console.error("[UserInputForm] No planId available for user input submission"),s("user-input-submitted",U)}catch(U){console.error("[UserInputForm] User input submission failed:",U)}},m=I=>I?Array.isArray(I)?I:typeof I=="string"?I.split(",").map(U=>U.trim()).filter(U=>U.length>0):[]:[],_=I=>typeof I=="boolean"?I:typeof I=="string"?I==="true":!1;return _e(()=>{p.value&&clearTimeout(p.value)}),(I,U)=>{var S,$,y,u,T;return h(),g("div",Cm,[o("div",Rm,[k(r(P),{icon:"carbon:user",class:"user-icon"}),o("h4",Im,c(I.$t("chat.userInputRequired")),1)]),o("p",Am,c(((S=I.userInputWaitState)==null?void 0:S.title)??I.$t("chat.userInput.message")),1),($=I.userInputWaitState)!=null&&$.formDescription?(h(),g("p",xm,c((y=I.userInputWaitState)==null?void 0:y.formDescription),1)):B("",!0),o("form",{onSubmit:me(d,["prevent"]),class:"user-input-form"},[(u=I.userInputWaitState)!=null&&u.formInputs&&I.userInputWaitState.formInputs.length>0?(h(),g("div",Dm,[(h(!0),g(ne,null,ae((T=I.userInputWaitState)==null?void 0:T.formInputs,(w,E)=>(h(),g("div",{key:E,class:"form-group"},[o("label",{for:`form-input-${w.label.replace(/\W+/g,"_")}`},c(w.label)+c(_(w.required)?" *":"")+": ",9,Fm),!w.type||w.type==="text"?te((h(),g("input",{key:0,type:"text",id:`form-input-${w.label.replace(/\W+/g,"_")}`,name:w.label,placeholder:w.placeholder||"",required:_(w.required),"onUpdate:modelValue":f=>a[E]=f,class:"form-input"},null,8,Mm)),[[le,a[E]]]):w.type==="email"?te((h(),g("input",{key:1,type:"email",id:`form-input-${w.label.replace(/\W+/g,"_")}`,name:w.label,placeholder:w.placeholder||"",required:_(w.required),"onUpdate:modelValue":f=>a[E]=f,class:"form-input"},null,8,Um)),[[le,a[E]]]):w.type==="number"?te((h(),g("input",{key:2,type:"number",id:`form-input-${w.label.replace(/\W+/g,"_")}`,name:w.label,placeholder:w.placeholder||"",required:_(w.required),"onUpdate:modelValue":f=>a[E]=f,class:"form-input"},null,8,Nm)),[[le,a[E]]]):w.type==="password"?te((h(),g("input",{key:3,type:"password",id:`form-input-${w.label.replace(/\W+/g,"_")}`,name:w.label,placeholder:w.placeholder||"",required:_(w.required),"onUpdate:modelValue":f=>a[E]=f,class:"form-input"},null,8,Om)),[[le,a[E]]]):w.type==="textarea"?te((h(),g("textarea",{key:4,id:`form-input-${w.label.replace(/\W+/g,"_")}`,name:w.label,placeholder:w.placeholder||"",required:_(w.required),"onUpdate:modelValue":f=>a[E]=f,class:"form-input form-textarea",rows:"4"},null,8,Lm)),[[le,a[E]]]):w.type==="select"&&w.options?te((h(),g("select",{key:5,id:`form-input-${w.label.replace(/\W+/g,"_")}`,name:w.label,required:_(w.required),"onUpdate:modelValue":f=>a[E]=f,class:"form-input form-select"},[o("option",qm,c(I.$t("selectCommon.pleaseSelect")),1),(h(!0),g(ne,null,ae(m(w.options),f=>(h(),g("option",{key:f,value:f},c(f),9,jm))),128))],8,Bm)),[[ut,a[E]]]):w.type==="checkbox"&&w.options?(h(),g("div",Vm,[(h(!0),g(ne,null,ae(m(w.options),f=>(h(),g("label",{key:f,class:"checkbox-item"},[te(o("input",{type:"checkbox",id:`form-input-${w.label.replace(/\W+/g,"_")}-${f.replace(/\W+/g,"_")}`,name:w.label,value:f,"onUpdate:modelValue":q=>a[E]=q,class:"form-checkbox"},null,8,Hm),[[kt,a[E]]]),o("span",Wm,c(f),1)]))),128))])):w.type==="radio"&&w.options?(h(),g("div",zm,[(h(!0),g(ne,null,ae(m(w.options),f=>(h(),g("label",{key:f,class:"radio-item"},[te(o("input",{type:"radio",id:`form-input-${w.label.replace(/\W+/g,"_")}-${f.replace(/\W+/g,"_")}`,name:w.label,value:f,"onUpdate:modelValue":q=>a[E]=q,class:"form-radio"},null,8,Jm),[[Os,a[E]]]),o("span",Gm,c(f),1)]))),128))])):te((h(),g("input",{key:8,type:"text",id:`form-input-${w.label.replace(/\W+/g,"_")}`,name:w.label,placeholder:w.placeholder||"",required:_(w.required),"onUpdate:modelValue":f=>a[E]=f,class:"form-input"},null,8,Km)),[[le,a[E]]])]))),128))])):(h(),g("div",Xm,[o("label",Ym,c(I.$t("common.input"))+":",1),te(o("input",{type:"text",id:"form-input-genericInput",name:"genericInput","onUpdate:modelValue":U[0]||(U[0]=w=>l.value=w),class:"form-input"},null,512),[[le,l.value]])])),o("button",Qm,c(I.$t("chat.userInput.submit")),1)],32)])}}}),eh=ue(Zm,[["__scopeId","data-v-043b591c"]]),th={class:"response-section"},sh={class:"response-header"},oh={class:"response-avatar"},nh={class:"response-name"},ah={key:0,class:"response-timestamp"},lh={class:"response-content"},rh={key:1,class:"final-response"},ih=["innerHTML"],ch={class:"response-actions"},dh=["title"],uh=["title"],ph={key:2,class:"response-placeholder"},mh={class:"typing-indicator"},hh={class:"typing-text"},fh={key:3,class:"response-error"},vh={class:"error-text"},gh={key:4,class:"response-empty"},bh={class:"empty-text"},yh=de({__name:"ResponseSection",props:{content:{},isStreaming:{type:Boolean},error:{},timestamp:{},userInputWaitState:{},planId:{},genericInput:{}},emits:["copy","regenerate","retry","user-input-submitted"],setup(n,{emit:e}){const t=n,s=e,{formatResponseText:a,formatTimestamp:l}=Nt(),i=async()=>{if(t.content)try{const m=t.content.replace(/<[^>]*>/g,"");await navigator.clipboard.writeText(m),s("copy")}catch(m){console.error("Failed to copy to clipboard:",m)}},p=()=>{s("regenerate")},v=()=>{s("retry")},d=m=>{console.log("[ResponseSection] User input submitted:",m),s("user-input-submitted",m)};return(m,_)=>{var I;return h(),g("div",th,[o("div",sh,[o("div",oh,[k(r(P),{icon:"carbon:bot",class:"bot-icon"})]),o("div",nh,c(m.$t("chat.botName")),1),m.timestamp?(h(),g("div",ah,c(r(l)(m.timestamp)),1)):B("",!0)]),o("div",lh,[(I=m.userInputWaitState)!=null&&I.waiting?(h(),oe(eh,ss({key:0,"user-input-wait-state":m.userInputWaitState},m.planId?{"plan-id":m.planId}:{},{"generic-input":m.genericInput??"",onUserInputSubmitted:d}),null,16,["user-input-wait-state","generic-input"])):B("",!0),m.content?(h(),g("div",rh,[o("div",{class:"response-text",innerHTML:r(a)(m.content)},null,8,ih),o("div",ch,[o("button",{class:"action-btn copy-btn",onClick:i,title:m.$t("chat.copyResponse")},[k(r(P),{icon:"carbon:copy"})],8,dh),o("button",{class:"action-btn regenerate-btn",onClick:p,title:m.$t("chat.regenerateResponse")},[k(r(P),{icon:"carbon:renew"})],8,uh)])])):m.isStreaming?(h(),g("div",ph,[o("div",mh,[_[0]||(_[0]=o("div",{class:"typing-dots"},[o("span"),o("span"),o("span")],-1)),o("span",hh,c(m.$t("chat.thinkingResponse")),1)])])):m.error?(h(),g("div",fh,[k(r(P),{icon:"carbon:warning",class:"error-icon"}),o("span",vh,c(m.error),1),o("button",{class:"retry-btn",onClick:v},c(m.$t("chat.retry")),1)])):(h(),g("div",gh,[o("span",bh,c(m.$t("chat.waitingForResponse")),1)]))])])}}}),_h=ue(yh,[["__scopeId","data-v-6581a34f"]]),Sh={class:"assistant-message"},$h=de({__name:"AssistantMessage",props:{message:{},isStreaming:{type:Boolean}},emits:["copy","regenerate","retry","step-selected"],setup(n,{emit:e}){const t=n,s=e,a=()=>{s("copy",t.message.id)},l=()=>{s("regenerate",t.message.id)},i=()=>{s("retry",t.message.id)},p=(d,m)=>{console.log("[AssistantMessage] User input submitted:",m,"for message:",d.id)},v=d=>{console.log("[AssistantMessage] Step selected:",d),s("step-selected",d)};return(d,m)=>{var _,I,U,S;return h(),g("div",Sh,[d.message.thinkingDetails?(h(),oe(Em,{key:0,"thinking-details":d.message.thinkingDetails,onStepSelected:v},null,8,["thinking-details"])):B("",!0),d.message.planExecution?(h(),oe(Fs,{key:1,"plan-execution":d.message.planExecution,"step-actions":d.message.stepActions||[],"generic-input":d.message.genericInput||"",onStepSelected:v},null,8,["plan-execution","step-actions","generic-input"])):B("",!0),d.message.content||d.message.error||d.isStreaming||(I=(_=d.message.planExecution)==null?void 0:_.userInputWaitState)!=null&&I.waiting?(h(),oe(_h,ss({key:2,content:d.message.content||"","is-streaming":d.isStreaming||!1},{...d.message.error?{error:d.message.error}:{},...(U=d.message.planExecution)!=null&&U.userInputWaitState?{userInputWaitState:d.message.planExecution.userInputWaitState}:{},...(S=d.message.planExecution)!=null&&S.currentPlanId?{planId:d.message.planExecution.currentPlanId}:{}},{timestamp:d.message.timestamp,"generic-input":d.message.genericInput||"",onCopy:a,onRegenerate:l,onRetry:i,onUserInputSubmitted:m[0]||(m[0]=$=>p(d.message,$))}),null,16,["content","is-streaming","timestamp","generic-input"])):B("",!0)])}}}),wh=ue($h,[["__scopeId","data-v-3810c279"]]),kh=de({__name:"ChatMessage",props:{message:{},isStreaming:{type:Boolean}},emits:["copy","regenerate","retry","step-selected"],setup(n,{emit:e}){const t=n,s=e,{getMessageClasses:a}=Nt(),l=ce(()=>a(t.message)),i=m=>{s("copy",m)},p=m=>{s("regenerate",m)},v=m=>{s("retry",m)},d=m=>{s("step-selected",m)};return(m,_)=>(h(),g("div",{class:se(["chat-message",l.value])},[m.message.type==="user"?(h(),oe(Wu,{key:0,message:m.message},null,8,["message"])):m.message.type==="assistant"?(h(),oe(wh,{key:1,message:m.message,"is-streaming":m.isStreaming||!1,onCopy:i,onRegenerate:p,onRetry:v,onStepSelected:d},null,8,["message","is-streaming"])):B("",!0)],2))}}),Th=ue(kh,[["__scopeId","data-v-218b3735"]]);function At(n){const e={...n};return"agentExecutionSequence"in n&&Array.isArray(n.agentExecutionSequence)&&(e.agentExecutionSequence=n.agentExecutionSequence.map(t=>Ph(t))),e}function Ph(n){const e={...n};return"subPlanExecutionRecords"in n&&Array.isArray(n.subPlanExecutionRecords)&&(e.subPlanExecutionRecords=n.subPlanExecutionRecords.map(t=>At(t))),e}function Eh(n){const e={...n};return"thinkingDetails"in n&&n.thinkingDetails&&(e.thinkingDetails=At(n.thinkingDetails)),"planExecution"in n&&n.planExecution&&(e.planExecution=At(n.planExecution)),"attachments"in n&&Array.isArray(n.attachments)&&(e.attachments=[...n.attachments]),e}function Ch(){const n=M([]),e=M(!1),t=M(null),s=M(null),a=ce(()=>n.value.length>0?n.value[n.value.length-1]:null),l=ce(()=>t.value!==null),i=ce(()=>n.value.length>0),p=(E,f,q)=>{const z={id:`msg_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,type:E,content:f,timestamp:new Date,isStreaming:!1,...q};return n.value.push(z),z},v=(E,f)=>{const q=n.value.findIndex(z=>z.id===E);q!==-1&&(n.value[q]={...n.value[q],...f})},d=E=>{const f=n.value.findIndex(q=>q.id===E);f!==-1&&n.value.splice(f,1)},m=()=>{n.value=[],t.value=null,s.value=null},_=E=>{t.value=E,v(E,{isStreaming:!0})},I=E=>{E&&v(E,{isStreaming:!1}),t.value===E&&(t.value=null)},U=E=>{s.value=E},S=(E,f,q="content")=>{const z=n.value.find(Z=>Z.id===E);z&&typeof z[q]=="string"&&v(E,{[q]:z[q]+f})},$=(E,f)=>{v(E,{thinkingDetails:f})},y=(E,f)=>{v(E,{thinking:f})},u=(E,f)=>{v(E,{planExecution:f})},T=E=>n.value.find(f=>f.id===E),w=E=>n.value.findIndex(f=>f.id===E);return{messages:Qe(n),isLoading:e,streamingMessageId:Qe(t),activeMessageId:Qe(s),lastMessage:a,isStreaming:l,hasMessages:i,addMessage:p,updateMessage:v,removeMessage:d,clearMessages:m,startStreaming:_,stopStreaming:I,setActiveMessage:U,appendToMessage:S,updateMessageThinking:y,updateMessageThinkingDetails:$,updateMessagePlanExecution:u,findMessage:T,getMessageIndex:w}}function Rh(n){const e=M(!1),t=M(!0),s=150,a=async(y=!0)=>{n.value&&(await ge(),n.value.scrollTo({top:n.value.scrollHeight,behavior:y?"smooth":"auto"}))},l=()=>{if(!n.value)return!1;const{scrollTop:y,scrollHeight:u,clientHeight:T}=n.value;return u-y-T<s},i=()=>{if(!n.value)return;const y=l();e.value=!y&&n.value.scrollHeight>n.value.clientHeight,y&&(t.value=!0)},p=()=>{i(),l()||(t.value=!1)},v=async()=>{t.value&&await a()},d=async()=>{t.value=!0,await a()},m=(y,u=!0)=>{if(!n.value)return;const T=n.value.querySelector(`[data-message-id="${y}"]`);T&&T.scrollIntoView({behavior:u?"smooth":"auto",block:"center"})},_=()=>{if(!n.value)return{scrollTop:0,scrollHeight:0,clientHeight:0,isAtTop:!0,isAtBottom:!0,scrollPercentage:0};const{scrollTop:y,scrollHeight:u,clientHeight:T}=n.value,w=y===0,E=y+T>=u-5,f=u>T?y/(u-T)*100:100;return{scrollTop:y,scrollHeight:u,clientHeight:T,isAtTop:w,isAtBottom:E,scrollPercentage:f}},I=()=>{n.value&&n.value.addEventListener("scroll",p,{passive:!0})},U=()=>{n.value&&n.value.removeEventListener("scroll",p)},S=()=>{I(),i()},$=()=>{U()};return Se(()=>{ge(()=>{S()})}),_e(()=>{$()}),{showScrollToBottom:Qe(e),isAutoScrollEnabled:Qe(t),scrollToBottom:a,autoScrollToBottom:v,forceScrollToBottom:d,scrollToMessage:m,isNearBottom:l,checkScrollPosition:i,getScrollInfo:_,addScrollListener:I,removeScrollListener:U,initializeScrollBehavior:S,cleanupScrollBehavior:$}}class Ot{static async sendMessage(e){return Lt.withLlmCheck(async()=>{const t={...e,isVueRequest:!0},s=await fetch(`${this.BASE_URL}/execute`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!s.ok)throw new Error(`API request failed: ${s.status}`);return await s.json()})}static async sendMessageWithDefaultPlan(e){return Lt.withLlmCheck(async()=>{const t="default-plan-id-001000222",s={userRequirement:e.input},a={toolName:t,replacementParams:s,isVueRequest:!0};e.uploadedFiles&&e.uploadedFiles.length>0&&(a.uploadedFiles=e.uploadedFiles,console.log("[DirectApiService] Including uploaded files:",e.uploadedFiles.length)),e.uploadKey&&(a.uploadKey=e.uploadKey,console.log("[DirectApiService] Including uploadKey:",e.uploadKey)),console.log("[DirectApiService] Sending message with default plan:",a);const l=await fetch(`${this.BASE_URL}/executeByToolNameAsync`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!l.ok)throw new Error(`API request failed: ${l.status}`);return await l.json()})}}fe(Ot,"BASE_URL","/api/executor");const Ih=Object.freeze(Object.defineProperty({__proto__:null,DirectApiService:Ot},Symbol.toStringTag,{value:"Module"})),Fe=class Fe{constructor(){fe(this,"POLL_INTERVAL",5e3);fe(this,"state",tt({activePlanId:null,lastSequenceSize:0,isPolling:!1,pollTimer:null}));fe(this,"callbacks",{});fe(this,"planExecutionCache",new Map);fe(this,"uiStateCache",new Map);console.log("[PlanExecutionManager] Initialized with callback-based event system")}getCachedPlanRecord(e){return this.planExecutionCache.get(e)}getCachedUIState(e){return this.uiStateCache.get(e)}setCachedUIState(e,t){this.uiStateCache.set(e,t),console.log(`[PlanExecutionManager] Cached UI state for rootPlanId: ${e}`)}getAllCachedRecords(){return new Map(this.planExecutionCache)}hasCachedPlanRecord(e){return this.planExecutionCache.has(e)}setCachedPlanRecord(e,t){this.planExecutionCache.set(e,t),console.log(`[PlanExecutionManager] Cached plan execution record for rootPlanId: ${e}`)}clearCachedPlanRecord(e){const t=this.planExecutionCache.delete(e);return t&&console.log(`[PlanExecutionManager] Cleared cached plan execution record for rootPlanId: ${e}`),t}clearAllCachedRecords(){const e=this.planExecutionCache.size,t=this.uiStateCache.size;this.planExecutionCache.clear(),this.uiStateCache.clear(),console.log(`[PlanExecutionManager] Cleared all caches - Plans: ${e}, UI States: ${t}`)}static getInstance(){return Fe.instance||(Fe.instance=new Fe),Fe.instance}getActivePlanId(){return this.state.activePlanId}getState(){return this.state}setEventCallbacks(e){this.callbacks={...this.callbacks,...e},console.log("[PlanExecutionManager] Event callbacks set:",Object.keys(e))}async handleUserMessageSendRequested(e){if(this.validateAndPrepareUIForNewRequest(e))try{if(await this.sendUserMessageAndSetPlanId(e),this.state.activePlanId)this.initiatePlanExecutionSequence(e,this.state.activePlanId);else throw new Error("Failed to get valid plan ID")}catch(t){console.error("[PlanExecutionManager] Failed to send user message:",t);const s=this.state.activePlanId??"error";this.setCachedUIState(s,{enabled:!0}),this.emitChatInputUpdateState(s),this.state.activePlanId=null}}handlePlanExecutionRequested(e,t){console.log("[PlanExecutionManager] Received plan execution request:",{planId:e,query:t}),e?(this.state.activePlanId=e,this.initiatePlanExecutionSequence(t??"Execute Plan",e)):console.error("[PlanExecutionManager] Invalid plan execution request: missing planId")}handleCachedPlanExecution(e,t){const s=this.getCachedPlanRecord(e);return s!=null&&s.currentPlanId?(console.log(`[PlanExecutionManager] Found cached plan execution record for rootPlanId: ${e}`),this.handlePlanExecutionRequested(s.currentPlanId,t),!0):(console.log(`[PlanExecutionManager] No cached plan execution record found for rootPlanId: ${e}`),!1)}validateAndPrepareUIForNewRequest(e){if(!e)return console.warn("[PlanExecutionManager] Query is empty"),!1;if(this.state.activePlanId)return!1;this.emitChatInputClear();const t=this.state.activePlanId??"ui-state";return this.setCachedUIState(t,{enabled:!1,placeholder:"Processing..."}),this.emitChatInputUpdateState(t),!0}async sendUserMessageAndSetPlanId(e){try{const t=await Ot.sendMessage({input:e});if(t!=null&&t.planId)return this.state.activePlanId=t.planId,t;if(t!=null&&t.planTemplateId)return this.state.activePlanId=t.planTemplateId,{...t,planId:t.planTemplateId};throw console.error("[PlanExecutionManager] Failed to get planId from response:",t),new Error("Failed to get valid planId from API response")}catch(t){throw console.error("[PlanExecutionManager] API call failed:",t),t}}initiatePlanExecutionSequence(e,t){console.log(`[PlanExecutionManager] Starting plan execution sequence for query: "${e}", planId: ${t}`);const s=t;this.emitDialogRoundStart(s),this.startPolling()}handlePlanCompletion(e){this.emitPlanCompleted(e.rootPlanId??""),this.state.lastSequenceSize=0,this.stopPolling();try{setTimeout(async()=>{if(this.state.activePlanId)try{await Ze.deletePlanTemplate(this.state.activePlanId),console.log(`[PlanExecutionManager] Plan template ${this.state.activePlanId} deleted successfully`)}catch(t){console.log(`Delete plan execution record failed: ${t.message}`)}},5e3)}catch(t){console.log(`Delete plan execution record failed: ${t.message}`)}e.completed&&(this.state.activePlanId=null,this.emitChatInputUpdateState(e.rootPlanId??""))}handlePlanError(e){this.emitPlanError(e.message??""),this.state.lastSequenceSize=0,this.stopPolling();try{setTimeout(async()=>{if(this.state.activePlanId)try{await Ze.deletePlanTemplate(this.state.activePlanId),console.log(`[PlanExecutionManager] Plan template ${this.state.activePlanId} deleted successfully`)}catch(t){console.log(`Delete plan execution record failed: ${t.message}`)}},5e3)}catch(t){console.log(`Delete plan execution record failed: ${t.message}`)}}async pollPlanStatus(){if(this.state.activePlanId){if(this.state.isPolling){console.log("[PlanExecutionManager] Previous polling still in progress, skipping");return}try{this.state.isPolling=!0;const e=await this.getPlanDetails(this.state.activePlanId);if(!e){console.warn("[PlanExecutionManager] No details received from API - this might be a temporary network issue");return}if(e.status&&e.status==="failed"&&e.message&&!e.message.includes("Failed to get detailed information")){this.handlePlanError(e);return}e.rootPlanId&&this.setCachedPlanRecord(e.rootPlanId,e),this.emitPlanUpdate(e.rootPlanId??""),e.completed&&this.handlePlanCompletion(e)}catch(e){console.error("[PlanExecutionManager] Failed to poll plan status:",e)}finally{this.state.isPolling=!1}}}async getPlanDetails(e){try{const t=await yt.getDetails(e);return t!=null&&t.rootPlanId&&(this.planExecutionCache.set(t.rootPlanId,t),console.log(`[PlanExecutionManager] Cached plan execution record for rootPlanId: ${t.rootPlanId}`)),t}catch(t){return console.error("[PlanExecutionManager] Failed to get plan details:",t),{currentPlanId:e,status:"failed",message:t instanceof Error?t.message:"Failed to get plan"}}}startPolling(){this.state.pollTimer&&clearInterval(this.state.pollTimer),this.state.pollTimer=window.setInterval(()=>{this.pollPlanStatus()},this.POLL_INTERVAL),console.log("[PlanExecutionManager] Started polling")}async pollPlanStatusImmediately(){console.log("[PlanExecutionManager] Polling plan status immediately"),await this.pollPlanStatus()}stopPolling(){this.state.pollTimer&&(clearInterval(this.state.pollTimer),this.state.pollTimer=null),console.log("[PlanExecutionManager] Stopped polling")}cleanup(){this.stopPolling(),this.state.activePlanId=null,this.state.lastSequenceSize=0,this.state.isPolling=!1,this.clearAllCachedRecords()}emitChatInputClear(){this.callbacks.onChatInputClear&&this.callbacks.onChatInputClear()}emitChatInputUpdateState(e){this.callbacks.onChatInputUpdateState&&this.callbacks.onChatInputUpdateState(e)}emitDialogRoundStart(e){this.callbacks.onDialogRoundStart&&this.callbacks.onDialogRoundStart(e)}emitPlanUpdate(e){this.callbacks.onPlanUpdate&&this.callbacks.onPlanUpdate(e)}emitPlanCompleted(e){this.callbacks.onPlanCompleted&&this.callbacks.onPlanCompleted(e)}emitPlanError(e){this.callbacks.onPlanError&&this.callbacks.onPlanError(e)}};fe(Fe,"instance",null);let xt=Fe;const Re=xt.getInstance(),Ah={class:"chat-container"},xh={key:0,class:"loading-message"},Dh={class:"loading-content"},Fh=["title"],Mh=de({__name:"ChatContainer",props:{mode:{default:"plan"},initialPrompt:{default:""}},emits:["step-selected"],setup(n,{expose:e,emit:t}){const s=t,{t:a}=$e(),{messages:l,isLoading:i,streamingMessageId:p,addMessage:v,updateMessage:d,startStreaming:m,stopStreaming:_,findMessage:I}=Ch(),U=M(null),{scrollToBottom:S,autoScrollToBottom:$,showScrollToBottom:y}=Rh(U),u=M(),T=R=>p.value===R,w=ce(()=>l.value.map(Eh)),E=()=>{},f=R=>{const J=R.target;if(J.classList.contains("md-copy-btn")){const K=J.getAttribute("data-raw");if(K){const F=decodeURIComponent(K);navigator.clipboard.writeText(F).then(()=>{J.textContent=a("chat.copied"),setTimeout(()=>{J.textContent=a("chat.copy")},1e3)})}}},q=async R=>{const J=I(R);if(J)try{const K=J.content.replace(/<[^>]*>/g,"");await navigator.clipboard.writeText(K)}catch(K){console.error("Failed to copy message:",K)}},z=R=>{const J=I(R);J&&J.type==="assistant"&&(d(R,{content:""}),m(R))},Z=R=>{I(R)&&(d(R,{content:""}),m(R))},A=R=>{console.log("[ChatContainer] Step selected:",R),s("step-selected",R)},N=R=>{console.log("[ChatContainer] Plan update received:",R);const J=Re.getCachedPlanRecord(R);if(!J){console.warn("[ChatContainer] No cached plan data found for rootPlanId:",R);return}console.log("[ChatContainer] Retrieved plan details from cache:",J);const K=l.value.findIndex(F=>{var D;return((D=F.planExecution)==null?void 0:D.currentPlanId)===J.currentPlanId&&F.type==="assistant"});if(K!==-1){const F=l.value[K],D={planExecution:JSON.parse(JSON.stringify(J))};if(!J.agentExecutionSequence||J.agentExecutionSequence.length===0){if(console.log("[ChatContainer] Handling simple response without agent execution sequence"),J.completed){D.thinking="";const X=J.summary??J.result??J.message??"Execution completed";D.content=X,console.log("[ChatContainer] Set simple response content:",X)}}else console.log("[ChatContainer] Handling detailed plan with agent execution sequence");d(F.id,D)}},x=R=>{if(console.log("[ChatContainer] Plan completed:",R),R.rootPlanId){const J=l.value.findIndex(K=>{var F;return((F=K.planExecution)==null?void 0:F.currentPlanId)===R.rootPlanId});if(J!==-1){const K=l.value[J],F=R.summary??R.result??"Execution completed";d(K.id,{thinking:"",content:F}),console.log("[ChatContainer] Updated completed message:",F)}}},H=R=>{console.log("[ChatContainer] Dialog round start:",R)},b=R=>{console.log("[ChatContainer] Plan error:",R),v("assistant",`Error: ${R}`),console.error("[ChatContainer] Plan execution error:",R)};return Se(()=>{pe(l,()=>{ge(()=>{$()})},{deep:!0}),Re.setEventCallbacks({onPlanUpdate:N,onPlanCompleted:x,onDialogRoundStart:H,onPlanError:b})}),_e(()=>{u.value&&clearInterval(u.value)}),e({scrollToBottom:S,handlePlanUpdate:N,handlePlanCompleted:x,handleDialogRoundStart:H,handlePlanError:b,addMessage:v,updateMessage:d,startStreaming:m,stopStreaming:_}),(R,J)=>(h(),g("div",Ah,[o("div",{class:"messages",ref_key:"messagesRef",ref:U,onScroll:E,onClick:f},[(h(!0),g(ne,null,ae(w.value,K=>(h(),oe(Th,{key:K.id,message:K,"is-streaming":T(K.id),onCopy:q,onRegenerate:z,onRetry:Z,onStepSelected:A},null,8,["message","is-streaming"]))),128)),r(i)?(h(),g("div",xh,[o("div",Dh,[k(r(P),{icon:"carbon:circle-dash",class:"loading-icon"}),o("span",null,c(R.$t("chat.processing")),1)])])):B("",!0)],544),k(Ue,{name:"scroll-button"},{default:Ie(()=>[r(y)?(h(),g("button",{key:0,class:"scroll-to-bottom",onClick:J[0]||(J[0]=()=>r(S)()),title:R.$t("chat.scrollToBottom")},[k(r(P),{icon:"carbon:chevron-down"})],8,Fh)):B("",!0)]),_:1})]))}}),Uh=ue(Mh,[["__scopeId","data-v-e7a5d6c9"]]),Nh={class:"input-area"},Oh={class:"input-container"},Lh=["placeholder","disabled"],Bh=["title"],qh=["disabled","title"],jh=de({__name:"InputArea",props:{placeholder:{default:""},disabled:{type:Boolean,default:!1},initialValue:{default:""}},emits:["send","clear","update-state","plan-mode-clicked"],setup(n,{expose:e,emit:t}){const{t:s}=$e(),a=n,l=t,i=M(),p=M(),v=M(""),d=ce(()=>a.placeholder||s("input.placeholder")),m=M(d.value),_=M([]),I=M(null),U=()=>{var b;console.log("[FileUpload] Resetting session and clearing uploadKey"),(b=p.value)==null||b.resetSession()};_e(()=>{U()});const S=(b,R)=>{_.value=b.map(J=>J.originalName),I.value=R,console.log("[InputArea] Files uploaded:",b.length,"uploadKey:",R),_.value.length>0&&(m.value=s("input.filesAttached",{count:_.value.length}))},$=b=>{_.value=b.map(R=>R.originalName),console.log("[InputArea] Files removed, remaining:",b.length),_.value.length===0?m.value=d.value:m.value=s("input.filesAttached",{count:_.value.length})},y=b=>{I.value=b,console.log("[InputArea] Upload key changed:",b)},u=()=>{console.log("[InputArea] Upload started")},T=()=>{console.log("[InputArea] Upload completed")},w=b=>{console.error("[InputArea] Upload error:",b)},E=ce(()=>!!a.disabled),f=()=>{ge(()=>{i.value&&(i.value.style.height="auto",i.value.style.height=Math.min(i.value.scrollHeight,120)+"px")})},q=b=>{b.key==="Enter"&&!b.shiftKey&&(b.preventDefault(),z())},z=()=>{if(!v.value.trim()||E.value)return;const R={input:v.value.trim(),memoryId:xe.selectMemoryId,uploadedFiles:_.value};I.value?(R.uploadKey=I.value,console.log("[InputArea] Including uploadKey in message:",I.value)):console.log("[InputArea] No uploadKey available for message"),l("send",R),A()},Z=()=>{l("plan-mode-clicked")},A=()=>{v.value="",f(),l("clear")},N=(b,R)=>{R&&(m.value=b?R:s("input.waiting")),l("update-state",b,R)},x=b=>{v.value=b,f()},H=()=>v.value.trim();return pe(()=>a.initialValue,b=>{b&&b.trim()&&(v.value=b,f())},{immediate:!0}),e({clearInput:A,updateState:N,setInputValue:x,getQuery:H,resetSession:U,focus:()=>{var b;return(b=i.value)==null?void 0:b.focus()},get uploadedFiles(){var b,R;return((R=(b=p.value)==null?void 0:b.uploadedFiles)==null?void 0:R.map(J=>J.originalName))||[]},get uploadKey(){var b;return((b=p.value)==null?void 0:b.uploadKey)||null}}),Se(()=>{}),_e(()=>{}),(b,R)=>(h(),g("div",Nh,[k(xs,{ref_key:"fileUploadRef",ref:p,disabled:E.value,onFilesUploaded:S,onFilesRemoved:$,onUploadKeyChanged:y,onUploadStarted:u,onUploadCompleted:T,onUploadError:w},null,8,["disabled"]),o("div",Oh,[te(o("textarea",{"onUpdate:modelValue":R[0]||(R[0]=J=>v.value=J),ref_key:"inputRef",ref:i,class:"chat-input",placeholder:m.value,disabled:E.value,onKeydown:q,onInput:f},null,40,Lh),[[le,v.value]]),o("button",{class:"plan-mode-btn",title:b.$t("input.planMode"),onClick:Z},[k(r(P),{icon:"carbon:document"}),ee(" "+c(b.$t("input.planMode")),1)],8,Bh),o("button",{class:"send-button",disabled:!v.value.trim()||E.value,onClick:z,title:b.$t("input.send")},[k(r(P),{icon:"carbon:send-alt"}),ee(" "+c(b.$t("input.send")),1)],8,qh)])]))}}),Vh=ue(jh,[["__scopeId","data-v-84fb4aeb"]]);class Le{static async getAllCronTasks(){try{const e=await fetch(this.BASE_URL);return await(await this.handleResponse(e)).json()}catch(e){throw console.error("Failed to get cron tasks:",e),e}}static async getCronTaskById(e){try{const t=await fetch(`${this.BASE_URL}/${e}`);return await(await this.handleResponse(t)).json()}catch(t){throw console.error("Failed to get cron task by id:",t),t}}static async createCronTask(e){try{const t=await fetch(this.BASE_URL,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});return await(await this.handleResponse(t)).json()}catch(t){throw console.error("Failed to create cron task:",t),t}}static async updateCronTask(e,t){try{const s=await fetch(`${this.BASE_URL}/${e}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});return await(await this.handleResponse(s)).json()}catch(s){throw console.error("Failed to update cron task:",s),s}}static async updateTaskStatus(e,t){try{const s=await fetch(`${this.BASE_URL}/${e}/status?status=${t}`,{method:"PUT"});await this.handleResponse(s)}catch(s){throw console.error("Failed to update task status:",s),s}}static async deleteCronTask(e){try{const t=await fetch(`${this.BASE_URL}/${e}`,{method:"DELETE"});await this.handleResponse(t)}catch(t){throw console.error("Failed to delete cron task:",t),t}}static async handleResponse(e){if(!e.ok)try{const t=await e.json();throw new Error(t.message||`API request failed: ${e.status}`)}catch{throw new Error(`API request failed: ${e.status} ${e.statusText}`)}return e}}fe(Le,"BASE_URL","/api/cron-tasks");const Be={validateCronExpression(n){const e=n.trim().split(/\s+/);return e.length>=5&&e.length<=6},formatTime(n){return new Date(n).toLocaleString()},async saveTask(n){try{let e;return n.id?e=await Le.updateCronTask(Number(n.id),n):e=await Le.createCronTask(n),e}catch(e){throw console.error("Failed to save cron task:",e),e}},async deleteTask(n){try{await Le.deleteCronTask(String(n))}catch(e){throw console.error("Failed to delete cron task:",e),e}},async toggleTaskStatus(n){if(!n.id)throw new Error("Task ID is required");const e=n.status===0?1:0;return await Le.updateCronTask(Number(n.id),{...n,status:e})},prepareTaskExecution(n){return n.planTemplateId?{useTemplate:!0,planData:{title:n.cronName||"Scheduled Task Execution",planData:{id:n.planTemplateId,planTemplateId:n.planTemplateId,planId:n.planTemplateId},params:n.executionParams||void 0}}:{useTemplate:!1,taskContent:n.planDesc||n.cronName||""}}},Hh={class:"modal-header"},Wh={class:"header-actions"},zh={class:"status-switch"},Jh={class:"status-label"},Gh={class:"toggle-switch"},Kh=["checked"],Xh={class:"modal-content"},Yh={class:"form-group"},Qh={class:"form-label"},Zh=["placeholder"],ef={class:"form-group"},tf={class:"form-label"},sf=["placeholder"],of={class:"form-help"},nf={class:"form-group"},af={class:"form-label"},lf=["placeholder"],rf={class:"form-group"},cf={class:"form-label"},df={class:"template-toggle"},uf={key:0,class:"template-selector"},pf={value:""},mf=["value"],hf={class:"form-help"},ff={key:0,class:"form-group"},vf={class:"time-info"},gf={class:"time-label"},bf={class:"time-value"},yf={key:1,class:"form-group"},_f={class:"time-info"},Sf={class:"time-label"},$f={class:"time-value"},wf={class:"modal-footer"},kf=["disabled"],Tf=de({__name:"TaskDetailModal",props:{modelValue:{type:Boolean},task:{}},emits:["update:modelValue","save"],setup(n,{emit:e}){const t=n,s=e,a=M(!1),l=M([]),i=M({cronName:"",cronTime:"",planDesc:"",status:1,linkTemplate:!1,templateId:"",planTemplateId:""}),p=async()=>{try{const S=await Ze.getAllPlanTemplates();S&&S.templates&&(l.value=S.templates.map($=>({id:$.id,name:$.title||"Unnamed Template"})))}catch(S){console.error("Failed to get template list:",S)}},v=S=>{S.key==="Escape"&&t.modelValue&&s("update:modelValue",!1)};Se(()=>{p(),document.addEventListener("keydown",v)}),_e(()=>{document.removeEventListener("keydown",v)});const d=S=>{S.target===S.currentTarget&&s("update:modelValue",!1)},m=()=>{i.value.linkTemplate=!1,i.value.templateId="",i.value.planTemplateId=""},_=()=>i.value.cronName.trim()?i.value.cronTime.trim()?Be.validateCronExpression(i.value.cronTime)?i.value.planDesc.trim()?i.value.linkTemplate&&!i.value.templateId?(alert("Please select a plan template"),!1):!0:(alert("Task description cannot be empty"),!1):(alert("Invalid Cron expression format, should be 5-6 parts separated by spaces"),!1):(alert("Cron expression cannot be empty"),!1):(alert("Task name cannot be empty"),!1),I=S=>Be.formatTime(S),U=async()=>{var S;if(_()){a.value=!0;try{const $={...i.value,...((S=t.task)==null?void 0:S.id)!==void 0&&{id:t.task.id},cronName:i.value.cronName.trim(),cronTime:i.value.cronTime.trim(),planDesc:i.value.planDesc.trim(),status:i.value.status,planTemplateId:i.value.linkTemplate&&i.value.templateId||""};s("save",$)}finally{a.value=!1}}};return pe(()=>t.task,S=>{if(S){const $=S.templateId||S.planTemplateId||"";i.value={cronName:S.cronName||"",cronTime:S.cronTime||"",planDesc:S.planDesc||"",status:S.status??1,linkTemplate:!!$,templateId:$,planTemplateId:$}}else i.value={cronName:"",cronTime:"",planDesc:"",status:1,linkTemplate:!1,templateId:"",planTemplateId:""}},{immediate:!0}),pe(()=>t.modelValue,S=>{S||(i.value={cronName:"",cronTime:"",planDesc:"",status:1,linkTemplate:!1,templateId:"",planTemplateId:""})}),(S,$)=>(h(),oe(Ye,{to:"body"},[k(Ue,{name:"modal"},{default:Ie(()=>{var y,u,T;return[S.modelValue?(h(),g("div",{key:0,class:"modal-overlay",onClick:d},[o("div",{class:"modal-container",onClick:$[8]||($[8]=me(()=>{},["stop"]))},[o("div",Hh,[o("h3",null,c(S.$t("cronTask.taskDetail")),1),o("div",Wh,[o("div",zh,[o("span",Jh,c(S.$t("cronTask.taskStatus")),1),o("label",Gh,[o("input",{type:"checkbox",checked:i.value.status===0,onChange:$[0]||($[0]=w=>i.value.status=i.value.status===0?1:0)},null,40,Kh),$[9]||($[9]=o("span",{class:"toggle-slider"},null,-1))])]),o("button",{class:"close-btn",onClick:$[1]||($[1]=w=>S.$emit("update:modelValue",!1))},[k(r(P),{icon:"carbon:close"})])])]),o("div",Xh,[o("form",{onSubmit:me(U,["prevent"]),class:"task-form"},[o("div",Yh,[o("label",Qh,c(S.$t("cronTask.taskName")),1),te(o("input",{"onUpdate:modelValue":$[2]||($[2]=w=>i.value.cronName=w),type:"text",class:"form-input",placeholder:S.$t("cronTask.taskNamePlaceholder"),required:""},null,8,Zh),[[le,i.value.cronName]])]),o("div",ef,[o("label",tf,c(S.$t("cronTask.cronExpression")),1),te(o("input",{"onUpdate:modelValue":$[3]||($[3]=w=>i.value.cronTime=w),type:"text",class:"form-input",placeholder:S.$t("cronTask.cronExpressionPlaceholder"),required:""},null,8,sf),[[le,i.value.cronTime]]),o("div",of,c(S.$t("cronTask.cronExpressionHelp")),1)]),o("div",nf,[o("label",af,c(S.$t("cronTask.taskDescription")),1),te(o("textarea",{"onUpdate:modelValue":$[4]||($[4]=w=>i.value.planDesc=w),class:"form-textarea",placeholder:S.$t("cronTask.taskDescriptionPlaceholder"),rows:"4",required:""},null,8,lf),[[le,i.value.planDesc]])]),o("div",rf,[o("label",cf,c(S.$t("cronTask.planTemplate")),1),o("div",df,[o("button",{type:"button",class:se(["template-btn",i.value.linkTemplate?"active":""]),onClick:$[5]||($[5]=w=>i.value.linkTemplate=!0)},[k(r(P),{icon:"carbon:checkmark"}),ee(" "+c(S.$t("cronTask.linkTemplate")),1)],2),o("button",{type:"button",class:se(["template-btn",i.value.linkTemplate?"":"active"]),onClick:m},[k(r(P),{icon:"carbon:close"}),ee(" "+c(S.$t("cronTask.noTemplate")),1)],2)]),i.value.linkTemplate?(h(),g("div",uf,[te(o("select",{"onUpdate:modelValue":$[6]||($[6]=w=>i.value.templateId=w),class:"form-select"},[o("option",pf,c(S.$t("cronTask.selectTemplate")),1),(h(!0),g(ne,null,ae(l.value,w=>(h(),g("option",{key:w.id,value:w.id},c(w.name),9,mf))),128))],512),[[ut,i.value.templateId]]),o("div",hf,c(S.$t("cronTask.templateHelpText")),1)])):B("",!0)]),(y=S.task)!=null&&y.createTime?(h(),g("div",ff,[o("div",vf,[o("span",gf,c(S.$t("cronTask.createTime"))+":",1),o("span",bf,c(I(S.task.createTime)),1)])])):B("",!0),(u=S.task)!=null&&u.updateTime?(h(),g("div",yf,[o("div",_f,[o("span",Sf,c(S.$t("cronTask.updateTime"))+":",1),o("span",$f,c(I(S.task.updateTime)),1)])])):B("",!0)],32)]),o("div",wf,[o("button",{type:"button",class:"cancel-btn",onClick:$[7]||($[7]=w=>S.$emit("update:modelValue",!1))},c(S.$t("common.cancel")),1),o("button",{type:"button",class:"save-btn",onClick:U,disabled:a.value},[a.value?(h(),oe(r(P),{key:0,icon:"carbon:loading",class:"loading-icon"})):B("",!0),ee(" "+c((T=t.task)!=null&&T.id?S.$t("common.save"):S.$t("common.create")),1)],8,kf)])])])):B("",!0)]}),_:1})]))}}),Pf=ue(Tf,[["__scopeId","data-v-45bbcf14"]]),Ef={class:"modal-header"},Cf={class:"header-actions"},Rf={class:"modal-content"},If={key:0,class:"loading-container"},Af={key:1,class:"empty-container"},xf={key:2,class:"task-list"},Df=["onClick"],Ff={class:"task-main"},Mf={class:"task-info"},Uf={class:"task-header"},Nf={class:"task-name"},Of={class:"task-description"},Lf={class:"task-time"},Bf=["onClick"],qf=["onClick","disabled","title"],jf=["onClick","title"],Vf={class:"dropdown-menu"},Hf=["onClick"],Wf=["onClick","disabled"],zf=["onClick","disabled"],Jf={class:"confirm-header"},Gf={class:"confirm-content"},Kf={class:"confirm-actions"},Xf=["disabled"],Yf={class:"confirm-header"},Qf={class:"confirm-content"},Zf={class:"create-options"},ev={class:"option-content"},tv={class:"option-title"},sv={class:"option-desc"},ov={class:"option-content"},nv={class:"option-title"},av={class:"option-desc"},lv={class:"confirm-actions"},rv=de({__name:"CronTaskModal",props:{modelValue:{type:Boolean,required:!0}},emits:["update:modelValue"],setup(n,{emit:e}){const t=os(),s=ns(),a=as(),{t:l}=$e(),i=n,p=e,v=M([]),d=M(!1),m=M(null),_=M(null),I=M(null),U=M(null),S=M(!1),$=M(null),y=M(!1),u=M(null),T=M(!1),w=O=>{O.target===O.currentTarget&&p("update:modelValue",!1)},E=async()=>{d.value=!0;try{v.value=await Le.getAllCronTasks()}catch(O){console.error("Failed to load cron tasks:",O),a.error(`Failed to load tasks: ${O instanceof Error?O.message:String(O)}`)}finally{d.value=!1}},f=async O=>{m.value=O;try{const V=v.value.find(j=>j.id===O);if(!V){console.error("Task not found:",O);return}p("update:modelValue",!1);const Y=Date.now().toString();await t.push({name:"direct",params:{id:Y}}),await new Promise(j=>setTimeout(j,100));const L=Be.prepareTaskExecution(V);L.useTemplate&&L.planData?s.emitPlanExecutionRequested(L.planData):L.taskContent&&s.setTask(L.taskContent)}catch(V){console.error("Failed to execute task:",V),a.error(`Execution failed: ${V instanceof Error?V.message:String(V)}`)}finally{m.value=null}},q=O=>{$.value={...O},S.value=!0,U.value=null},z=async O=>{try{await Be.saveTask(O),await E(),S.value=!1,a.success("Task saved successfully")}catch(V){console.error("Failed to save task:",V),a.error(`Save failed: ${V instanceof Error?V.message:String(V)}`)}},Z=O=>{u.value=O,y.value=!0},A=async()=>{var O;if((O=u.value)!=null&&O.id){_.value=u.value.id;try{await Be.deleteTask(u.value.id),await E(),y.value=!1,u.value=null,a.success("Task deleted successfully")}catch(V){console.error("Failed to delete task:",V),a.error(`Delete failed: ${V instanceof Error?V.message:String(V)}`)}finally{_.value=null}}},N=()=>{y.value=!1,u.value=null},x=O=>{U.value=U.value===O?null:O},H=async O=>{if(O.id){I.value=O.id;try{await Be.toggleTaskStatus(O),await E(),U.value=null,a.success(`Task ${O.status===0?"disabled":"enabled"} successfully`)}catch(V){console.error("Failed to toggle task status:",V),a.error(`Status toggle failed: ${V instanceof Error?V.message:String(V)}`)}finally{I.value=null}}},b=async O=>{try{await navigator.clipboard.writeText(O),a.success("Cron expression copied successfully")}catch(V){a.error(`Copy failed: ${V instanceof Error?V.message:String(V)}`)}},R=()=>{T.value=!0},J=()=>{T.value=!1;try{p("update:modelValue",!1);const O=l("cronTask.template");s.setTaskToInput(O);const V=Date.now().toString();t.push({name:"direct",params:{id:V}})}catch(O){console.error("Error in createWithJmanus:",O),a.error(`Creation failed: ${O instanceof Error?O.message:String(O)}`)}},K=()=>{T.value=!1,$.value={cronName:"",cronTime:"",planDesc:"",status:0,planTemplateId:""},S.value=!0},F=()=>{T.value=!1},D=O=>{const V=O.target;!V.closest(".action-dropdown")&&!V.closest(".dropdown-menu")&&(U.value=null)},X=O=>{O.key==="Escape"&&(y.value?N():T.value?F():i.modelValue&&p("update:modelValue",!1))};return Se(()=>{document.addEventListener("click",D,!0),document.addEventListener("keydown",X)}),_e(()=>{document.removeEventListener("click",D,!0),document.removeEventListener("keydown",X)}),pe(()=>i.modelValue,O=>{O&&E()}),(O,V)=>(h(),g(ne,null,[(h(),oe(Ye,{to:"body"},[k(Ue,{name:"modal"},{default:Ie(()=>[n.modelValue?(h(),g("div",{key:0,class:"modal-overlay",onClick:w},[o("div",{class:"modal-container",onClick:V[3]||(V[3]=me(()=>{},["stop"]))},[o("div",Ef,[o("h3",null,c(O.$t("cronTask.title")),1),o("div",Cf,[o("button",{class:"add-task-btn",onClick:[R,V[0]||(V[0]=me(()=>{},["stop"]))]},[k(r(P),{icon:"carbon:add"}),ee(" "+c(O.$t("cronTask.addTask")),1)]),o("button",{class:"close-btn",onClick:V[1]||(V[1]=Y=>O.$emit("update:modelValue",!1))},[k(r(P),{icon:"carbon:close"})])])]),o("div",Rf,[d.value?(h(),g("div",If,[k(r(P),{icon:"carbon:loading",class:"loading-icon"}),o("span",null,c(O.$t("common.loading")),1)])):v.value.length===0?(h(),g("div",Af,[k(r(P),{icon:"carbon:time",class:"empty-icon"}),o("span",null,c(O.$t("cronTask.noTasks")),1)])):(h(),g("div",xf,[(h(!0),g(ne,null,ae(v.value,Y=>(h(),g("div",{key:Y.id||"",class:"task-item",onClick:L=>q(Y)},[o("div",Ff,[o("div",Mf,[o("div",Uf,[o("div",Nf,c(Y.cronName),1),o("div",{class:se(["task-status-badge",Y.status===0?"active":"inactive"])},[k(r(P),{icon:Y.status===0?"carbon:checkmark-filled":"carbon:pause-filled"},null,8,["icon"]),o("span",null,c(Y.status===0?O.$t("cronTask.active"):O.$t("cronTask.inactive")),1)],2)]),o("div",Of,c(Y.planDesc),1),o("div",Lf,[k(r(P),{icon:"carbon:time"}),o("span",{class:"cron-readable",style:{cursor:"pointer"},onClick:me(L=>b(Y.cronTime),["stop"])},c(Y.cronTime),9,Bf)])])]),o("div",{class:"task-actions",onClick:V[2]||(V[2]=me(()=>{},["stop"]))},[o("button",{class:"action-btn execute-btn",onClick:L=>f(Y.id),disabled:m.value===Y.id,title:O.$t("cronTask.executeOnce")},[k(r(P),{icon:m.value===Y.id?"carbon:loading":"carbon:play-filled"},null,8,["icon"]),ee(" "+c(O.$t("cronTask.executeOnce")),1)],8,qf),o("div",{class:se(["action-dropdown",{active:U.value===Y.id}])},[o("button",{class:"action-btn dropdown-btn",onClick:L=>x(Y.id),title:O.$t("cronTask.operations")},[k(r(P),{icon:"carbon:overflow-menu-horizontal"}),ee(" "+c(O.$t("cronTask.operations")),1)],8,jf),te(o("div",Vf,[o("button",{class:"dropdown-item edit-btn",onClick:L=>q(Y)},[k(r(P),{icon:"carbon:edit"}),ee(" "+c(O.$t("cronTask.edit")),1)],8,Hf),o("button",{class:"dropdown-item toggle-btn",onClick:L=>H(Y),disabled:I.value===Y.id},[k(r(P),{icon:I.value===Y.id?"carbon:loading":Y.status===0?"carbon:pause-filled":"carbon:play-filled"},null,8,["icon"]),ee(" "+c(Y.status===0?O.$t("cronTask.disable"):O.$t("cronTask.enable")),1)],8,Wf),o("button",{class:"dropdown-item delete-btn",onClick:L=>Z(Y),disabled:_.value===Y.id},[k(r(P),{icon:_.value===Y.id?"carbon:loading":"carbon:trash-can"},null,8,["icon"]),ee(" "+c(O.$t("cronTask.delete")),1)],8,zf)],512),[[es,U.value===Y.id]])],2)])],8,Df))),128))]))])])])):B("",!0)]),_:1})])),k(Pf,{modelValue:S.value,"onUpdate:modelValue":V[4]||(V[4]=Y=>S.value=Y),task:$.value,onSave:z},null,8,["modelValue","task"]),(h(),oe(Ye,{to:"body"},[k(Ue,{name:"modal"},{default:Ie(()=>{var Y,L,j,G;return[y.value?(h(),g("div",{key:0,class:"modal-overlay",onClick:N},[o("div",{class:"confirm-modal",onClick:V[5]||(V[5]=me(()=>{},["stop"]))},[o("div",Jf,[k(r(P),{icon:"carbon:warning",class:"warning-icon"}),o("h3",null,c(O.$t("cronTask.deleteConfirm")),1)]),o("div",Gf,[o("p",null,c(O.$t("cronTask.deleteConfirmMessage",{taskName:((Y=u.value)==null?void 0:Y.cronName)||((L=u.value)==null?void 0:L.planDesc)||""})),1)]),o("div",Kf,[o("button",{class:"confirm-btn cancel-btn",onClick:N},c(O.$t("common.cancel")),1),o("button",{class:"confirm-btn delete-btn",onClick:A,disabled:_.value===((j=u.value)==null?void 0:j.id)},[k(r(P),{icon:_.value===((G=u.value)==null?void 0:G.id)?"carbon:loading":"carbon:trash-can"},null,8,["icon"]),ee(" "+c(O.$t("cronTask.delete")),1)],8,Xf)])])])):B("",!0)]}),_:1})])),(h(),oe(Ye,{to:"body"},[k(Ue,{name:"modal"},{default:Ie(()=>[T.value?(h(),g("div",{key:0,class:"modal-overlay",onClick:F},[o("div",{class:"confirm-modal create-options-modal",onClick:V[6]||(V[6]=me(()=>{},["stop"]))},[o("div",Yf,[k(r(P),{icon:"carbon:time",class:"create-icon"}),o("h3",null,c(O.$t("cronTask.createTask")),1)]),o("div",Qf,[o("p",null,c(O.$t("cronTask.selectCreateMethod")),1),o("div",Zf,[o("button",{class:"create-option-btn jmanus-btn",onClick:J},[k(r(P),{icon:"carbon:ai-status"}),o("div",ev,[o("span",tv,c(O.$t("cronTask.createWithJmanus")),1),o("span",sv,c(O.$t("cronTask.createWithJmanusDesc")),1)])]),o("button",{class:"create-option-btn manual-btn",onClick:K},[k(r(P),{icon:"carbon:edit"}),o("div",ov,[o("span",nv,c(O.$t("cronTask.createManually")),1),o("span",av,c(O.$t("cronTask.createManuallyDesc")),1)])])])]),o("div",lv,[o("button",{class:"confirm-btn cancel-btn",onClick:F},c(O.$t("common.cancel")),1)])])])):B("",!0)]),_:1})]))],64))}}),iv=ue(rv,[["__scopeId","data-v-a90a3961"]]),cv={class:"direct-page"},dv={class:"direct-chat"},uv={class:"chat-header"},pv={class:"header-actions"},mv=["title"],hv=["title"],fv=["title"],vv=["title"],gv={class:"chat-content"},bv=["title"],yv={class:"message-content"},_v=de({__name:"index",setup(n){const e=Ls(),t=os(),s=ns(),{t:a}=$e(),{message:l}=Hs(),i=M(""),p=M(""),v=M(),d=M(),m=M(),_=M(),I=M(!1),U=M(!1),S=M(null),$=M(!1),y=M(50),u=M(!1),T=M(0),w=M(0),E=ce(()=>{if(W.isCollapsed)return y.value;let L=26;_.value&&_.value.sidebarWidth!==void 0&&(L=_.value.sidebarWidth);const j=100-L;return Math.max(20,Math.min(j,y.value))});Se(()=>{if(console.log("[Direct] onMounted called"),console.log("[Direct] taskStore.currentTask:",s.currentTask),console.log("[Direct] taskStore.hasUnprocessedTask():",s.hasUnprocessedTask()),Re.setEventCallbacks({onPlanUpdate:j=>{console.log("[Direct] Plan update event received for rootPlanId:",j),A(j)&&(console.log("[Direct] Processing plan update for current rootPlanId:",j),d.value&&typeof d.value.handlePlanUpdate=="function"?(console.log("[Direct] Calling chatRef.handlePlanUpdate with rootPlanId:",j),d.value.handlePlanUpdate(j)):console.warn("[Direct] chatRef.handlePlanUpdate method not available"),v.value&&typeof v.value.updateDisplayedPlanProgress=="function"?(console.log("[Direct] Calling rightPanelRef.updateDisplayedPlanProgress with rootPlanId:",j),v.value.updateDisplayedPlanProgress(j)):console.warn("[Direct] rightPanelRef.updateDisplayedPlanProgress method not available"))},onPlanCompleted:j=>{if(console.log("[Direct] Plan completed event received for rootPlanId:",j),!!A(j)){if(console.log("[Direct] Processing plan completion for current rootPlanId:",j),d.value&&typeof d.value.handlePlanCompleted=="function"){const G=Re.getCachedPlanRecord(j);G&&G.completed?G.summary&&G.summary.trim().length>0?(console.log("[Direct]  Plan details are valid and complete from polling cache, updating UI"),d.value.handlePlanCompleted(G)):(console.warn("[Direct]  Plan completed but summary is empty, still proceeding with available data"),d.value.handlePlanCompleted(G)):(console.warn("[Direct]  Plan details incomplete in cache, attempting API fallback"),yt.getDetails(j).then(re=>{console.log("[Direct]  Got fresh details from API:",re),re&&re.completed?(console.log("[Direct] Fresh details from API are valid, updating UI"),Re.setCachedPlanRecord(j,re),d.value.handlePlanCompleted(re)):(console.warn("[Direct]  API details also incomplete, using best available data"),d.value.handlePlanCompleted(G??{planId:j}))}).catch(re=>{console.error("[Direct] API call failed (likely record deleted), using cached data:",re),d.value.handlePlanCompleted(G??{planId:j})}))}else console.warn("[Direct] chatRef.handlePlanCompleted method not available");S.value=null,console.log("[Direct] 🧹 Cleared currentRootPlanId after plan completion"),m.value&&typeof m.value.resetSession=="function"&&(console.log("[Direct] 🧹 Calling inputRef.resetSession to clear sessionPlanId"),m.value.resetSession())}},onDialogRoundStart:j=>{console.log("[Direct] Dialog round start event received for rootPlanId:",j),S.value=j,console.log("[Direct] Set currentRootPlanId to:",j),d.value&&typeof d.value.handleDialogRoundStart=="function"?(console.log("[Direct] Calling chatRef.handleDialogRoundStart with planId:",j),d.value.handleDialogRoundStart(j)):console.warn("[Direct] chatRef.handleDialogRoundStart method not available")},onChatInputClear:()=>{console.log("[Direct] Chat input clear event received"),H()},onChatInputUpdateState:j=>{if(console.log("[Direct] Chat input update state event received for rootPlanId:",j),!A(j,!0))return;const G=Re.getCachedUIState(j);G&&R(G.enabled,G.placeholder)},onPlanError:j=>{d.value.handlePlanError(j)}}),console.log("[Direct] Event callbacks registered to planExecutionManager"),W.loadPlanTemplateList(),s.hasUnprocessedTask()&&s.currentTask){const j=s.currentTask.prompt;console.log("[Direct] Found unprocessed task from store:",j),s.markTaskAsProcessed(),ge(async()=>{try{console.log("[Direct] Calling handleChatSendMessage with taskContent:",j),await N({input:j})}catch(G){console.warn("[Direct] handleChatSendMessage failed, falling back to prompt:",G),i.value=j}})}else{const j=s.getAndClearTaskToInput();j?(p.value=j,console.log("[Direct] Setting inputOnlyContent for input only:",p.value)):(i.value=e.query.prompt||"",console.log("[Direct] Received task from URL:",i.value),console.log("[Direct] No unprocessed task in store"))}const L=localStorage.getItem("directPanelWidth");L&&(y.value=parseFloat(L)),console.log("[Direct] Final prompt value:",i.value),p.value&&ge(()=>{m.value&&typeof m.value.setInputValue=="function"&&(m.value.setInputValue(p.value),console.log("[Direct] Set input value:",p.value),p.value="")}),window.addEventListener("plan-execution-requested",j=>{console.log("[DirectView] Received plan-execution-requested event:",j.detail),O(j.detail)})}),pe(()=>s.currentTask,L=>{if(console.log("[Direct] Watch taskStore.currentTask triggered, newTask:",L),L&&!L.processed){const j=L.prompt;s.markTaskAsProcessed(),console.log("[Direct] Received new task from store:",j),ge(async()=>{try{console.log("[Direct] Directly executing new task via handleChatSendMessage:",j),await N({input:j})}catch(G){console.warn("[Direct] handleChatSendMessage failed for new task:",G)}})}else console.log("[Direct] Task is null or already processed, ignoring")},{immediate:!1}),pe(()=>i.value,(L,j)=>{console.log("[Direct] prompt value changed from:",j,"to:",L)},{immediate:!1}),pe(()=>s.taskToInput,L=>{console.log("[Direct] Watch taskStore.taskToInput triggered, newTaskToInput:",L),L!=null&&L.trim()&&(console.log("[Direct] Setting input value from taskToInput:",L),ge(()=>{m.value&&typeof m.value.setInputValue=="function"&&(m.value.setInputValue(L.trim()),console.log("[Direct] Input value set from taskToInput watch:",L.trim()),s.getAndClearTaskToInput())}))},{immediate:!1}),_e(()=>{console.log("[Direct] onUnmounted called, cleaning up resources"),S.value=null,Re.cleanup(),document.removeEventListener("mousemove",q),document.removeEventListener("mouseup",z),window.removeEventListener("plan-execution-requested",L=>{O(L.detail)})});const f=L=>{u.value=!0,T.value=L.clientX,w.value=y.value,document.addEventListener("mousemove",q),document.addEventListener("mouseup",z),document.body.style.cursor="col-resize",document.body.style.userSelect="none",L.preventDefault()},q=L=>{if(!u.value)return;const j=window.innerWidth,re=(L.clientX-T.value)/j*100;let Ce=w.value+re;Ce=Math.max(20,Math.min(80,Ce)),y.value=Ce},z=()=>{u.value=!1,document.removeEventListener("mousemove",q),document.removeEventListener("mouseup",z),document.body.style.cursor="",document.body.style.userSelect="",localStorage.setItem("directPanelWidth",y.value.toString())},Z=()=>{y.value=50,localStorage.setItem("directPanelWidth","50")},A=(L,j=!1)=>!S.value||L===S.value||j&&(L==="ui-state"||L==="error")?!0:(console.log("[Direct] Ignoring event for non-current rootPlanId:",L,"current:",S.value),!1),N=async L=>{var G,re,Ce,He,We,ze,Je,Ge,Ke;let j=null;try{console.log("[DirectView] Processing send-message event:",L);const Te=(G=d.value)==null?void 0:G.addMessage("user",L.input);L.attachments&&Te&&((re=d.value)==null||re.updateMessage(Te.id,{attachments:L.attachments})),j=(Ce=d.value)==null?void 0:Ce.addMessage("assistant","",{thinking:a("chat.thinkingProcessing")}),j&&((He=d.value)==null||He.startStreaming(j.id));const{DirectApiService:nt}=await Bs(async()=>{const{DirectApiService:Pe}=await Promise.resolve().then(()=>Ih);return{DirectApiService:Pe}},void 0);console.log("[DirectView] Calling DirectApiService.sendMessageWithDefaultPlan");const ie=await nt.sendMessageWithDefaultPlan(L);console.log("[DirectView] API response received:",ie),ie.planId&&j?((We=d.value)==null||We.updateMessage(j.id,{thinking:a("chat.planningExecution"),planExecution:{currentPlanId:ie.planId,rootPlanId:ie.planId,status:"running"}}),S.value=ie.planId,console.log("[DirectView] Set currentRootPlanId to:",ie.planId),Re.handlePlanExecutionRequested(ie.planId,L.input),console.log("[DirectView] Started polling for plan execution updates")):j&&((ze=d.value)==null||ze.updateMessage(j.id,{content:ie.message||ie.result||"No response received from backend"}),(Je=d.value)==null||Je.stopStreaming(j.id))}catch(Te){console.error("[DirectView] Send message failed:",Te),(Ge=d.value)==null||Ge.addMessage("assistant",`Error: ${(Te==null?void 0:Te.message)||"Failed to send message"}`),j&&((Ke=d.value)==null||Ke.stopStreaming(j.id))}},x=async L=>{console.log("[DirectView] Send message from input:",JSON.stringify(L)),await N(L)},H=()=>{console.log("[DirectView] Input cleared"),m.value&&typeof m.value.clear=="function"&&m.value.clear()},b=()=>{console.log("[DirectView] Input focused")},R=(L,j)=>{console.log("[DirectView] Input state updated:",L,j),U.value=!L},J=L=>{console.log("[DirectView] Step selected:",L),v.value&&typeof v.value.handleStepSelected=="function"?(console.log("[DirectView] Forwarding step selection to right panel:",L),v.value.handleStepSelected(L)):console.warn("[DirectView] rightPanelRef.handleStepSelected method not available")},K=(L,j,G,re)=>{console.log("[DirectView] Sub plan step selected:",{parentPlanId:L,subPlanId:j,stepIndex:G,subStepIndex:re}),v.value&&typeof v.value.handleSubPlanStepSelected=="function"?(console.log("[DirectView] Forwarding sub plan step selection to right panel:",{parentPlanId:L,subPlanId:j,stepIndex:G,subStepIndex:re}),v.value.handleSubPlanStepSelected(L,j,G,re)):console.warn("[DirectView] rightPanelRef.handleSubPlanStepSelected method not available")},F=()=>{console.log("[DirectView] Plan mode button clicked"),W.toggleSidebar(),console.log("[DirectView] Sidebar toggled, isCollapsed:",W.isCollapsed)},D=()=>{t.push("/home")},X=()=>{t.push("/configs")},O=async L=>{var re,Ce,He,We,ze,Je,Ge,Ke,Te,nt;if(console.log("[DirectView] Plan execution requested:",L),I.value){console.log("[DirectView] Plan execution already in progress, ignoring request");return}I.value=!0;let j=!1,G=null;try{console.log("[DirectView] Adding messages for plan execution:",L.title),(re=d.value)==null||re.addMessage("user",L.title),j=!0,G=(Ce=d.value)==null?void 0:Ce.addMessage("assistant","",{thinking:a("chat.planningExecution")}),G&&((He=d.value)==null||He.startStreaming(G.id),console.log("[DirectView] Added assistant message for plan execution:",G.id))}catch(ie){console.warn("[DirectView] Failed to add messages:",ie)}try{const ie=(We=L.planData)==null?void 0:We.planTemplateId;if(!ie)throw new Error(a("direct.planTemplateIdNotFound"));console.log("[Direct] Executing plan with templateId:",ie,"params:",L.params),console.log("[Direct] About to call PlanActApiService.executePlan");const Pe=L.uploadedFiles||[],_t=L.uploadKey||void 0;console.log("[Direct] 🔍 DEBUG - InputArea uploadedFiles:",Pe),console.log("[Direct] 🔍 DEBUG - InputArea uploadKey:",_t),console.log("[Direct] Executing with uploaded files:",(Pe==null?void 0:Pe.length)??0),console.log("[Direct] Executing with replacement params:",L.replacementParams);let we;if((ze=L.params)!=null&&ze.trim()?(console.log("[Direct] Calling executePlan with rawParam:",L.params.trim()),we=await Ze.executePlan(ie,L.params.trim(),Pe,L.replacementParams,_t)):(console.log("[Direct] Calling executePlan without rawParam"),we=await Ze.executePlan(ie,void 0,Pe,L.replacementParams,_t)),console.log("[Direct] Plan execution API response:",we),we.planId&&G)console.log("[Direct] Got planId from response:",we.planId,"starting plan execution"),(Je=d.value)==null||Je.updateMessage(G.id,{thinking:a("chat.planningExecution"),planExecution:{currentPlanId:we.planId,rootPlanId:we.planId,status:"running"}}),S.value=we.planId,console.log("[Direct] Set currentRootPlanId to:",we.planId),console.log("[Direct] Delegating plan execution to planExecutionManager"),Re.handlePlanExecutionRequested(we.planId,L.title);else throw console.error("[Direct] No planId in response:",we),new Error(a("direct.executionFailedNoPlanId"))}catch(ie){console.error("[Direct] Plan execution failed:",ie),console.error("[Direct] Error details:",{message:ie.message,stack:ie.stack}),S.value=null;try{console.log("[Direct] Adding error messages to chat"),j||(Ge=d.value)==null||Ge.addMessage("user",L.title),G?((Ke=d.value)==null||Ke.updateMessage(G.id,{content:`${a("direct.executionFailed")}: ${ie.message||a("common.unknownError")}`,thinking:void 0}),(Te=d.value)==null||Te.stopStreaming(G.id)):(nt=d.value)==null||nt.addMessage("assistant",`${a("direct.executionFailed")}: ${ie.message||a("common.unknownError")}`)}catch(Pe){console.error("[Direct] Failed to add error messages:",Pe),alert(`${a("direct.executionFailed")}: ${ie.message||a("common.unknownError")}`)}}finally{console.log("[Direct] Plan execution finished, resetting isExecutingPlan flag"),I.value=!1}},V=()=>{d.value.showMemory()},Y=()=>{xe.clearMemoryId(),d.value.newChat()};return(L,j)=>(h(),g("div",cv,[o("div",dv,[k(Mi,{ref_key:"sidebarRef",ref:_,onPlanExecutionRequested:O},null,512),o("div",{class:"left-panel",style:qe({width:E.value+"%"})},[o("div",uv,[o("button",{class:"back-button",onClick:D},[k(r(P),{icon:"carbon:arrow-left"})]),o("h2",null,c(L.$t("conversation")),1),o("div",pv,[k(Ws),o("button",{class:"config-button",onClick:Y,title:L.$t("memory.newChat")},[k(r(P),{icon:"carbon:add",width:"20"})],8,mv),o("button",{class:"config-button",onClick:X,title:L.$t("direct.configuration")},[k(r(P),{icon:"carbon:settings-adjust",width:"20"})],8,hv),o("button",{class:"cron-task-btn",onClick:j[0]||(j[0]=G=>$.value=!0),title:L.$t("cronTask.title")},[k(r(P),{icon:"carbon:alarm",width:"20"})],8,fv),o("button",{class:"cron-task-btn",onClick:j[1]||(j[1]=G=>r(xe).toggleSidebar()),title:L.$t("memory.selectMemory")},[k(r(P),{icon:"carbon:calendar",width:"20"})],8,vv)])]),o("div",gv,[k(Uh,{ref_key:"chatRef",ref:d,mode:"direct","initial-prompt":i.value||"",onStepSelected:J,onSubPlanStepSelected:K},null,8,["initial-prompt"])]),(h(),oe(Vh,{key:L.$i18n.locale,ref_key:"inputRef",ref:m,disabled:U.value,placeholder:U.value?r(a)("input.waiting"):r(a)("input.placeholder"),"initial-value":i.value,onSend:x,onClear:H,onFocus:b,onUpdateState:R,onPlanModeClicked:F},null,8,["disabled","placeholder","initial-value"]))],4),o("div",{class:"panel-resizer",onMousedown:f,onDblclick:Z,title:L.$t("direct.panelResizeHint")},j[3]||(j[3]=[o("div",{class:"resizer-line"},null,-1)]),40,bv),k(Fu,{ref_key:"rightPanelRef",ref:v,style:qe({width:100-y.value+"%"}),"current-root-plan-id":S.value},null,8,["style","current-root-plan-id"])]),k(iv,{modelValue:$.value,"onUpdate:modelValue":j[2]||(j[2]=G=>$.value=G)},null,8,["modelValue"]),k(Ic,{onMemorySelected:V}),r(l).show?(h(),g("div",{key:0,class:se(["message-toast",r(l).type])},[o("div",yv,[o("span",null,c(r(l).text),1)])],2)):B("",!0)]))}}),zv=ue(_v,[["__scopeId","data-v-35690d5f"]]);export{zv as default};
